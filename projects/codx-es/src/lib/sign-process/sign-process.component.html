<!--
<codx-views
  #base
  funcID="EST11"
  [showToolBar]="true"
  service="ES"
  assemblyName="ES"
  entityName="EP_Bookings"
  predicate="ResourceType=@0"
  dataValue="1"
  [views]="views"
  [button]="button"
  (buttonClick)="click($event)"
  [moreFuncs]="moreFunc"
  idField="RecID"
  className="BookingsBusiness"
  method="GetEventsAsync"
  (requestEnded)="closeEditForm($event)"
>
</codx-views> -->
<!-- <div class="d-flex mb-3">
  <div class="codx_e-header col-4">
    <div class="d-flex align-items-center btn-tabs">
      <button
        class="btn btn-white text-dark me-1"
        [class.active]="task_View_Stt === '1'"
        (click)="clickChangeTaskViewStatus('1')"
      >
        <i class="icon-format_list_numbered icon-16"></i>
        <span class="ms-2 fw-bold">Mới tạo</span>
      </button>
      <button
        class="btn btn-white text-dark me-1"
        [class.active]="task_View_Stt === '2'"
        (click)="clickChangeTaskViewStatus('2')"
      >
        <i class="icon-spellcheck icon-16"></i>
        <span class="ms-2 fw-bold">Chờ duyệt</span>
      </button>
      <button
        class="btn btn-white text-dark me-1"
        [class.active]="task_View_Stt === '3'"
        (click)="clickChangeTaskViewStatus('3')"
      >
        <i class="icon-download_done icon-16"></i>
        <span class="ms-2 fw-bold">Hoàn tất</span>
      </button>
    </div>
    <div class="tab-pane fade show active" id="tab_1" role="tabpanel">

      <div class="items tab-horizone">
        <div class="codx_e-container">
          <div class="wmd-content mt-2">
            <codx-listview
              [itemTemplate]="taskItem"
              #listview
              [autoLoad]="autoLoad"
              [entityName]="'ES_SignFiles'"
              [entityPer]="'ES_SignFiles'"
              formName="SignFiles"
              gridViewName="grvSignFiles"
              [method]="'GetAsync'"
              [assemblyName]="'ES'"
              [className]="'SignFilesBusiness'"
              predicate="ApproveStatus=@0"
              [funcId]=""
              [dataValue]="task_View_Stt"
              pageSize="20"
              type="listView"
              (changeRowSelected)="changeItemDetail($event)"
              [selectFirst]="true"
              groupBy="createdOn"
            >
            </codx-listview>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-8">
    <ng-container
      *ngTemplateOutlet="signFileDetail"
      class="signFileDetail"
    ></ng-container>
  </div>
</div>

<ng-template #taskItem let-item>
  <div
    class="d-flex flex-grow-1 p-4 vmd-items active"
    (click)="changeItemDetail(item)"
  >
    <div class="symbol symbol-35px symbol-circle me-4">
      <codx-img #image objectId="ADMIN" objectType="AD_Users"></codx-img>
    </div>
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex align-items-center justify-content-between">
        <div class="text-dark fw-bold fs-36">
          {{ (item?.title).toUpperCase() }}
        </div>
        <div class="d-flex flex-center" *ngIf="item?.priority ? true : false">
          <span
            class="badge badge-md"
            [style.background-color]="
              item?.priority | vll: 'L0186':'color' | async
            "
          >
            {{ item ? (item.priority | vll: "VL003":"text" | async) : "" }}
          </span>
          <span
            class="icon-flag ms-1"
            [style.color]="item?.priority | vll: 'L0186':'color' | async"
          ></span>
        </div>
      </div>
      <div class="text-dark">
        {{ item?.abstract }}
      </div>
      <div class="d-flex justify-content-between">
        <div class="d-flex align-items-center mt-1">
          <div
            class="badge badge-md me-3"
            [style.background-color]="
              item.approveStatus | vll: 'L0186':'color' | async
            "
          >
            {{ item.approveStatus | vll: "ES003":"text" | async }}
          </div>
          <div class="text-gray-600 fs-7 icon-calendar">
            {{ item.createdOn | date: "dd/MM/yyyy" }}
          </div>
        </div>
        <div class="symbol symbol-35px symbol-circle me-4">
          <codx-img #image objectId="ADMIN" objectType="AD_Users"></codx-img>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #signFileDetail class="task-info">
  <div class="">
    <div class="vmd-detail">
      <div class="d-flex justify-content-end flex-grow-1 position-relative">
        <div>
          <div class="send-request position-relative" (click)="sendToApprove()">
            <button class="d-flex justify-content-between" *ngIf="canRequest">
              <div class="icon-forward icon"></div>
              <span>Gửi duyệt</span>
            </button>
          </div>
          <div class="position-absolute w-100">
            <span
              class="badge badge-square badge-md rounded"
              [style.background-color]="
                item_Detail
                  ? (item_Detail.priority | vll: 'L0186':'color' | async)
                  : ''
              "
            >
              {{
                item_Detail
                  ? (item_Detail.priority | vll: "VL003":"text" | async)
                  : ""
              }}
            </span>
          </div>
        </div>
        <div
          class="dropdown"
          (mouseover)="changeNavState(true)"
          (mouseout)="changeNavState(false)"
        >
          <button
            class="btn btn-icon btn-xs h-20px"
            type="button"
            id="dropdownMenuButton"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <span class="icon-more_horiz icon-18"></span>
          </button>
          <div
            class="dropdown-menu position-absolute test"
            [class.show]="openNav"
            aria-labelledby="dropdownMenuButton"
          >
            <a class="dropdown-item" (click)="editSignFile($event)">
              <div class="d-flex align-items-center">
                <span class="icon-edit text-warning icon-18"></span>
                <span class="ms-3">Edit</span>
              </div>
            </a>
            <a class="dropdown-item" (click)="viewDetailSignFile($event)">
              <div class="d-flex align-items-center">
                <span class="icon-list_alt text-primary icon-18"></span>
                <span class="ms-3">Watch Detail</span>
              </div>
            </a>
            <a class="dropdown-item" (click)="removeSignFile($event)">
              <div class="d-flex align-items-center">
                <span class="icon-clear text-danger icon-18"></span>
                <span class="ms-3">Remove</span>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mb-1">
    <div class="d-flex flex-grow-1 mb-2">
      <div class="d-flex flex-column flex-grow-1">
        <h1 class="text-dark fw-bold fs-66">
          {{ item_Detail ? item_Detail.title : "" }}
        </h1>
      </div>
    </div>
  </div>
  <div class="d-flex flex-column flex-grow-1">
    <div class="d-flex symbol symbol-50px symbol-circle mb-2">
      <codx-img
        #image
        objectId="{{ item_Detail ? item_Detail.employeeID : '' }}"
        objectType="AD_Users"
      >
      </codx-img>
      <div class="text-dark fw-bold fs-36 ml-4">
        {{ item_Detail?.owner ? item_Detail?.owner : "" }}
        <div class="fw-bold me-6">
          {{ item_Detail ? item_Detail.bUID : "" }}
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex flex-grow-1 mb-2">
    <div class="symbol symbol-20px me-4 icon-apartment"></div>
    <div class="d-flex flex-column flex-grow-1">
      <div class="text-dark fw-bold fs-6">
        {{
          item_Detail?.deptID
            ? (item_Detail?.deptID | vll: "Depts":"text" | async)
            : ""
        }}
      </div>
    </div>
  </div>
  <div class="d-flex mt-1">
    <div class="d-flex me-6">
      <span class="fw-bold me-1">Ngày yêu cầu:</span>
      <span class="text-gray-600">
        {{
          item_Detail
            ? (item_Detail.createdOn | date: "dd/MM/yyyy")
            : "dd/MM/yyyy"
        }}
      </span>
    </div>
    <div class="d-flex me-6">
      <span class="fw-bold me-1">Ngày hết hạn:</span>
      <span class="text-gray-600">
        {{
          item_Detail?.permission
            ? (item_Detail.permissions?.expiredOn | date: "dd/MM/yyyy")
            : "dd/MM/yyyy"
        }}
      </span>
    </div>
    <div class="d-flex align-items-center text-dark me-6">
      <span class="me-1">Ưu tiên:</span>
      <span
        class="icon-flag icon-16 me-2"
        [style.color]="
          item_Detail
            ? (item_Detail?.priority | vll: 'L0186':'color' | async)
            : ''
        "
      ></span>
      <span class="text-gray-600">
        {{
          item_Detail
            ? (item_Detail?.priority | vll: "L0186":"text" | async)
            : ""
        }}
      </span>
    </div>
  </div>
  <div class="d-flex mt-1">
    <div class="d-flex align-items-center text-dark me-6">
      <span class="me-1">Số tham chiếu:</span>
      <span class="text-gray-600">
        {{ item_Detail ? item_Detail?.refNo : "" }}
      </span>
    </div>
    <div class="d-flex me-6">
      <span class="fw-bold me-1">Ngày tham chiếu:</span>
      <span class="text-gray-600">
        {{
          item_Detail
            ? (item_Detail?.refDate | date: "dd/MM/yyyy")
            : "dd/MM/yyyy"
        }}
      </span>
    </div>
  </div>
  <div>
    <div
      class="symbol symbol-20px icon-file-pdf me-4"
      *ngFor="let file of item_Detail?.files"
    >
      {{ file?.fileName }}
    </div>
  </div>
  <div class="codx_e-header" [class.active]="true">
    <div class="d-flex align-items-center btn-tabs">
      <button
        class="btn btn-white text-dark me-1"
        [class.active]="item_Detail_Stt === '1'"
        (click)="clickChangeItemViewStatus('1', item_Detail?.recID)"
      >
        <i class="icon-description icon-16"></i>
        <span class="ms-2 fw-bold">Mô tả ngắn gọn</span>
      </button>
      <button
        class="btn btn-white text-dark me-1"
        [class.active]="item_Detail_Stt === '2'"
        (click)="clickChangeItemViewStatus('2', item_Detail?.recID)"
      >
        <i class="icon-format_list_numbered icon-16"></i>
        <span class="ms-2 fw-bold">Công việc</span>
      </button>
      <button
        class="btn btn-white text-dark me-1"
        [class.active]="item_Detail_Stt === '3'"
        (click)="clickChangeItemViewStatus('3', item_Detail?.recID)"
      >
        <i class="icon-people_alt icon-16"></i>
        <span class="ms-2 fw-bold">Qui trình duyệt</span>
      </button>
    </div>
  </div>

  <div class="summary mt-2" *ngIf="item_Detail_Stt == '1'">
    {{ item_Detail?.abstract }}
  </div>
  <div class="list_Of_Jobs mt-2" *ngIf="item_Detail_Stt == '2'">
    <ng-container>
      <codx-treeview
        #treeAdd
        id="treeAdd"
        [data]="taskViews"
        [showSearch]="false"
        [itemTemplate]="taskViewDetail"
        [autoLoad]="false"
        [isOutput]="true"
        [isLoadChild]="false"
      >
      </codx-treeview>
    </ng-container>
  </div>
  <div class="cdx-timeline-vertical mt-2" *ngIf="item_Detail_Stt == '3'">
    <div class="timeline timeline-3">
      <div class="timeline-items">
        <div
          class="timeline-item"
          *ngFor="let part of processes; let index = index"
        >
          <div class="timeline-media d-flex flex-column flex-grow-1">
            <div class="stepper-label">
              <h3 class="stepper-title">
                {{ index + 1 }}
              </h3>
            </div>
          </div>
          <div class="title-space d-flex flex-row flex-grow-1 mr-2">
            <div class="title">
              {{ (part.stepType | vll: "ES002":"text" | async).toUpperCase() }}
            </div>
            <div
              class="icon-check_circle"
              *ngIf="part.isActived.length != 0"
            ></div>
          </div>
          <div class="approvers_Info w-100">
            <div
              *ngFor="let approver of part.approvers"
              class="approver_Info d-flex justify-content-around flex-grow-1 w-100"
            >
              <div class="d-flex flex-grow-1">
                <div class="symbol symbol-35px symbol-circle me-4">
                  <codx-img
                    #image
                    objectId="{{approver.approver}}"
                    objectType="AD_Users"
                  >
                  </codx-img>
                </div>
                <div class="approver-info">
                  <span>
                    {{ approver.approverName }}
                  </span>
                  <div class="align-items-center me-1">
                    {{ approver.approverPosition }}
                  </div>
                  <div class="align-items-center me-1">
                    {{ approver.comment }}
                  </div>
                </div>
              </div>
              <div class="d-flex show-time justify-content-end text-top">
                <div class="time-duration">
                  <span
                    *ngIf="approver.status < 3; else time_activated"
                    class="badge badge-secondary step-status"
                    style.color="white"
                  >
                    {{ approver.duration }}h
                  </span>

                  <ng-template #time_activated>
                    <span
                      class="badge badge-md step-status"
                      [class.badge-primary]="
                        approver.leadtime > approver.duration
                      "
                      [class.badge-danger]="
                        approver.leadtime <= approver.duration
                      "
                    >
                      {{ "2022-06-09T03:40:14.605+00:00" | date: "HH:mm" }} -
                      {{
                        setDate(
                          "2022-06-09T03:40:14.605+00:00",
                          approver.leadtime
                        ) | date: "HH:mm"
                      }}
                    </span>
                  </ng-template>

                  <div *ngIf="approver.approvedOn ? true : false">
                    {{ approver.approvedOn | date: "short" }}
                  </div>
                </div>
                <div class="icon icon-attach">1</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-horizone mt-6">
    <div class="codx_e-header">
      <div class="d-flex align-items-center btn-tabs">
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="item_Detail_Data_Stt === '1'"
          (click)="clickChangeItemDetailDataStatus('1')"
        >
          <i class="icon-history icon-16"></i>
          <span class="ms-2 fw-bold">Lịch sử</span>
        </button>
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="item_Detail_Data_Stt === '2'"
          (click)="clickChangeItemDetailDataStatus('2')"
        >
          <i class="icon-message icon-16"></i>
          <span class="ms-2 fw-bold">Thảo luận</span>
        </button>
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="item_Detail_Data_Stt === '3'"
          (click)="clickChangeItemDetailDataStatus('3')"
        >
          <i class="icon-attach icon-16"></i>
          <span class="ms-2 fw-bold">Đính kèm</span>
        </button>
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="item_Detail_Data_Stt === '4'"
          (click)="clickChangeItemDetailDataStatus('4')"
        >
          <i class="icon-insert_link icon-16"></i>
          <span class="ms-2 fw-bold">Liên kết</span>
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #taskViewDetail let-user>
  <div class="user_Info">
    <div class="d-flex">
      <div class="symbol symbol-35px symbol-circle me-4">
        <codx-img
          #image
          objectId="{{user.owner}}"
          objectType="AD_Users"
        ></codx-img>
      </div>
      <div class="info">
        <h1>
          {{ user.userName }}
        </h1>
        <div>
          {{ user.positionName }}
        </div>
        <div
          *ngIf="
            user.category == '1' || user.category == '3';
            else templatetaskName
          "
        >
          {{ user.memo }}
        </div>
        <ng-template #templatetaskName>
          <div>
            {{ user.taskName }}
          </div>
        </ng-template>
        <div class="icons d-flex">
          <a class="icon icon-person">
            {{ user.items?.length }}
          </a>
          <a class="icon icon-sms">
            {{ user.comments || 0 }}
          </a>
          <a class="icon icon-attachment">
            {{ user.attachments || 0 }}
          </a>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #content let-modal>
  <div class="modal-header" style="height: 20px">
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex justify-content-between align-items-center">
        <h4 id="modal-basic-title"></h4>
        <button
          type="button"
          class="btn btn-xs btn-icon btn-light btn-hover-primary"
          aria-label="Close"
          (click)="modal.dismiss()"
        >
          <span class="icon-close icon-20 text-dark text-hover-primary"></span>
        </button>
      </div>
    </div>
  </div>

  <app-edit-sign-file #editSFile></app-edit-sign-file>
</ng-template> -->
