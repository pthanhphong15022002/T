<codx-form #form [dialog]="dialog" [headerText]="headerText" [subHeaderText]="subHeaderText" [body]="body"
  [footer]="footer" *ngIf="isAfterRender">
  <ng-template #body>
    <div class="mt-3">
      <div class="fw-bolder codx-label">
        <codx-label default="Icon & màu sắc" name="lblIconColor" [formModel]="form.formModel"></codx-label>
      </div>
      <div class="d-block">
        <codx-input class="btn btn-icon btn-primary btn-icon btn-icon-md btn-circle me-5" type="vllicon"
          refValue="L1470" field="icon" [crrValue]="dialogCategory.value.icon" (valueChange)="valueChange($event)">
        </codx-input>
        <button type="button" class="btn btn-clean btn-sm btn-icon btn-icon-md ms-2" data-dismiss="modal">
          <i class="icon-color_lens text-primary text-hover-primary-dark icon-24"></i>
        </button>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-8">
        <codx-label class="fw-bolder" default="Tên phân loại" fiedName="CategoryName" [formModel]="form.formModel">
        </codx-label>
        <codx-input type="text" name="text" field="categoryName" ngDefaultControl cssClass="form-control"
          [Group]="dialogCategory" ControlName="categoryName">
        </codx-input>
      </div>
      <div class="col-4">
        <codx-label class="fw-bolder" default="Mã phân loại" fiedName="CategoryID" [formModel]="form.formModel">
        </codx-label>
        <codx-input type="text" name="text" field="categoryID" ngDefaultControl cssClass="form-control"
          [Group]="dialogCategory" ControlName="categoryID" disabled="true">
        </codx-input>
      </div>
    </div>
    <div class="d-flex align-items-center mt-3">
      <codx-input #checkbox type="switch" id="switch" [checked]="dialogCategory.value.eSign" labelPosition="After"
        field="eSign" class="test-switch" (valueChange)="valueChange($event)">
      </codx-input>
      <label class="ms-2">
        <codx-label class="fw-bolder" fiedName="ESign" default="Chữ ký số" [formModel]="form.formModel"></codx-label>
      </label>
    </div>
    <div class="row mt-3">
      <div class="col-6">
        <codx-label class="fw-bolder" default="Loại chữ kí" fiedName="SignatureType" [formModel]="form.formModel">
        </codx-label>
        <codx-input type="valuelist" name="valuelist" ngDefaultControl [refValue]="cbxName['SignatureType']"
          [crrValue]="dialogCategory.value.signatureType" field="signatureType" (valueChange)="valueChange($event)">
        </codx-input>
      </div>
      <div class="col-6">
      </div>
    </div>
    <div class="mt-3">
      <codx-label class="fw-bolder" default="Ghi chú" fiedName="Note" [formModel]="form.formModel">
      </codx-label>
      <codx-input type="textarea" format="ed2" rows="3" class="test-textarea" field="note" ControlName="note"
        (valueChange)="valueChange($event)" ngDefaultControl [crrValue]="dialogCategory.value.note??''">
      </codx-input>
    </div>
    <div class=" row mt-3">
      <div class="d-flex flex-stack mt-3">
        <div class="fw-bolder text-primary">
          <codx-label default="Đánh số văn bản" fiedName="AutoNumber" [formModel]="form.formModel">
          </codx-label>
        </div>
        <span class="text-end align-items-end">
          <button type="button" class="btn btn-clean btn-sm btn-icon btn-icon-md" data-dismiss="modal"
            (click)="openAutoNumPopup()">
            <i class=" icon-edit-one text-primary text-hover-primary-dark icon-24"></i>
          </button>
        </span>
      </div>
      <div class="col-6">
        <codx-input type="text" name="text" [crrValue]="viewAutoNumber" disabled="true">
        </codx-input>
      </div>
    </div>
    <div class="d-flex flex-stack mt-3">
      <div class="fw-bolder ">
        <codx-label class="text-primary" default="Qui trình duyệt" fiedName="ProcessID" [formModel]="form.formModel">
        </codx-label>
      </div>
      <span class="text-end align-items-end">
        <button type="button" class="btn btn-clean btn-sm btn-icon btn-icon-md" data-dismiss="modal"
          (click)="openPopupApproval()">
          <i class="icon-settings text-primary text-hover-primary-dark icon-24"></i>
        </button>
      </span>
    </div>

    <div class="codx-approval" *ngIf="lstStep.length > 0">
      <ng-container *ngFor="let item of lstStep, let index = index">
        <div class="codx-approval-step step-test pb-1">
          <div class="codx-approval-header d-flex align-items-center">
            <div class="step-number">{{item.stepNo}}</div>
            <div class="step-title text-gray-800 fw-bolder fs-4">{{item.memo}}</div>
            <!-- <div class="badge badge-success badge-sm badge-circle ms-3">
              <span class="icon-check icon-16"></span>
            </div> -->
          </div>
          <div class="codx-approval-content ms-17">
            <ng-container *ngFor="let approver of item.approvers">
              <div class="d-flex align-items-top justify-content-between mb-2">
                <codx-temp-full [imageId]="approver.approver" [imageObjType]="'AD_Users'" [imageWidth]="40"
                  [title]="approver.approverName" [desc]="approver.positionName ?? 'Vị trí công việc'">
                </codx-temp-full>
                <div class="d-flex align-items-center text-center">
                  <div class="ms-6 d-flex">
                    <span class="text-dark">{{item.leadtime}} giờ</span>
                  </div>
                </div>
              </div>
            </ng-container>

          </div>
        </div>
        <div class="codx-approval-step step-signature-temp pb-3" *ngIf="index == lstStep.length-1"></div>
      </ng-container>
      <!-- <div class="codx-approval-step step-test pb-3">
        <div class="codx-approval-header d-flex align-items-center">
          <div class="step-number">1</div>
          <div class="step-title text-gray-800 fw-bold fs-4">KIỂM TRA</div>
          <div class="badge badge-success badge-sm badge-circle ms-3">
            <span class="icon-check icon-16"></span>
          </div>
        </div>
        <div class="codx-approval-content ms-17">

          <div class="d-flex align-items-top justify-content-between mb-2">
            <codx-temp-full [imageId]="'ADMIN'" imageObjType="AD_Users" [imageWidth]="35"
              [title]="'Lê Phạm Hoài Thương'" [desc]="'HR Manager'">
            </codx-temp-full>
            <div class="d-flex align-items-center text-center">
              <div class="ms-6 d-flex">
                <span class="text-dark">45 phút</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="codx-approval-step step-signature-temp pb-3">
        <div class="codx-approval-header d-flex align-items-center">
          <div class="step-number">2</div>
          <div class="step-title text-gray-800 fw-bold fs-4">KÝ NHÁY</div>
        </div>
        <div class="codx-approval-content ms-17">
          <div class="d-flex align-items-top justify-content-between mb-2">
            <codx-temp-full [imageId]="'ADMIN'" imageObjType="AD_Users" [imageWidth]="35"
              [title]="'Lê Phạm Hoài Thương'" [desc]="'HR Manager'">
            </codx-temp-full>
            <div class="d-flex align-items-center text-center">
              <div class="ms-6 d-flex">
                <span class="text-dark">45 phút</span>
              </div>
            </div>
          </div>
          <div class="d-flex align-items-top justify-content-between mb-2">
            <codx-temp-full [imageId]="'ADMIN'" imageObjType="AD_Users" [imageWidth]="35"
              [title]="'Lê Phạm Hoài Thương'" [desc]="'HR Manager'">
            </codx-temp-full>
            <div class="d-flex align-items-center text-center">
              <div class="ms-6 d-flex">
                <span class="text-dark">45 phút</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="codx-approval-step step-signature-temp pb-3">
        <div class="codx-approval-header d-flex align-items-center">
          <div class="step-number">2</div>
          <div class="step-title text-gray-800 fw-bold fs-4">KÝ NHÁY</div>
        </div>
        <div class="codx-approval-content ms-17">
          <div class="d-flex align-items-top justify-content-between mb-2">
            <codx-temp-full [imageId]="'ADMIN'" imageObjType="AD_Users" [imageWidth]="35"
              [title]="'Lê Phạm Hoài Thương'" [desc]="'HR Manager'">
            </codx-temp-full>
            <div class="d-flex align-items-center text-center">
              <div class="ms-6 d-flex">
                <span class="text-dark">45 phút</span>
              </div>
            </div>
          </div>
          <div class="d-flex align-items-top justify-content-between mb-2">
            <codx-temp-full [imageId]="'ADMIN'" imageObjType="AD_Users" [imageWidth]="35"
              [title]="'Lê Phạm Hoài Thương'" [desc]="'HR Manager'">
            </codx-temp-full>
            <div class="d-flex align-items-center text-center">
              <div class="ms-6 d-flex">
                <span class="text-dark">45 phút</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="codx-approval-step step-signature-temp pb-3"></div> -->
    </div>
  </ng-template>
  <ng-template #footer>
    <button class="btn btn-light-primary justify-content-end" (click)="onSaveForm(true)">
      <codx-label default="Lưu" name="lblSave" [formModel]="form.formModel"></codx-label>
    </button>
  </ng-template>
</codx-form>

<!-- <ng-template #editApprovalStep>
  <popup-add-approval-step [transId]="transID" [stepNo]="stepNo" (close)="changeStep($event)"></popup-add-approval-step>
</ng-template> -->
