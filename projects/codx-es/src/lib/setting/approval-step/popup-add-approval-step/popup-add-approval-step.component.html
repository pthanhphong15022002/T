<codx-form [dialog]="dialog" [headerText]="header1" [subHeaderText]="subHeaderText" [body]="body" [footer]="footer"
  [formControl]="dialogApprovalStep" *ngIf="isAfterRender">
  <ng-template #body>
    <div class="codx_tab h-100 pt-5">
      <ejs-tab headerPlacement="Left">
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              <codx-temp-full cardCss="tab-temp" icoCss="icon-info icon-20  me-2" [title]="'Thông tin chung'"
                [subTitle]="">
              </codx-temp-full>
            </ng-template>
            <ng-template #content>
              <div id="rome" class="tabpanel">
                <div class="tab-content">
                  <div class="d-flex flex-column mb-4">
                    <codx-label class="fw-bolder" default="Mô tả" fiedName="StepName" [formModel]="formModel">
                    </codx-label>
                    <codx-input type="text" name="text" ControlName="stepName" [Group]="dialogApprovalStep"
                      placeholder="" class="form-control"></codx-input>
                  </div>
                  <div class="d-flex flex-column mb-4">
                    <div class=" row">
                      <div class="col-6">
                        <codx-label class="fw-bolder" default="Hành động" fiedName="StepType" [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['StepType']" field="stepType"
                          (valueChange)="valueChange($event)" [crrValue]="dialogApprovalStep.value.stepType">
                        </codx-input>
                      </div>
                      <div class="col-4">
                        <codx-label class="fw-bolder" default="Thời gian xử lí (giờ)" fiedName="Leadtime"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="text" ControlName="leadtime" placeholder="0" [Group]="dialogApprovalStep"
                          (valueChange)="valueChange($event)" [crrValue]="parseInt(dialogApprovalStep.value.leadtime)">
                        </codx-input>
                      </div>
                    </div>
                  </div>

                  <div class="d-flex flex-column mb-4">
                    <div class="d-flex justify-content-between align-items-center ">
                      <div class="fw-bolder d-block mb-2">
                        <codx-label class="text-primary" default="Người thực hiện" fiedName="Attendees"
                          [formModel]="formModel">
                        </codx-label>
                      </div>

                      <!-- <span class=" icon-group_add text-primary fs-1">

                      </span> -->
                      <div class="icon-person_add_alt_1 text-hover-primary icon-22 ml-2 mb-2"
                        (click)="testdata(controlShare)">
                      </div>
                      <!-- <codx-input [showInput]="false" [multiple]="true" type="share" refValue="ES014" field="popup"
                        (valueChange)="valueChange($event)">
                      </codx-input> -->

                    </div>
                    <ng-container *ngFor="let item of dialogApprovalStep.value.approvers">
                      <div class="d-flex align-items-center mb-2 w-100">
                        <codx-temp-full cardCss="card-template" *ngIf="item.roleType == 'U'" [imageId]="item.approver"
                          [subTitle]="" [title]="item.approverName"
                          [subTitle]="item.roleType == 'U' ? (item.positionName ?? 'Vị trí công việc') : ''"
                          [status]="lstStep.status" [statusVll]="" [imageObjType]="'AD_Users'" [modeImgs]="false"
                          [titleLine]="3" [formModel]="formModel" (clickMF)="MFClick($event, item)">
                        </codx-temp-full>

                        <codx-temp-full cardCss="card-template" *ngIf="item.roleType != 'U'" [imageSrc]="'./assets/themes/sys/default/img/' +
                          (item.icon ? item.icon : 'share_default.svg')" imgCss="me-4 symbol symbol-40px symbol-circle"
                          [imageWidth]="30" [subTitle]="" [title]="(item.approver| vll:'ES014':'text'|async)"
                          [subTitle]="item.roleType == 'U' ? (item.positionName ?? 'Vị trí công việc') : ''"
                          [status]="lstStep.status" [statusVll]="" [modeImgs]="false" [titleLine]="3"
                          [formModel]="formModel" (clickMF)="MFClick($event, item)">
                        </codx-temp-full>
                      </div>
                    </ng-container>
                  </div>

                  <div class="d-flex flex-column mb-4" *ngIf="dialogApprovalStep.value.approvers?.length > 0">
                    <div class="row">
                      <ng-container *ngFor="let item of lstApproveMode; let index = index">
                        <div class="col-3" *ngIf="dialogApprovalStep.value.approveMode == item.value">
                          <div class="d-flex align-items-center">
                            <codx-input type="radio" [checked]="true" [label]="item.text"
                              [crrValue]="dialogApprovalStep.value.approveMode == item.value ? true : false"
                              name="radio" field="approveMode" class="test-switch"
                              (valueChange)="valueModeChange($event, item)">
                            </codx-input>
                          </div>
                        </div>

                        <div class="col-3" *ngIf="dialogApprovalStep.value.approveMode != item.value">
                          <div class="d-flex align-items-center">
                            <codx-input type="radio" [label]="item.text"
                              [crrValue]="dialogApprovalStep.value.approveMode == item.value ? true : false"
                              name="radio" field="approveMode" class="test-switch"
                              (valueChange)="valueModeChange($event, item)">
                            </codx-input>
                          </div>
                        </div>
                      </ng-container>
                      <!-- <div class="col-4">
                        <div class="d-flex align-items-center">
                          <codx-input type="radio" [checked]="true" label="Duyệt đại diện"
                            [crrValue]="dialogApprovalStep.value.representative" name="radio" field="representative"
                            class="test-switch" (valueChange)="valueChange($event)">
                          </codx-input>

                        </div>
                      </div>
                      <div class="col-4">
                        <div class="d-flex align-items-center">
                          <codx-input name="radio" type="radio" label="Duyêt tuần tự"
                            [crrValue]="dialogApprovalStep.value.sequential" field="sequential" class="test-switch"
                            (valueChange)="valueChange($event)"></codx-input>
                        </div>
                      </div> -->
                    </div>
                  </div>

                  <div class="d-flex flex-column mb-4">
                    <div class="fw-bolder d-block mb-2">
                      <codx-label class="text-primary" default="Đóng góp ý kiến" fiedName="Attendees"
                        [formModel]="formModel">
                      </codx-label>
                    </div>

                    <div class="row">
                      <div class="col-6">
                        <codx-label class="fw-bolder" default="Cho ý kiến khi duyệt" fiedName="ApproveControl"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['ApproveControl']"
                          field="approveControl" (valueChange)="valueChange($event)"
                          [crrValue]="dialogApprovalStep.value.approveControl">
                        </codx-input>
                      </div>
                      <div class="col-6">
                        <codx-label class="fw-bolder" default="Cho ý kiến khi từ chối" fiedName="RejectControl"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['RejectControl']"
                          field="rejectControl" (valueChange)="valueChange($event)"
                          [crrValue]="dialogApprovalStep.value.rejectControl">
                        </codx-input>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <codx-temp-full cardCss="tab-temp" icoCss="icon-rule icon-20  me-2" [title]="'Điều kiện'" [subTitle]="">
              </codx-temp-full>
            </ng-template>
            <ng-template #content>

              <div id="rome" class="tabpanel">
                <div class="tab-content">
                  <div class="d-flex justify-content-between align-items-center mb-4 ">
                    <h4 class="fw-bolder text-gray-800 d-block mb-2">
                      <codx-label default="Người xét duyệt" fiedName="Approvers" [formModel]="formModel">
                      </codx-label>
                    </h4>
                    <!-- <span class=" icon-group_add text-primary fs-1">

                    </span> -->

                  </div>
                </div>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <codx-temp-full cardCss="tab-temp" icoCss="icon-email icon-20  me-2" [title]="'Email/thông báo'"
                [subTitle]="">
              </codx-temp-full>
            </ng-template>
            <ng-template #content>
              <div id="rome" class="tabpanel">
                <div class="tab-content">
                  <ng-container *ngFor="let item of dialogApprovalStep.value.emailTemplates">
                    <div class="d-flex justify-content-between align-items-center" *ngIf="item?.emailType == '11'">
                      <div class="fw-bolder d-block mb-4">
                        <codx-label class="text-primary" default="Thiết lập mẫu email duyệt" [formModel]="formModel"
                          fiedName="lblEmailSubmit">
                        </codx-label>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center" *ngIf="item?.emailType == '21'">
                      <div class="fw-bolder d-block mb-4 mt-5">
                        <codx-label class="text-primary" default="Email yêu cầu hủy kết quả duyệt/yêu cầu"
                          [formModel]="formModel" fiedName="lblEmailReject">
                        </codx-label>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center" *ngIf="item?.emailType == '31'">
                      <div class="fw-bolder d-block mb-4 mt-5">
                        <codx-label class="text-primary" default="Thiết email cảnh báo quá hạn duyệt"
                          [formModel]="formModel" fiedName="lblEmailAlert">
                        </codx-label>
                      </div>
                    </div>
                    <div class="d-flex flex-column mb-4">
                      <div class="row">
                        <div class="col-6">
                          <!-- <codx-label class=" fw-bold" default="Email gửi yêu cầu duyệt" fiedName="Category"
                            [formModel]="formModel">
                          </codx-label> -->
                          <div class="fw-bolder">{{item?.emailType|vll:'ES012':'text'|async}}</div>
                        </div>
                        <div class="col-6">
                          <div class="row">
                            <div class="col-6">
                              <codx-input type="checkbox" label="Thông báo" labelPosition="after" field="isAlert"
                                class="test-check" (valueChange)="valueEmailChange($event, item)"
                                [crrValue]="item?.isAlert == '1'">
                              </codx-input>
                            </div>
                            <div class="col-4">
                              <codx-input type="checkbox" label="Email" labelPosition="after" field="isEmail"
                                class="test-check" (valueChange)="valueEmailChange($event, item)"
                                [crrValue]="item?.isEmail == '1'">
                              </codx-input>
                            </div>
                            <div class="col-2">
                              <div class="icon-email icon-24 ml-2"
                                [ngClass]="item?.isEmail == '1' ? 'text-hover-primary' : 'text-muted'"
                                (click)="openSetupEmail(item)">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                </div>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <codx-temp-full cardCss="tab-temp" icoCss="icon-tune icon-20  me-2" [title]="'Thông tin khác'"
                [subTitle]="">
              </codx-temp-full>
            </ng-template>
            <ng-template #content>
              <div id="rome" class="tabpanel">
                <div class="tab-content">
                  <!-- <div class="d-flex flex-column mb-4">
                    <div class="row">
                      <div class="col-6">
                        <codx-label class="fw-bolder" default="Cảnh báo đến hạn" fiedName="OverdueControl"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['OverdueControl']"
                          field="overdueControl" (valueChange)="valueChange($event)">
                        </codx-input>
                      </div>
                      <div class="col-3">
                        <codx-label class="fw-bolder" default="Thời gian nhắc" fiedName="Reminder"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['Reminder']" field="reminder"
                          (valueChange)="valueChange($event)">
                        </codx-input>
                      </div>
                      <div class="col-3">
                        <codx-label class="fw-bolder" default="Số lần lặp" fiedName="Loops" [formModel]="formModel">
                        </codx-label>
                        <codx-input type="number" name="number" [min]="0" placeholder="0" field="loops"
                          (valueChange)="valueChange($event)">
                        </codx-input>
                      </div>
                    </div>
                  </div> -->
                  <div class="d-flex flex-column mb-4">
                    <div class="row">
                      <div class="col-7">
                        <codx-label class="fw-bolder" default="Xử lí động khi quá hạn" fiedName="OverdueControl"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['OverdueControl']"
                          field="overdueControl" (valueChange)="valueChange($event)"
                          [crrValue]="dialogApprovalStep.value.overdueControl">
                        </codx-input>
                      </div>
                      <!-- <div class="col-3">
                        <codx-label class="fw-bolder" class="fw-bolder" default="Thời gian nhắc" fiedName="Reminder"
                          [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['Reminder']" field="reminder"
                          (valueChange)="valueChange($event)">
                        </codx-input>
                      </div> -->
                      <div class="col-4">
                        <codx-label class="fw-bolder" default="Số lần lặp" fiedName="Loops" [formModel]="formModel">
                        </codx-label>
                        <codx-input type="number" name="number" [min]="0" placeholder="0" field="loops"
                          (valueChange)="valueChange($event)">
                        </codx-input>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column mb-4">
                    <div class="row">
                      <div class="col-7">
                        <codx-label class="fw-bolder" default="Cho phép hủy yêu cầu khi đã duyệt"
                          fiedName="CancelControl" [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['CancelControl']"
                          field="cancelControl" (valueChange)="valueChange($event)"
                          [crrValue]="dialogApprovalStep.value.cancelControl">
                        </codx-input>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex flex-column mb-4">
                    <div class="row">
                      <div class="col-7">
                        <codx-label class="fw-bolder" class="fw-bolder" default="Thay thế vị trí trống"
                          fiedName="AlterApprovers" [formModel]="formModel">
                        </codx-label>
                        <codx-input type="valuelist" name="valuelist" [refValue]="cbxName['AlterApprovers']"
                          field="alterApprovers" (valueChange)="valueChange($event)"
                          [crrValue]="dialogApprovalStep.value.alterApprovers">
                        </codx-input>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </ng-template>
  <ng-template #footer>
    <div class="d-flex justify-content-end">
      <a class="btn btn-primary font-weight-bold" (click)="onSaveForm()">
        <codx-label name="lblSave" default="Lưu" [formModel]="formModel"></codx-label>
      </a>
    </div>
  </ng-template>


  <ng-template #controlShare let-dialog>
    <codx-share [dialog]="dialog" [multiple]="true" (eventApply)="applyShare($event)" [listName]="vllShare">
    </codx-share>
  </ng-template>

</codx-form>


<ng-template>
  <!-- <attachment #attachment type="right" objectType="ES_Signatures" [objectId]="" [functionID]="modelPage.functionID"
    (fileAdded)="fileAdded($event)"></attachment> -->
</ng-template>
