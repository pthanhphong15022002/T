<div class="card-body p-0 codx-card-custom">
  <div class="codx-stepper stepper stepper-pills">
    <div class="stepper-header d-flex flex-wrap flex-stack ps-6">
      <div class="d-flex align-items-center">
        <h2 class="h2-title">
          <div [innerHTML]="data.title"></div>
        </h2>
      </div>
      <div class="d-flex justify-content-end">
        <button
          type="button"
          class="btn btn-sm btn-bg-primary text-inverse-primary me-2 mb-2 min-w-60px rounded-4"
          [disabled]="!canOpenSubPopup"
          (click)="clickOpenPopupADR(1)"
        >
          <codx-vll
            *ngIf="data?.stepType != 'S1' && data?.stepType != 'S2'"
            [name]="'ES002'"
            [value]="data?.stepType"
            [showText]="true"
          >
          </codx-vll>
          <codx-label
            *ngIf="data?.stepType == 'S1' || data?.stepType == 'S2'"
            name="lblApprove"
            [formModel]="formModel"
            default="Ký"
          ></codx-label>
        </button>
        <button
          type="button"
          class="btn btn-sm btn-bg-danger text-inverse-danger me-2 mb-2 min-w-60px rounded-4"
          [disabled]="!canOpenSubPopup"
          (click)="clickOpenPopupADR(2)"
        >
          <codx-label
            name="lblDeny"
            [formModel]="formModel"
            default="Từ chối"
          ></codx-label>
        </button>
        <button
          type="button"
          class="btn btn-sm btn-bg-warning text-inverse-warning me-2 mb-2 min-w-60px rounded-4"
          [disabled]="!canOpenSubPopup"
          (click)="clickOpenPopupADR(3)"
        >
          <codx-label
            name="lblRedo"
            [formModel]="formModel"
            default="Làm lại"
          ></codx-label>
        </button>

        <button
          type="button"
          class="btn btn-sm btn-bg-danger text-inverse-danger me-2 mb-2 min-w-60px rounded-4"
          [disabled]="!canOpenSubPopup"
          (click)="clickUSB()"
        >
          <codx-label
            name="lblDeny"
            [formModel]="formModel"
            default="USB"
          ></codx-label>
        </button>

        <div class="btn btn-sm btn-bg-white text-inverse-white mb-2">
          <i class="icon-close icon-18" (click)="close()"></i>
        </div>
      </div>
    </div>
    <div class="stepper-body no-header pt-2 w-100">
      <lib-pdf
        #pdfView
        [isApprover]="isApprover"
        [transRecID]="transRecID"
        [recID]="sfRecID"
        [stepNo]="stepNo"
        [isEditable]="canOpenSubPopup"
        (isActiveToSign)="changeActiveOpenPopup($event)"
      >
      </lib-pdf>
    </div>
  </div>
</div>

<ng-template #popupApprove let-dialog1>
  <div class="codx-form card w-100 h-100 rounded-0 border-0">
    <div class="card-header flex-column">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="card-title">
          <div class="d-flex flex-column">
            {{ title }}
            <!-- <codx-label
              class="dialog-title line-clamp line-clamp-1"
              name="lblProcessTemplate"
              default="Quy trình mẫu"
              [formModel]="formModel"
            ></codx-label> -->
          </div>
        </div>
        <div class="card-toolbar">
          <button
            type="button"
            class="btn btn-flex text-dark-75 text-hover-primary px-0"
            (click)="close(dialog1)"
          >
            <span class="icon-close icon-18"></span>
          </button>
        </div>
      </div>
      <div class="d-flex align-items-end justify-content-between w-100">
        <div class="d-flex align-items-center w-100">
          <span class="dialog-subheader">
            {{ subTitle }}
          </span>
        </div>
      </div>
    </div>
  </div>
  <div class="card-body h-300px">
    <ng-container *ngTemplateOutlet="body1"></ng-container>
  </div>
  <div class="card-footer border-0">
    <ng-container *ngTemplateOutlet="footer1"></ng-container>
  </div>
  <!-- <codx-form
    #form
    [headerText]="title"
    [subHeaderText]="subTitle"
    [body]="body1"
    [footer]="footer1"
    [dialog]="dialog"
    [data]="approvalTrans"
  > -->
  <ng-template #body1>
    <div class="reason form-group" *ngIf="mode != 1">
      <codx-label
        fiedName="ResourceName"
        [formModel]="formModel"
        default="Lí do"
      >
      </codx-label>
      <codx-input
        type="combobox"
        [Group]="dialogSignFile"
        [ControlName]="controlName"
        [formModel]="formModel"
      >
      </codx-input>
    </div>

    <div class="note form-group">
      <codx-label fiedName="Comment" [formModel]="formModel" default="Ghi chú">
      </codx-label>
      <codx-input
        type="text"
        ControlName="comment"
        [Group]="dialogSignFile"
        [formModel]="formModel"
      >
      </codx-input>
    </div>

    <div class="attachment" *ngIf="mode == 1">
      <!-- <codx-attachment
        #attachment
        objectType="ES_SignFiles"
        [objectId]="recID"
        hideBtnSave="1"
        hideFolder="1"
        hideUploadBtn="0"
        hideDes="1"
        [functionID]="funcID"
        type="inline"
        (fileCount)="getfileCount($event)"
      >
      </codx-attachment> -->
      <codx-attachment
        #attachment
        [objectType]="'ES_SignFiles'"
        hideBtnSave="1"
        hideFolder="1"
        hideUploadBtn="1"
        hideDes="1"
        hideImageUpload="0"
        hideImageThumb="1"
        [functionID]="funcID"
        [objectId]="sfRecID"
        [allowMultiFile]="1"
        [idBrowse]="'add'"
      >
      </codx-attachment>
    </div>
  </ng-template>

  <ng-template #footer1>
    <div
      [class]="
        mode == 1
          ? 'justify-content-between d-flex'
          : 'justify-content-end d-flex'
      "
    >
      <button
        *ngIf="mode == 1"
        type="button"
        class="btn btn-primary"
        (click)="popupUploadFile()"
      >
        <codx-label
          name="lblAttachFiles"
          default="Đính kèm"
          [formModel]="formModel"
        ></codx-label>
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="saveDialog1(dialog1)"
      >
        <codx-label
          name="lblSave"
          default="OK"
          [formModel]="dialog.formModel"
        ></codx-label>
      </button>
    </div>
  </ng-template>
  <!-- </codx-form> -->
</ng-template>

<ng-template #popupApprove1 let-dialog1>
  <codx-form
    #form
    [headerText]="title"
    [subHeaderText]="subTitle"
    [body]="body"
    [footer]="footer"
    [dialog]="dialog"
    [data]="approvalTrans"
  >
    <ng-template #body>
      <div class="reason form-group" *ngIf="mode != 1">
        <codx-label
          fiedName="ResourceName"
          [formModel]="formModel"
          default="Lí do"
        >
        </codx-label>
        <codx-input
          type="combobox"
          [Group]="dialogSignFile"
          [ControlName]="controlName"
          [formModel]="formModel"
        >
        </codx-input>
      </div>

      <div class="note form-group">
        <codx-label fiedName="" [formModel]="formModel" default="Ghi chú">
        </codx-label>
        <codx-input
          type="text"
          ControlName="comment"
          [Group]="dialogSignFile"
          [formModel]="formModel"
        >
        </codx-input>
      </div>

      <div class="attachment" *ngIf="mode == 1">
        <!-- <codx-attachment
        #attachment
        objectType="ES_SignFiles"
        [objectId]="recID"
        hideBtnSave="1"
        hideFolder="1"
        hideUploadBtn="0"
        hideDes="1"
        [functionID]="funcID"
        type="inline"
        (fileCount)="getfileCount($event)"
      >
      </codx-attachment> -->
        <codx-attachment
          #attachment
          [objectType]="'ES_SignFiles'"
          hideBtnSave="1"
          hideFolder="1"
          hideUploadBtn="1"
          hideDes="1"
          hideImageUpload="0"
          hideImageThumb="1"
          [functionID]="funcID"
          [objectId]="sfRecID"
          [allowMultiFile]="1"
          [idBrowse]="'add'"
        >
        </codx-attachment>
      </div>
    </ng-template>

    <ng-template #footer>
      <div
        [class]="
          mode == 1
            ? 'justify-content-between card-footer d-flex'
            : 'justify-content-end card-footer d-flex'
        "
      >
        <button
          *ngIf="mode == 1"
          type="button"
          class="btn btn-primary"
          (click)="popupUploadFile()"
        >
          <codx-label
            name="lblAttachFiles"
            default="Đính kèm"
            [formModel]="formModel"
          ></codx-label>
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="saveDialog1(dialog1)"
        >
          <codx-label
            name="lblSave"
            default="OK"
            [formModel]="dialog.formModel"
          ></codx-label>
        </button>
      </div>
    </ng-template>
  </codx-form>
</ng-template>
