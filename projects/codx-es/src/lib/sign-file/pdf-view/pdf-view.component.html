<div class="d-flex justify-content-between main-pane stepper-body tab-custom w-100">
  <div class="main-content d-flex flex-column-fluid h-100">
    <div class="flex-column flex-lg-row-auto  main-left" [class.hideCol]="hideThumbnail">
      <ejs-tab #leftToolbar [class.d-none]="hideThumbnail" heightAdjustMode='Fill'>
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              {{ headerLeftName[0].text }}
            </ng-template>
            <ng-template #content>
              <div #thumbnailTab id="thumbnailTab"></div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              {{ headerLeftName[1].text }}
            </ng-template>
            <ng-template #content> </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
    <div class="d-flex flex-column flex-row-fluid main-center">
      <div class="d-flex d-flex align-items-center justify-content-between stepper-toolbar">
        <div class="left_Toolbar d-flex justify-content-start align-items-center">
          <ejs-toolbar (created)="leftTollbarCreated($event)">
            <e-items>
              <e-item [prefixIcon]="
                  hideThumbnail
                    ? 'icon-arrow_forward_ios'
                    : 'icon-arrow_back_ios rotate-180'
                " (click)="changeShowThumbnailState()"></e-item>
              <e-item [disabled]="cannotAct" prefixIcon="icon-skip_previous icon-20 btn btn-sm btn-icon  w-30px h-30px"
                (click)="pdfviewerControl?.navigation?.goToFirstPage()" [disabled]="cannotAct">
              </e-item>
              <e-item prefixIcon="icon-navigate_before icon-20 btn btn-sm btn-icon  w-30px h-30px"
                (click)="this.pdfviewerControl?.navigation?.goToPreviousPage()" [disabled]="cannotAct">
              </e-item>
              <e-item [template]="pageInput" type="Input"></e-item>
              <e-item prefixIcon="icon-navigate_next icon-20 btn btn-sm btn-icon  w-30px h-30px"
                (click)="pdfviewerControl?.navigation?.goToNextPage()" [disabled]="cannotAct">
              </e-item>
              <e-item prefixIcon="icon-skip_next icon-20 btn btn-sm btn-icon  w-30px h-30px"
                (click)="pdfviewerControl?.navigation?.goToLastPage()" [disabled]="cannotAct">
              </e-item>

              <e-item prefixIcon="icon-article icon-20 btn btn-sm btn-icon  w-30px h-30px" (click)="show($event)"
                [disabled]="cannotAct">
              </e-item>
            </e-items>
          </ejs-toolbar>
        </div>

        <div class="chooseSignFile w-100 d-flex justify-content-center align-items-center  ">
          <ejs-dropdownlist id="signfilesDropdownList" [dataSource]="lstFiles" [fields]="file"
            (change)="changeSignFile($event)" [(value)]="curFileID"></ejs-dropdownlist>
        </div>
        <div class="right_Toolbar d-flex justify-content-end align-items-center">
          <ejs-toolbar>
            <e-items>
              <e-item prefixIcon="e-zoom-out btn btn-sm btn-icon w-30px h-30px" (click)="clickZoom('out')"
                [disabled]="cannotAct">
              </e-item>
            </e-items>
          </ejs-toolbar>
          <ejs-dropdownlist style="width: 100%; min-width: 70px" id="zoomValuesDropdownList" [dataSource]="lstZoomValue"
            [placeholder]="zoomValue" (change)="clickZoom('to', $event)"></ejs-dropdownlist>
          <ejs-toolbar>
            <e-items>
              <e-item prefixIcon="e-zoom-in btn btn-sm btn-icon  w-30px h-30px" (click)="clickZoom('in')"
                [disabled]="cannotAct">
              </e-item>
            </e-items>
          </ejs-toolbar>
          <ejs-toolbar class="border-start">
            <e-items>
              <e-item prefixIcon="e-print btn btn-sm btn-icon  w-30px h-30px" (click)="clickPrint($event)"
                [disabled]="cannotAct">
              </e-item>
              <e-item prefixIcon="e-download btn btn-sm btn-icon  w-30px h-30px" (click)="clickDownload()"
                [disabled]="cannotAct">
              </e-item>
              <e-item [prefixIcon]="
                  !hideActions
                    ? 'icon-arrow_forward_ios'
                    : 'icon-arrow_back_ios'
                " (click)="changeShowActionsState()"></e-item>
            </e-items>
          </ejs-toolbar>
        </div>
      </div>

      <div class="h-100 pdfviewer_Space w-100 flex-row-fluid">
        <ejs-pdfviewer #pdfviewer id="pdfViewer" [(serviceUrl)]="service" [enableToolbar]="false"
          [enableNavigationToolbar]="false" [enableAnnotationToolbar]="false" [enableThumbnail]="true"
          (created)="onCreated($event)" [enableAnnotation]="true" (documentUnload)="changeCanActState(true)"
          (annotationAdd)="addAnnoEvent($event)" (annotationMove)="resetTime($event)"
          (annotationRemove)="removeAnnot($event)" (annotationResize)="resetTime($event)"
          (annotationSelect)="selectedAnnotation($event)" (annotationPropertiesChange)="resetTime($event)"
          (documentLoad)="loadingAnnot($event)" (printEnd)="cancelPrint($event)" [enableCommentPanel]="false"
          (pageChange)="pageChange($event)" [zoomValue]="zoomValue" (zoomChange)="changeZoomValue($event)"
          [ajaxRequestSettings]="ajaxSetting" style="
            height: 100% !important;
            width: 100% !important;
            position: relative;
            display: block;
          ">
        </ejs-pdfviewer>
      </div>
    </div>
    <div class="actions flex-column flex-lg-row-auto main-right" [class.hideCol]="hideActions">
      <ejs-tab #rightToolbar [class.d-none]="hideActions" heightAdjustMode='Fill'>
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              {{ headerRightName[0].text }}
            </ng-template>

            <ng-template #content>
              <div class="position-relative" *ngIf="!isApprover">
                <div class="mt-3 mb-3">
                  <codx-label name="lblChooseSigner" [formModel]="" default="Chọn người kí cần thiết lập"
                    class="fw-bold text-primary"></codx-label>
                </div>
                <ejs-dropdownlist #inputAuthor id="signatureDropdownList" [dataSource]="lstSigners" [fields]="person"
                  (change)="changeSigner($event)" [itemTemplate]="signer" [valueTemplate]="signer"
                  [(value)]="curSignerID">
                  <ng-template #signer let-approver>
                    <codx-temp-full cardCss="card-select px-2 pt-4 pb-2" [imageId]="approver.authorID"
                      [imageObjType]="'AD_Users'" [imageWidth]="35" imgCss="me-2" [title]="
                          approver.roleType == 'U'
                            ? approver.fullName
                            : (approver.roleType | vll: 'ES014':'text' | async)
                        " [subTitle]="approver.position ?? 'Vị trí công việc'" [baseHeaderRightTmp]="footer"
                      [dataItem]="approver">
                    </codx-temp-full>
                  </ng-template>
                </ejs-dropdownlist>
                <!-- <codx-input
                    class="form-control me-2"
                    type="valuelist"
                    field="vllOrganize"
                    refValue="ES015"
                    (valueChange)="changeSigner($event)"
                  ></codx-input> -->
              </div>
              <div class="mt-3 mb-3">
                <codx-label name="lblDragAction" [formModel]="" default="Kéo thả" class="fw-bold text-primary">
                </codx-label>
              </div>

              <div class="d-flex flex-wrap d-grid align-items-center">
                <div class="card-item me-6 mb-6" *ngFor="let action of actionsButton; let index = index"
                  [class.active]="holding == index + 1" (click)="changeAnnotationItem(index + 1)">
                  <codx-card-center cardCss="border h-100 w-125px pt-4 pb-2 " icoCss="icon-30 mb-1 {{
                        index + 1 | vll: 'ES015':'icon' | async
                      }}" content="{{ index + 1 | vll: 'ES015':'text' | async }}">
                  </codx-card-center>
                </div>
              </div>

              <!--begin::Item-->
              <div class="d-flex align-items-center my-2">
                <div class="d-flex justify-content-start me-2">
                  <!--begin::Switch-->
                  <codx-input type="switch" labelPosition="After" field="" [crrValue]="needSuggest"
                    (valueChange)="changeSuggestState($event)">
                  </codx-input>
                  <!--end::Switch-->
                </div>
                <div class="text-gray-800 text-nowrap">
                  <codx-label name="lblSuggestSignArea" default="Gợi ý vị trí ký" class="fw-bold"></codx-label>
                </div>
              </div>
              <!--end::Item-->
              <!--begin::Item-->
              <div class="autoSign_Space d-flex align-items-center my-2">
                <div class="d-flex justify-content-start me-2">
                  <!--begin::Switch-->
                  <codx-input type="switch" field="autoSignLastLine" [crrValue]="autoSignState"
                    (valueChange)="changeAutoSignState($event, 0)"></codx-input>
                  <!--end::Switch-->
                </div>
                <div class="text-gray-800 text-nowrap">
                  <codx-label name="lblSignLastLine" default="Ký dòng cuối cùng" class="fw-bold"></codx-label>
                </div>
              </div>
              <!--end::Item-->
            </ng-template>
          </e-tabitem>

          <e-tabitem>
            <ng-template #headerText>
              {{ headerRightName[1].text }}
            </ng-template>
            <ng-template #content>
              <ng-container>
                <!-- <codx-listview
                    #listview
                    service="ES"
                    assemblyName="ERM.Business.ES"
                    className="SignFilesBusiness"
                    method="GetAllAreasAsync"
                    [dataValue]="dataValue"
                    predicate="null"
                    entityName="ES_SignFiles"
                    [itemTemplate]="itemTmpl"
                  >
                  </codx-listview> -->
                <ejs-listview id="groupedList" [dataSource]="lstAreas" [cssClass]="cssClass" [showHeader]="true">
                  <ng-template #template let-area="">
                    <div class="annotationItem py-3" (click)="goToSelectedAnnotation(area)">
                      <codx-temp-full [title]="
                            (area.labelType | vll: 'ES015':'text' | async) +
                            ' - ' +
                            getAreaOwnerName(area.signer)
                          " [resourceObjType]="'AD_Users'" [icoCss]="
                            'symbol symbol-icon symbol-circle symbol-32px me-2 ' +
                            (area.labelType | vll: 'ES015':'icon' | async)
                          " [iconCss2]="(area.recID != curSelectedAnnotID)? 'icon-expand_more':'icon-expand_less'"
                        [subTitle]="'Trang ' + (+area.location.pageNumber + 1)" [subTitleCss]="'page-end'">
                      </codx-temp-full>
                      <div [class.d-none]="
                            area.recID != curSelectedAnnotID ||
                            area.labelType == '1' ||
                            area.labelType == '2'
                          " [formGroup]="formAnnot">
                        <div class="qr-switch " *ngIf="area.labelType == 8">
                          <codx-input class="form-control me-2" type="switch" [crrValue]="renderQRAllPage"
                            (valueChange)="changeQRRenderState($event)">
                            <codx-label name="lblSave" default="Lặp lại cho tất cả các trang" [formModel]="">
                            </codx-label>
                          </codx-input>
                        </div>
                        <div class="text-content my-2 ms-12" *ngIf="area.labelType == 6">
                          <input type="text" formControlName="content" class="w-100 d-block" [style]="
                                'font-size: ' +
                                curAnnotFontSize +
                                'px;' +
                                'font-family: ' +
                                curAnnotFontStyle +
                                ';'
                              " [ngClass]="{
                                'fw-bolder': isBold,
                                'fst-italic': isItalic,
                                'text-decoration-underline': isUnd
                              }" [defaultValue]="area.labelType" />
                        </div>

                        <div class="date-content my-2 ms-12" *ngIf="area.labelType == 5">
                          <ejs-dropdownlist class="me-2 min-w-70px" id="dateFormatsDropdownList"
                            [dataSource]="lstAnnotDateFormat" [(value)]="curAnnotDateFormat"
                            formControlName="dateFormat">
                          </ejs-dropdownlist>

                        </div>
                        <div class="d-flex my-2 ms-12">
                          <div class="text-format d-flex align-items-center" *ngIf="area.labelType != 8">
                            <ejs-dropdownlist class="me-2 min-w-70px" id="fontStylesDropdownList"
                              [dataSource]="lstAnnotFontStyle" [(value)]="curAnnotFontStyle"
                              formControlName="fontStyle">
                            </ejs-dropdownlist>
                            <ejs-dropdownlist class="me-2 w-100px" id="fontSizesDropdownList"
                              [dataSource]="lstAnnotFontSize" [(value)]="curAnnotFontSize" formControlName="fontSize">
                            </ejs-dropdownlist>
                          </div>
                          <div class="btn-format d-flex align-items-center" *ngIf="area.labelType != 8">
                            <button type="button" class="btn btn-sm btn-icon me-1" [ngClass]="{
                                btn: true,
                                'bg-white border': !isBold,
                                'btn-success': isBold
                              }" (click)="changeFontWeight(1)">
                              <span class="icon-format_bold"></span>
                              <!-- <codx-label name="lblSave" default="B" [formModel]=""></codx-label> -->
                            </button>
                            <button type="button" class="btn btn-sm btn-icon me-1" [ngClass]="{
                                btn: true,
                                'bg-white border': !isItalic,
                                'btn-success': isItalic
                              }" (click)="changeFontWeight(2)">
                              <span class="icon-format_italic"></span>
                              <!-- <codx-label name="lblSave" default="I" [formModel]=""></codx-label> -->
                            </button>
                            <button type="button" class="btn btn-sm btn-icon" [ngClass]="{
                                btn: true,
                                'bg-white border': !isUnd,
                                'btn-success': isUnd
                              }" (click)="changeFontWeight(3)">
                              <span class="icon-format_underlined"></span>
                              <!-- <codx-label name="lblSave" default="U" [formModel]=""></codx-label> -->
                            </button>
                          </div>

                        </div>
                        <div class="d-flex ms-12">
                          <codx-input class="me-4" type="radio" label="Ngày phát hành" [checked]="true"
                            labelPosition="After">
                          </codx-input>
                          <codx-input type="radio" label="Ngày ký" [checked]="false" labelPosition="After">
                          </codx-input>
                        </div>
                        <div class="btn-apply d-flex justify-content-end">
                          <button type="button" class="btn btn-sm btn-primary" (click)="
                                changeAnnotPro(
                                  area.labelType,
                                  area.recID,
                                  area.createdOn
                                )
                              ">
                            <codx-label name="lblSave" default="OK" [formModel]=""></codx-label>
                          </button>
                        </div>
                      </div>
                    </div>
                  </ng-template>
                  <ng-template #groupTemplate let-dataSource="">
                    <div class="e-list-wrapper">
                      <span class="e-list-item-content">{{
                        dataSource.items[0].location.pageNumber + 1
                        }}</span>
                    </div>
                  </ng-template>
                </ejs-listview>
              </ng-container>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="isApprover">
            <ng-template #headerText>
              {{ headerRightName[2].text }}
            </ng-template>
            <ng-template #content></ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="isApprover">
            <ng-template #headerText>
              {{ headerRightName[3].text }}
            </ng-template>
            <ng-template #content></ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </div>
  <img class="row position-absolute invisible" style="width: 250px !important; height: 250px !important" #qrCode
    id="qrCode" />
</div>

<ng-template #footer let-data>
  <codx-vll class="footer-left" [showText]="true" name="ES002" [value]="data.signType"></codx-vll>
</ng-template>

<ng-template #itemTmpl let-data>
  <codx-temp-full [title]="
      (data.labelType | vll: 'ES004':'text' | async) +
      ' - ' +
      getAreaOwnerName(data.signer)
    " [resourceObjType]="'AD_Users'" [icoCss]="
      'w-40px h-40px  fs-4 d-flex justify-content-center align-items-center rounded-circle me-2 ' +
      (data.labelType | vll: 'ES004':'icon' | async)
    " [subTitle]="'Trang ' + data.location?.pageNumber + 1">
  </codx-temp-full>
</ng-template>

<ng-template #pageInput>
  <!-- <input
    id="numeric"
    type="number"
    min="1"
    [max]="pageMax"
    [step]="pageStep"
    [(value)]="curPage"
    defaultValue="1"
    (keyup.enter)="goToPage($event)"
  /> -->
  <codx-input type="number" [min]="1" [max]="pageMax" [crrValue]="curPage" (valueChange)="goToPage($event)">
  </codx-input>
</ng-template>