<!-- <codx-form [formGroup]="dialogSignFile" *ngIf="isAfterRender" [body]="body" [footer]="footer" [dialog]="dialog"
  [headerText]="" [subHeaderText]=""> -->
<div class="card-body p-0 codx-card-custom" *ngIf="isAfterRender">
  <div class="codx-stepper stepper stepper-pills">
    <div class="stepper-header d-flex flex-wrap flex-stack ps-6">
      <div class="d-flex align-items-center ">
        <h2 class="h2-title">
          <codx-label name="lblTitleSignFile" default="Thêm mới tài liệu" [formModel]="formModel"></codx-label>
        </h2>
      </div>
      <div class="d-flex align-items-center stepper">
        <div class="stepper-nav flex-center flex-wrap" #status>
          <div class="stepper-item active" data-kt-stepper-element="nav" data-kt-stepper-action="step"
            ngbTooltip="Upload file" (click)="clickTab(0)">
            <div class="stepper-wrapper d-flex align-items-center">
              <div class="stepper-icon">
                <i class="stepper-default icon-24 icon-radio_button_checked"></i>
                <i class="stepper-active icon-30 text-primary icon-radio_button_checked"></i>
                <i class="stepper-approve icon-30 text-primary icon-check_circle"></i>
                <i class="stepper-approve-disabled icon-30 text-gray-400 icon-check_circle"></i>
              </div>
            </div>
            <div class="stepper-line w-35px mx-1"></div>
          </div>

          <div class="stepper-item" data-kt-stepper-element="nav" data-kt-stepper-action="step" (click)="clickTab(1)"
            ngbTooltip="Bổ sung thông tin tài liệu">
            <div class="stepper-wrapper d-flex align-items-center">
              <div class="stepper-icon">
                <i class="stepper-default icon-24 icon-radio_button_checked"></i>
                <i class="stepper-active icon-30 text-primary icon-radio_button_checked"></i>
                <i class="stepper-approve icon-30 text-primary icon-check_circle"></i>
                <i class="stepper-approve-disabled icon-30 text-gray-400 icon-check_circle"></i>
              </div>
            </div>
            <div class="stepper-line w-35px mx-1"></div>
          </div>

          <div class="stepper-item" data-kt-stepper-element="nav" data-kt-stepper-action="step" (click)="clickTab(2)"
            ngbTooltip="Quy trình duyệt">
            <div class="stepper-wrapper d-flex align-items-center">
              <div class="stepper-icon">
                <i class="stepper-default icon-24 icon-radio_button_checked"></i>
                <i class="stepper-active icon-30 text-primary icon-radio_button_checked"></i>
                <i class="stepper-approve icon-30 text-primary icon-check_circle"></i>
                <i class="stepper-approve-disabled icon-30 text-gray-400 icon-check_circle"></i>
              </div>
            </div>
            <div class="stepper-line w-35px mx-1"></div>
          </div>

          <div class="stepper-item" data-kt-stepper-element="nav" data-kt-stepper-action="step" (click)="clickTab(3)"
            ngbTooltip="Đánh dấu chữ ký">
            <div class="stepper-wrapper d-flex align-items-center">
              <div class="stepper-icon">
                <i class="stepper-default icon-24 icon-radio_button_checked"></i>
                <i class="stepper-active icon-30 text-primary icon-radio_button_checked"></i>
                <i class="stepper-approve icon-30 text-primary icon-check_circle"></i>
                <i class="stepper-approve-disabled icon-30 text-gray-400 icon-check_circle"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end">

        <a href="#" class="btn btn-sm btn-bg-danger text-inverse-danger me-2 mb-2 min-w-60px rounded-4">Từ chối</a>
        <a href="#" class="btn btn-sm btn-bg-warning text-inverse-warning me-2 mb-2 min-w-60px rounded-4">Làm lại</a>
        <a href="#" class="btn btn-sm btn-bg-primary text-inverse-primary me-2 mb-2 min-w-60px rounded-4">Ký</a>

        <button type="button" class="btn btn-sm btn-bg-primary text-inverse-primary me-2 mb-2 min-w-60px rounded-4"
          (click)="continue(currentTab)" *ngIf="currentTab == 3 && dialogSignFile.value.files?.length > 0">
          <codx-label name="lbl" [formModel]="formModel" default="Tiếp tục"></codx-label>
        </button>
        <div class="btn btn-sm btn-bg-white text-inverse-white mb-2">
          <i class="icon-close icon-18" (click)="close(templateClose)"></i>
        </div>
      </div>
    </div>
    <div class="stepper-body p-2 w-100" *ngIf="currentTab < 3">
      <div class="card shadow-none border-0 rounded-0 mx-auto w-100 w-md-800px h-100">
        <div class="card-body overflow-auto">
          <div class="tab-content">
            <div class="tab-pane fade" id="pane_1" [ngClass]="currentTab == 0 ? 'active show' : ''">
              <div class="mb-10 mt-10 text-center">
                <h2 class="h2-title">
                  <codx-label name="lblUploadFile" [formModel]="formModel" default="Upload file"></codx-label>
                </h2>
              </div>
              <div class="text-center">
                <codx-attachment #attachment objectType="ES_SignFiles" hideImageUpload="0"
                  [objectId]="dialogSignFile.value.recID" hideBtnSave="1" hideFolder="1" hideUploadBtn="0"
                  [functionID]="formModel.funcID" type="inline" (fileCount)="getfileCount($event)">
                </codx-attachment>
              </div>
              <div class="d-flex align-items-center" *ngIf="lstDataFile.length > 0">
                <div class="text-center"></div>
                <button type="button" class="btn btn-primary me-3" (click)="popup($event, 0)">
                  <i class="icon-cloud_upload fs-5"></i>
                  <codx-label name="" [formModel]="formModel" class="" default="Thêm mới"></codx-label>
                </button>
              </div>
            </div>
            <div class="tab-pane fade" id="pane_2" [ngClass]="currentTab == 1 ? 'active show' : ''">
              <div class="mb-10 mt-10 text-center">
                <h2 class="h2-title">
                  <codx-label name="lblTitleAddSignFile" [formModel]="formModel" default="Bổ sung thông tin tài liệu">
                  </codx-label>
                </h2>
              </div>
              <div class="w-100 form-content">
                <div class="form-group">
                  <codx-label fiedName="Title" default="Tên tài liệu" [formModel]="formModel">
                  </codx-label>
                  <codx-input type="text" name="text" field="title" [Group]="dialogSignFile">
                  </codx-input>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <codx-label fiedName="CategoryID" [formModel]="formModel" default="Phân loại">
                      </codx-label>
                      <codx-input type="combobox" name="combobox" [refValue]="cbxName['CategoryID']" field="categoryID"
                        (valueChange)="valueChange($event)" [crrValue]="dialogSignFile.value?.categoryID">
                      </codx-input>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <codx-label default="Mức độ ưu tiên" fiedName="Priority" [formModel]="formModel">
                      </codx-label>
                      <codx-input type="valuelist" name="valuelist" ngDefaultControl field="priority"
                        (valueChange)="valueChange($event)" [refValue]="cbxName['Priority']"
                        [crrValue]="dialogSignFile.value?.priority">
                      </codx-input>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <codx-label fiedName="RefNo" [formModel]="formModel" default="Số văn bản">
                      </codx-label>
                      <codx-input type="text" name="text" field="refNo" [disabled]="true"
                        [crrValue]="dialogSignFile.value.refNo">
                      </codx-input>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <!-- <div class="form-group">
                        <codx-label fiedName="Pages" default="Số trang" [formModel]="formModel">
                        </codx-label>
                        <codx-input type="number" name="number" ngDefaultControl field="pages" [Group]="dialogSignFile"
                          (valueChange)="valueChange($event)" [min]="0" placeholder="0"
                          [crrValue]="dialogSignFile.value?.pages" [showSpinButton]="false">
                        </codx-input>
                      </div> -->
                  </div>
                </div>
                <div class="form-group">
                  <codx-label fiedName="EmployeeID" [formModel]="formModel" default="Người yêu cầu">
                  </codx-label>
                  <codx-input type="combobox" name="combobox" ngDefaultControl [refValue]="cbxName['EmployeeID']"
                    field="employeeID" (valueChange)="valueChange($event)"
                    [crrValue]="dialogSignFile.value?.employeeID">
                  </codx-input>
                </div>
                <div class="form-group">
                  <codx-label fiedName="OrgUnitID" [formModel]="formModel" default="Phòng ban">
                  </codx-label>
                  <codx-input type="combobox" name="combobox" ngDefaultControl [refValue]="cbxName['OrgUnitID']"
                    field="orgUnitID" (valueChange)="valueChange($event)" [crrValue]="dialogSignFile.value?.orgUnitID"
                    class="form-control">
                  </codx-input>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="pane_3" [ngClass]="currentTab == 2 ? 'active show' : ''">
              <app-approval-steps #stepAppr *ngIf="currentTab == 2" #viewApprovalStep
                [transId]="dialogSignFile.value.approveControl=='1'? dialogSignFile.value.recID : dialogSignFile.value.processID"
                (addEditItem)="openFormAdd($event)">
              </app-approval-steps>
            </div>
            <div class="tab-pane fade" id="pane_4" [ngClass]="currentTab == 3 ? 'active show' : ''">

            </div>
          </div>
        </div>



        <div class="d-flex flex-stack  justify-content-between card-footer border-0">

          <div class="left">
            <button type="button" class="btn btn-lg btn-light-primary me-3" data-kt-stepper-action="previous">
              <codx-label name="" [formModel]="formModel" class="" default="Quay lại" class="">
              </codx-label>
            </button>
            <button type="button" class="btn btn-primary me-3" *ngIf="currentTab != 0"
              (click)="openPopup(processTemplate)">
              <codx-label name="" [formModel]="formModel" class="" default="Quy trình mẫu" class="">
              </codx-label>
            </button>
          </div>

          <div *ngIf="currentTab == 0"></div>
          <button type="button" class="btn btn-primary" (click)="continue(currentTab)"
            [ngClass]="(attachment?.fileUploadList?.length <= 0 && currentTab == 0) && dialogSignFile.value.files?.length <= 0 ? 'disabled' : ''">
            <codx-label name="lblContinue" [formModel]="formModel" default="Tiếp tục"></codx-label>
          </button>

        </div>
      </div>
    </div>
    <lib-approval *ngIf="currentTab == 3 && dialogSignFile.value.files?.length > 0" [isApprover]="false"
      [recID]="dialogSignFile.value.recID">
    </lib-approval>
  </div>
</div>
<ng-template #pdf>

</ng-template>
<ng-template #footer> </ng-template>

<ng-template #processTemplate let-dialogTemplate>
  <div class="codx-form card w-100 h-100 rounded-0 border-0">
    <div class="card-header flex-column">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="card-title">
          <div class="d-flex flex-column">
            <codx-label class="dialog-title line-clamp line-clamp-1" name="lblProcessTemplate" default="Quy trình mẫu"
              [formModel]="formModel"></codx-label>
          </div>
        </div>
        <div class="card-toolbar">
          <button type="button" class="btn btn-flex text-dark-75 text-hover-primary px-0"
            (click)="closeDialogTmp(dialogTemplate)">
            <span class="icon-close icon-18"></span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="form-group">
        <label class="me-2">
          <codx-label fiedName="" [formModel]="formModel" default="Qui trình mẫu"></codx-label>
        </label>
        <codx-input type="combobox" class="form-control" field="processID" refValue="ProcessTemplate"
          (valueChange)="valueChange($event)">
        </codx-input>
      </div>
    </div>
    <div class="card-footer border-0">
      <div class="d-flex justify-content-end">
        <a class="btn btn-primary" (click)="onSaveProcessID(dialogTemplate)">
          <codx-label name="lblSave" default="Lưu" [formModel]="formModel">
          </codx-label>
        </a>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #templateClose let-dialogClose>
  <div class="codx-form card w-100 h-100 rounded-0 border-0">
    <div class="card-header flex-column">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="card-title">
          <div class="d-flex flex-column">
            <codx-label class="dialog-title line-clamp line-clamp-1" name="lblIsSave" default="Lưu quy trình"
              [formModel]="formModel"></codx-label>
          </div>
        </div>
        <div class="card-toolbar">
          <button type="button" class="btn btn-flex text-dark-75 text-hover-primary px-0"
            (click)="closeDialogTmp(dialogClose)">
            <span class="icon-close icon-18"></span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="">
        <label class="me-2">
          <codx-label *ngIf="isAddNew" name="lblCloseAddNewForm" [formModel]="formModel"
            default="Bạn có muốn lưu quy trình đã thiết lập"></codx-label>
          <codx-label *ngIf="!isAddNew" name="lblCloseEditForm" [formModel]="formModel"
            default="Bạn có muốn lưu quy trình đã đã chỉnh sửa"></codx-label>
        </label>
      </div>
    </div>
    <div class="card-footer border-0">
      <div class="d-flex justify-content-end">
        <a class="btn btn-primary" (click)="clickIsSave(true, dialogClose)">
          <codx-label name="lblSave" default="Lưu" [formModel]="formModel">
          </codx-label>
        </a>
        <a *ngIf="isAddNew" class="btn btn-danger" (click)="clickIsSave(false, dialogClose)">
          <codx-label name="lblDelete" default="Xóa" [formModel]="formModel">
          </codx-label>
        </a>
        <a *ngIf="!isAddNew" class="btn btn-secondary" (click)="clickNotSave(dialogClose)">
          <codx-label name="lblExit" default="Thoát" [formModel]="formModel">
          </codx-label>
        </a>
      </div>
    </div>
  </div>
</ng-template>