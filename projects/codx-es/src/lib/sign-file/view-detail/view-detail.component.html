<codx-detail-tmp
  #itemDetailTemplate
  [header]="header"
  [body]="body"
  [footer]="footer"
>
  <ng-template #header>
    <div class="vmd-detail">
      <div class="d-flex justify-content-end flex-grow-1 position-relative">
        <div>
          <div class="send-request position-relative">
            <button class="d-flex justify-content-between" *ngIf="canRequest">
              <div class="icon-forward icon"></div>
              <codx-label name="lblSendToApprove" [formModel]="itemDetailTemplate.formModel" default="Gửi duyệt"></codx-label>
            </button>
          </div>
          <div class="w-100">
            <span
              class="badge badge-square badge-md rounded"
              [style.background-color]="
                itemDetail
                  ? (itemDetail.priority | vll: 'VL003':'color' | async)
                  : ''
              "
            >
              {{
                itemDetail
                  ? (itemDetail.priority | vll: "VL003":"text" | async)
                  : ""
              }}
            </span>
          </div>
        </div>
        <div
          class="dropdown"
          (mouseover)="changeNavState(true)"
          (mouseout)="changeNavState(false)"
        >
          <button
            class="btn btn-icon btn-xs h-20px"
            type="button"
            id="dropdownMenuButton"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <span class="icon-more_horiz icon-18"></span>
          </button>
          <!-- <div
            class="dropdown-menu position-absolute test"
            [class.show]="openNav"
            aria-labelledby="dropdownMenuButton"
          >
            <a class="dropdown-item">
              <div class="d-flex align-items-center">
                <span class="icon-edit text-warning icon-18"></span>
                <span class="ms-3">Edit</span>
              </div>
            </a>
            <a class="dropdown-item">
              <div class="d-flex align-items-center">
                <span class="icon-list_alt text-primary icon-18"></span>
                <span class="ms-3">Watch Detail</span>
              </div>
            </a>
            <a class="dropdown-item">
              <div class="d-flex align-items-center">
                <span class="icon-clear text-danger icon-18"></span>
                <span class="ms-3">Remove</span>
              </div>
            </a>
          </div> -->
        </div>
      </div>
    </div>
    <div class="mb-1">
      <div class="d-flex flex-grow-1 mb-2">
        <div class="d-flex flex-column flex-grow-1">
          <h1 class="text-dark fw-bold fs-66">
            {{ itemDetail ? itemDetail.title : "" }}
          </h1>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex symbol-50px mb-2">
        <codx-img
          #image
          objectId="{{ itemDetail ? itemDetail.employeeID : '' }}"
          objectType="AD_Users"
        >
        </codx-img>
        <div class="text-dark fw-bold fs-36 ml-4">
          {{ itemDetail?.owner ? itemDetail?.owner : "" }}
          <div class="fw-bold me-6">
            {{ itemDetail ? itemDetail.bUID : "" }}
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex flex-grow-1 mb-2">
      <div class="symbol symbol-20px me-4 icon-apartment"></div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fs-6">
          {{
            itemDetail?.deptID
              ? (itemDetail?.deptID | vll: "Depts":"text" | async)
              : ""
          }}
        </div>
      </div>
    </div>
    <div class="d-flex mt-1">
      <div class="d-flex me-6">
        <codx-label name="lblDateRequest" [formModel]="itemDetailTemplate.formModel" default="Ngày yêu cầu:" class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          {{
            itemDetail
              ? (itemDetail.createdOn | date: "dd/MM/yyyy")
              : "dd/MM/yyyy"
          }}
        </span>
      </div>
      <div class="d-flex me-6">
        <codx-label name="lblDateExpire" [formModel]="itemDetailTemplate.formModel" default="Ngày hết hạn:" class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          {{
            itemDetail?.permission
              ? (itemDetail.permissions?.expiredOn | date: "dd/MM/yyyy")
              : "dd/MM/yyyy"
          }}
        </span>
      </div>
      <div class="d-flex align-items-center text-dark me-6">
        <codx-label name="lblPriority" [formModel]="itemDetailTemplate.formModel" default="Ưu tiên:"  class="me-1"></codx-label>
        <span
          class="icon-flag icon-16 me-2"
          [style.color]="
            itemDetail
              ? (itemDetail?.priority | vll: 'L0186':'color' | async)
              : ''
          "
        ></span>
        <span class="text-gray-600">
          {{
            itemDetail
              ? (itemDetail?.priority | vll: "L0186":"text" | async)
              : ""
          }}
        </span>
      </div>
    </div>
    <div class="d-flex mt-1">
      <div class="d-flex align-items-center text-dark me-6">
        <codx-label name="lblRefNumber" [formModel]="itemDetailTemplate.formModel" default="Số tham chiếu:" class="me-1"></codx-label>
        <span class="text-gray-600">
          {{ itemDetail ? itemDetail?.refNo : "" }}
        </span>
      </div>
      <div class="d-flex me-6">
        <codx-label name="lblRefDate" [formModel]="itemDetailTemplate.formModel" default="Ngày tham chiếu:" class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          {{
            itemDetail
              ? (itemDetail?.refDate | date: "dd/MM/yyyy")
              : "dd/MM/yyyy"
          }}
        </span>
      </div>
    </div>
    <div>
      <div
        class="symbol symbol-20px icon-file-pdf me-4"
        *ngFor="let file of itemDetail?.files"
      >
        {{ file?.fileName }}
      </div>
    </div>
    <div class="codx_e-header" [class.active]="true">
      <div class="d-flex align-items-center btn-tabs">
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="itemDetailStt === '1'"
          (click)="clickChangeItemViewStatus('1', itemDetail?.recID)"
        >
          <i class="icon-description icon-16"></i>
          <codx-label name="lblAbstract" [formModel]="itemDetailTemplate.formModel" default="Mô tả ngắn gọn" class="ms-2 fw-bold"></codx-label>
        </button>
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="itemDetailStt === '2'"
          (click)="clickChangeItemViewStatus('2', itemDetail?.recID)"
        >
          <i class="icon-format_list_numbered icon-16"></i>
          <codx-label name="lblBusiness" [formModel]="itemDetailTemplate.formModel" default="Công việc" class="ms-2 fw-bold"></codx-label>
        </button>
        <button
          class="btn btn-white text-dark me-1"
          [class.active]="itemDetailStt === '3'"
          (click)="clickChangeItemViewStatus('3', itemDetail?.recID)"
        >
          <i class="icon-people_alt icon-16"></i>
          <codx-label name="lblApprovalTrans" [formModel]="itemDetailTemplate.formModel" default="Qui trình duyệt" class="ms-2 fw-bold"></codx-label>
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #body>
    <div class="container" style="height: 800px">
      <div class="summary mt-2" *ngIf="itemDetailStt == '1'">
        {{ itemDetail?.abstract }}
      </div>
      <div class="list_Of_Jobs mt-2" *ngIf="itemDetailStt == '2'">
        <ng-container>
          <codx-treeview
            #treeAdd
            id="treeAdd"
            [data]="taskViews"
            [showSearch]="false"
            [itemTemplate]="taskViewDetail"
            [autoLoad]="false"
            [isOutput]="true"
            [isLoadChild]="false"
          >
          </codx-treeview>
        </ng-container>
      </div>
      <div class="cdx-timeline-vertical mt-2" *ngIf="itemDetailStt == '3'">
        <div class="timeline timeline-3">
          <div class="timeline-items">
            <div
              class="timeline-item"
              *ngFor="let part of processes; let index = index"
            >
              <div class="timeline-media d-flex flex-column flex-grow-1">
                <div class="stepper-label">
                  <h3 class="stepper-title">
                    {{ index + 1 }}
                  </h3>
                </div>
              </div>
              <div class="title-space d-flex flex-row flex-grow-1 mr-2">
                <div class="title">
                  {{
                    (part.stepType | vll: "ES002":"text" | async)?.toUpperCase()
                  }}
                </div>
                <div
                  class="icon-check_circle"
                  *ngIf="part.isActived.length != 0"
                ></div>
              </div>
              <div class="approvers_Info w-100">
                <div
                  *ngFor="let approver of part.approvers"
                  class="approver_Info d-flex justify-content-around flex-grow-1 w-100"
                >
                  <div class="d-flex flex-grow-1">
                    <div class="me-4">
                      <codx-img
                        #image
                        objectId="{{ approver.approver }}"
                        objectType="AD_Users"
                      >
                      </codx-img>
                    </div>
                    <div class="approver-info">
                      <span>
                        {{ approver.approverName }}
                      </span>
                      <div class="align-items-center me-1">
                        {{ approver.approverPosition }}
                      </div>
                      <div class="align-items-center me-1">
                        {{ approver.comment }}
                      </div>
                    </div>
                  </div>
                  <div class="d-flex show-time justify-content-end text-top">
                    <div class="time-duration">
                      <span
                        *ngIf="approver.status < 3; else time_activated"
                        class="badge badge-secondary step-status"
                        style.color="white"
                      >
                        {{ approver.duration }}h
                      </span>

                      <ng-template #time_activated>
                        <span
                          class="badge badge-md step-status"
                          [class.badge-primary]="
                            approver.leadtime > approver.duration
                          "
                          [class.badge-danger]="
                            approver.leadtime <= approver.duration
                          "
                        >
                          {{ "2022-06-09T03:40:14.605+00:00" | date: "HH:mm" }}
                          -
                          {{
                            setDate(
                              "2022-06-09T03:40:14.605+00:00",
                              approver.leadtime
                            ) | date: "HH:mm"
                          }}
                        </span>
                      </ng-template>

                      <div *ngIf="approver.approvedOn ? true : false">
                        {{ approver.approvedOn | date: "short" }}
                      </div>
                    </div>
                    <div class="icon icon-attach">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #footer class="task-info">
    <div class="tab-horizone mt-6">
      <div class="codx_e-header">
        <div class="d-flex align-items-center btn-tabs">
          <button
            class="btn btn-white text-dark me-1"
            [class.active]="itemDetailDataStt === '1'"
            (click)="clickChangeItemDetailDataStatus('1')"
          >
            <i class="icon-history icon-16"></i>
            <span class="ms-2 fw-bold">Lịch sử</span>
          </button>
          <button
            class="btn btn-white text-dark me-1"
            [class.active]="itemDetailDataStt === '2'"
            (click)="clickChangeItemDetailDataStatus('2')"
          >
            <i class="icon-message icon-16"></i>
            <codx-label name="lblDiscussion" [formModel]="itemDetailTemplate.formModel" default="Thảo luận" class="ms-2 fw-bold"></codx-label>
          </button>
          <button
            class="btn btn-white text-dark me-1"
            [class.active]="itemDetailDataStt === '3'"
            (click)="clickChangeItemDetailDataStatus('3')"
          >
            <i class="icon-attach icon-16"></i>
            <codx-label name="lblAttachment" [formModel]="itemDetailTemplate.formModel" default="Đính kèm" class="ms-2 fw-bold"></codx-label>
          </button>
          <button
            class="btn btn-white text-dark me-1"
            [class.active]="itemDetailDataStt === '4'"
            (click)="clickChangeItemDetailDataStatus('4')"
          >
            <i class="icon-insert_link icon-16"></i>
            <codx-label name="lblLink" [formModel]="itemDetailTemplate.formModel" default="Liên kết" class="ms-2 fw-bold"></codx-label>
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</codx-detail-tmp>

<ng-template #taskViewDetail let-user>
  <div class="user_Info">
    <div class="d-flex">
      <div class="me-4">
        <codx-img
          #image
          objectId="{{ user.owner }}"
          objectType="AD_Users"
        ></codx-img>
      </div>
      <div class="info">
        <h1>
          {{ user.userName }}
        </h1>
        <div>
          {{ user.positionName }}
        </div>
        <div
          *ngIf="
            user.category == '1' || user.category == '3';
            else templatetaskName
          "
        >
          {{ user.memo }}
        </div>
        <ng-template #templatetaskName>
          <div>
            {{ user.taskName }}
          </div>
        </ng-template>
        <div class="icons d-flex">
          <a class="icon icon-person">
            {{ user.items?.length }}
          </a>
          <a class="icon icon-sms">
            {{ user.comments || 0 }}
          </a>
          <a class="icon icon-attachment">
            {{ user.attachments || 0 }}
          </a>
        </div>
      </div>
    </div>
  </div>
</ng-template>
