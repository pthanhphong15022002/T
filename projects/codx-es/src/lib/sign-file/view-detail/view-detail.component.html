<codx-detail-tmp #itemDetailTemplate [header]="header" [dataItem]="itemDetail" [footer]="!hideFooter ? footer : null"
  [body]="body" [hideMF]="hideMF" [formModel]="formModel" (clickMF)="openFormFuncID($event)"
  (changeDataMF)="changeDataMF($event, itemDetail)" class="h-100">
  <ng-template #header>
    <div class="d-flex justify-content-between flex-grow-1 mb-3">
      <div class="d-flex align-items-center">
        <codx-temp-full [title]="itemDetail?.title" [icoCss]="
            'fs-7 d-flex justify-content-center align-items-center rounded-circle me-2 p-2 ' +
            itemDetail?.icon
          " [icoStyle]="setStyles(itemDetail?.color)" [titleCss]="'fs-4'">
        </codx-temp-full>
      </div>
      <div class="d-flex align-self-center">
        <codx-vll *ngIf="showApproveStatus" [showText]="true" [showBgColor]="true" [formModel]="formModel"
          [field]="'ApproveStatus'" [value]="itemDetail?.approveStatus"
          class="badge badge-light badge-square badge-md fs-7">
        </codx-vll>
      </div>
    </div>

    <div class="d-flex flex-column flex-grow-1 mb-2">
      <codx-temp-full [title]="itemDetail?.ownerName" [subTitle]="itemDetail?.ownerPosition ?? ''"
        [imageId]="itemDetail?.owner" imageObjType="AD_Users" [imageWidth]="40">
      </codx-temp-full>
    </div>
    <div class="d-flex flex-grow-1 mb-2">
      <div class="me-4 icon-apartment"></div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fs-6">
          <codx-label fiedName="OrgUnitID" [formModel]="formModel" class="fw-bold me-1"></codx-label>
          : {{ itemDetail?.ownerOrgUnit }}
        </div>
      </div>
    </div>

    <div class="d-flex mt-1 flex-grow-1 mb-2">
      <div class="d-flex me-6">
        <codx-label fiedName="CreatedOn" [formModel]="formModel" class="fw-bold me-1">
        </codx-label>
        <span class="text-gray-600">
          :
          {{ itemDetail?.createdOn | fmDT }}
        </span>
      </div>
      <div class="d-flex me-6">
        <codx-label fiedName="ExpiredOn" [formModel]="formModel" class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          :
          {{ itemDetail?.permissions?.expiredOn | fmDT }}
        </span>
      </div>
      <div class="d-flex text-dark me-6">
        <codx-label fiedName="Priority" [formModel]="formModel" class="fw-bold me-1">
        </codx-label>
        :
        <codx-vll [formModel]="formModel" [field]="'Priority'" [value]="itemDetail?.priority" [showText]="true"
          [showIcon]="true" class="text-gray-600 d-flex">
        </codx-vll>
      </div>
    </div>
    <div class="d-flex mb-2">
      <div class="d-flex me-6">
        <codx-label fiedName="RefNo" [formModel]="formModel" class="fw-bold me-1">
        </codx-label>
        <span class="text-gray-600">
          : {{ itemDetail ? itemDetail?.refNo : "" }}
        </span>
      </div>
      <div class="d-flex me-6">
        <codx-label fiedName="RefDate" [formModel]="itemDetailTemplate.formModel" class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          :
          {{ itemDetail?.refDate | fmDT }}
        </span>
      </div>
    </div>
    <div class="mb-2">
      <ng-container *ngIf="files.length > 0">
        <codx-thumbnail [files]="files" displayThumb="simple" [hideHover]="'0'"> </codx-thumbnail>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #body>
    <div class="tab-horizone h-od-tab h-100">
      <ul ngbNav #nav="ngbNav" [(activeId)]="itemDetailStt" class="nav-tabs">
        <li [ngbNavItem]="1">
          <a class="ps-0" ngbNavLink>
            <div class="d-flex align-item-center">
              <span class="icon-info icon-18 me-2" [ngClass]="{ 'text-primary': itemDetailStt === 1 }"></span><span>
                <codx-label name="lblAbstract" [formModel]="itemDetailTemplate.formModel" default="Mô tả ngắn gọn"
                  class="fw-bold"></codx-label>
              </span>
            </div>
          </a>
          <ng-template ngbNavContent>
            <ng-container *ngIf="itemDetail?.abstract; else defaulEmpt">
              <div class="summary mt-2" *ngIf="itemDetailStt == '1'">
                {{ itemDetail?.abstract }}
              </div>
            </ng-container>
          </ng-template>
        </li>
        <li [ngbNavItem]="2">
          <a ngbNavLink>
            <div class="d-flex align-item-center">
              <span class="icon-format_list_numbered icon-18 me-2"
                [ngClass]="{ 'text-primary': itemDetailStt === 2 }"></span><span>
                <codx-label name="lblBusiness" [formModel]="itemDetailTemplate.formModel" default="Công việc"
                  class="fw-bold"></codx-label>
              </span>
            </div>
          </a>
          <ng-template ngbNavContent>
            <ng-container *ngIf="taskViews != null; else defaulEmpt">
              <ng-container *ngIf="taskViews != null">
                <codx-treeview #treeAdd id="treeAdd" [data]="taskViews[0]" [showSearch]="false"
                  [itemTemplate]="templateorg" [autoLoad]="false" [isOutput]="true" [isLoadChild]="false">
                </codx-treeview>
              </ng-container>
            </ng-container>
          </ng-template>
        </li>
        <li [ngbNavItem]="3">
          <a ngbNavLink>
            <div class="d-flex align-item-center">
              <span class="icon-people_alt icon-18 me-2"
                [ngClass]="{ 'text-primary': itemDetailStt === 3 }"></span><span>
                <codx-label name="lblApprovalTrans" [formModel]="itemDetailTemplate.formModel" default="Quy trình duyệt"
                  class="fw-bold"></codx-label>
              </span>
            </div>
          </a>
          <ng-template ngbNavContent>
            <ng-container *ngIf="itemDetailStt === 3; else defaulEmpt">
              <codx-approval-step [transID]="transID" [approveStatus]="itemDetail?.approveStatus">
              </codx-approval-step>
            </ng-container>
          </ng-template>
        </li>
      </ul>
      <div [ngbNavOutlet]="nav" class="pt-5"></div>
    </div>
  </ng-template>

  <ng-template #footer>
    <codx-tabs [entityName]="formModel.entityName" [objectID]="itemDetail?.transID" [funcID]="formModel.funcID"
      [dataReferences]="dataReferences" [vllRefType]="vllRefType">
    </codx-tabs>
  </ng-template>

  <ng-template #templateorg let-data>
    <div class="container-fluid justify-content-between d-flex">
      <div class="d-flex align-items-top mt-5">
        <codx-temp-full [imageId]="data?.userID" [imageObjType]="'AD_Users'" [title]="data?.userName" [titleLine]="2"
          [subTitle]="data?.positionNameCreate" [desc]="data?.taskName" [dataItem]="data" [footer]="footerTask">
        </codx-temp-full>
      </div>
      <div class="mt-5 ms-5 justify-content-end w-120px text-center" *ngIf="data?.items?.length == 0">
        <codx-vll [name]="'L0614'" [value]="data?.status" [showText]="true" [showBgColor]="true"
          [formModel]="formModel"></codx-vll>
        <div class="progress h-6px w-100 mt-2">
          <div class="progress-bar bg-primary" role="progressbar" [style.width.%]="data?.percentage" aria-valuenow="50"
            aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="d-flex mt-2">
          <span class="icon-schedule icon-16 text-gray-600"></span>
          <span class="ms-2 text-dark">{{ data?.dueDate | fmDT }}</span>
        </div>
      </div>
    </div>
  </ng-template>
</codx-detail-tmp>
<ng-template #footerTask let-data>
  <div class="d-flex align-items-center mt-2" [style.marginLeft.px]="50">
    <div class="d-flex align-items-center">
      <span class="icon-person me-1" [class.text-muted]="data?.items.length == 0"
        [class.text-primary]="data?.items.length > 0"></span>
      <span class="text-dark" *ngIf="data?.items.length > 0">{{
        data?.items.length
        }}</span>
    </div>
    <div class="d-flex align-items-center ms-6">
      <span class="icon-chat_bubble_outline me-1 text-muted"></span>
      <span class="text-dark"></span>
    </div>
    <div class="d-flex align-items-center ms-6">
      <span class="icon-attach_file me-1 text-muted"></span>
      <span class="text-dark"></span>
    </div>
  </div>
</ng-template>
<ng-template #taskViewDetail let-user>
  <div class="user_Info">
    <div class="d-flex">
      <div class="me-4">
        <codx-img #image [objectId]="user.owner" objectType="AD_Users"></codx-img>
      </div>
      <div class="info">
        <h1>
          {{ user.userName }}
        </h1>
        <div>
          {{ user.positionName }}
        </div>
        <div *ngIf="
            user.category == '1' || user.category == '3';
            else templatetaskName
          ">
          {{ user.memo }}
        </div>
        <ng-template #templatetaskName>
          <div>
            {{ user.taskName }}
          </div>
        </ng-template>
        <div class="icons d-flex">
          <a class="icon icon-person">
            {{ user.items?.length }}
          </a>
          <a class="icon icon-sms">
            {{ user.comments || 0 }}
          </a>
          <a class="icon icon-attachment">
            {{ user.attachments || 0 }}
          </a>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #defaulEmpt>
  <div class="container h-100">
    <div class="list-empty card card-flush h-100">
      <div class="d-flex flex-column flex-center justify-content-center">
        <img src="../assets/themes/sys/default/img/DataEmpty.svg" class="w-200px" />
        <div class="fw-bold mt-1 text-center">
          {{ "SYS011" | mssg | async }}
        </div>
        <!-- <div class="mt-2 text-center">Chưa có dữ liệu phát sinh.</div> -->
      </div>
    </div>
  </div>
</ng-template>

<ng-template #addCancelComment let-dialogCancel>
  <div class="codx-form card w-100 h-100 rounded-0 border-0">
    <div class="card-header flex-column">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="card-title">
          <div class="d-flex flex-column">
            <codx-label class="dialog-title line-clamp line-clamp-1" name="lblEquipment" default="Nhập tên"
              formName="EmailTemplates" gridViewName="grvEmailTemplates"></codx-label>
          </div>
        </div>
        <div class="card-toolbar">
          <button type="button" class="btn btn-flex text-dark-75 text-hover-primary px-0"
            (click)="closeDialogCancel(dialogCancel)">
            <span class="icon-close icon-18"></span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="form-group me-3">
        <codx-label default="Tình trạng" formModel="formModel" fiedName="ApproveStatus">
        </codx-label>
        <codx-input type="text" field="approveStatus" [crrValue]="'0'" [formModel]="formModel" [disabled]="true">
        </codx-input>
      </div>
      <div class="form-group me-3">
        <codx-label default="Bình luận" formModel="formModel" name="lblComment">
        </codx-label>
        <codx-input type="textarea" [crrValue]="comment" field="comment" (valueChange)="valueChange($event)"
          format="td">
        </codx-input>
      </div>
    </div>
    <div class="card-footer border-0">
      <div class="d-flex justify-content-end">
        <a class="btn btn-primary fw-bold" (click)="saveComment(dialogCancel)">
          <codx-label name="lblSave" default="Lưu" [formModel]="formModel">
          </codx-label>
        </a>
      </div>
    </div>
  </div>
</ng-template>