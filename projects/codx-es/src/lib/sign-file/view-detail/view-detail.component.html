<codx-detail-tmp #itemDetailTemplate [header]="header" [dataItem]="itemDetail" [body]="body" [footer]="footer"
  [formModel]="formModel" (clickMF)="openFormFuncID($event)">

  <ng-template #header>
    <div class="vmd-detail">
      <div class="d-flex justify-content-between flex-grow-1 mb-2">
        <div class="d-flex align-items-center">

          <codx-temp-full [title]="itemDetail?.title"
            [icoCss]="'w-20px h-20px fs-7 d-flex justify-content-center align-items-center rounded-circle me-2 ' +itemDetail?.icon"
            [icoStyle]="setStyles(itemDetail?.color)">
          </codx-temp-full>
        </div>
        <div class="d-flex align-self-center">
          <codx-vll [showText]="true" [formModel]="formModel" [field]="'ApproveStatus'"
            [value]="itemDetail?.approveStatus" class="badge badge-light badge-square badge-md fs-7">
          </codx-vll>
        </div>
      </div>
    </div>

    <div class="d-flex flex-column flex-grow-1 mb-2">
      <codx-temp-full [title]="itemDetail?.ownerName" [subTitle]="itemDetail?.ownerPosition ?? 'Vị trí công việc'"
        [imageId]="itemDetail?.createdBy" imageObjType="AD_Users" [imageWidth]="40">
      </codx-temp-full>
    </div>
    <div class="d-flex flex-grow-1 mb-2">
      <div class="me-4 icon-apartment"></div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fs-6">
          <codx-label field="OrgUnitID" [formModel]="formModel" default="Phòng " class="fw-bold me-1"
            style="font-weight: bold"></codx-label>
          : {{ itemDetail?.ownerOrgUnit }}
        </div>
      </div>
    </div>

    <div class="d-flex mt-1 flex-grow-1 mb-2">
      <div class="d-flex me-6">
        <codx-label field="CreatedOn" [formModel]="formModel" default="Ngày yêu cầu" class="fw-bold me-1">
        </codx-label>
        <span class="text-gray-600">
          : {{itemDetail? (itemDetail?.createdOn | date: "dd/MM/yyyy"): "dd/MM/yyyy"}}
        </span>
      </div>
      <div class="d-flex me-6">
        <codx-label field="ExpiredOn" [formModel]="formModel" default="Ngày hết hạn" class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          : {{
          itemDetail?.permission
          ? (itemDetail?.permissions?.expiredOn | date: "dd/MM/yyyy")
          : "dd/MM/yyyy"
          }}
        </span>
      </div>
      <div class="d-flex text-dark me-6">
        <codx-label fiedName="Priority" [formModel]="formModel" default="Ưu tiên" class="fw-bold me-1">
        </codx-label>
        <!-- <span class="icon-flag icon-16" [style.color]="
            itemDetail
              ? (itemDetail?.priority | vll: 'L0186':'color' | async)
              : ''
          "></span>
        <span class="text-gray-600">
          {{
          itemDetail
          ? (itemDetail?.priority | vll: "L0186":"text" | async)
          : ""
          }}
        </span> -->
        : <codx-vll [formModel]="formModel" [field]="'Priority'" [value]="itemDetail?.priority" [showText]="true"
          class="text-gray-600">
        </codx-vll>
      </div>
    </div>
    <div class="d-flex mb-2">
      <div class="d-flex me-6">
        <codx-label field="RefNo" [formModel]="itemDetailTemplate.formModel" default="Số văn bản" class="fw-bold me-1">
        </codx-label>
        <span class="text-gray-600">
          : {{ itemDetail ? itemDetail?.refNo : "" }}
        </span>
      </div>
      <div class="d-flex me-6">
        <codx-label field="RefDate" [formModel]="itemDetailTemplate.formModel" default="Ngày tham chiếu"
          class="fw-bold me-1"></codx-label>
        <span class="text-gray-600">
          : {{
          itemDetail
          ? (itemDetail?.refDate | date: "dd/MM/yyyy")
          : "dd/MM/yyyy"
          }}
        </span>
      </div>
    </div>
    <div class="mb-2">
      <codx-attachment #attachment [objectType]="formModel.entityName" hideBtnSave="1" hideFolder="1" hideUploadBtn="1"
        hideDes="1" [functionID]="" [objectId]="itemDetail?.recID" [allowMultiFile]="1" [functionID]="formModel.funcID">
      </codx-attachment>
      <!-- <codx-attachment #attachment objectType="ES_SignFiles" hideImageUpload="0"
      [objectId]="dialogSignFile.value.recID" hideBtnSave="1" hideFolder="1" hideUploadBtn="0"
      [functionID]="formModel.funcID" type="inline" (fileCount)="getfileCount($event)">
    </codx-attachment> -->
    </div>

    <div class="codx_e-header mb-2" [class.active]="true">
      <div class="d-flex align-items-center btn-tabs">
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailStt == '1'"
          (click)="clickChangeItemViewStatus('1', itemDetail?.recID)">
          <i class="icon-info icon-16"></i>
          <codx-label name="lblAbstract" [formModel]="itemDetailTemplate.formModel" default="Mô tả ngắn gọn"
            class="ms-1 fw-bold"></codx-label>
        </button>
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailStt == '2'"
          (click)="clickChangeItemViewStatus('2', itemDetail?.recID)">
          <i class="icon-format_list_numbered icon-16"></i>
          <codx-label name="lblBusiness" [formModel]="itemDetailTemplate.formModel" default="Công việc"
            class="ms-1 fw-bold"></codx-label>
        </button>
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailStt == '3'"
          (click)="clickChangeItemViewStatus('3', itemDetail?.recID)">
          <i class="icon-people_alt icon-16"></i>
          <codx-label name="lblApprovalTrans" [formModel]="itemDetailTemplate.formModel" default="Quy trình duyệt"
            class="ms-1 fw-bold"></codx-label>
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #body>
    <div class="container mb-2">
      <div class="summary mt-2" *ngIf="itemDetailStt == '1'">
        {{ itemDetail?.abstract }}
      </div>
      <div class="list_Of_Jobs mb-2" *ngIf="itemDetailStt == '2'">
        <ng-container *ngIf="taskViews[0].length>0">
          <codx-treeview #treeAdd id="treeAdd" [data]="taskViews[0]" [showSearch]="false" [itemTemplate]="templateorg"
            [autoLoad]="false" [isOutput]="true" [isLoadChild]="false"></codx-treeview>
        </ng-container>
        <!-- <ng-container>
          <codx-treeview #treeAdd id="treeAdd" [data]="taskViews" [showSearch]="false" [itemTemplate]="taskViewDetail"
            [autoLoad]="false" [isOutput]="true" [isLoadChild]="false">
          </codx-treeview>
        </ng-container> -->
      </div>
      <div *ngIf="itemDetailStt == '3'" class="mb-2">
        <lib-view-approval-process [transID]="transID" [approveStatus]="itemDetail?.approveStatus">
        </lib-view-approval-process>

        <div class="row w-100" *ngFor="let part of process; let index = index">
          <div class="col-12">
            <div class="codx-approval">
              <div class="codx-approval-step step-test pb-3">
                <div class="codx-approval-header d-flex align-items-center mb-4">
                  <div class="step-number" [class.active]="part.isActived.lenght > 0 ? true : false">
                    {{ part.stepNo }}
                  </div>
                  <div class="step-title text-gray-800 fw-bold fs-4">
                    {{ part.stepType | vll: "ES002":"text" | async }}
                  </div>
                  <div class="badge badge-success badge-sm badge-circle ms-3"
                    *ngIf="part.isActived.lenght > 0 ? true : false">
                    <span class="icon-check icon-16"></span>
                  </div>
                </div>
                <div class="codx-approval-content ms-17" *ngFor="let approve of part.approvers">
                  <div class="d-flex align-items-top justify-content-between mb-3">
                    <codx-temp-full [imageId]="approve.approver" imageObjType="AD_Users" [imageWidth]="35"
                      [title]="approve.approverName" [desc]="approve.approverPosition" [desc2]="approve.comment">
                    </codx-temp-full>
                    <div class="d-flex align-items-center text-center">
                      <div class="d-flex flex-column">
                        <div class="text-dark fw-bold">
                          {{ approve.status | vll: "ES003":"text" | async }}
                        </div>
                        <div *ngIf="approve.status == '1'">
                          <div class="badge badge-danger">
                            {{ approve.leadtime }}
                          </div>
                        </div>
                        <!-- <div class="badge my-1 badge-primary" *ngIf="
                            approve.duration <= approve.leadtime;
                            else inQueue
                          ">
                          {{ getHour("2022-07-06T00:00:00Z", 0) }}
                          -cc
                          {{ getHour(approve.activedOn, approve.leadtime) }}
                        </div>
                        <ng-template #inQueue>
                          <div class="badge badge-danger">
                            {{ approve.leadtime }}
                          </div>
                        </ng-template>
                        <div class="text-gray-600 fs-7" *ngIf="approve.approvedOn ? true : false">
                          {{ approve.approvedOn | date: "medium" }}
                        </div> -->
                      </div>
                      <div class="ms-6 d-flex">
                        <span class="icon-attach_file icon-18 me-1"></span>
                        <span class="text-dark">
                          {{
                          approve.attachments ? approve.attachments : 0
                          }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #footer class="task-info">
    <div class="codx_e-header">
      <div class="d-flex align-items-center btn-tabs">
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailDataStt == '1'"
          (click)="clickChangeItemDetailDataStatus('1')">
          <i class="icon-history icon-16"></i>
          <span class="ms-2 fw-bold">Lịch sử</span>
        </button>
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailDataStt == '2'"
          (click)="clickChangeItemDetailDataStatus('2')">
          <i class="icon-message icon-16"></i>
          <codx-label name="lblDiscussion" [formModel]="itemDetailTemplate.formModel" default="Thảo luận"
            class="ms-2 fw-bold"></codx-label>
        </button>
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailDataStt == '3'"
          (click)="clickChangeItemDetailDataStatus('3')">
          <i class="icon-attach icon-16"></i>
          <codx-label name="lblAttachment" [formModel]="itemDetailTemplate.formModel" default="Đính kèm"
            class="ms-2 fw-bold"></codx-label>
        </button>
        <button class="btn btn-white text-dark me-1" [class.active]="itemDetailDataStt == '4'"
          (click)="clickChangeItemDetailDataStatus('4')">
          <i class="icon-insert_link icon-16"></i>
          <codx-label name="lblLink" [formModel]="itemDetailTemplate.formModel" default="Liên kết" class="ms-2 fw-bold">
          </codx-label>
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #templateorg let-data>
    <div class="container-fluid justify-content-between d-flex">
      <div class="d-flex align-items-top mt-5">
        <codx-temp-full [imageId]="data?.userID" [imageObjType]="'AD_Users'" [title]="data?.userName" [titleLine]="2"
          [subTitle]="data?.positionNameCreate" [desc]="data?.taskName" [dataItem]="data" [footer]="footerTask">
        </codx-temp-full>
      </div>
      <div class="mt-5 ms-5 justify-content-end w-120px text-center" *ngIf="data?.items?.length == 0">
        <codx-vll [name]="'L0614'" [value]="data?.status" [showText]="true" [showBgColor]="false"></codx-vll>
        <div class="progress h-6px w-100 mt-2">
          <div class="progress-bar bg-primary" role="progressbar" [style.width.%]="data?.percentage" aria-valuenow="50"
            aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="d-flex mt-2">
          <span class="icon-schedule icon-16 text-gray-600"></span>
          <span class="ms-2 text-dark">{{data?.dueDate | date: "dd/MM/yyyy"}}</span>
        </div>
      </div>
    </div>
  </ng-template>
</codx-detail-tmp>
<ng-template #footerTask let-data>
  <div class="d-flex align-items-center mt-2" [style.marginLeft.px]="50">
    <div class="d-flex align-items-center">
      <span class="icon-person me-1" [class.text-muted]="data?.items.length == 0"
        [class.text-primary]="data?.items.length > 0"></span>
      <span class="text-dark" *ngIf="data?.items.length > 0">{{data?.items.length}}</span>
    </div>
    <div class="d-flex align-items-center ms-6">
      <span class="icon-chat_bubble_outline me-1 text-muted"></span>
      <span class="text-dark"></span>
    </div>
    <div class="d-flex align-items-center ms-6">
      <span class="icon-attach_file me-1 text-muted"></span>
      <span class="text-dark"></span>
    </div>
  </div>
</ng-template>
<ng-template #taskViewDetail let-user>
  <div class="user_Info">
    <div class="d-flex">
      <div class="me-4">
        <codx-img #image [objectId]="user.owner" objectType="AD_Users"></codx-img>
      </div>
      <div class="info">
        <h1>
          {{ user.userName }}
        </h1>
        <div>
          {{ user.positionName }}
        </div>
        <div *ngIf="
            user.category == '1' || user.category == '3';
            else templatetaskName
          ">
          {{ user.memo }}
        </div>
        <ng-template #templatetaskName>
          <div>
            {{ user.taskName }}
          </div>
        </ng-template>
        <div class="icons d-flex">
          <a class="icon icon-person">
            {{ user.items?.length }}
          </a>
          <a class="icon icon-sms">
            {{ user.comments || 0 }}
          </a>
          <a class="icon icon-attachment">
            {{ user.attachments || 0 }}
          </a>
        </div>
      </div>
    </div>
  </div>
</ng-template>
