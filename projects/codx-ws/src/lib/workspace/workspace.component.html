<div class="f-flex flex-column w-100 h-100">
    <div class="spinner_panel" *ngIf="loading">
      <div class="loader"></div>
    </div>
    <!-- <div #header class="my-3">
        <lib-header [funcID]="funcID"></lib-header>
    </div> -->
    <div #body class="bg-white h-100 mx-3 mt-4 d-flex flex-column pt-4 pb-60px px-6 scroll-y">
        <!-- begin content -->
          <ng-container *ngFor="let md of modules">
            <div class="d-flex flex-column my-2">
              <div class="d-flex align-items-center">
                <span class="icon-16" [ngClass]="md.largeIcon"></span>
                <span class="fs-4 ms-2 fw-bold">{{md.customName}}</span>
              </div>
              <div class="mx-7"><span class="fs-6 text-gray-800">{{md.countsNote}}</span></div>
              <div class="d-flex flex-wrap mx-4">
                <div class="d-flex flex-column w-200px h-150px rounded-1 wsp-bg-primary m-2 text-white p-3 cursor-pointer" 
                  *ngFor="let c of md.childs" (click)="selectedChange(c)"
                  [style.backgroundColor]="c?.color"
                >
                  <div class="d-flex flex-column h-100">
                    <span class="fs-5-sm">{{c.customName}}</span>
                    <span class="fs-7 opacity-75">{{c.countsNote}}</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center h-50px">
                    <ng-container *ngIf="c?.smallIcon">
                      <img class="w-40px h-40px" [src]="c.smallIcon"/>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        <!-- end content -->
    </div>
    <!-- Speed dial -->
    <div class="speedial">
      <ejs-tooltip id="details" target=".tooltip-speeddial .e-speeddial-li" position="LeftCenter">
        <div id="target" class="speeddial-appearence-target custom-index">
            <button ejs-speeddial id="speeddial1" [disabled]="disabledSpeedDial"
              target="#target" 
              position="BottomRight" 
              content="AI Tool"
              [items]="speedDialItems"
              itemTemplate="#itemTemplate">
              <ng-template #itemTemplate let-item>
                  <div class="itemlist" (click)="openPoup(item)">
                      <span [class]="item.iconCss" style="padding:3px"></span>
                      <span class="text">{{item.text}}</span>
                  </div>
              </ng-template>
          </button>
        </div>
      </ejs-tooltip>
    </div>
</div>


<!-- CV -->
<ng-template #popupCV let-dialog>
  <codx-form [dialog]="dialog" [formModel]="dialog.formModel" headerText="UPload CV" [subHeader]="CVSubHeader" [body]="CVBody" [footer]="CVFooter" >
  </codx-form>
  <ng-template #CVSubHeader>
    <div class="d-flex flex-column justify-content-end">
      <label for="exampleFormControlInput1" class="form-label">Selected File:</label>
      <input type="file" id="exampleFormControlInput1" class="w-100 cursor-pointer" (change)="onSelectFileCV($event)">
    </div>
  </ng-template>
  <ng-template #CVBody>
    <div class="px-4 py-3 overflow-auto">
      <div class="mb-3" *ngIf="cvModel.name">
        <label for="exampleFormControlInput2" class="form-label">Họ Tên</label>
        <input type="text" class="form-control" id="exampleFormControlInput2" placeholder="Họ và tên" [value]="cvModel.name">
      </div>
      <div class="mb-3" *ngIf="cvModel.birthDay">
        <label for="exampleFormControlInput2" class="form-label">Ngày sinh</label>
        <input type="text" class="form-control" id="exampleFormControlInput2" placeholder="Ngày sinh" [value]="cvModel.birthDay">
      </div>
      <div class="mb-3" *ngIf="cvModel.phone">
        <label for="exampleFormControlInput3" class="form-label">SĐT</label>
        <input type="text" class="form-control" id="exampleFormControlInput3" placeholder="Số điện thoại" [value]="cvModel.phone">
      </div>
      <div class="mb-3" *ngIf="cvModel.email">
        <label for="exampleFormControlInput4" class="form-label">Email</label>
        <input type="text" class="form-control" id="exampleFormControlInput4" placeholder="Email" [value]="cvModel.email">
      </div>
      <div class="mb-3" *ngIf="cvModel.address">
        <label for="exampleFormControlInput5" class="form-label">Địa chỉ</label>
        <input type="text" class="form-control" id="exampleFormControlInput5" placeholder="Địa chỉ" [value]="cvModel.address">
      </div>
      <div class="mb-3" *ngIf="cvModel.educations?.length > 0">
        <label for="exampleFormControlInput6" class="form-label">Trình độ</label>
        <select class="form-select" aria-label="multiple select example" id="exampleFormControlInput6">
          <ng-container *ngFor="let item of cvModel.educations">
            <option >{{item.date }} - {{item.university}} - {{item.degree}}</option>
          </ng-container>
        </select>
      </div>
      <div class="mb-3" *ngIf="cvModel.skills?.length > 0">
        <label for="exampleFormControlInput7" class="form-label">Kỹ năng</label>
        <select class="form-select" aria-label="multiple select example" id="exampleFormControlInput7">
          <ng-container *ngFor="let item of cvModel.skills">
            <option>{{item}}</option>
          </ng-container>
        </select>
      </div>
      <div class="mb-3" *ngIf="cvModel.experience?.length > 0">
        <label for="exampleFormControlInput8" class="form-label">Kinh nghiệm</label>
        <select class="form-select" aria-label="multiple select example" id="exampleFormControlInput8">
          <ng-container *ngFor="let item of cvModel.experience">
            <option>{{item.date}} - {{item.company}} - {{item.roles}}</option>
          </ng-container>
        </select>
      </div>
      <div class="mb-3" *ngIf="cvModel.projects?.length > 0">
        <label for="exampleFormControlInput8" class="form-label">Dự án cá nhân</label>
        <select class="form-select" aria-label="multiple select example" id="exampleFormControlInput8">
          <ng-container *ngFor="let item of cvModel.projects">
            <option>{{item.name}} - {{item.description}} - {{item.roles}}</option>
          </ng-container>
        </select>
      </div>
      <div class="mb-3" *ngIf="cvModel.result">
        <label class="form-label">Đánh giá</label>
        <codx-input 
          field="result" 
          format="ed" 
          type="textarea" 
          [crrValue]="cvModel.result">
        </codx-input>
      </div>
    </div>
  </ng-template>
  <ng-template #CVFooter>
    <div class="d-flex flex-column justify-content-end">
      <button class="btn btn-primary" (click)="dialog.close()">OK</button>
    </div>
  </ng-template>
</ng-template>

<!-- Email -->
<ng-template #popupEmail let-dialog>
  <codx-form [dialog]="dialog" [formModel]="dialog.formModel" headerText="Soạn thảo Email" [body]="EmailBody" [footer]="EmailFooter" >
  </codx-form>
  <ng-template #EmailBody>
    <div class="py-3 overflow-auto">
      <!-- <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Ngôn ngữ</label>
        <select class="form-select" id="exampleFormControlInput1" (change)="valueChange($event)">
          <ng-container *ngFor="let item of emailModel.language">
          <option [value]="item.text">{{item.text}}</option>
          </ng-container>
        </select>
      </div> -->
      <div class="mb-3">
        <label for="exampleFormControlInput2" class="form-label">Chủ đề</label>
        <codx-input type="text" className="form-control" field="subject" [crrValue]="emailModel.subject" (valueChange)="valueChange($event,'email')" placeholder="Nhập chủ đề">
        </codx-input>
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput3" class="form-label">Nội dung gợi ý</label>
        <codx-input type="textarea" format="ed2" className="form-control" field="contents" [crrValue]="emailModel.contents" (valueChange)="valueChange($event,'email')" placeholder="Nhập nội dung">
        </codx-input>
      </div>
      <!-- <ng-container *ngIf="emailModel.result">
        <div [innerHTML]="emailModel.result" class="border border-secondary p-4"></div>
      </ng-container> -->
      <div class="textarea-keyresult">
        <codx-input 
          field="result" 
          format="ed" 
          type="textarea" 
          [crrValue]="emailModel.result" 
          (valueChange)="valueChange($event,'email')">
        </codx-input>
      </div>
    </div>
  </ng-template>
  <ng-template #EmailFooter>
    <div class="d-flex flex-column justify-content-end">
      <button class="btn btn-primary" (click)="createdMail()">Soạn mail</button>
    </div>
  </ng-template>
</ng-template>

<!-- Social Media -->
<ng-template #popupSocial let-dialog>
  <codx-form [dialog]="dialog" [formModel]="dialog.formModel" headerText="Tạo nội dung" [body]="SocialBody" [footer]="SocialFooter" >
  </codx-form>
  <ng-template #SocialBody>
    <div class="y-3 h-100">
      <!-- <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Ngôn ngữ</label>
        <select class="form-select" id="exampleFormControlInput1" (change)="valueChange($event)">
          <ng-container *ngFor="let item of emailModel.language">
          <option [value]="item.text">{{item.text}}</option>
          </ng-container>
        </select>
      </div> -->
      <div class="mb-3">
        <label for="exampleFormControlInput2" class="form-label">Social media:</label>
        <div class="row">
          <div class="col">
            <select class="form-select" aria-label="Default select example" [(ngModel)]="socialMediaModel.type">
              <ng-container *ngFor="let item of socialMediaModel.socialMedias">
                <option [ngValue]="item.text">{{item.text}}</option>
              </ng-container>
            </select>
          </div>
        </div>
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput3" class="form-label">Nội dung gợi ý</label>
        <codx-input type="textarea" format="ed2" className="form-control" field="contents" [crrValue]="socialMediaModel.contents" (valueChange)="valueChange($event,'social media')" placeholder="Nhập nội dung">
        </codx-input>
      </div>
      <!-- <ng-container *ngIf="socialMediaModel.result">
        <div [innerHTML]="socialMediaModel.result" class="border border-secondary p-4"></div>
      </ng-container> -->
      <div class="textarea-keyresult">
        <codx-input 
          field="result" 
          format="ed" 
          type="textarea" 
          [crrValue]="socialMediaModel.result">
        </codx-input>
      </div>
    </div>
  </ng-template>
  <ng-template #SocialFooter>
    <div class="d-flex flex-column justify-content-end">
      <button class="btn btn-primary" (click)="createdSocialMedia()">Tạo nội dung</button>
    </div>
  </ng-template>

</ng-template>

<!-- OKR -->
<ng-template #popupOKR let-dialog>
  <codx-form [dialog]="dialog" [formModel]="dialog.formModel" headerText="Tạo Key Result" [body]="OKRBody" [footer]="OKRFooter" >
  </codx-form>
  <ng-template #OKRBody>
    <div class="py-3 h-100">
      <!-- <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Ngôn ngữ</label>
        <select class="form-select" id="exampleFormControlInput1" (change)="valueChange($event)">
          <ng-container *ngFor="let item of emailModel.language">
          <option [value]="item.text">{{item.text}}</option>
          </ng-container>
        </select>
      </div> -->
      <div class="mb-3">
        <label for="exampleFormControlInput3" class="form-label">Object:</label>
        <codx-input type="text" className="form-control" field="target" [crrValue]="okrModel.target" (valueChange)="valueChange($event,'okr')">
        </codx-input>
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput3" class="form-label">Số key:</label>
        <codx-input type="text" className="form-control" field="num_KPI" [crrValue]="okrModel.num_KPI" (valueChange)="valueChange($event,'okr')">
        </codx-input>
      </div>
      <div class="mb-3 textarea-keyresult">
        <codx-input 
          field="result" 
          format="ed" 
          type="textarea" 
          [crrValue]="okrModel.result">
        </codx-input>
      </div>
    </div>
  </ng-template>
  <ng-template #OKRFooter>
    <div class="d-flex flex-column justify-content-end">
      <button class="btn btn-primary" (click)="createdOKR()">Tạo Key Result</button>
    </div>
  </ng-template>
</ng-template>

<!-- Upload files CV -->
<ng-template #popupUploads let-dialog>
  <codx-form [dialog]="dialog" [formModel]="dialog.formModel" headerText="UPloads CV" [body]="body" [footer]="footer" >
  </codx-form>
  <ng-template #body>
    <div class="h-100" *ngIf="jsonExports.length > 0">
      <table class="table h-100">
        <thead>
          <tr class="table-secondary">
            <th>STT</th>
            <th>Họ tên</th>
            <th>Email</th>
            <th>SĐT</th>
            <th>Kỹ năng</th>
            <th *ngIf="cellExvalueate">Đánh giá</th>
          </tr>
        </thead>
        <tbody class="overflow-auto">
          <ng-container *ngFor="let item of jsonExports;index as idx">
            <tr>
              <td>{{idx + 1}}</td>
              <td>{{item.name}}</td>
              <td>{{item.phone}}</td>
              <td>{{item.email}}</td>
              <td>
                <ng-container *ngIf="item.skills?.length > 0">
                  <span *ngFor="let skill of item.skills"  class="badge rounded-pill bg-secondary m-1">{{skill}}</span>
                </ng-container>
              </td>
              <td>
                <span *ngIf="item.result" class="text-start">
                  {{item.result.evaluate}}
                </span>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </ng-template>
  <ng-template #footer>
    <div class="d-flex align-items-center justify-content-between w-100">
      <div>
        <span class="icon-photo icon-24 text-success" type="button" data-toggle="tooltip" title="Attach files" (click)="inputFile.click()"></span>
        <input #inputFile type="file" class="d-none" multiple (change)="onSelectFiles($event)">
      </div>
      <div class="w-100 rounded-pill">
        <codx-input type="text" field="request" [placeholder]="'Nhập nội dung'" [crrValue]="request" (valueChange)="valueChange($event,'request')"></codx-input>
      </div>
      <div>
        <span class="icon-send" type="button" (click)="searchCV()"></span>
      </div>
    </div>
  </ng-template>
</ng-template>