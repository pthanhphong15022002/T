<codx-views
  #view
  [views]="views"
  [autoLoad]="false"
  [funcID]="funcID"
  (filterReportChange)="filterChange($event)"
  (onActions)="onActions($event)"
  [moreFuncs]="buttons"
>
</codx-views>

<ng-template #template>
  <div class="w-100 h-100" *ngIf="isLoaded">
    <div *ngIf="funcID == 'TMD001'">
      <ng-container *ngTemplateOutlet="dashboard1"> </ng-container>
    </div>
    <div *ngIf="funcID == 'TMD002'">
      <ng-container *ngTemplateOutlet="dashboard2"> </ng-container>
    </div>
    <div *ngIf="funcID == 'TMD003'">
      <ng-container *ngTemplateOutlet="dashboard3"> </ng-container>
    </div>
  </div>
  <div class="w-100 h-100" *ngIf="!isLoaded">
    <div
      class="d-flex justify-content-center align-items-center h-100 bg-light"
    >
      <div class="col-lg-3 col-md-3 col-3" align="center">
        <div id="rounded-container">
          <!-- <ejs-progressbar
            [id]="newGuid()"
            [type]="'Circular'"
            [maximum]="100"
            [minimum]="0"
            [value]="40"
            [width]="'150'"
            [height]="'150'"
            [isIndeterminate]="true"
            [progressThickness]="10"
            [animation]="{ enable: true, duration: 2000, delay: 0 }"
          >
          </ejs-progressbar> -->
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #dashboard1>
  <codx-dashboard
    #dashboard
    [templates]="templates1"
    [panels]="panels1"
    [datas]="datas1"
    [isEditMode]="isEditMode"
    [cellSpacing]="[10, 10]"
  ></codx-dashboard>
</ng-template>

<ng-template #dashboard2>
  <codx-dashboard
    #dashboard
    [templates]="templates2"
    [panels]="panels2"
    [datas]="datas2"
    [isEditMode]="isEditMode"
    [cellSpacing]="[10, 10]"
  ></codx-dashboard>
</ng-template>

<ng-template #dashboard3
  ><codx-dashboard
    #dashboard
    [templates]="templates3"
    [panels]="panels3"
    [datas]="datas3"
    [isEditMode]="isEditMode"
    [cellSpacing]="[10, 10]"
  ></codx-dashboard
></ng-template>

<!--#region my_dashboard  -->
<ng-template #my_dashboard>
  <div class="w-100 h-100" id="1">
    <div
    class="w-100 h-100 border  border-secondary rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND Status == @2',
          '1;2;10',
          'TMT0201'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Chuathuchien.svg'"
        [title]="'Chưa thực hiện'"
        [value]="getTaskStatus('10')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="2">
    <div
    class="w-100 h-100 border  border-warning rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND Status == @2',
          '1;2;20',
          'TMT0201'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Dangthuchien.svg'"
        [title]="'Đang thực hiện'"
        [value]="getTaskStatus('20')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="3">
    <div
    class="w-100 h-100 border  border-danger rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND IsOverdue == @2',
          '1;2;true',
          'TMT0201'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Quahan.svg'"
        [title]="'Quá hạn'"
        [value]="getOverdueTasks().length"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="4">
    <div
      class="w-100 h-100 border  border-success rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND Status == @2',
          '1;2;90',
          'TMT0201'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Hoantat.svg'"
        [title]="'Hoàn tất'"
        [value]="getTaskStatus('90')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="5">
    <div class="assignchart-group w-100" style="height: 70%">
      <div
        *ngFor="let task of taskByCategory | keyvalue; let i = index"
        class="assignchart-item d-flex align-items-center justify-content-end"
        [title]=""
      >
        <div class="fw-bold me-2">{{ task.value.length }}</div>
        <div
          class="assignchart-task"
          style="color: #000000"
          [style.background-color]="paletteColor[i]"
          [style.width]="
            (task.value.length/dataset.length) * 100 + '%'
          "
        ></div>
      </div>
    </div>
    <div class="w-100" style="height: 30%">
      <div class="d-flex justify-content-around align-items-center">
        <div class="d-flex align-items-center">
          <div
            style="width: 20px; height: 5px; background-color: #a6dff5"
          ></div>
          <div class="ms-2">Được giao</div>
        </div>
        <div class="d-flex align-items-center">
          <div
            style="width: 20px; height: 5px; background-color: #06ddb8"
          ></div>
          <div class="ms-2">Tự tạo</div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="6">
    <ejs-treemap
      align="center"
      style="display: block"
      [dataSource]="taskByRefType"
      [weightValuePath]="'quantity'"
      [palette]="['#005dc7', '#0078ff', '#3699ff', '#d3e8ff']"
      [leafItemSettings]="{
        labelPath: 'refType'
      }"
      [tooltipSettings]="{
        visible: true,
        template:
          '<div><span >${refType}: </span><span >${quantity}</span></div>'
      }"
      enableDrillDown="false"
    >
    </ejs-treemap>
    <!-- <img
      style="width: 100%; height: 100%"
      src="assets/themes/sys/default/img/Empty_TreeMaps.svg"
    /> -->
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="7">
    <div
      class="d-flex justify-content-center align-items-center w-100"
      style="height: 70%"
    >
      <ejs-circulargauge
        class="d-block"
        style="width: 100%; height: 100%"
        background="transparent"
        #circulargauge=""
        [tooltip]="tooltip"
        [legendSettings]="{
          visible: false
        }"
      >
        <e-axes>
          <e-axis
            [title]="'Tỷ lệ hoàn thành công việc'"
            minimum="0"
            radius="100%"
            maximum="100"
            startAngle="0"
            endAngle="360"
            [majorTicks]="{
              height: 0
            }"
            [labelStyle]="{
              position: 'Inside',
              useRangeColor: true,
              font: { size: '0px', fontFamily: 'inherit' }
            }"
            [lineStyle]="{
              width: 0
            }"
            [minorTicks]="{
              height: 0
            }"
            [ranges]="[
              {
                start: 0,
                end: 100,
                radius: '100%',
                startWidth: 12,
                endWidth: 12,
                color: '#E0E0E0'
              }
            ]"
            [pointers]="[
              {
                roundedCornerRadius: 20,
                value: toFixed((getTaskStatus('90')/dataset.length)*100),
                type: 'RangeBar',
                radius: '100%',
                color: '#0078ff',
                border: {
                  width: 0
                },
                animation: {
                  enable: false
                },
                pointerWidth: 12
              }
            ]"
          >
          </e-axis>
          <e-axis
            [title]="'Tỷ lệ hoàn thành đúng hạn'"
            minimum="0"
            radius="80%"
            maximum="100"
            startAngle="0"
            endAngle="360"
            [majorTicks]="{
              height: 0
            }"
            [labelStyle]="{
              position: 'Inside',
              useRangeColor: true,
              font: { size: '0px', fontFamily: 'inherit' }
            }"
            [lineStyle]="{
              width: 0
            }"
            [minorTicks]="{
              height: 0
            }"
            [ranges]="[
              {
                start: 0,
                end: 100,
                radius: '70%',
                startWidth: 12,
                endWidth: 12,
                color: '#E0E0E0'
              }
            ]"
            [pointers]="[
              {
                roundedCornerRadius: 20,
                value: toFixed(getTasksDoneOntime().length),
                type: 'RangeBar',
                radius: '70%',
                color: '#2cd9c5',
                border: {
                  width: 0
                },
                animation: {
                  enable: false
                },
                pointerWidth: 12
              }
            ]"
          >
          </e-axis>
        </e-axes>
      </ejs-circulargauge>
    </div>
    <div class="container w-100" style="height: 30%">
      <div class="d-flex justify-content-center align-items-center">
        <div class="m-2">
          <div class="d-flex align-items-center">
            <div
              class="me-2"
              style="
                height: 10px;
                width: 10px;
                border-radius: 10%;
                background-color: #5465ff;
              "
            ></div>
            <span style="font-size: 0.75vw">Tỷ lệ hoàn thành công việc</span>
          </div>
          <div class="ms-6">
            <span class="fw-bold fs-4"
              >{{ toFixed((getTaskStatus('90')/dataset.length)*100) }}%</span
            >
          </div>
        </div>
        <div class="m-2">
          <div class="d-flex align-items-center">
            <div
              class="me-2"
              style="
                height: 10px;
                width: 10px;
                border-radius: 10%;
                background-color: #04deb7;
              "
            ></div>
            <span style="font-size: 0.75vw"
              >Tỷ lệ hoàn thành công việc đúng hạn</span
            >
          </div>
          <div class="ms-6">
            <span class="fw-bold fs-4"
              >{{ toFixed(getTasksDoneOntime().length) }}%</span
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="8">
    <div
      class="d-flex justify-content-center align-items-center w-100"
      style="height: 70%"
    >
      <div style="position: relative" class="w-100 h-100">
        <ejs-circulargauge class="d-block" style="width: 100%; height: 100%">
          <e-axes>
            <e-axis
              [lineStyle]="lineStyle"
              radius="100%"
              startAngle="230"
              endAngle="130"
              minimum="0"
              maximum="150"
              [labelStyle]="labelStyle1"
              [majorTicks]="majorTicks1"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="100%"
                  roundedCornerRadius="15"
                  color="#FF8008"
                  [linearGradient]="rangeLinearGradient2"
                  startWidth="15"
                  endWidth="15"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="Marker"
                  [value]="(getEtimated()/getTotalTime())*100"
                  markerShape="Image"
                  imageUrl="./assets/themes/tm/default/img/Button.svg"
                  radius="90%"
                  markerWidth="30"
                  markerHeight="30"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div
          style="
            position: absolute;
            top: 50%;
            right: 50%;
            transform: translate(50%, -50%);
          "
        >
          <p class="text-center text-gray-900 fw-bold fs-4" style="margin: 0px">
            {{ toFixed((getEtimated()/getTotalTime())*100) }} %
          </p>
        </div>
      </div>
    </div>
    <div class="w-100" style="height: 3 0%">
      <div class="d-flex justify-content-between align-items-center">
        <div class="w-100 h-100 d-flex flex-column justify-content-center">
          <div class="fw-bold text-center" style="font-size: 0.75vw">
            Tổng thời gian hoàn thành thực tế
          </div>
          <div class="d-flex justify-content-center align-items-center">
            <div class="fw-bold" style="font-size: 1.75vw">
              {{toFixed(getTotalTime())}}
            </div>
            <div class="ms-2" style="font-size: 0.75vw">giờ</div>
          </div>
        </div>
        <div class="w-100 h-100 d-flex flex-column justify-content-center">
          <div class="fw-bold text-center" style="font-size: 0.75vw">
            Tổng thời gian làm việc
          </div>
          <div class="d-flex justify-content-center align-items-center">
            <div class="fw-bold" style="font-size: 1.75vw">
              {{ toFixed(getEtimated()) }}
            </div>
            <div class="ms-2" style="font-size: 0.75vw">giờ</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="9">
    <div class="p-2 w-100 h-100">
      <div class="d-flex justify-content-center h-10">
        <div id="group1" class="btn-group">
          <input
            class="btn-check"
            type="radio"
            id="left1"
            name="align1"
            value="left"
            checked
          />
          <label class="btn btn-outline-primary" for="left1">Số lượng</label>
          <input
            class="btn-check"
            type="radio"
            id="center1"
            name="align1"
            value="center"
          />
          <label class="btn btn-outline-primary" for="center1">Thời gian</label>
        </div>
      </div>
      <div id="column" style="height: 40%">
        <ejs-accumulationchart
          #pie1
          class="d-block"
          style="height: 100%; width: 100%"
          [tooltip]="tooltip"
          [centerLabel]="{
            text:
            getTaskGroups().length + '<br>công việc'
          }"
          [legendSettings]="{ visible: false }"

        >
          <e-accumulation-series-collection>
            <e-accumulation-series
              [dataLabel]="dataLabel"
              [dataSource]="taskByGroup"
              xName="groupName"
              yName="quantity"
              startAngle="0"
              innerRadius="80%"
              radius="70%"
              [explode]="true"
              [explodeOffset]="'10%'"
              [palettes]="palettes"
            >
            </e-accumulation-series>
          </e-accumulation-series-collection>
        </ejs-accumulationchart>
      </div>
      <div class="h-50 position-relative">
        <div
          class="position-absolute overflow-x-hidden"
          style="max-height: 100%; width: 100%"
        >
          <div *ngFor="let data of taskByGroup" class="mt-4">
            <div class="mx-2 my-5">
              <div class="d-flex justify-content-between">
                <div>
                  <span>{{ data.groupName }}</span>
                  <span>&nbsp;(</span>
                  <span>{{ data.quantity }}</span>
                  <span>)</span>
                </div>
                <div>
                  <span>{{
                    toFixed((data.quantity/dataset.length)*100)
                  }}</span
                  ><span>% </span>
                </div>
              </div>
              <div class="d-flex align-items-center min-w-200px">
                <div class="h-5px w-100 bg-gray-200 rounded-4">
                  <div
                    class="rounded-4 h-5px"
                    role="progressbar"
                    [style.width]="(data.quantity/dataset.length)*100 + '%'"
                    [style.background-color]="'#3699ff'"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #my_dashboard>
  <div class="w-100 h-100" id="10">
    <ejs-chart
      style="display: block"
      align="center"
      width="100%"
      height="100%"
      [id]="newGuid()"
      [tooltip]="{ enable: true }"
      [primaryXAxis]=" {
        valueType: 'Category',
        majorGridLines: { width: 0 },
    } "
      [primaryYAxis]="{
        majorTickLines: { width: 0 }, lineStyle: { width: 0 }
    }"
    [palettes]="paletteColor"
    >
      <e-series-collection>
        <e-series
          [dataSource]="doneTasks"
          type="Line"
          [xName]="'taskID'"
          [yName]="'completed'"
          name="WorkHours"
          [marker]="circleMarker"
        >
        </e-series>
        <e-series
          [dataSource]="doneTasks"
          type="Column"
          [xName]="'taskID'"
          [yName]="'estimated'"
          name="Tasks"
        >
        </e-series>
      </e-series-collection>
    </ejs-chart>
  </div>
</ng-template>

<!--#endregion -->

<!--#region team_dashboard  -->
<ng-template #team_dashboard>
  <div class="w-100 h-100" id="1">
    <div
      class="w-100 h-100 border  border-secondary rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND Status == @2',
          '1;2;10',
          'TMT0202'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Chuathuchien.svg'"
        [title]="'Chưa thực hiện'"
        [value]="getTaskStatus('10')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="2">
    <div
    class="w-100 h-100 border  border-warning rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND Status == @2',
          '1;2;20',
          'TMT0202'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Dangthuchien.svg'"
        [title]="'Đang thực hiện'"
        [value]="getTaskStatus('20')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="3">
    <div
    class="w-100 h-100 border  border-danger rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND IsOverdue == @2',
          '1;2;true',
          'TMT0202'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Quahan.svg'"
        [title]="'Quá hạn'"
        [value]="getOverdueTasks().length"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="4">
    <div
    class="w-100 h-100 border  border-success rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks(
          '(Category == @0 OR Category == @1) AND Status == @2',
          '1;2;90',
          'TMT0202'
        )
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Hoantat.svg'"
        [title]="'Hoàn tất'"
        [value]="getTaskStatus('90')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="5">
    <div
      class="w-100 h-100 d-flex justify-content-start align-items-center p-2"
    >
      <div class="d-flex align-items-center">
        <div class="progress-container">
          <div class="progress-container-align position-relative">
            <div
              class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center"
            >
              <span class="fw-bold" style="font-size: 0.5vw"
                >{{
                  toFixed(
                    (getTasksDoneOntime().length /
                    dataset.length) *
                      100
                  )
                }}%</span
              >
            </div>
            <ejs-progressbar
              #annotation1
              [id]="newGuid()"
              [type]="'Circular'"
              [maximum]="dataset.length"
              [minimum]="0"
              [value]="getTasksDoneOntime().length"
              [width]="'75'"
              [height]="'75'"
              [trackThickness]="10"
              [progressThickness]="10"
              [animation]="animation"
            >
            </ejs-progressbar>
          </div>
        </div>
      </div>
      <div class="p-2">
        <div class="fw-bold">Đúng hạn</div>
        <div class="fw-bold" style="font-size: 1.25rem">
          {{ getTasksDoneOntime().length }}
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="6">
    <div
      class="w-100 h-100 d-flex justify-content-start align-items-center p-2"
    >
      <div class="d-flex align-items-center">
        <div class="progress-container">
          <div class="progress-container-align position-relative">
            <div
              class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center"
            >
              <span class="fw-bold" style="font-size: 0.5vw">
                {{
                  toFixed(
                    ((getOverdueTasks().length) /
                    dataset.length) *
                      100
                  )
                }}%</span
              >
            </div>
            <ejs-progressbar
              #annotation1
              [id]="newGuid()"
              [type]="'Circular'"
              [maximum]="dataset.length"
              [minimum]="0"
              [value]="getOverdueTasks().length"
              [width]="'75'"
              [height]="'75'"
              [trackThickness]="10"
              [progressThickness]="10"
              [progressColor]="'#FF4500'"
              [animation]="animation"
            >
            </ejs-progressbar>
          </div>
        </div>
      </div>
      <div class="p-2">
        <div class="fw-bold">Quá hạn</div>
        <div class="fw-bold" style="font-size: 1.25rem">
          {{ getOverdueTasks().length }}
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="7">
    <ejs-accumulationchart
      #pie2
      class="w-100 h-100"
      style="display: block"
      [centerLabel]="{
        text:
        getTaskGroups().length + '<br>công việc'
      }"
      [tooltip]="tooltip"

    >
      <e-accumulation-series-collection>
        <e-accumulation-series
          [dataSource]="taskByGroup"
          [dataLabel]="dataLabel"
          xName="groupName"
          yName="quantity"
          startAngle="0"
          innerRadius="80%"
          radius="70%"
          [palettes]="palettes"
        >
        </e-accumulation-series>
      </e-accumulation-series-collection>
    </ejs-accumulationchart>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="8">
    <div class="w-100 h-100">
      <div class="my-5 h-10">
        <div class="d-flex justify-content-center align-items-center">
          <div
            class="btn-group"
            role="group"
            aria-label="Basic radio toggle button group"
          >
            <input
              type="radio"
              class="btn-check"
              name="btnradio"
              id="btnLowestRadio"
              autocomplete="off"

              #eleAsc
              (change)="changeDir(eleAsc,'8')"
            />
            <label
              class="btn btn-outline-primary"
              for="btnLowestRadio"
            ><codx-label default="Thấp nhất" [formName]="'sys'" [name]="'lblLowest'"></codx-label></label>

            <input
              type="radio"
              class="btn-check"
              name="btnradio"
              id="btnHighestRadio"
              autocomplete="off"
              #eleDesc
              checked
              (change)="changeDir(eleDesc,'8')"
            />
            <label
              class="btn btn-outline-primary"
              for="btnHighestRadio"
              default="Cao nhất"
            ><codx-label default="Cao nhất" [formName]="'sys'" [name]="'lblHighest'"></codx-label></label>
          </div>
        </div>
      </div>
      <div class="container p-0" style="height: 90%" *ngIf="tasksDoneOntimeEmployees.length">
        <div
          class="w-100 h-100 overflow-scroll"
          style="max-height: 95%; width: 100%"

        >
          <div
            class="mx-2"
            *ngFor="let data of sortByProp(tasksDoneOntimeEmployees,'onTimePercentage','desc')"
          >
            <div class="d-flex justify-content-between">
              <div class="d-flex justify-content-between align-items-center">
                <codx-img
                  *ngIf="data.employeeID"
                  [objectType]="'AD_Users'"
                  [objectId]="data.employeeID"
                ></codx-img>
                <div class="ms-2">
                  <div class="text-dark">{{ data.employeeName }}</div>
                  <div>{{ data.departmentName }}</div>
                </div>
              </div>
              <div class="progress-container">
                <div class="progress-container-align position-relative">
                  <div
                    class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center"
                  >
                    <span class="fw-bold" style="font-size: 0.4vw"
                      >{{ toFixed(data.onTimePercentage) }}%</span
                    >
                  </div>
                  <ejs-progressbar
                    #annotation1
                    [id]="newGuid()"
                    [type]="'Circular'"
                    [maximum]="100"
                    [minimum]="0"
                    [value]="data.onTimePercentage"
                    [width]="'65'"
                    [height]="'65'"
                    [trackThickness]="7"
                    [progressThickness]="7"
                    [progressColor]="'#FF4500'"
                    [animation]="animation"
                  >
                  </ejs-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="9">
    <div class="position-relative w-100 h-100 pt-5">
      <div
        class="position-absolute overflow-x-hidden"
        style="max-height: 100%; width: 100%"
      >
        <div
          *ngFor="let data of sortByProp(tasksDoneOntimeEmployees,'quantity','desc')"
          class="topchart-item d-flex align-items-center justify-content-end"
        >
          <div *ngIf="+data?.percentage > 0" class="float-end row w-100">
            <div class="fw-bold  col-4  my-auto">
             {{data.employeeName}}
            </div>
            <div class="col-8" [title]="data.quantity+' | '+ data.totalHours + ' giờ' ">
                <div
                class="topchart-user"
                style="color: #fff;float:right"
                [style.width]="(data.quantity/sumByProp(tasksDoneOntimeEmployees,'quantity'))*100 + '%'"
                [style.backgroundColor]="random_bg_color()"

              >
                <span>{{ data.quantity }}</span>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="10">
    <ejs-chart
      style="display: block"
      align="center"
      width="100%"
      height="100%"
      [id]="newGuid()"
      [tooltip]="{ enable: true }"
      [primaryXAxis]=" {
        valueType: 'Category',
        majorGridLines: { width: 0 },
    } "
      [primaryYAxis]="{
        majorTickLines: { width: 0 }, lineStyle: { width: 0 }
    }"
    [palettes]="paletteColor"
    >
      <e-series-collection>
        <e-series
          [dataSource]="tasksDoneOntimeEmployees"
          type="Line"
          xName="employeeName"
          yName="totalHours"
          name="WorkHours"
          [marker]="circleMarker"
        >
        </e-series>
        <e-series
          [dataSource]="tasksDoneOntimeEmployees"
          type="Column"
          xName="employeeName"
          yName="quantity"
          name="Tasks"

        >
        </e-series>
      </e-series-collection>
    </ejs-chart>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="11">
    <div
      class="d-flex justify-content-center align-items-center w-100"
      style="height: 70%"
    >
      <div style="position: relative" class="w-100 h-100">
        <ejs-circulargauge class="d-block" style="width: 100%; height: 100%">
          <e-axes>
            <e-axis
              [lineStyle]="lineStyle"
              radius="100%"
              startAngle="230"
              endAngle="130"
              minimum="0"
              maximum="150"
              [labelStyle]="labelStyle1"
              [majorTicks]="majorTicks1"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="100%"
                  roundedCornerRadius="15"
                  color="#FF8008"
                  [linearGradient]="rangeLinearGradient2"
                  startWidth="15"
                  endWidth="15"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="Marker"
                  [value]="(getEtimated()/getTotalTime())*100"
                  markerShape="Image"
                  imageUrl="./assets/themes/tm/default/img/Button.svg"
                  radius="90%"
                  markerWidth="30"
                  markerHeight="30"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div
          style="
            position: absolute;
            top: 50%;
            right: 50%;
            transform: translate(50%, -50%);
          "
        >
          <p class="text-center text-gray-900 fw-bold fs-4" style="margin: 0px">
            {{ toFixed((getEtimated()/getTotalTime())*100) }} %
          </p>
        </div>
      </div>
    </div>
    <div class="w-100" style="height: 30%">
      <div class="d-flex justify-content-between align-items-center">
        <div class="w-100 h-100 d-flex flex-column justify-content-center">
          <div class="fw-bold text-center" style="font-size: 0.75vw">
            Tổng thời gian hoàn thành thực tế
          </div>
          <div class="d-flex justify-content-center align-items-center">
            <div class="fw-bold" style="font-size: 1.75vw">
              {{ toFixed(getTotalTime())  }}
            </div>
            <div class="ms-2" style="font-size: 0.75vw">giờ</div>
          </div>
        </div>
        <div class="w-100 h-100 d-flex flex-column justify-content-center">
          <div class="fw-bold text-center" style="font-size: 0.75vw">
            Tổng thời gian làm việc
          </div>
          <div class="d-flex justify-content-center align-items-center">
            <div class="fw-bold" style="font-size: 1.75vw">
              {{ toFixed(getEtimated()) }}
            </div>
            <div class="ms-2" style="font-size: 0.75vw">giờ</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- <ng-template #team_dashboard>
  <div class="w-100 h-100" id="12" title="Tổng thời gian hoàn thành thực tế">
    <div class="w-100 h-100 d-flex flex-column justify-content-center">
      <div class="fw-bold text-center" style="font-size: 0.75vw">
        Tổng thời gian hoàn thành thực tế
      </div>
      <div class="d-flex justify-content-center align-items-center">
        <div class="fw-bold" style="font-size: 1.75vw">
          {{ teamDBData.workPerformance.actualHours }}
        </div>
        <div class="ms-2" style="font-size: 0.75vw">giờ</div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #team_dashboard>
  <div class="w-100 h-100" id="13" title="Tổng thời gian làm việc">
    <div class="w-100 h-100 d-flex flex-column justify-content-center">
      <div class="fw-bold text-center" style="font-size: 0.75vw">
        Tổng thời gian làm việc
      </div>
      <div class="d-flex justify-content-center align-items-center">
        <div class="fw-bold" style="font-size: 1.75vw">
          {{ teamDBData.workPerformance.workHours }}
        </div>
        <div class="ms-2" style="font-size: 0.75vw">giờ</div>
      </div>
    </div>
  </div>
</ng-template> -->

<!--#endregion -->

<!--#region assign_dashboard  -->
<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="1">
    <div
    class="w-100 h-100 border  border-secondary rounded border-2"
      style="cursor: pointer"
      (click)="showTasks('Category == @0 AND Status == @1', '3;10', 'TMT0203')"
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Chuathuchien.svg'"
        [title]="'Chưa thực hiện'"
        [value]="getTaskStatus('10')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="2">
    <div
    class="w-100 h-100 border  border-warning rounded border-2"
      style="cursor: pointer"
      (click)="showTasks('Category == @0 AND Status == @1', '3;20', 'TMT0203')"
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Dangthuchien.svg'"
        [title]="'Đang thực hiện'"
        [value]="getTaskStatus('20')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="3">
    <div
    class="w-100 h-100 border  border-danger rounded border-2"
      style="cursor: pointer"
      (click)="
        showTasks('Category == @0  AND IsOverdue == @1', '3;true', 'TMT0203')
      "
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Quahan.svg'"
        [title]="'Quá hạn'"
        [value]="getOverdueTasks().length"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="4">
    <div
    class="w-100 h-100 border  border-success rounded border-2"
      style="cursor: pointer"
      (click)="showTasks('Category == @0 AND Status == @1', '3;90', 'TMT0203')"
    >
      <count-chart
        class="w-100 h-100"
        [hasIcon]="true"
        [iconUrl]="'assets/themes/tm/default/img/DB_Hoantat.svg'"
        [title]="'Hoàn tất'"
        [value]="getTaskStatus('90')"
      ></count-chart>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="5">
    <div
      class="w-100 h-100 d-flex justify-content-start align-items-center p-2"
    >
      <div class="d-flex align-items-center">
        <div class="progress-container">
          <div class="progress-container-align position-relative">
            <div
              class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center"
            >
              <span class="fw-bold" style="font-size: 0.5vw"
                >{{
                  toFixed(
                    (getTasksDoneOntime().length /
                    dataset.length) *
                      100
                  )
                }}%</span
              >
            </div>
            <ejs-progressbar
              #annotation1
              [id]="newGuid()"
              [type]="'Circular'"
              [maximum]="dataset.length"
              [minimum]="0"
              [value]="getTasksDoneOntime().length"
              [width]="'75'"
              [height]="'75'"
              [trackThickness]="10"
              [progressThickness]="10"
              [animation]="animation"
            >
            </ejs-progressbar>
          </div>
        </div>
      </div>
      <div class="p-2">
        <div class="fw-bold">Đúng hạn</div>
        <div class="fw-bold" style="font-size: 1.25rem">
          {{ getTasksDoneOntime().length }}
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="6">
    <div
      class="w-100 h-100 d-flex justify-content-start align-items-center p-2"
    >
      <div class="d-flex align-items-center">
        <div class="progress-container">
          <div class="progress-container-align position-relative">
            <div
              class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center"
            >
              <span class="fw-bold" style="font-size: 0.5vw"
                >{{
                  toFixed(
                    ((getOverdueTasks().length) /
                    dataset.length) *
                      100
                  )
                }}%</span
              >
            </div>
            <ejs-progressbar
              #annotation1
              [id]="newGuid()"
              [type]="'Circular'"
              [maximum]="dataset.length"
              [minimum]="0"
              [value]="getOverdueTasks().length"
              [width]="'75'"
              [height]="'75'"
              [trackThickness]="10"
              [progressThickness]="10"
              [progressColor]="'#FF4500'"
              [animation]="animation"
            >
            </ejs-progressbar>
          </div>
        </div>
      </div>
      <div class="p-2">
        <div class="fw-bold">Quá hạn</div>
        <div class="fw-bold" style="font-size: 1.25rem">
          {{ getOverdueTasks().length }}
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="7">
    <div class="w-100 h-100">
      <div class="my-5 h-10">
        <div class="d-flex justify-content-center align-items-center">
          <div
            class="btn-group"
            role="group"
            aria-label="Basic radio toggle button group"
          >
            <input
              type="radio"
              class="btn-check"
              name="btnradio1"
              id="btnQuantityRadio"
              autocomplete="off"
              checked
            />
            <codx-label
              class="btn btn-outline-primary"
              for="btnQuantityRadio"
              default="Số lượng"
            ></codx-label>

            <input
              type="radio"
              class="btn-check"
              name="btnradio1"
              id="btnTimeRadio"
              autocomplete="off"
            />
            <codx-label
              class="btn btn-outline-primary"
              for="btnTimeRadio"
              default="Thời gian"
            ></codx-label>
          </div>
        </div>
      </div>
      <div class="my-4" style="height: 40%">
        <ejs-accumulationchart
          #pie1
          class="h-100 w-100"
          style="display: block"
          [tooltip]="tooltip"

          [centerLabel]="{
            text:
            getRefsTasks().length + '<br>công việc'
          }"
          [legendSettings]="{ visible: false }"
        >
          <e-accumulation-series-collection>
            <e-accumulation-series
              [dataSource]="taskByRefType"
              xName="refType"
              yName="quantity"
              startAngle="0"
              innerRadius="80%"
              radius="70%"
              [explode]="true"
              [explodeOffset]="'10%'"
              [dataLabel]="dataLabelRef"
              [palettes]="palettes"
            >
            </e-accumulation-series>
          </e-accumulation-series-collection>
        </ejs-accumulationchart>
      </div>
      <div class="h-50 position-relative">
        <div
          class="overflow-x-hidden position-absolute"
          style="max-height: 100%; width: 100%"
        >
          <div
            *ngFor="let ref of taskByRefType"
            class="mx-2 my-5"
          >
            <div class="d-flex justify-content-between">
              <span>{{ ref.refType }} ({{ ref.quantity }})</span>
              <span>
                {{
                  ((ref.quantity / getRefsTasks().length) * 100) %
                    1 ===
                  0
                    ? (ref.quantity / getRefsTasks().length) * 100
                    : (
                        (ref.quantity / getRefsTasks().length) *
                        100
                      ).toFixed(1)
                }}%
              </span>
            </div>
            <div class="d-flex align-items-center min-w-200px">
              <div class="h-5px w-100 bg-gray-200 rounded-4">
                <div
                  class="rounded-4 h-5px"
                  role="progressbar"
                  [style.width]="
                    (ref.quantity / getRefsTasks().length) * 100 +
                    '%'
                  "
                  [style.background-color]="'#3699ff'"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="8">
    <div class="w-100 h-100 position-relative">
      <div
        class="overflow-x-hidden position-absolute"
        style="max-height: 100%; width: 100%"
      >
        <div class="mx-3 my-4" *ngFor="let task of tasksByProjectID">
          <div class="text-dark fw-bold">
            {{ task?.projectName ? task?.projectName : task?.projectID }}
          </div>
          <div
            class="d-flex flex-row justify-content-between align-items-center"
          >
            <div class="d-block w-100">
              <div class="progress border">
                <div
                class="progress-bar bg-secondary"
                [style.width]="
                  (task.new /task.quantity) * 100 +
                  '%'
                "
                [title]="
                  (task.new / task.quantity) * 100 +
                  '%'
                "
               ></div>
                <div
                  class="progress-bar bg-danger"
                  [style.width]="
                    (task.overdue /task.quantity) * 100 +
                    '%'
                  "
                  [title]="
                    (task.overdue / task.quantity) * 100 +
                    '%'
                  "
                ></div>
                <div
                  class="progress-bar bg-warning"
                  [style.width]="
                    (task.inprocess/ task?.quantity) * 100 +
                    '%'
                  "
                  [title]="
                    (task?.inprocess / task?.quantity) * 100 +
                    '%'
                  "
                ></div>
                <div
                  class="progress-bar bg-success"
                  [style.width]="
                    (task.done / task.quantity) * 100 +
                    '%'
                  "
                  [title]="
                    (task.done / task.quantity) * 100 +
                    '%'
                  "
                ></div>
              </div>
            </div>
            <div class="ms-2">
              <span>{{ task?.quantity }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <img
      style="width: 100%; height: 100%"
      src="assets/themes/sys/default/img/Empty_Stack.svg"
    /> -->
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="9">
    <div class="position-relative w-100 h-100 pt-5">
      <div
        class="position-absolute overflow-x-hidden"
        style="max-height: 100%; width: 100%"
      >
        <div
          *ngFor="let data of sortByProp(tasksDoneOntimeEmployees,'quantity','desc')"
          class="topchart-item d-flex align-items-center justify-content-end"
        >
          <div *ngIf="+data?.percentage > 0" class="float-end row w-100">
            <div class="fw-bold  col-4  my-auto">
             {{data.employeeName}}
            </div>
            <div class="col-8" [title]="data.quantity+' | '+ data.totalHours + ' giờ' ">
                <div
                class="topchart-user"
                style="color: #fff;float:right"
                [style.width]="(data.quantity/sumByProp(tasksDoneOntimeEmployees,'quantity'))*100 + '%'"
                [style.backgroundColor]="random_bg_color()"

              >
                <span>{{ data.quantity }}</span>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div id="10">
    <ejs-accumulationchart
      id="pie"
      class="d-block"
      style="height: 100%; width: 100%"
      [legendSettings]="{
    visible: true,
  }"
      [tooltip]="{ enable: true }"
      [enableAnimation]="{
        enable: true
      }"
      [centerLabel]="{
        text: getProjectsTasks().length + '<br>công việc'
      }"
      (pointClick)="hehe($event)"
    >
      <e-accumulation-series-collection>
        <e-accumulation-series
          [dataSource]="tasksByProjectID"
          [dataLabel]="dataLabelProj"
          xName="projectName"
          yName="quantity"
          innerRadius="70%"
          [border]="{ width: 3 }"
          [palettes]="palettes"
        >
        </e-accumulation-series>
      </e-accumulation-series-collection>
    </ejs-accumulationchart>
  </div>
</ng-template>

<ng-template #assign_dashboard>
  <div class="w-100 h-100" id="11">
    <div class="w-100 h-100">
      <div class="my-5 h-10">
        <div class="d-flex justify-content-center align-items-center">
          <div
            class="btn-group"
            role="group"
            aria-label="Basic radio toggle button group"
          >
            <input
              type="radio"
              class="btn-check"
              name="btnradio"
              id="btnLowestRadio"
              autocomplete="off"

              #eleAsc
              (change)="changeDir(eleAsc,'8')"
            />
            <label
              class="btn btn-outline-primary"
              for="btnLowestRadio"
            ><codx-label default="Thấp nhất" [formName]="'sys'" [name]="'lblLowest'"></codx-label></label>

            <input
              type="radio"
              class="btn-check"
              name="btnradio"
              id="btnHighestRadio"
              autocomplete="off"
              #eleDesc
              checked
              (change)="changeDir(eleDesc,'8')"
            />
            <label
              class="btn btn-outline-primary"
              for="btnHighestRadio"
              default="Cao nhất"
            ><codx-label default="Cao nhất" [formName]="'sys'" [name]="'lblHighest'"></codx-label></label>
          </div>
        </div>
      </div>
      <div class="container p-0" style="height: 90%" *ngIf="tasksDoneOntimeEmployees.length">
        <div
          class="overflow-scroll overflow-x-hidden"
          style="max-height: 95%; width: 100%"

        >
          <div
            class="mx-2"
            *ngFor="let data of sortByProp(tasksDoneOntimeEmployees,'onTimePercentage','desc')"
          >
            <div class="d-flex justify-content-between">
              <div class="d-flex justify-content-between align-items-center">
                <codx-img
                  *ngIf="data.employeeID"
                  [objectType]="'AD_Users'"
                  [objectId]="data.employeeID"
                ></codx-img>
                <div class="ms-2">
                  <div class="text-dark">{{ data.employeeName }}</div>
                  <div>{{ data.departmentName }}</div>
                </div>
              </div>
              <div class="progress-container">
                <div class="progress-container-align position-relative">
                  <div
                    class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center"
                  >
                    <span class="fw-bold" style="font-size: 0.4vw"
                      >{{ toFixed(data.onTimePercentage) }}%</span
                    >
                  </div>
                  <ejs-progressbar
                    #annotation1
                    [id]="newGuid()"
                    [type]="'Circular'"
                    [maximum]="100"
                    [minimum]="0"
                    [value]="data.onTimePercentage"
                    [width]="'65'"
                    [height]="'65'"
                    [trackThickness]="10"
                    [progressThickness]="10"
                    [progressColor]="'#FF4500'"
                    [animation]="animation"
                  >
                  </ejs-progressbar>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<!--#endregion -->

<ng-template #showTask1 let-dialog>
  <div class="w-100 h-100 d-flex flex-column">
    <div class="px-5 py-5 d-flex justify-content-between">
      <codx-label
        class="fs-3 fw-bold"
        default="Danh sách công việc"
        name="lblTasks"
      ></codx-label>
      <span class="icon-close cusor-pointer" (click)="dialog.close()"></span>
    </div>
    <div class="overflow-auto px-5 pb-5" style="height: 680px">
      <codx-tasks-share
        class="tasks-share-content w-100"
        [funcID]="'TMT0201'"
        [dataValue]="dataValues"
        [predicate]="predicates"
        [showButtonAdd]="false"
        [showMoreFunc]="true"
      ></codx-tasks-share>
    </div>
  </div>
</ng-template>

<ng-template #showTask2 let-dialog>
  <div class="w-100 h-100 d-flex flex-column">
    <div class="px-5 py-5 d-flex justify-content-between">
      <codx-label
        class="fs-3 fw-bold"
        default="Danh sách công việc"
        name="lblTasks"
      ></codx-label>
      <span class="icon-close cusor-pointer" (click)="dialog.close()"></span>
    </div>
    <div class="overflow-auto px-5 pb-5" style="height: 680px">
      <codx-tasks-share
        class="tasks-share-content w-100"
        [funcID]="'TMT0202'"
        [dataValue]="dataValues"
        [predicate]="predicates"
        [showButtonAdd]="false"
        [showMoreFunc]="true"
      ></codx-tasks-share>
    </div>
  </div>
</ng-template>

<ng-template #showTask3 let-dialog>
  <div class="w-100 h-100 d-flex flex-column">
    <div class="px-5 py-5 d-flex justify-content-between">
      <codx-label
        class="fs-3 fw-bold"
        default="Danh sách công việc"
        name="lblTasks"
      ></codx-label>
      <span class="icon-close cusor-pointer" (click)="dialog.close()"></span>
    </div>
    <div class="overflow-auto px-5 pb-5" style="height: 680px">
      <codx-tasks-share
        class="tasks-share-content w-100"
        [funcID]="'TMT0203'"
        [dataValue]="dataValues"
        [predicate]="predicates"
        [showButtonAdd]="false"
        [showMoreFunc]="true"
      ></codx-tasks-share>
    </div>
  </div>
</ng-template>
