<codx-form headerText="{{title}}" subHeaderText="" [body]="body" [footer]="footer" [dialog]="dialog">
  <ng-template popup adde #body>
    <codx-tag entityName="AD_Users" [isEdit]="true" [value]=""></codx-tag>

    <!-- <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex mb-5">
        <span class="btn btn-sm btn-primary btn-pill me-2">Project</span>
        <span class="btn btn-sm btn-light-primary btn-pill me-2">Customize</span>
        <div class="dropdown" id="tag_toggle">
          <div class="topbar-item" data-toggle="dropdown">
            <span class="btn btn-sm btn-secondary btn-pill btn-dropdown">Tag +</span>
          </div>
          <div class="dropdown-menu p-0 m-0 dropdown-menu-left dropdown-menu-anim-up dropdown-menu-md">
            <div class="quick-search quick-search-dropdown" id="tag_dropdown">
              <div class="input-group">
                <input type="text" class="form-control" placeholder="Tag..." />
                <div class="input-group-append">
                  <button class="btn btn-secondary" type="button">Lưu</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-extand d-flex justify-content-end">
        <a class="text-dark-75 text-hover-primary d-flex align-items-center" style="cursor:pointer;"
          (click)="extendShow()">
          <span class="me-2 text-dark">
            <codx-label name="lblExtend" formName="Tasks" default="Mở rộng"></codx-label>
          </span>
          <span class="icon-login icon-20 ms-1"></span>
        </a>
      </div>
    </div> -->
    <ejs-tab headerPlacement="Left">
      <e-tabitems>
        <e-tabitem>
          <ng-template #headerText class="me-10 border-0 ">
            <div class="d-flex align-items-center mb-2">
              <span class="icon-info icon-18 me-2"></span>
              <div class="fw-bold">Thông tin chung</div>
            </div>
          </ng-template>
          <ng-template #content class="ms-10">
            <div class="form-group">
              <label>
                <codx-label fiedName="TaskName" formName="Tasks" gridViewName="grvTasks" default="Tên công việc"
                  (valueChange)="valueChange($event)" [crrValue]="task?.taskName">
                </codx-label>
              </label>
              <codx-input placeholder="Tên công việc" field="taskName" type="text" [crrValue]="task.taskName"
                (valueChange)="valueChange($event)">
              </codx-input>
              <!-- <input #taskNameInput [class.is-error]="required.taskName" name="taskName" [(ngModel)]="task.taskName"
                [readonly]="readOnly" type="text" class="form-control" placeholder="Tên công việc"
                (focus)="textboxChange($event.target.value)" />
              <div id="errorCopy" autofocus *ngIf="!required.taskName" class="invalid-feedback">
                Tên công việc. -->
            </div>
            <div class="form-group mt-3">
              <label>
                <codx-label fiedName="TaskGroupID" formName="Tasks" gridViewName="grvTasks" default="Nhóm triển khai">
                </codx-label>
              </label>
              <codx-input service="TM" type="combobox" [disabled]="readOnly" name="combobox"
                placeholder="Nhóm công việc" refValue="TaskGroups" loadFull="true" field="taskGroupID"
                (valueChange)="cbxChange($event)" [multiple]="false" [crrValue]="task.taskGroupID">
              </codx-input>
            </div>
            <div class="form-group row mt-3">
              <div class="col-6">
                <label>
                  <codx-label fiedName="DueDate" formName="Tasks" gridViewName="grvTasks" default="Ngày hết hạn">
                  </codx-label>
                </label>
                <codx-input type="datetime" class="test-datetime" field="dueDate" format="F" placeholder="datetime"
                  [disabled]="readOnly" (valueChange)="changeTime($event)">
                </codx-input>
              </div>
              <div class="col-6">
                <label>
                  <codx-label fiedName="Priority" formName="Tasks" gridViewName="grvTasks" default="Ưu tiên">
                  </codx-label>
                </label>
                <codx-input type="valuelist" field="priority" [crrValue]="task.priority" refValue="L0186"
                  [disabled]="readOnly" [placeholder]="'Chọn độ ưu tiên'" (valueChange)="changeVLL($event)">
                </codx-input>
              </div>
            </div>
            <div class="extend-function">
              <hr />
              <div class="d-flex justify-content-center" (click)="showPlan = !showPlan">
                <div class="d-flex align-items-center w-auto extend-title">
                  <span class="text-primary text-hover-primary_darker fw-bold me-1">Kế hoạch</span>
                  <span *ngIf="showPlan"
                    class="icon-keyboard_arrow_down icon-16 text-primary text-hover-primary_darker"></span>
                  <span *ngIf="!showPlan"
                    class="icon-keyboard_arrow_up icon-16 text-primary text-hover-primary_darker"></span>
                </div>
              </div>
            </div>
            <ng-container *ngIf="(param?.PlanControl !='0'|| param?.PlanControl == null) && showPlan ">
              <div class="form-group row mt-3">
                <div class="col-4">
                  <label>
                    <codx-label fiedName="StartDate" formName="Tasks" gridViewName="grvTasks" default="Ngày bắt đầu">
                    </codx-label>
                  </label>
                  <codx-input name="startDate" type="datetime" class="test-datetime" [disabled]="readOnly"
                    field="startDate" placeholder="datetime" [crrValue]="task.startDate" format="d"
                    (valueChange)="changeTime($event)">
                  </codx-input>
                </div>
                <div class="col-4">
                  <label>
                    <codx-label fiedName="EndDate" formName="Tasks" gridViewName="grvTasks" default="Ngày kết thúc">
                    </codx-label>
                  </label>
                  <codx-input name="endDate" type="datetime" class="test-datetime" [disabled]="readOnly" field="endDate"
                    placeholder="datetime" [crrValue]="task.endDate" format="d" (valueChange)="changeTime($event)">
                  </codx-input>
                </div>
                <div class="col-4">
                  <label>
                    <codx-label fiedName="Estimated" formName="Tasks" gridViewName="grvTasks"
                      default="Số giờ thực hiện">
                    </codx-label>
                  </label>
                  <codx-input type="text" [disabled]="readOnly" field="estimated" placeholder="Số giờ thực hiện"
                    [crrValue]="task.estimated" (valueChange)="valueChange($event)">
                  </codx-input>
                  <!-- <input type="number" class="form-control" [disabled]="readOnly" [(ngModel)]="task.estimated" /> -->
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="showAssignTo">
              <div class="d-flex align-items-center justify-content-between mt-6">
                <div class="d-flex align-items-center mb-3">
                  <span class="icon-person icon-18 me-2 text-primary"></span>
                  <div class="fw-bold fs-6 text-primary">Phân công cho</div>
                </div>
                <button *ngIf="!readOnly" type="button" class="btn btn-sm btn-light-primary" (click)="openDialog()">
                  <i class="icon-person_add_alt fs-5 me-1"></i>
                </button>
              </div>
              <codx-share (eventApply)="eventApply($event)"> </codx-share>
              <!-- <div class="symbol-group">
                <ng-container *ngFor="let item of listUser">
                  <codx-img class="symbol flex symbol-40px symbol-circle me-4" [objectId]="item" objectType="AD_Users">
                  </codx-img>
                </ng-container>
              </div> -->
            </ng-container>
            <div class="d-flex align-items-center justify-content-between mt-6">
              <div class="d-flex align-items-center mb-3">
                <span class="icon-attach icon-18 me-2 text-primary"></span>
                <div class="fw-bold fs-6 text-primary">Tài liệu đính kèm</div>
              </div>
              <button (click)="popup($event)" class="btn btn-sm btn-light-primary">Thêm file</button>
              <ng-template>
                <attachment #attachment type="center" objectType="TM_Tasks" objectId="TSK2205-0506" functionID="TM001"
                  (fileAdded)="fileAdded($event)"></attachment>
              </ng-template>

            </div>
            add attachfile cho nay
            <div class="d-flex align-items-center file-item mt-5">
              <codx-img class="h-35px me-2" #image objectId="ADMIN"></codx-img>
              <div class="d-flex flex-column flex-grow-1">
                <span class="text-dark">Bang-chamcongthang6-V2.doc</span>
                <div class="d-flex mt-1">
                  <div class="text-gray-600">20/07/2021</div>
                  <div class="mx-2 text-gray-500">|</div>
                  <div class="text-gray-600">Lê Phạm Thương Hoài</div>
                </div>
              </div>
              <div class="dropdown">
                <button class="btn btn-icon btn-md" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <span class="icon-more_vert icon-20"></span>
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item">
                    <div class="d-flex align-items-center">
                      <span class="icon-edit text-warning icon-18"></span>
                      <span class="ms-3">Chỉnh sửa</span>
                    </div>
                  </a>
                  <a class="dropdown-item">
                    <div class="d-flex align-items-center">
                      <span class="icon-list_alt text-primary icon-18"></span>
                      <span class="ms-3">Xem thông tin</span>
                    </div>
                  </a>
                  <a class="dropdown-item">
                    <div class="d-flex align-items-center">
                      <span class="icon-clear text-danger icon-18"></span>
                      <span class="ms-3">Xóa</span>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </ng-template>
        </e-tabitem>

        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-center">
              <span class="icon-article icon-18 me-2"></span>
              <div class="fw-bold">Mô tả công việc</div>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="form-group mt-3">
              <div class="d-flex align-items-center justify-content-between">
                <codx-label fiedName="Memo" formName="Tasks" gridViewName="grvTasks" default="Mô tả chi tiết">
                </codx-label>
                <span class="icon-open_in_new icon-20 text-gray-500" (click)="openInputMemo2()"></span>
              </div>
              <codx-input type="textarea" field="memo" [crrValue]="task.memo" [disabled]="readOnly" class="form-control"
                (valueChange)="changeMemo($event)"></codx-input>
              <input *ngIf="openMemo2" name="txtMemo2" [(ngModel)]="task.memo2" placeholder="Ghi chú phân công..."
                type="text" [readOnly]="readOnly" class="col-md-8" style="
                  border-width: thin;
                  border-style: none;
                  margin-top: 3px;
                  outline: none;" />
            </div>
          </ng-template>
        </e-tabitem>

        <e-tabitem *ngIf="showAssignTo">
          <ng-template #headerText>
            <div class="d-flex align-items-center">
              <span class="icon-person_outline icon-18 me-2"></span>
              <div class="fw-bold">Phân công cho</div>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="d-flex align-items-center justify-content-between mt-4">
              <div class="d-flex align-items-center">
                <span class="icon-person icon-16 me-2 text-primary"></span>
                <div class="fw-bold fs-6 text-primary">Phân công cho</div>
              </div>
              <button *ngIf="!readOnly" type="button" class="btn btn-sm btn-light-primary" (click)="openDialog()">
                <i class="icon-person_add_alt fs-5 me-1"></i>Add user
              </button>
            </div>
            <div>
              <ng-container *ngFor="let item of listUserDetail; index as i">
                <div class="d-flex py-2 border-bottom justify-content-between list-title">
                  <div class="d-flex align-items-top">
                    <codx-img class="symbol symbol-40px symbol-circle me-4" [objectId]="item?.userID"
                      objectType="AD_Users">
                    </codx-img>

                    <div class="d-flex flex-column me-2 ">
                      <div class="text-dark fw-bold fs-6">
                        {{item?.userName}}
                      </div>
                      <div class="text-gray-700">{{item.positionName}} <span *ngIf=" item.departmentName"> |
                          {{item.departmentName}}</span></div>

                      <div class="text-dark" *ngIf="listMemo2OfUser[i]?.memo2 == null">
                        <input name="txtTaskMemo2" placeholder="Ghi chú phân công..." type="text" [readonly]="readOnly"
                          (keydown.enter)="changeMeno2User($event.target.value,item?.userID)" style="
                            border-width: thin;
                            border-style: none;
                            margin-top: 3px;
                            outline: none;" />
                      </div>
                      <div class="text-dark" *ngIf="listMemo2OfUser[i]?.memo2 != null">
                        <input name="txtTaskMemo2" value={{listMemo2OfUser[i]?.memo2}}
                          placeholder="Ghi chú phân công..." type="text" [readonly]="readOnly"
                          (keydown.enter)="changeMeno2User($event.target.value,item?.userID)" style="
                            border-width: thin;
                            border-style: none;
                            margin-top: 3px;
                            outline: none;" />
                      </div>

                    </div>
                  </div>
                  <div *ngIf="!readOnly">
                    <a (click)="onDeleteUser(item.userID)" style="cursor: pointer">
                      <div class="d-flex align-item-center">
                        <span class="icon-close icon-16 text-danger me-2"></span>
                        <span class="text-hover-danger">Delete</span>
                      </div>
                    </a>
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-template>
        </e-tabitem>
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-center">
              <span class="icon-check_box icon-18 me-2"></span>
              <div class="fw-bold">Công việc cần làm</div>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="d-flex align-items-center justify-content-between mt-4">
              <div class="d-flex align-items-center">
                <span class="icon-playlist_add_check icon-16 me-2 text-primary"></span>
                <div class="fw-bold fs-6 text-primary">Công việc cần làm</div>
              </div>
            </div>
            <div>

            </div>
            <div>
              <ng-container *ngFor="let item of listTodo; index as i">
                <div
                  class="d-flex justify-content-between align-items-center checkbox-item mb-4 card-with-dropdown-item">
                  <div class="checkbox-list">
                    <div class="d-flex flex-column flex-grow-1 w-100">
                      <div class="flex" *ngIf="i != indexEditTodo">
                        <div class="">
                          <input #checkShareRight1 type="checkbox" [disabled]="readOnly"
                            [checked]="item.status == STATUS_TASK_GOAL.Checked" id="checkShareRight1"
                            (change)="updateStatusTodoList(i)">
                        </div>
                        <div class="" (click)="editTodo(i, item.text)" style="
                            margin-top: 4px; margin-left: 12px;">
                          {{ item.text }}
                        </div>
                      </div>
                      <div *ngIf="i == indexEditTodo">
                        <div class="flex">
                          <div class="">
                            <input #checkShareRight1 type="checkbox" [disabled]="readOnly" id="checkShareRight1" style="margin-left: -8px;
                              height: 14px;
                              width: 14px;
                              margin-top: 5px" class="col-md-4">
                          </div>
                          <div class="">
                            <input type="text" #txtTodoEdit name="txtTodoEdit" matInput autofocus
                              [value]="contentTodoEdit" (blur)="updateTodoList(txtTodoEdit.value)"
                              (keydown.enter)="updateTodoList(txtTodoEdit.value)" class="form-control"
                              placeholder="Add to do list..." />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="!readOnly">
                    <a (click)="onDeleteTodo(i)" style="cursor: pointer">
                      <div>
                        <span class="icon-close icon-20 text-danger ms-2 me-2"></span>
                        <span>Delete</span>
                      </div>
                    </a>
                  </div>
                </div>
              </ng-container>
              <div class="d-flex justify-content-between align-items-center checkbox-item mb-4" *ngIf="!readOnly">
                <div class="checkbox-list">
                  <div class="d-flex flex-column flex-grow-1 w-100">
                    <div class="row">
                      <input #checkShareRight1 type="checkbox" [disabled]="readOnly" id="checkShareRight1" style="margin-left: -8px;
                        height: 14px;
                        width: 14px;
                        margin-top: 5px" class="col-md-4">
                      <input #txtTodoAdd name="txtTodoAdd" matInput [(ngModel)]="todoAddText" #checkShareRight1
                        (blur)="onAddToDo(txtTodoAdd)" placeholder="Add to do list..."
                        (keydown.enter)="onAddToDo(txtTodoAdd)" type="text" class="col-md-8" style="margin-left: -17px;
                            border-width: thin;
                            border-style: none;
                            margin-top: 3px;
                            outline: none;" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>
        </e-tabitem>
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-center">
              <span class="icon-insert_link icon-18 me-2"></span>
              <div class="fw-bold">Tham chiếu</div>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="form-group mt-3" *ngIf="param?.ProjectControl != '0'">
              <label>
                <codx-label fiedName="ProjectID" formName="Tasks" gridViewName="grvTasks" default="Dự án">
                </codx-label>
              </label>
              <codx-input service="TM" type="combobox" name="combobox" style="border: none" placeholder="Dự án"
                ngDefaultControl refValue="Projects" loadFull="true" field="projectID" (valueChange)="cbxChange($event)"
                [disabled]="readOnly" [crrValue]="task.projectID">
              </codx-input>
            </div>
            <div class="form-group mt-3" *ngIf="param?.Location != '0'">
              <label>
                <codx-label fiedName="Location" formName="Tasks" gridViewName="grvTasks" default="Địa điểm">
                </codx-label>
              </label>
              <input type="text" class="form-control" [readonly]="readOnly" [(ngModel)]="task.location" />
            </div>
            <div class="form-group mt-3" *ngIf="param?.ReferenceControl != '0'">
              <label>
                <codx-label fiedName="RefNo" formName="Tasks" gridViewName="grvTasks" default="Tham chiếu">
                </codx-label>
              </label>
              <codx-input service="SYS" type="combobox" name="combobox" class="form-control borderless p-0"
                style="border: none" placeholder="Tham chiếu" ngDefaultControl refValue="" [disabled]="readOnly"
                loadFull="true" field="refNo" (valueChange)="cbxChange($event)"></codx-input>
            </div>
            <div class="form-group mt-3" *ngIf="param?.ActivityControl != '0' || param?.ActivityControl == null ">
              <label>
                <codx-label fiedName="ActivityID" formName="Tasks" gridViewName="grvTasks" default="Bước quy trình">
                </codx-label>
              </label>
              <codx-input service="SYS" type="combobox" name="combobox" class="form-control borderless p-0"
                placeholder="Bước qui trình" ngDefaultControl refValue="" loadFull="true" field="activityID"
                [disabled]="readOnly" (valueChange)="cbxChange($event)">
              </codx-input>
            </div>
          </ng-template>
        </e-tabitem>
      </e-tabitems>
    </ejs-tab>
  </ng-template>
  <ng-template #footer>
    <div class="d-flex justify-content-between">
      <!-- <button class="btn btn-light-primary">
        Sửa
      </button> -->
      <button type="button" class="btn btn-primary ms-1" (click)="saveData(task.taskID)" *ngIf="!readOnly">Lưu</button>
    </div>
  </ng-template>
</codx-form>
