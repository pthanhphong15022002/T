<div class="page-content d-flex flex-row">
  <div class="w-100 me-4">
    <!-- <codx-input type="switch"></codx-input> -->
    <div class="row m-0 bg-body mb-2 p-3">
      <div class="col-4 px-0">
        <div class="d-flex justify-content-between h-50px p-3" style="background-color: #d8fffd">
          <div class="d-flex justify-content-between">
            <div class="icon-28 icon-access_time me-2" style="color: rgb(6, 221, 184)"></div>
            <div>
              <div class="fw-bold text-gray-400">
                <codx-label name="lblTask" default="Công việc" [formModel]="formModel"></codx-label>
              </div>
              <div class="text-dark fw-bold">
                <codx-label name="lblOverdueTask" default="Chưa thực hiên" [formModel]="formModel"></codx-label>
              </div>
            </div>
          </div>
          <div class="text-gray-900 fw-bolder fs-2 mt-1 me-2">
            {{ dbData?.newTasks }}
          </div>
        </div>
      </div>

      <div class="col-4 pe-0">
        <div class="d-flex justify-content-between rounded h-50px p-3" style="background-color: #daecff">
          <div class="d-flex justify-content-between">
            <div class="icon-28 icon-access_time me-2" style="color: rgb(0, 93, 199)"></div>
            <div>
              <div class="fw-bold text-gray-400">
                <codx-label name="lblTask" default="Công việc" [formModel]="formModel"></codx-label>
              </div>
              <div class="text-dark fw-bold">
                <codx-label name="lblOverdueTask" default="Chưa thực hiên" [formModel]="formModel"></codx-label>
              </div>
            </div>
          </div>
          <div class="text-gray-900 fw-bolder fs-2 mt-1 me-2">
            {{ dbData?.newTasks }}
          </div>
        </div>
      </div>
      <div class="col-4 pe-0">
        <div class="d-flex justify-content-between rounded h-50px p-3" style="background-color: #fff8e6">
          <div class="d-flex align-items-center">
            <div class="icon-28 icon-access_time me-2" style="color: rgb(255, 128, 8)"></div>
            <div class="d-flex flex-column">
              <div class="text-gray-400">
                <codx-label name="lblTask" default="Công việc" [formModel]="formModel"></codx-label>
              </div>
              <div class="fw-bold text-dark">
                <codx-label name="lblOverdueTask" default="Hoãn lại" [formModel]="formModel"></codx-label>
              </div>
            </div>
          </div>
          <div class="text-gray-900 fw-bolder fs-2 mt-1 me-2">
            {{ dbData?.postponeTasks }}
          </div>
        </div>
      </div>
    </div>
    <div class="row m-0 bg-body mb-2">
      <div class="d-flex justify-content-end">
        <button type="button" class="btn align-self-end" (mouseenter)="openTooltip()" (mouseleave)="closeTooltip()">
          <i class="icon-info text-dark"></i>
        </button>
      </div>
      <div class="col-3" style="position: relative; height: 200px">
        <ejs-circulargauge style="display: block" centerY="50%" height="200">
          <e-axes>
            <e-axis [lineStyle]="lineStyle" radius="100%" startAngle="230" endAngle="130" minimum="0" maximum="150"
              [labelStyle]="labelStyle1" [majorTicks]="majorTicks1" [minorTicks]="minorTicks">
              <e-ranges>
                <e-range start="0" end="150" radius="100%" roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient1" startWidth="10" endWidth="10">
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer type="Marker" [value]="dbData?.performance" markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="90%" markerWidth="20" markerHeight="20">
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
          ">
          <p class="text-center" style="margin: 0px">Availability</p>
          <p class="text-center text-gray-900 fw-bolder fs-2" style="margin: 0px">
            {{ dbData?.availability.toFixed(2) }}
          </p>
        </div>
      </div>
      <div class="col-3" style="position: relative; height: 200px">
        <ejs-circulargauge style="display: block" centerY="50%" height="200">
          <e-axes>
            <e-axis [lineStyle]="lineStyle" radius="100%" startAngle="230" endAngle="130" minimum="0" maximum="150"
              [labelStyle]="labelStyle1" [majorTicks]="majorTicks1" [minorTicks]="minorTicks">
              <e-ranges>
                <e-range start="0" end="150" radius="100%" roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient1" startWidth="10" endWidth="10">
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer type="Marker" [value]="dbData?.performance" markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="90%" markerWidth="20" markerHeight="20">
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
          ">
          <p class="text-center" style="margin: 0px">Performance</p>
          <p class="text-center text-gray-900 fw-bolder fs-2" style="margin: 0px">
            {{ dbData?.performance.toFixed(2) }}
          </p>
        </div>
      </div>
      <div class="col-3" style="position: relative; height: 200px">
        <ejs-circulargauge style="display: block" centerY="50%" height="200">
          <e-axes>
            <e-axis [lineStyle]="lineStyle" radius="100%" startAngle="230" endAngle="130" minimum="0" maximum="150"
              [labelStyle]="labelStyle1" [majorTicks]="majorTicks1" [minorTicks]="minorTicks">
              <e-ranges>
                <e-range start="0" end="150" radius="100%" roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient1" startWidth="10" endWidth="10">
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer type="Marker" [value]="dbData?.performance" markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="90%" markerWidth="20" markerHeight="20">
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
          ">
          <p class="text-center" style="margin: 0px">Quality</p>
          <p class="text-center text-gray-900 fw-bolder fs-2" style="margin: 0px">
            {{ dbData?.quality.toFixed(2) }}
          </p>
        </div>
      </div>
      <div class="col-3" style="position: relative; height: 200px">
        <ejs-circulargauge style="display: block" centerY="50%" height="200">
          <e-axes>
            <e-axis [lineStyle]="lineStyle" radius="100%" startAngle="230" endAngle="130" minimum="0" maximum="150"
              [labelStyle]="labelStyle1" [majorTicks]="majorTicks1" [minorTicks]="minorTicks">
              <e-ranges>
                <e-range start="0" end="150" radius="100%" roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient2" startWidth="10" endWidth="10">
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer type="Marker" [value]="dbData?.kpi" markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="90%" markerWidth="20" markerHeight="20">
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
          ">
          <p class="text-center" style="margin: 0px">KPI</p>
          <p class="text-center text-gray-900 fw-bolder fs-2" style="margin: 0px">
            {{ dbData?.kpi.toFixed(2) }}
          </p>
        </div>
      </div>
    </div>
    <div class="d-flex mb-4">
      <div class="me-2" style="position: relative; width: 50%">
        <ejs-accumulationchart id="chart-task-group" [legendSettings]="legendSettings2">
          <e-accumulation-series-collection>
            <e-accumulation-series [dataSource]="dbData?.tasksByGroup" xName="taskGroupName" yName="qty" radius="70%"
              innerRadius="70%"></e-accumulation-series>
          </e-accumulation-series-collection>
        </ejs-accumulationchart>
        <div style="
            position: absolute;
            top: 50%;
            left: 40%;
            transform: translate(-50%, -50%);
          ">
          <div class="text-center">
            <p class="text-gray-900 fw-bolder fs-2">{{ dbData?.tasks }}</p>
            <codx-label name="lblTasks" default="Công việc" [formModel]="formModel">
            </codx-label>
          </div>
        </div>
      </div>
      <div class="ms-2 bg-body" style="position: relative; width: 50%">
        <div class="row">
          <div class="col-5">
            <ejs-circulargauge style="display: block" centerY="40%" width="100%" height="100%">
              <e-axes>
                <e-axis radius="100%" startAngle="0" endAngle="360" minimum="0" maximum="150" [lineStyle]="lineStyle"
                  [labelStyle]="labelStyle2" [majorTicks]="majorTicks2" [minorTicks]="minorTicks">
                  <e-ranges>
                    <e-range start="0" end="150" radius="90%" startWidth="12" endWidth="12" color="#F0F0F0">
                    </e-range>
                  </e-ranges>
                  <e-pointers>
                    <e-pointer type="RangeBar" roundedCornerRadius="10" radius="90%" color="#04DEB7" pointerWidth="12"
                      [value]="dbData?.rateDoneTaskOnTime">
                    </e-pointer>
                  </e-pointers>
                </e-axis>
                <e-axis radius="80%" startAngle="0" endAngle="360" minimum="0" maximum="150" [lineStyle]="lineStyle"
                  [labelStyle]="labelStyle2" [majorTicks]="majorTicks2" [minorTicks]="minorTicks">
                  <e-ranges>
                    <e-range start="0" end="150" radius="115%" startWidth="12" endWidth="12" color="#F0F0F0">
                    </e-range>
                  </e-ranges>
                  <e-pointers>
                    <e-pointer type="RangeBar" roundedCornerRadius="10" radius="115%" color="#5465FF" markerWidth="12"
                      pointerWidth="12" [value]="dbData?.rateDoneTask">
                    </e-pointer>
                  </e-pointers>
                </e-axis>
              </e-axes>
            </ejs-circulargauge>
          </div>
          <div class="col-7" style="margin-top: 100px">
            <div class="ps-9 pt-12">
              <div class="d-flex align-items-top">
                <div class="label1"></div>
                <div class="d-flex flex-column">
                  <div>Tỷ lệ hoàn thành công việc</div>
                  <div class="text-dark fs-3 fw-bold">
                    {{ dbData?.rateDoneTask.toFixed(2) }}%
                  </div>
                </div>
              </div>
              <div class="d-flex align-items-top">
                <div class="label2"></div>
                <div class="d-flex flex-column">
                  <div>Tỷ lệ hoàn thành công việc đúng hạn</div>
                  <div class="text-dark fs-3 fw-bold">
                    {{ dbData?.rateDoneTaskOnTime.toFixed(2) }}%
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row bg-body mb-2">
      <ejs-chart style="display: block" background="transparent" id="chartbar" [primaryXAxis]="columnXAxis"
        [primaryYAxis]="columnYAxis" [legendSettings]="legendSettings1" height="100%" width="100%">
        <e-axes>
          <e-axis rowIndex="0" name="WorkHours" opposedPosition="true" labelFormat="" [minimum]="0" [maximum]="100"
            [interval]="4">
          </e-axis>
        </e-axes>
        <e-series-collection>
          <e-series fill="#005DC7" [dataSource]="dbData?.dataBarChart?.barChart" type="Column" name="Tasks"
            xName="label" yName="value" [cornerRadius]="radius">
          </e-series>
          <e-series fill="#F9D923" [dataSource]="dbData?.dataBarChart?.lineChart" type="Line" name="WorkHours"
            yName="value" xName="label" yAxisName="WorkHours">
          </e-series>
        </e-series-collection>
      </ejs-chart>
    </div>
  </div>

  <div class="w-350px min-w-350p bg-body">
    <div class="taskbox-user">
      <selectweek #selectweek (onChangeValue)="onChangeValueSelectedWeek($event)"></selectweek>
      <div class="taskbox-list">
        <codx-listview #listview service="TM" assemblyName="ERM.Business.TM" className="ReportBusiness"
          method="GetTasksOfDayAsync" entityName="TM_Tasks" [itemTemplate]="TemplateList" [height]="200">
        </codx-listview>
      </div>
    </div>
  </div>
</div>

<ng-template #tooltip let-dialog>
  <div class="modal-header" style="border-bottom: none">
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex justify-content-between">
          <span style="margin-right: 20px">
            <i class="icon-info" style="color: #005dc7"></i></span>
          <h2 id="modal-basic-title">
            <codx-label name="lblEvaluateWorkEfficiency" default="Đánh giá hiệu quả làm việc"
              [formModel]="dialog.formModel"></codx-label>
          </h2>
        </div>
        <button type="button" class="btn btn-xs btn-icon btn-light btn-hover-primary" aria-label="Close"
          (click)="dialog.close()">
          <span class="icon-close icon-20 text-dark text-hover-primary"></span>
        </button>
      </div>
    </div>
  </div>
  <div class="modal-body">
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">Availability (%)</p>
      <p class="">Tỷ lệ thời gian làm việc = <strong>(1)/(2)</strong></p>
      <p style="margin: 0px 0px 0px 20px">
        (1) Số giờ chấm công thực tế của nhân viên
      </p>
      <p style="
          font-style: italic;
          font-size: 12px;
          font-weight: 200;
          margin: 0px 0px 0px 30px;
          color: rgb(0, 0, 0, 0.5);
        ">
        (* Nếu chưa tích hợp chấm công sẽ bằng giờ công chuẩn)
      </p>
      <p style="margin: 0px 0px 0px 20px">
        (2) Số giờ công chuẩn theo lịch làm việc của công ty
      </p>
    </div>
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">Performance (%)</p>
      <p>Hiệu suất làm việc = <strong>(3)/(4)</strong></p>
      <p style="margin: 0px 0px 0px 20px">
        (3) Tổng số giờ hoàn thành công việc thực tế
      </p>
      <p style="margin: 0px 0px 0px 20px">
        (4) Tổng giờ công thực tế có điều chỉnh
      </p>
    </div>
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">Quality (%)</p>
      <p>Chất lượng công việc = <strong>(5)/(6)</strong></p>
      <p style="margin: 0px 0px 0px 20px">
        (5) Tổng số giờ hoàn thành công việc thực tế được duyệt
      </p>
      <p style="
          font-style: italic;
          font-size: 12px;
          font-weight: 200;
          margin: 0px 0px 0px 30px;
          color: rgb(0, 0, 0, 0.5);
        ">
        (* Nếu không sử dụng quy trình xét duyệt thì số giờ sẽ bằng số giờ thực
        tế)
      </p>
      <p style="margin: 0px 0px 0px 20px">
        (6) Tổng số giờ hoàn thành công việc thực tế
      </p>
    </div>
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">KPI (%)</p>
      <p>Năng suất tương đương</p>
      <p style="
          margin-left: 100px;
          padding-bottom: 10px;
          width: fit-content;
          box-sizing: bor-box;
          border-bottom: 1px solid #000;
          text-align: center;
        ">
        Availability (%) * Performance (%) * Quality (%)
      </p>
      <p style="text-align: center">1000</p>
    </div>
  </div>
</ng-template>

<ng-template #TemplateList let-task>
  <div class="d-flex p-3 flex-grow-1 task-item" *ngFor="let task of taskOfDay">
    <codx-img class="symbol symbol-40px symbol-circle me-3" objectType="AD_Users" [objectId]="task?.createdBy"
      [objectName]="task?.userName"></codx-img>
    <div class="d-flex flex-column flex-grow-1">
      <div class="text-dark fw-bold">
        {{ task?.userName }}
      </div>
      <div class="text-gray-600 fs-7">{{ task?.positionName }}</div>
      <div class="task-name text-gray-600 fs-7">
        {{ task?.taskName }}
      </div>
      <div class="d-flex justify-content-start">
        <div class="bagde bagde-light-primary me-2" [style.border-color]="task.status | vll: 'L0614':'color' | async"
          [style.background-color]="" [style.color]="task.status | vll: 'L0614':'color' | async" style="border: none">
          {{ task.status | vll: "L0614":"text" | async }}
        </div>
        <div>{{ task.dueDate | date }}</div>
      </div>
    </div>
  </div>
</ng-template>