<div class="page-content d-flex flex-row pt-4">
  <div class="w-75 m-2">
    <!-- <codx-input type="switch"></codx-input> -->
    <div
      class="d-xl-flex justify-content-xl-between bg-body mb-2 p-4 rounded"
      style="height: 10%"
    >
      <div
        class="border rounded"
        style="background-color: rgb(4, 222, 183, 0.1)"
      >
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="d-flex justify-content-between">
              <div
                class="icon icon-access_time"
                style="color: rgb(4, 222, 183)"
              ></div>
              <div>
                <div class="fw-bold text-gray-400">
                  <codx-label
                    name="lblTask"
                    default="Công việc"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
                <div class="text-gray-900 fw-bold mb-2 mt-5">
                  <codx-label
                    name="lblOverdueTask"
                    default="Đã quá hạn"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
              </div>
            </div>
            <div class="text-gray-900 fw-bolder fs-2 mb-2 mt-5">
              {{ dbData?.overDueTasks }}
            </div>
          </div>
        </div>
      </div>
      <div
        class="border rounded"
        style="background-color: rgb(0, 93, 199, 0.1)"
      >
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="d-flex justify-content-between">
              <div
                class="icon icon-access_time"
                style="color: rgb(0, 93, 199)"
              ></div>
              <div>
                <div class="fw-bold text-gray-400">
                  <codx-label
                    name="lblTask"
                    default="Công việc"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
                <div class="text-gray-900 fw-bold mb-2 mt-5">
                  <codx-label
                    name="lblOverdueTask"
                    default="Chưa thực hiên"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
              </div>
            </div>
            <div class="text-gray-900 fw-bolder fs-2 mb-2 mt-5">
              {{ dbData?.newTasks }}
            </div>
          </div>
        </div>
      </div>
      <div
        class="border rounded"
        style="background-color: rgb(255, 128, 8, 0.1)"
      >
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="d-flex justify-content-between">
              <div
                class="icon icon-access_time"
                style="color: rgb(255, 128, 8)"
              ></div>
              <div>
                <div class="fw-bold text-gray-400">
                  <codx-label
                    name="lblTask"
                    default="Công việc"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
                <div class="fw-bold text-black">
                  <codx-label
                    name="lblOverdueTask"
                    default="Hoãn lại"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
              </div>
            </div>
            <div class="text-gray-900 fw-bolder fs-2 mb-2 mt-5">
              {{ dbData?.postponeTasks }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row bg-body mb-2" style="height: 30%">
      <div class="d-flex justify-content-end">
        <button
          type="button"
          class="btn align-self-end"
          (mouseenter)="openTooltip()"
          (mouseleave)="closeTooltip()"
        >
          <i class="icon-info text-dark"></i>
        </button>
      </div>

      <div
        class="col-xxl-3 col-xl-6 col-lg-6"
        style="position: relative; height: 250px"
      >
        <ejs-circulargauge style="display: block" centerY="40%" height="250">
          <e-axes>
            <e-axis
              [lineStyle]="lineStyle"
              radius="90%"
              startAngle="230"
              endAngle="130"
              minimum="0"
              maximum="150"
              [labelStyle]="labelStyle1"
              [majorTicks]="majorTicks1"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="115%"
                  roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient1"
                  startWidth="17"
                  endWidth="17"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="Marker"
                  [value]="dbData?.availability"
                  markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="108%"
                  markerWidth="28"
                  markerHeight="28"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div
          style="
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
          "
        >
          <p class="text-center" style="margin: 0px">Availability</p>
          <p
            class="text-center text-gray-900 fw-bolder fs-2"
            style="margin: 0px"
          >
            {{ dbData?.availability.toFixed(2) }}
          </p>
        </div>
      </div>
      <div
        class="col-xxl-3 col-xl-6 col-lg-6"
        style="position: relative; height: 250px"
      >
        <ejs-circulargauge style="display: block" centerY="40%" height="250">
          <e-axes>
            <e-axis
              [lineStyle]="lineStyle"
              radius="90%"
              startAngle="230"
              endAngle="130"
              minimum="0"
              maximum="150"
              [labelStyle]="labelStyle1"
              [majorTicks]="majorTicks1"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="115%"
                  roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient1"
                  startWidth="17"
                  endWidth="17"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="Marker"
                  [value]="dbData?.performance"
                  markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="108%"
                  markerWidth="28"
                  markerHeight="28"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div
          style="
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
          "
        >
          <p class="text-center" style="margin: 0px">Performance</p>
          <p
            class="text-center text-gray-900 fw-bolder fs-2"
            style="margin: 0px"
          >
            {{ dbData?.performance.toFixed(2) }}
          </p>
        </div>
      </div>
      <div
        class="col-xxl-3 col-xl-6 col-lg-6"
        style="position: relative; height: 250px"
      >
        <ejs-circulargauge style="display: block" centerY="40%" height="250">
          <e-axes>
            <e-axis
              [lineStyle]="lineStyle"
              radius="90%"
              startAngle="230"
              endAngle="130"
              minimum="0"
              maximum="150"
              [labelStyle]="labelStyle1"
              [majorTicks]="majorTicks1"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="115%"
                  roundedCornerRadius="10"
                  [linearGradient]="rangeLinearGradient1"
                  startWidth="17"
                  endWidth="17"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="Marker"
                  [value]="dbData?.quality"
                  markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="108%"
                  markerWidth="28"
                  markerHeight="28"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div
          style="
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
          "
        >
          <p class="text-center" style="margin: 0px">Quality</p>
          <p
            class="text-center text-gray-900 fw-bolder fs-2"
            style="margin: 0px"
          >
            {{ dbData?.quality.toFixed(2) }}
          </p>
        </div>
      </div>
      <div
        class="col-xxl-3 col-xl-6 col-lg-6"
        style="position: relative; height: 250px"
      >
        <ejs-circulargauge style="display: block" centerY="40%" height="250">
          <e-axes>
            <e-axis
              [lineStyle]="lineStyle"
              radius="90%"
              startAngle="230"
              endAngle="130"
              minimum="0"
              maximum="150"
              [labelStyle]="labelStyle1"
              [majorTicks]="majorTicks1"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="115%"
                  roundedCornerRadius="10"
                  startWidth="17"
                  endWidth="17"
                  [linearGradient]="rangeLinearGradient2"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="Marker"
                  [value]="dbData?.performance"
                  markerShape="Image"
                  imageUrl="https://ej2.syncfusion.com/angular/demos/assets/circular-gauge/images/golf-ball.png"
                  radius="108%"
                  markerWidth="28"
                  markerHeight="28"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>
        <div
          style="
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
          "
        >
          <p class="text-center" style="margin: 0px">KPI</p>
          <p
            class="text-center text-gray-900 fw-bolder fs-2"
            style="margin: 0px"
          >
            {{ dbData?.kpi.toFixed(2) }}
          </p>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-between mb-4" style="height: 30%">
      <div class="row" style="position: relative; width: 50%; height: 100%">
        <ejs-accumulationchart
          id="chart-task-group"
          [legendSettings]="legendSettings"
          width="100%"
          height="100%"
        >
          <e-accumulation-series-collection>
            <e-accumulation-series
              [dataSource]="dbData?.tasksByGroup"
              xName="taskGroupName"
              yName="qty"
              innerRadius="70%"
            ></e-accumulation-series>
          </e-accumulation-series-collection>
        </ejs-accumulationchart>
        <div style="position: absolute; top: 35%; left: 35%">
          <div class="text-center">{{ dbData?.tasks }}</div>
          <codx-label
            name="lblTasks"
            default="Công việc"
            [formModel]="formModel"
          >
          </codx-label>
        </div>
      </div>
      <div class="row" style="position: relative; width: 50%; height: 100%">
        <ejs-circulargauge
          style="display: block"
          centerY="40%"
          width="100%"
          height="100%"
        >
          <e-axes>
            <e-axis
              radius="100%"
              startAngle="0"
              endAngle="360"
              minimum="0"
              maximum="150"
              [lineStyle]="lineStyle"
              [labelStyle]="labelStyle2"
              [majorTicks]="majorTicks2"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="115%"
                  startWidth="12"
                  endWidth="12"
                  color="#F0F0F0"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="RangeBar"
                  roundedCornerRadius="10"
                  radius="115%"
                  color="#04DEB7"
                  pointerWidth="12"
                  [value]="dbData?.rateDoneTaskOnTime"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
            <e-axis
              radius="80%"
              startAngle="0"
              endAngle="360"
              minimum="0"
              maximum="150"
              [lineStyle]="lineStyle"
              [labelStyle]="labelStyle2"
              [majorTicks]="majorTicks2"
              [minorTicks]="minorTicks"
            >
              <e-ranges>
                <e-range
                  start="0"
                  end="150"
                  radius="115%"
                  startWidth="12"
                  endWidth="12"
                  color="#F0F0F0"
                >
                </e-range>
              </e-ranges>
              <e-pointers>
                <e-pointer
                  type="RangeBar"
                  roundedCornerRadius="10"
                  radius="115%"
                  color="#5465FF"
                  markerWidth="12"
                  pointerWidth="12"
                  [value]="dbData?.rateDoneTask"
                >
                </e-pointer>
              </e-pointers>
            </e-axis>
          </e-axes>
        </ejs-circulargauge>

        <!-- <div style="width: 200px; margin-top: 70px">
          <div style="display: flex; justify-content: between">
            <div class="label1" style="margin-left: 10px"></div>
            <div>Tỷ lệ hoàn thành công việc</div>
          </div>
          <h3>{{ dbData?.rateDoneTask.toFixed(2) }}%</h3>
          <div style="display: flex; justify-content: between">
            <div class="label2"></div>
            <div>Tỷ lệ hoàn thành công việc đúng hạn</div>
          </div>
          <h3>{{ dbData?.rateDoneTaskOnTime.toFixed(2) }}%</h3>
        </div> -->
      </div>
    </div>
    <div class="row bg-body mb-2" style="height: 30%">
      <ejs-chart
        style="display: block"
        background="transparent"
        id="chartbar"
        [primaryXAxis]="columnXAxis"
        [primaryYAxis]="columnYAxis"
        [legendSettings]="legendSettings"
        height="100%"
        width="100%"
      >
        <e-axes>
          <e-axis
            rowIndex="0"
            name="WorkHours"
            opposedPosition="true"
            labelFormat=""
            [minimum]="0"
            [maximum]="100"
            [interval]="4"
          >
          </e-axis>
        </e-axes>
        <e-series-collection>
          <e-series
            fill="#005DC7"
            [dataSource]="dbData?.dataBarChart?.barChart"
            type="Column"
            name="Tasks"
            xName="label"
            yName="value"
            [cornerRadius]="radius"
          >
          </e-series>
          <e-series
            fill="#F9D923"
            [dataSource]="dbData?.dataBarChart?.lineChart"
            type="Line"
            name="WorkHours"
            yName="value"
            xName="label"
            yAxisName="WorkHours"
          >
          </e-series>
        </e-series-collection>
      </ejs-chart>
    </div>
  </div>

  <div class="w-25 border bg-body m-2">
    <div class="taskbox-user" style="height: 20%">
      <selectweek
        #selectweek
        (onChangeValue)="onChangeValueSelectedWeek($event)"
      ></selectweek>
      <div class="taskbox-list" style="height: 80%">
        <div
          class="d-flex p-3 flex-grow-1 task-item"
          *ngFor="let task of taskOfDay"
        >
          <codx-img
            class="symbol symbol-40px symbol-circle me-3"
            objectType="AD_Users"
            [objectId]="task?.createdBy"
            [objectName]="task?.userName"
          ></codx-img>
          <div class="d-flex flex-column flex-grow-1">
            <div class="text-dark fw-bold">
              {{ task?.userName }}
            </div>
            <div class="text-gray-600 fs-7">{{ task?.positionName }}</div>
            <div class="task-name text-gray-600 fs-7">
              {{ task?.taskName }}
            </div>
            <div class="d-flex justify-content-start">
              <div
                class="bagde bagde-light-primary me-2"
                [style.border-color]="
                  task.status | vll: 'L0614':'color' | async
                "
                [style.background-color]="
                  (task.status | vll: 'L0614':'color' | async) + '30'
                "
                [style.color]="task.status | vll: 'L0614':'color' | async"
                style="border: none"
              >
                {{ task.status | vll: "L0614":"text" | async }}
              </div>
              <div>{{ task.dueDate | date }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #tooltip let-dialog>
  <div class="modal-header" style="border-bottom: none">
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex justify-content-between">
          <span style="margin-right: 20px">
            <i class="icon-info" style="color: #005dc7"></i
          ></span>
          <h2 id="modal-basic-title">
            <codx-label
              name="lblEvaluateWorkEfficiency"
              default="Đánh giá hiệu quả làm việc"
              [formModel]="dialog.formModel"
            ></codx-label>
          </h2>
        </div>
        <button
          type="button"
          class="btn btn-xs btn-icon btn-light btn-hover-primary"
          aria-label="Close"
          (click)="dialog.close()"
        >
          <span class="icon-close icon-20 text-dark text-hover-primary"></span>
        </button>
      </div>
    </div>
  </div>
  <div class="modal-body">
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">Availability (%)</p>
      <p class="">Tỷ lệ thời gian làm việc = <strong>(1)/(2)</strong></p>
      <p style="margin: 0px 0px 0px 20px">
        (1) Số giờ chấm công thực tế của nhân viên
      </p>
      <p
        style="
          font-style: italic;
          font-size: 12px;
          font-weight: 200;
          margin: 0px 0px 0px 30px;
          color: rgb(0, 0, 0, 0.5);
        "
      >
        (* Nếu chưa tích hợp chấm công sẽ bằng giờ công chuẩn)
      </p>
      <p style="margin: 0px 0px 0px 20px">
        (2) Số giờ công chuẩn theo lịch làm việc của công ty
      </p>
    </div>
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">Performance (%)</p>
      <p>Hiệu suất làm việc = <strong>(3)/(4)</strong></p>
      <p style="margin: 0px 0px 0px 20px">
        (3) Tổng số giờ hoàn thành công việc thực tế
      </p>
      <p style="margin: 0px 0px 0px 20px">
        (4) Tổng giờ công thực tế có điều chỉnh
      </p>
    </div>
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">Quality (%)</p>
      <p>Chất lượng công việc = <strong>(5)/(6)</strong></p>
      <p style="margin: 0px 0px 0px 20px">
        (5) Tổng số giờ hoàn thành công việc thực tế được duyệt
      </p>
      <p
        style="
          font-style: italic;
          font-size: 12px;
          font-weight: 200;
          margin: 0px 0px 0px 30px;
          color: rgb(0, 0, 0, 0.5);
        "
      >
        (* Nếu không sử dụng quy trình xét duyệt thì số giờ sẽ bằng số giờ thực
        tế)
      </p>
      <p style="margin: 0px 0px 0px 20px">
        (6) Tổng số giờ hoàn thành công việc thực tế
      </p>
    </div>
    <div style="margin-bottom: 20px">
      <p style="font-weight: 700; margin: 0px">KPI (%)</p>
      <p>Năng suất tương đương</p>
      <p
        style="
          margin-left: 100px;
          padding-bottom: 10px;
          width: fit-content;
          box-sizing: bor-box;
          border-bottom: 1px solid #000;
          text-align: center;
        "
      >
        Availability (%) * Performance (%) * Quality (%)
      </p>
      <p style="text-align: center">1000</p>
    </div>
  </div>
</ng-template>
