<div class="page-content d-flex flex-row">
  <div class="w-100 me-4 scroll-y h-100">
    <div class="row m-0 bg-body rounded-2 mb-3">
      <div class="fs-4 fw-bold mt-4">Thống kê theo nhóm công việc</div>
      <div class="col-lg-6" style="height: 250px">
        <ejs-accumulationchart
          id="chart-group-task"
          width="100%"
          height="250"
          [legendSettings]="legendRateDoneSettings"
        >
          <e-accumulation-series-collection>
            <e-accumulation-series
              [dataSource]="tasksByGroup ? tasksByGroup : {}"
              xName="taskGroupName"
              yName="percentage"
              innerRadius="82%"
            >
            </e-accumulation-series>
          </e-accumulation-series-collection>
        </ejs-accumulationchart>
      </div>
      <div class="col-lg-6" style="position: relative; height: 250px">
        <ejs-accumulationchart
          id="chart-rate-done"
          width="100%"
          height="250"
          [legendSettings]="legendRateDoneSettings"
        >
          <e-accumulation-series-collection>
            <e-accumulation-series
              [dataSource]="piedata ? piedata : {}"
              xName="x"
              yName="y"
              innerRadius="80%"
            >
            </e-accumulation-series>
          </e-accumulation-series-collection>
        </ejs-accumulationchart>
        <div
          style="
            position: absolute;
            top: 50%;
            left: 155px;
            transform: translate(-50%, -50%);
          "
        >
          <p class="text-center text-gray-900 fw-bold fs-4" style="margin: 0px">
            {{ qtyTasks }}
          </p>
          <p class="text-center fs-7 text-gray-500">Đánh giá</p>
        </div>
      </div>
    </div>
    <div class="row m-0 bg-body rounded-2 mb-3">
      <div class="fs-4 fw-bold mt-4">
        Thống kê công việc hoàn thành và số giờ thực hiện
      </div>
      <ejs-chart
        style="display: block"
        background="transparent"
        id="chartbar"
        [primaryXAxis]="columnXAxis"
        [primaryYAxis]="columnYAxis"
        [legendSettings]="legendSettings1"
        height="80%"
        width="100%"
      >
        <e-axes>
          <e-axis
            rowIndex="0"
            name="WorkHours"
            opposedPosition="true"
            labelFormat=""
            [minimum]="0"
            [maximum]="100"
            [interval]="8"
          >
          </e-axis>
        </e-axes>
        <e-series-collection>
          <e-series
            fill="#005DC7"
            [dataSource]="dataBarChart?.barChart"
            type="Column"
            name="Tasks"
            xName="label"
            yName="value"
            [cornerRadius]="radius"
          >
          </e-series>
          <e-series
            fill="#F9D923"
            [dataSource]="dataBarChart?.lineChart"
            type="Line"
            name="WorkHours"
            yName="value"
            xName="label"
            yAxisName="WorkHours"
          >
          </e-series>
        </e-series-collection>
      </ejs-chart>
    </div>
  </div>
  <div class="w-350px min-w-350px">
    <div class="rounded-2 bg-body mb-3">
      <div class="d-flex justify-content-start border-bottom p-5">
        <div class="bg-light-primary p-3 rounded-1 me-3">
          <span class="icon-check-correct icon-24"></span>
        </div>
        <div class="d-flex flex-column">
          <h1 class="mb-0">{{ status?.doneTasks }}</h1>
          <div class="text-gray-600">Công việc đã hoàn tất</div>
        </div>
      </div>
      <div class="d-flex py-3">
        <div class="w-50 p-3 border-right">
          <div class="fs-7 text-nowrap text-center">
            Tỷ lệ hoàn thành đúng hạn
          </div>
          <div class="text-primary fw-bolder fs-header text-center mt-2">
            {{ rateDoneTaskOnTime | number }} %
          </div>
        </div>
        <div class="w-50 p-3">
          <div class="fs-7 text-nowrap text-center">Công việc trễ hạn</div>
          <div class="text-primary fw-bolder fs-header text-center mt-2">
            {{ status?.overdueTasks }}
          </div>
        </div>
      </div>
    </div>
    <div class="rounded-2 bg-body mb-3">
      <div class="text-dark text-center fw-bold pt-5 mb-3">
        Danh sách nhân viên thực hiện công việc
      </div>
      <div style="position: relative" class="px-5">
        <button
          class="btn btn-icon btn-light btn-sortby"
          style="z-index: 99"
          (click)="sort()"
        >
          <div *ngIf="isDesc; then Desc; else Asc"></div>
          <ng-template #Desc
            ><span class="text-right icon-sort_Z-A"></span
          ></ng-template>
          <ng-template #Asc>
            <span class="text-right icon-sort_A-Z"></span>
          </ng-template>
        </button>
        <ejs-tab id="element">
          <e-tabitems>
            <e-tabitem
              [header]="headerText[0]"
              [content]="volumeWork"
            ></e-tabitem>
            <e-tabitem
              [header]="headerText[1]"
              [content]="workHours"
            ></e-tabitem>
          </e-tabitems>
        </ejs-tab>
      </div>
    </div>
  </div>
</div>

<!-- Khối lượng công việc -->
<ng-template #volumeWork>
  <div class="d-flex flex-column" *ngFor="let item of vlWork">
    <div class="d-flex flex-column">
      <div class="d-flex align-items-center justify-content-end">
        <span class="me-3">{{ item?.owner ? item?.owner : item?.id}}</span>
        <codx-img
          [width]="25"
          [objectId]="item?.id"
          [objectName]="item?.owner"
          [objectType]="'AD_Users'"
        ></codx-img>
      </div>
      <div class="d-flex align-items-center mb-5">
        <span class="fw-bold w-50px me-3 text-end">{{ item?.qtyTasks }}</span>
        <div class="progress w-100">
          <div
            class="progress-bar progress-bar-done"
            role="progressbar"
            [style.width.%]="item?.status?.done"
          ></div>
          <div
            class="progress-bar progress-bar-processing"
            role="progressbar"
            [style.backgroundColor]=""
            [style.width.%]="item?.status?.processing"
          ></div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thời gian thực hiện -->
<ng-template #workHours>
  <div class="d-flex flex-column" *ngFor="let item of hrWork">
    <div class="d-flex flex-column">
      <div class="d-flex align-items-center justify-content-end">
        <span class="me-3">{{ item?.owner ? item?.owner : item?.id }}</span>
        <codx-img
          [width]="25"
          [objectId]="item?.id"
          [objectName]="item?.owner"
          [objectType]="'AD_Users'"
        ></codx-img>
      </div>
      <div class="d-flex align-items-center mb-5">
        <span class="fw-bold w-50px me-3 text-end">{{ item?.completed }}</span>
        <div class="progress w-100">
          <div
            class="progress-bar progress-bar-processing"
            role="progressbar"
            [style.width.%]="item?.percentage"
          ></div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

