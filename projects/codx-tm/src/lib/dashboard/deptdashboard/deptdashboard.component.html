<codx-views #view [views]="views"> </codx-views>

<ng-template #content>
  <div class="page-content d-flex flex-row">
    <div class="w-100 me-4">
      <div class="row m-0 bg-body rounded-2 mb-3">
        <div class="fs-4 fw-bold mt-4">Thống kê theo nhóm công việc</div>
        <div class="col-lg-6 mb-2" style="height: 250px">
          <ejs-accumulationchart
            id="chart-group-task"
            width="100%"
            height="250"
            [legendSettings]="legendRateDoneSettings"
            [tooltip]="tooltip"
          >
            <e-accumulation-series-collection>
              <e-accumulation-series
                [dataSource]="tasksByGroup"
                xName="taskGroupName"
                yName="percentage"
                innerRadius="80%"
              >
              </e-accumulation-series>
            </e-accumulation-series-collection>
          </ejs-accumulationchart>
        </div>
        <div class="col-lg-6" style="position: relative; height: 250px">
          <ejs-accumulationchart
            id="chart-rate-done"
            width="100%"
            height="250"
            [legendSettings]="legendRateDoneSettings"
            [tooltip]="tooltip"
          >
            <e-accumulation-series-collection>
              <e-accumulation-series
                [dataSource]="tasksByOrgUnit"
                xName="orgUnitName"
                yName="qty"
                innerRadius="80%"
              >
              </e-accumulation-series>
            </e-accumulation-series-collection>
          </ejs-accumulationchart>
        </div>
      </div>
      <div class="row m-0 bg-body mb-2">
        <div class="col-lg-6">
          <div class="fs-4 fw-bold mt-4">
            Thống kê công việc hoàn thành và số giờ thực hiện
          </div>
          <ejs-chart
            style="display: block"
            background="transparent"
            [chartArea]="chartArea"
            width="100%"
            [align]="'center'"
            id="chartbar"
            [primaryXAxis]="columnXAxis"
            [primaryYAxis]="columnYAxis"
            [legendSettings]="legendSettings"
          >
            <e-axes>
              <e-axis
                rowIndex="0"
                name="WorkHours"
                opposedPosition="true"
                title=""
                labelFormat=""
                [minimum]="0"
                [maximum]="100"
                [interval]="8"
              >
              </e-axis>
            </e-axes>
            <e-series-collection>
              <e-series
                fill="#005DC7"
                [dataSource]="dataBarChart?.barChart"
                type="Column"
                name="Tasks"
                xName="label"
                yName="value"
                [cornerRadius]="radius"
              >
              </e-series>
              <e-series
                fill="#F9D923"
                [dataSource]="dataBarChart?.lineChart"
                type="Line"
                name="WorkHours"
                yName="value"
                xName="label"
                yAxisName="WorkHours"
              >
              </e-series>
            </e-series-collection>
          </ejs-chart>
        </div>
        <div class="col-lg-6">
          <div class="fs-4 fw-bold mt-4 mb-4">Tỷ lệ hoàn thành đúng hạn</div>
          <div *ngFor="let group of groups">
            <div class="d-flex justify-content-between">
              <div class="d-flex justify-content-between">
                <codx-img
                  class="me-2"
                  [width]="25"
                  [objectId]="group?.orgUnitID"
                  [objectname]="group?.orgUnitName"
                  [objectType]="'AD_Users'"
                ></codx-img>
                <div>{{ group?.orgUnitName }}</div>
              </div>
              <div class="fs-2 fw-bold mt-4">{{ group?.rate | number }}%</div>
            </div>
            <ejs-progressbar
              [id]="group.orgUnitID"
              type="Linear"
              height="40"
              trackThickness="10"
              progressThickness="10"
              [value]="group.rate"
              [animation]="animation"
            ></ejs-progressbar>
          </div>
        </div>
      </div>
    </div>
    <div class="w-350px min-w-350px">
      <div class="rounded-2 bg-body mb-3 p-6">
        <button
          class="btn btn-icon btn-light btn-sortby"
          style="z-index: 99"
          (click)="switchEmp()"
        >
          <div *ngIf="isTopEmp; then Desc; else Asc"></div>
          <ng-template #Desc
            ><span class="text-right icon-sort_Z-A"></span
          ></ng-template>
          <ng-template #Asc>
            <span class="text-right icon-sort_A-Z"></span>
          </ng-template>
        </button>
        <div class="text-dark text-center fw-bold mb-6">
          {{
            isTopEmp
              ? "Tỷ lệ hoàn thành công việc đúng hạn cao nhất"
              : "Tỷ lệ hoàn thành công việc đúng hạn thấp nhất"
          }}
        </div>

        <div class="mb-3" *ngIf="isTopEmp; else lastEmp">
          <div *ngFor="let emp of topEmps">
            <div class="mb-3">
              <div class="d-flex justify-content-between">
                <div class="d-flex justify-content-between">
                  <codx-img
                    [width]="30"
                    [objectId]="emp?.userID"
                    [objectName]="emp?.userName"
                    [objectType]="'AD_Users'"
                  ></codx-img>
                  <div class="ms-3">
                    <div class="text-dark fw-bold">{{ emp?.userName }}</div>
                    <div class="text-gray-500 fs-7">{{ emp?.role }}</div>
                  </div>
                </div>
                <div>{{ emp?.rateDoneTaskOnTime | number }}%</div>
              </div>
            </div>
          </div>
        </div>

        <div class="rounded-2 bg-body mb-4">
          <div class="text-dark text-center fw-bold pt-6 mb-3">
            Danh sách nhóm thực hiện công việc
          </div>
          <div style="position: relative">
            <button
              class="btn btn-icon btn-light btn-sortby"
              style="z-index: 99"
              (click)="sort()"
            >
              <div *ngIf="isDesc; then Desc; else Asc"></div>
              <ng-template #Desc
                ><span class="text-right icon-sort_Z-A"></span
              ></ng-template>
              <ng-template #Asc>
                <span class="text-right icon-sort_A-Z"></span>
              </ng-template>
            </button>
            <ejs-tab id="element">
              <e-tabitems>
                <e-tabitem
                  [header]="headerText[0]"
                  [content]="volumeWork"
                ></e-tabitem>
                <e-tabitem
                  [header]="headerText[1]"
                  [content]="workHours"
                ></e-tabitem>
              </e-tabitems>
            </ejs-tab>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Khối lượng công việc -->
<ng-template #volumeWork>
  <div class="d-flex flex-column" *ngFor="let item of vlWork">
    <div class="d-flex align-items-center justify-content-end">
      <span class="me-3">{{ item?.orgUnitName }}</span>
      <codx-img
        [width]="25"
        [objectId]="item?.id"
        [objectName]="item?.orgUnitName"
        [objectType]="'AD_Users'"
      ></codx-img>
    </div>
    <div class="d-flex align-items-center mb-5">
      <span class="fw-bold w-50px me-3 text-end">{{ item?.qtyTasks }}</span>
      <div class="progress w-100">
        <div
          class="progress-bar progress-bar-done"
          role="progressbar"
          [style.width.%]="item?.status?.done"
        ></div>
        <div
          class="progress-bar progress-bar-processing"
          role="progressbar"
          [style.backgroundColor]=""
          [style.width.%]="item?.status?.processing"
        ></div>
        <div
          class="progress-bar progress-bar-postpone"
          role="progressbar"
          [style.width.%]="item?.status?.postpone"
        ></div>
        <div
          class="progress-bar progress-bar-cancel"
          role="progressbar"
          [style.width.%]="item?.status?.cancel"
        ></div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thời gian thực hiện -->
<ng-template #workHours>
  <div class="d-flex flex-column" *ngFor="let item of hrWork">
    <div class="d-flex flex-column">
      <div class="d-flex align-items-center justify-content-end">
        <span class="me-3">{{ item?.orgUnitName }}</span>
        <codx-img
          [width]="25"
          [objectId]="item?.id"
          [objectName]="item?.orgUnitName"
          [objectType]="'AD_Users'"
        ></codx-img>
      </div>
      <div class="d-flex align-items-center mb-5">
        <span class="fw-bold w-50px me-3 text-end">{{ item?.completed }}</span>
        <div class="progress w-100">
          <div
            class="progress-bar progress-bar-processing"
            role="progressbar"
            [style.width.%]="item?.percentage"
          ></div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #lastEmp>
  <div *ngFor="let emp of lastEmps">
    <div class="mb-3">
      <div class="d-flex justify-content-between">
        <div class="d-flex justify-content-between">
          <codx-img
            [width]="30"
            [objectId]="emp?.userID"
            [objectType]="'AD_Users'"
          ></codx-img>
          <div class="ms-3">
            <div class="text-dark fw-bold">{{ emp?.userName }}</div>
            <div class="text-gray-500 fs-7">{{ emp?.role }}</div>
          </div>
        </div>
        <div>{{ emp?.rateDoneTaskOnTime | number }}%</div>
      </div>
    </div>
  </div>
</ng-template>
