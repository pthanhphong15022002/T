<div class="empty-data" *ngIf="!itemSelected?.taskID"></div>
<ng-container *ngIf="itemSelected?.taskID">
  <codx-detail-tmp [header]="header" [formModel]="formModel" [body]="body" [footer]="footer"
    (clickMF)="clickMF($event, itemSelected)" [dataItem]="itemSelected">
    <ng-template #header>
      <div class="container_detail mt-4">
        <div class="d-flex flex-grow-1 mb-3">
          <div class="symbol symbol-60px symbol-circle me-4">
            <codx-img [objectId]="itemSelected?.createdBy" objectType="AD_Users" [width]="55">
            </codx-img>
          </div>
          <div class="d-flex flex-column flex-grow-1">
            <div class="d-flex justify-content-between">
              <div class="d-flex flex-column">
                <div class="fw-bold fs-6 text-dark codx-text-overflow-1line">
                  {{ itemSelected?.userNameCreate }}
                </div>
                <div class="text-gray-500 me-4 mb-1">
                  {{ itemSelected?.positionNameCreate }}
                </div>
                <div class="d-flex align-items-center">
                  <div class="d-flex align-items-center me-4">
                    <span class="icon-phone_android icon-16 text-gray-600 me-2"></span>
                    <div class="text-gray-600" [ngClass]="
                        itemSelected?.phoneCreate
                          ? 'text-gray-600'
                          : 'text-gray-400'
                      ">
                      {{
                      itemSelected?.phoneCreate
                      ? itemSelected?.phoneCreate
                      : "Số điện thoại"
                      }}
                    </div>
                  </div>
                  <div class="d-flex align-items-center">
                    <span class="icon-email icon-16 text-gray-600 me-2"></span>
                    <div class="font-size-sm" [ngClass]="
                        itemSelected?.emailCreate
                          ? 'text-gray-600'
                          : 'text-gray-400'
                      ">
                      {{
                      itemSelected?.emailCreate
                      ? itemSelected?.emailCreate
                      : "Email"
                      }}
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-status flex">
                <div class="badge badge-danger me-2 label-status" [style.border-color]="
                    (itemSelected?.status  | vll: vllStatus:'textColor' | async) +
                    '30'
                  " [style.background-color]="
                    (itemSelected?.status | vll: vllStatus:'textColor' | async) +
                    '30'
                  " [style.color]="
                  itemSelected?.status | vll: vllStatus:'textColor' | async
                  " style="border: none">
                  {{itemSelected?.status | vll: vllStatus:"text" | async }}
                </div>

                <div *ngIf="itemSelected?.extendStatus && vllExtendStatus" class="badge badge-danger me-2 label-status" [style.border-color]="
                    (itemSelected?.extendStatus  | vll: vllExtendStatus:'textColor' | async) +
                    '30'
                  " [style.background-color]="
                    (itemSelected?.extendStatus | vll: vllExtendStatus:'textColor' | async) +
                    '30'
                  " [style.color]="
                  itemSelected?.extendStatus| vll: vllExtendStatus:'textColor' | async
                  " style="border: none">
                  {{itemSelected?.extendStatus| vll: vllExtendStatus:"text" | async }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="task-info mt-2">
          <div class="d-flex mt-1">
            <div class="float-left me-6">
              <div class="fw-bold me-1">
                <codx-label fiedName="DueDate" formName="Tasks" gridViewName="grvTasks" default="Ngày hết hạn">
                </codx-label>:
              </div>
              <span *ngIf="itemSelected.dueDate " class="text-gray-700">{{
                itemSelected.dueDate | date: "dd/MM/yyyy"
                }}</span>
              <span #dueDate *ngIf="!itemSelected?.dueDate ">{{ itemSelected.dueDate | formatvalue:
                formModel:"dueDate":dueDate :"Tasks":"grvTasks"| async }}</span>
            </div>
            <div class="float-left align-items-center text-dark me-6">
              <div class="me-1 fw-bold">
                <codx-label fiedName="Priority" formName="Tasks" gridViewName="grvTasks" default="Ưu tiên">
                </codx-label>:
              </div>
              <!--<span [class]="itemSelected?.priority | vll: 'L0186':'icon' | async" [style.color]="
              itemSelected?.priority | vll: 'L0186':'textColor' | async
            ">
          </span>
          <span class="text-gray-700">{{
            itemSelected?.priority | vll: "L0186":"text" | async
            }}</span> -->
              <div *ngIf="itemSelected?.priority">
                <span class="icon-14 me-1" [class]="itemSelected?.priority | vll: 'L0186':'icon' | async" [style.color]="
                itemSelected?.priority | vll: 'L0186':'textColor' | async
              ">
                </span>
                <span class="text-gray-700">{{
                  itemSelected?.priority | vll: "L0186":"text" | async
                  }}</span>
              </div>
              <div #priority *ngIf="!itemSelected?.priority">{{itemSelected?.priority| formatvalue :
                formModel:"priority" : priority:"Tasks":"grvTasks"|async}}</div>

            </div>
            <div class="float-left">
              <div class="fw-bold me-1">
                <codx-label name="lblTaskGroupName" formName="Tasks" default="Nhóm công việc">
                </codx-label>:
              </div>
              <div *ngIf="itemSelected?.taskGroupName" class="text-gray-700">{{
                itemSelected?.taskGroupName
                }}</div>
              <div *ngIf="!itemSelected?.taskGroupName" #taskGroupName>{{
                itemSelected?.taskGroupName|formatvalue :formModel : "taskGroupName" :taskGroupName
                :"TaskGroups":"grvTaskGroups"|async
                }}</div>
            </div>
          </div>
          <div class="d-flex mt-1">
            <div class="float-left me-6">
              <div class="fw-bold me-1">
                <codx-label fiedName="StartDate" formName="Tasks" gridViewName="grvTasks" default="Ngày bắt đầu">
                </codx-label>:
              </div>
              <!-- <span [ngClass]="
                  itemSelected?.startDate ? 'text-gray-700' : 'text-gray-400'
                ">{{ itemSelected?.startDate ? (itemSelected?.startDate | date: "dd/MM/yyyy") : "dd/mm/yyyy"}}</span> -->

              <span *ngIf="itemSelected?.startDate" class="text-gray-700">{{itemSelected?.startDate | date:
                "dd/MM/yyyy"}}</span>
              <span #startDate *ngIf="!itemSelected?.startDate">{{itemSelected?.startDate| formatvalue :
                formModel:"startDate" : startDate:"Tasks":"grvTasks"|async}}</span>
            </div>
            <div class="float-left align-items-center text-dark me-6">
              <div class="me-1 fw-bold">
                <codx-label fiedName="EndDate" formName="Tasks" gridViewName="grvTasks" default="Ngày kết thúc">
                </codx-label>:
              </div>
              <!-- <span [ngClass]="
              itemSelected?.endDate ? 'text-gray-700' : 'text-gray-400'
            ">{{ itemSelected?.endDate ? (itemSelected?.endDate | date: "dd/MM/yyyy") : "dd/mm/yyyy"}}</span> -->
              <span *ngIf="itemSelected?.endDate" class="text-gray-700">{{itemSelected?.endDate | date:
                "dd/MM/yyyy"}}</span>
              <span #endDate *ngIf="!itemSelected?.endDate">{{itemSelected?.endDate| formatvalue : formModel:"endDate" :
                endDate:"Tasks":"grvTasks"|async}}</span>
            </div>
            <div class="float-left">
              <div class="fw-bold me-1">
                <codx-label fiedName="CompletedOn" formName="Tasks" gridViewName="grvTasks" default="Ngày hoàn tất">
                </codx-label>:
              </div>
              <!-- <span [ngClass]="
                  itemSelected?.completedOn ? 'text-gray-700' : 'text-gray-400'
                ">{{ itemSelected?.completedOn ?(itemSelected?.completedOn| date: "dd/MM/yyyy"): "dd/mm/yyyy"}}
                {{ " | " + (itemSelected?.completed?itemSelected?.completed : 0 ) +" h "}}</span>-->
              <!-- <span #completedOn class="text-gray-700">{{itemSelected?.completedOn? (itemSelected?.completedOn| date:
                "dd/MM/yyyy" +' | ' + itemSelected?.completed + 'h') :(itemSelected?.completedOn| formatvalue :
                formModel:"completedOn" : completedOn|async )}}</span> -->
              <span *ngIf="itemSelected?.completedOn" class="text-gray-700">{{itemSelected?.completedOn| date:
                "dd/MM/yyyy" }} | {{itemSelected.completed}} <span>h</span> </span>
              <span *ngIf="!itemSelected?.completedOn" #completedOn>{{itemSelected?.completedOn| formatvalue :
                formModel:"completedOn" : completedOn:"Tasks":"grvTasks"|async }}</span>
            </div>
          </div>
        </div>
        <div class="mt-2" *ngIf="param?.ProjectControl!='0' || param?.LocationControl!='0'">
          <div class="d-flex mb-1" *ngIf="param?.ProjectControl!='0'">
            <span class="fw-bold me-2">
              <!-- <codx-label fiedName="ProjectName" formName="Projects" gridViewName="grvProjects" default="Dự án:">
              </codx-label> -->
              <codx-label name="lblProjectName" formName="Projects" default="Dự án"></codx-label>:
            </span>
            <span *ngIf="itemSelected?.projectName" class="text-gray-700">{{ itemSelected?.projectName}}</span>
            <span *ngIf="!itemSelected?.projectName" #projectName>{{ itemSelected?.projectName| formatvalue :
              formModel:"projectName"
              : projectName:"Projects":"grvProjects"|async }}</span>
          </div>
          <div class="d-flex" *ngIf="param?.LocationControl!='0'">
            <span class="fw-bold me-2">
              <codx-label fiedName="Location" formName="Tasks" gridViewName="grvTasks" default="Địa điểm">
              </codx-label>:
            </span>
            <!-- <span class="text-gray-700">{{ itemSelected?.location }}</span> -->
            <span *ngIf="itemSelected?.location" class="text-gray-700">{{itemSelected?.location}}</span>
            <span #location *ngIf="!itemSelected?.location">{{itemSelected?.location| formatvalue :
              formModel:"location" : location :"Tasks":"grvTasks"|async}}</span>
          </div>
        </div>
        <div *ngIf="itemSelected.tags" class="mt-2">
          <codx-tag [entityName]="formModel.entityName" [disabled]="true" [isEdit]="false" [value]="itemSelected.tags">
          </codx-tag>
        </div>
      </div>
    </ng-template>
    <ng-template #body>
      <div class="mt-6 mb-3 text-primary fw-bold">
        <codx-label fiedName="AssignTo" formName="Tasks" gridViewName="grvTasks" default="Người thực hiện">
        </codx-label>:
      </div>
      <div class="">
        <!-- <div *ngIf="itemSelected.category == '3'" class="" (click)="openViewListTaskResource(itemSelected)">
          <codx-imgs [objectId]="itemSelected?.assignTo" objectType="AD_Users" [numberImages]="10" >
          </codx-imgs>
        </div>-->
        <div *ngIf="itemSelected.category == '3'" class="">
          <codx-imgs [objectId]="itemSelected?.assignTo" objectType="AD_Users" [numberImages]="10"
            (mouseenter)="popoverEmpList(popoverList,itemSelected)" [ngbPopover]="popEmpList"
            popoverClass="empPopoverClass" #popoverList="ngbPopover" placement="right bottom" container="body"
            autoClose="outside" [openDelay]="500">
          </codx-imgs>
        </div>
        <div *ngIf="itemSelected.category == '1' || itemSelected.category == '2'" class="">
          <codx-imgs [objectId]="itemSelected?.owner" objectType="AD_Users" [numberImages]="10">
          </codx-imgs>
        </div>

        <!-- 
        <div *ngIf="itemSelected?.category=='1'||itemSelected?.category=='2'">
          <codx-img [width]="35" [objectId]="itemSelected?.owner" objectType="AD_Users">
          </codx-img>
        </div>
        <div *ngIf="itemSelected?.category=='3'|| itemSelected?.category=='4'"
          (click)="openViewListTaskResource(itemSelected)">
            <div *ngIf="itemSelected.assignTo.split(';').length <= 3">
              <ng-container *ngFor="let item of itemSelected.assignTo.split(';')">
                <codx-img [width]="35" [objectId]="item" objectType="AD_Users">
                </codx-img>
              </ng-container>
            </div>
            <div *ngIf="itemSelected.assignTo.split(';').length > 3">
              <ng-container *ngFor="let item of itemSelected?.assignTo.split(';'); index as i">
                <codx-img *ngIf="i < 9" [width]="35" [objectId]="item" objectType="AD_Users">
                </codx-img>
                <div *ngIf="i == 9" class="symbol symbol-35px symbol-circle">
                  <span  class="symbol-label "
                    style="background-color : #d0e41c;">+{{itemSelected?.assignTo.split(';')?.length-9}}</span>
                </div>
              </ng-container>
            </div>
        </div> -->
      </div>
      <div class="mt-6 mb-3 text-primary fw-bold">
        <!-- <codx-label fiedName="TaskName" formName="Tasks" gridViewName="grvTasks" default="Công việc">
        </codx-label>: -->
        <codx-label name="lblTaskName" formName="Tasks" default="Công việc">
        </codx-label>:
      </div>
      <div class="task-name fw-bold fs-5 text-dark mt-2 mb-2">
        {{ itemSelected?.taskName }}
      </div>
      <div class="text-gray-700" *ngIf="itemSelected?.memo" [innerHTML]="itemSelected?.memo"></div>
      <!-- <div class="text-gray-400"  *ngIf="itemSelected?.memo2"  [innerHTML]="itemSelected?.memo2"></div> -->
      <div class="mt-6 mb-3" *ngIf="itemSelected?.listTaskGoals.length > 0">
        <div class="text-primary fw-bold">
          <codx-label name="lblListTaskBoard" formName="Tasks" default="Danh sách việc cần làm"></codx-label>:
        </div>
        <div class="checkbox-list mt-2 ms-6 text-dark">
          <ng-container *ngFor="let item of itemSelected?.listTaskGoals">
            <div>
              <codx-input type="checkbox" class="me-6" label="{{ item.memo }}" labelPosition="After"
                [crrValue]="item.status == '90'" [disabled]="true"></codx-input>
            </div>
          </ng-container>
        </div>
      </div>
    </ng-template>
    <ng-template #footer>
      <codx-tabs></codx-tabs>
    </ng-template>
  </codx-detail-tmp>
</ng-container>

<ng-template #popEmpList>
  <div class="fw-bold">
    <codx-label name="AssignmentList" formName="Tasks" default="Danh sách phân công cho"></codx-label>
    <span>{{'('+countResource +')'}}</span>
  </div>
  <div>
    <codx-searchbar *ngIf="countResource>0" (searchEvent)="searchName($event)"></codx-searchbar>
  </div>
  <div class="d-flex align-items-start user-card p-3" *ngFor="let item of listTaskResousceSearch">
    <div class="me-3">
      <div style=" position: relative">
        <codx-img class="" [objectId]="item?.resourceID" objectType="AD_Users">
        </codx-img>
        <div style="position: absolute; right: 0px;bottom: 0px">
          <ng-container *ngFor="let role of listRoles">
            <ng-container *ngIf="role.value== item.roleType">
              <span><img src="/assets/themes/tm/default/img/{{role.icon}}" alt=""></span>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column flex-grow-1">
      <div class="text-dark fw-bold">{{item?.resourceName}}</div>
      <div class="text-gray-600 fs-7">{{item?.positionName}}</div>
      <div class="text-dark">
        {{item?.memo}}
      </div>
      <div class="d-flex align-items-center" *ngIf="item?.roleType == 'R' || item?.roleType == 'A'">
        <div class="d-flex align-items-end me-2 codx-badge">
          <span>
            <div class="d-status">
              <div class="badge badge-danger me-2 label-status" [style.border-color]="
                  (item?.status | vll: 'L0614':'textColor' | async) +
                  '30'
                " [style.background-color]="
                  (item?.status | vll: 'L0614':'textColor' | async) +
                  '30'
                " [style.color]="
                item?.status | vll: 'L0614':'textColor' | async
                " style="border: none">
                {{ item?.status | vll: "L0614":"text" | async }}
              </div>
            </div>
          </span>
          <span>
            <span class="text-gray-700">{{
              item.dueDate | date: "dd/MM/yyyy"
              }}</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</ng-template>