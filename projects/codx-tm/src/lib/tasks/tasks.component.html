<!-- view listdetail -->
<ng-template #panelRight>
  <app-view-detail [formModel]="view.formModel" [param]="param" [itemSelected]="itemSelected" [listRoles]="listRoles"
    [popoverCrr]="popoverCrr" [vllStatus]="vllStatus" (clickMoreFunction)="receiveMF($event)"
    (hoverPopover)="hoverPopover($event)">
  </app-view-detail>
</ng-template>

<ng-template #itemViewList let-data>
  <lib-view-list [formModel]="view.formModel" [data]="data" (clickMoreFunction)="receiveMF($event)">
  </lib-view-list>
</ng-template>
<ng-template #treeView let-data>
  <lib-tree-view [formModel]="view.formModel" [data]="data" (clickMoreFunction)="receiveMF($event)">
  </lib-tree-view>
</ng-template>


<ng-template #itemTemplate let-data>
  <codx-temp-full cardCss="card-template border-bottom px-2 py-3" (clickMF)="clickMF($event,data)" [typeMF]="'hover'"
    [iconCss]="'icon-notifications' +' '+(data.isTimeOut?'expired':'unexpired')" [icoStatus2]="data?.priority"
    [icoStatusVll2]="'L0186'" [imageId]="data.createdBy" imageObjType="AD_Users" [title]="data.userNameCreate"
    [subTitle]="data.positionNameCreate" [content]="data.taskName" [formModel]="view.formModel" [footer]="footerList"
    [dataItem]="data">
  </codx-temp-full>
</ng-template>

<ng-template #cardKanban let-data let-setting="setting">
  <codx-card-img cardCss="border h-100" imageObjType="AD_Users" (clickMF)="clickMF($event,data)" [typeMF]="'hover'"
    [icoStatus]="data.priority" icoStatusVll="L0186" [title]="data.userName" [subTitle]="data.positionName"
    [content]="data.memo||'memo'" [status]="data.status" [statusVll]="vllStatus" [date]="data.dueDate"
    [resources]="data.assignTo" [rootData]="data" [formModel]="view.formModel" [setting]="setting"
    [footer]="cardImgFooter" [dataItem]="data">
  </codx-card-img>

</ng-template>

<ng-template #cardImgFooter let-data let-setting="setting">
  <div class="d-flex flex-column flex-grow-1 mt-2">
    <div class="d-flex align-items-center mb-2">
      <codx-tag [entityName]="view.formModel.entityName" [disabled]="true" [value]="data.tags"></codx-tag>
    </div>
    <div class="progress h-5px w-100 my-2" *ngIf="setting?.processBar">
      <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0"
        aria-valuemax="100"></div>
    </div>
    <!--begin::Item-->
    <div class="d-flex justify-content-between align-items-end mt-2">
      <div class="d-flex align-items-end me-2 codx-badge">
        <div class="d-flex align-items-center position-relative me-4">
          <span class="icon-mode_comment icon-20 text-gray-400"></span>
          <span
            class="position-absolute top-0 start-100 translate-middle  badge badge-circle badge-primary badge-sm mn-6">{{data.comments}}</span>
        </div>
        <div class="d-flex align-items-center position-relative me-4">
          <span class="icon-check_box icon-20 text-gray-400"></span>
          <span
            class="position-absolute top-0 start-100 translate-middle  badge badge-circle badge-primary badge-sm mn-6">{{data.attachments}}</span>
        </div>
        <div class="d-flex align-items-center position-relative me-4">
          <span class="icon-attach_file icon-20 text-gray-400"></span>
          <span
            class="position-absolute top-0 start-100 translate-middle  badge badge-circle badge-light badge-sm mn-6">0</span>
        </div>
      </div>
      <div class="symbol-group symbol-hover justify-content-end"
        *ngIf="setting.resources && data.assignTo && data.assignTo.length">
        <codx-imgs [width]="30" [objectId]="data.assignTo" objectType="AD_Users" [numberImages]="3"
          (click)="openViewListTaskResource(data)">
        </codx-imgs>
      </div>
    </div>
    <!--end::Item-->
  </div>
</ng-template>

<ng-template #cellTemplate let-data>
  <div [innerHtml]="getCellContent(data.date)"></div>
</ng-template>

<ng-template #eventTemplate let-data>
  <div>
    <div>{{data.taskName}}</div>
  </div>
</ng-template>


<ng-template #footerList let-data>
  <div class="d-flex justify-content-between align-items-end mt-2">
    <div class="d-flex align-items-end me-2 codx-badge">
      <span>
        <div class="d-status">
          <div class="badge badge-danger me-2 label-status" [style.border-color]="
              (data?.status | vll:vllStatus:'textColor' | async) +
              '30'
            " [style.background-color]="
              (data?.status | vll: vllStatus:'textColor' | async) +
              '30'
            " [style.color]="
            data?.status | vll: vllStatus:'textColor' | async
            " style="border: none">
            {{ data?.status | vll: vllStatus:"text" | async }}
          </div>
        </div>
      </span>
      <span>
        <span class="text-gray-700">{{
          data.dueDate | date: "dd/MM/yyyy"
          }}</span>
      </span>
    </div>
    <div *ngIf="data.category == '3'" class="" (mouseenter)="popoverEmpList(popoverList,data)" [ngbPopover]="popEmpList"
      popoverClass="empPopoverClass" #popoverList="ngbPopover" placement="right bottom" container="body"
      autoClose="outside">
      <codx-imgs [objectId]="data?.assignTo" objectType="AD_Users" [numberImages]="3" [openDelay]="500">
      </codx-imgs>
    </div>
    <!-- <div *ngIf="(data.category == '1' || data.category == '2') && data.owner != user.userID" class="">
      <codx-imgs [objectId]="data?.owner" objectType="AD_Users" [numberImages]="3">
      </codx-imgs>
    </div> -->
    <!-- <div *ngIf="data.category=='1'||data.category=='2'">
        <codx-img [width]="30" [objectId]="data.owner" objectType="AD_Users">
        </codx-img>
      </div>
      <div *ngIf="data.category=='3'|| data.category=='4'" (click)="openViewListTaskResource(data)">

          <div *ngIf="data.assignTo.split(';').length <= 3">
            <ng-container *ngFor="let item of data.assignTo.split(';')">
              <codx-img [width]="30" [objectId]="item" objectType="AD_Users">
              </codx-img>
            </ng-container>
          </div>
          <div *ngIf="data.assignTo.split(';').length > 3">
            <ng-container *ngFor="let item of data.assignTo.split(';'); index as i">
              <codx-img *ngIf="i < 2" [width]="30" [objectId]="item" objectType="AD_Users">
              </codx-img>
              <div *ngIf="i == 2" class="symbol symbol-30px symbol-circle">
                <span class="symbol-label fs-4"
                  style="background-color : #d0e41c;">+{{data.assignTo.split(';')?.length-2}}</span>
              </div>
            </ng-container>
          </div>
      </div>    -->
  </div>
</ng-template>

<ng-template #popEmpList>
  <div class="fw-bold">
    <codx-label name="AssignmentList" formName="Tasks" default="Danh sách phân công cho"></codx-label>
    <span>{{'('+countResource +')'}}</span>
  </div>
  <div>
    <codx-searchbar *ngIf="countResource>0" (searchEvent)="searchName($event)"></codx-searchbar>
  </div>
  <div class="d-flex align-items-start user-card p-3" *ngFor="let item of listTaskResousceSearch">
    <div class="me-3">
      <div style=" position: relative">
        <codx-img class="" [objectId]="item?.resourceID" objectType="AD_Users">
        </codx-img>
        <div style="position: absolute; right: 0px;bottom: 0px">
          <ng-container *ngFor="let role of listRoles">
            <ng-container *ngIf="role.value== item.roleType">
              <span><img src="/assets/themes/tm/default/img/{{role.icon}}" alt=""></span>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column flex-grow-1">
      <div class="text-dark fw-bold">{{item?.resourceName}}</div>
      <div class="text-gray-600 fs-7">{{item?.positionName}}</div>
      <div class="text-dark">
        {{item?.memo}}
      </div>
      <!-- || item?.roleType == 'A'  trước đó có A mà giờ ko A vì a ko thực hiện => ko status ? ?? thương-->
      <div class="d-flex align-items-center" *ngIf="item?.roleType == 'R' ">
        <div class="d-flex align-items-end me-2 codx-badge">
          <span>
            <div class="d-status">
              <div class="badge badge-danger me-2 label-status" [style.border-color]="
                  (item?.status | vll: vllStatus:'textColor' | async) +
                  '30'
                " [style.background-color]="
                  (item?.status | vll: vllStatus:'textColor' | async) +
                  '30'
                " [style.color]="
                item?.status | vll: vllStatus:'textColor' | async
                " style="border: none">
                {{ item?.status | vll: vllStatus:"text" | async }}
              </div>
            </div>
          </span>
          <span>
            <span class="text-gray-700">{{
              item.dueDate | date: "dd/MM/yyyy"
              }}</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<codx-views #view service="TM" entityName="TM_Tasks" idField="taskID" assemblyName="ERM.Business.TM"
  className="TaskBusiness" method="GetListDetailTasksAsync" [views]="views" [button]="button"
  (buttonClick)="click($event)" (viewChanged)="changeView($event)" (requestEnded)="requestEnded($event)"
  [dataObj]="dataObj" (selectedChange)="selectedChange($event)" (onDragDrop)="onDragDrop($event)"
  (onActions)="onActions($event)" [selectedFirst]="true" [autoLoad]="true">
</codx-views>
