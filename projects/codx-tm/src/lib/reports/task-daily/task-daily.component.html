<codx-views #view [funcID]="'TMR01'" [autoLoad]="false" entityName="TM_Tasks" service="TM" assemblyName="ERM.Business.TM" className="ReportBusiness"
  method="ListReportTasksAsync" [views]="views" idField="taskID" [pageSize]="100" [selectedFirst]="true"
  (filterReportChange)="paramChange($event)" (reportPrint)="printReport()"
  >
</codx-views>

<ng-template #GiftIDCell let-data>
  <div class="icon-flag icon-20" [class]="data?.priority | vll: 'L0186':'icon' | async"
    [style.color]="data?.priority | vll: 'L0186':'color' | async"></div>
</ng-template>
<ng-template #itemStatusVll let-data>
  <div class="task-status d-flex">
    <div class="badge badge-danger me-2" [style.border-color]="
    (data?.status | vll: 'L0614':'color' | async) + '30'
  " [style.background-color]="
    (data?.status | vll: 'L0614':'color' | async) + '30'
  " [style.color]="data?.status | vll: 'L0614':'color' | async" style="border: none">
      {{ data?.status | vll: "L0614":"text" | async }}
    </div>
  </div>
</ng-template>
<ng-template #itemMemo let-data>
  <div class="dropdown ms-2" [class.dropdown-customv2]="data.memo" [ngbPopover]="popDetail" #p="ngbPopover"
    [openDelay]="500" (mouseenter)="PopoverDetail(p, data)" (mouseleave)="PopoverDetail(p, null)" placement="bottom"
    autoClose="outside">
    <button [disabled]="!data.memo" class="btn" type="button" id="dropdownShowDescription" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="false">
      <span class="icon-assignment icon-16 text-dark-50 me-1"></span>
      <span class="task-des">Mô tả công
        việc</span>
    </button>
  </div>
</ng-template>

<ng-template #popDetail let-data>
  <div>
    <ng-container>
      <div class="d-flex flex-column flex-grow-1">
        <div class="result-title text-dark font-size-h5 mb-2">Mô tả chi tiết</div>
        <div class="text-dark-75 font-size-md">
          {{popoverDetail?.memo}}
          <div class="d-flex align-items-center mt-2">
            <div class="d-flex align-items-center me-2">
              <span class="icon-create icon-18 text-dark-50"></span>
              <span class="text-dark-50 text-italic"> {{popoverDetail?.memo2}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #itemOwner let-data>
  <div class="d-flex align-items-center" #itemOwner>
    <codx-img class="symbol symbol-24 symbol-circle me-3" [objectId]="data.owner" objectType="AD_Users">
    </codx-img>
    <div class="text-dark font-size-lg" style="margin-left: 20px;">{{data.userName}}</div>
  </div>
</ng-template>
<ng-template #itemDueDate let-data>
  <div *ngIf="data.dueDate==null">
    {{data?.dueDate }}
  </div>
  <div *ngIf="data.dueDate!=null">
    {{data?.dueDate |date:'dd/MM/yyyy'}}
  </div>
</ng-template>
<ng-template #itemCompletedOn let-data>
  <div *ngIf="data.completedOn==null">
    {{data?.completedOn }}
  </div>
  <div *ngIf="data.completedOn!=null">
    {{data?.completedOn |date:'dd/MM/yyyy'}}
  </div>
</ng-template>
<ng-template #itemActive let-data>
  <div class="d-flex align-items-center w-100px">
    <div class="d-flex align-items-center me-3 {{data?.comments  ? 'text-success' : 'text-dark-50'}}">
      <span class="text-hover-primary icon-chat_bubble_outline icon-16"></span>
      <span class="ms-1"> {{data?.comment}}</span>
    </div>
    <div class="d-flex align-items-center me-3 {{data?.todo ? 'text-success' : 'text-dark-50'}}">
      <span class="text-hover-primary icon-check-correct icon-16"></span>
      <span class="ms-1">
        {{data?.todo}}</span>
    </div>
    <div class="d-flex align-items-center {{data?.attachments ? 'text-success' : 'text-dark-50'}}">
      <span class="text-hover-primary icon-attach_file icon-16"></span>
      <span>
        {{data?.attachments}}
      </span>
    </div>
  </div>
</ng-template>


<ng-template #pined>
  <div class="d-flex justify-content-start w-100">
    <button [title]="titleCollapse"type="button" class="btn btn-sm background-color-white my-1 text-hover-primary " style="margin-left: -5px ;" (click)="collapse($event)">
      <i style="font-size: 21px !important;font-weight:600" class="icon-tune text-muted"></i>
    </button>
    <div class="w-100 d-flex justify-content-start ">
      <div class=" mx-3" *ngFor="let item of lstPined">
        <ng-container [ngSwitch]="item?.dataType" >
          <ng-container *ngSwitchCase="'string'">
            <div class="w-275px mt-3" *ngIf="!item.referedType">
              <codx-input
                type="text"
                [className]="'border'"
                [field]="item.controlName"
                placeholder="Có chứa giá trị..."
                [crrValue]="item.defaultValue"
                (valueChange)="reportObj.valueChange($event)"
              ></codx-input>
            </div>
            <div class="w-275px mt-3" *ngIf="item.referedType == '3'">
              <codx-input
                type="combobox"
                [field]="item.controlName"
                [crrValue]="item.defaultValue"
                [refValue]="item.referedValue"
                (valueChange)="reportObj.valueChange($event)"
              >
              </codx-input>
            </div>
            <div class="w-275px mt-3" *ngIf="item.referedType == '2'">
              <codx-input
                type="valuelist"
                [field]="item.controlName"
                [crrValue]="item.defaultValue"
                [refValue]="item.referedValue"
                (valueChange)="reportObj.valueChange($event)"
              >
              </codx-input>
            </div>
          </ng-container>
          <ng-container *ngSwitchCase="'bool'">
            <div
              class="float-end"
              *ngIf="item.controlType == 'LVSwitch'"
              [title]="item.controlName"
            >
              <codx-input
                class="float-right"
                type="switch"
                [field]="item.controlName"
                [crrValue]="
                  item.defaultValue ? item.defaulValue : false
                "
                (valueChange)="reportObj.valueChange($event,false,'switch')"
              ></codx-input>
            </div>
            <div
              class="w-100 ms-5 mt-3"
              *ngIf="item.controlType == 'LVCheckbox'"
            >
            <div class="d-flex">
              <div class="float-start mx-5">
                <codx-input
                type="checkBox"
                [field]="item.controlName"
                [crrValue]="
                  item.defaultValue ? item.defaulValue : false
                "
                (valueChange)="valueChange($event)"
              ></codx-input>
              </div>
              <div class="w-100 float-end">
                <span
                style="font-size:12px;font-weight: 400;"
                >{{item.labelName}}
              </span>
              </div>
            </div>

            </div>
          </ng-container>
          <ng-container *ngSwitchCase="'DateTime'">
            <div class="my-2 ">
              <codx-dropdown-calendar
                cssPopup="h-600px w-800px"
                cssClass=" button-radius"
                (change)="reportObj.changeValueDate($event)"
              ></codx-dropdown-calendar>
            </div>
          </ng-container>
          <ng-container *ngSwitchCase="'int'">
            <div class="w-100 mt-3">
              <div class="d-flex">
                <div class="float-start me-1">
                  <codx-input
                    type="number"
                    field="numberFrom"

                    [crrValue]="
                      item.defaultValue ? item.defaultValue : 0
                    "
                    (valueChange)="reportObj.valueChange($event)"
                    placeholder="Từ"
                  ></codx-input>
                </div>
                <div class="float-end ms-1">
                  <codx-input
                    type="number"
                    field="numberTo"
                    [crrValue]="
                      item.defaultValue ? item.defaultValue : 0
                    "
                    (valueChange)="reportObj.valueChange($event)"
                    placeholder="Đến"
                  ></codx-input>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #report>
  <codx-report [showToolbar]="true" [reportUUID]="funcID" [parameters]="param" [print]="print"></codx-report>
  </ng-template>
