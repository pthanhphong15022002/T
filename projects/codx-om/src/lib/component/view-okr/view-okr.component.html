<div class="okr-treeview ">
  <codx-treeview id="tree" #treeView [itemTemplate]="templateOKRTreeView" [data]="dataOKR" [enableCheck]="false"
    idField="recID" parentIdField="parentID" [autoLoad]="false" [isOutput]="true" [isLoadChild]="true"
    (selectionChange)="selectionChange($event)" >
  </codx-treeview>  
</div>
<ng-template #templateOKRTreeView let-item>
  <!--OB node-->
  <div class="d-flex align-items-center flex-column justify-content-between " *ngIf="item?.okrType==obType">
    <div class="w-100 ob-background d-flex justify-content-between ">   

      <div class="d-flex align-items-center  okr-treegroup col-8">
        <!-- <span class="ms-5 me-3" [inlineSVG]="okrVll?.ob?.icon"></span> -->
        <div class="progress-container">              
          <div class="progress-container-align position-relative">
            <span class="position-absolute w-100 h-100 d-flex justify-content-center align-items-center">
              <span>
                <span class="fs-6 fw-bold">{{item?.progress}}</span>
                <span class="fs-9">%</span>
              </span>
            </span>
            <div *ngIf="item?.recID!=null">
              <ejs-progressbar #annotation1 [id]="'label-container-tree'+item?.recID" [type]="'Circular'" [maximum]="100"
              [minimum]="0" [value]="item?.progress" [width]="'70'" [height]="'70'" [trackThickness]="5"
              [progressThickness]="3" [progressColor]="'#FF0000'"
              >
              <!-- <e-progressbar-annotations> <e-progressbar-annotation [content]="item?.progress +'%'" > </e-progressbar-annotation> </e-progressbar-annotations> [animation]="{enable: true, duration: 2000, delay: 0}" -->
            </ejs-progressbar>
            </div>
            
          </div>
        </div>
        <span class="ob-kr ob-name fs-5 fw-bold me-6" >{{ item?.okrName }}</span>
        <div class="d-flex flex-column">
          <div class="d-flex flex-stack">
            <codx-vll *ngIf="item?.category" [showText]="true" [showBgColor]="true" [name]="'OM012'"
              [value]="item?.category" class="me-2 badge badge-light badge-md fs-7">
            </codx-vll>
            <codx-vll *ngIf="item?.confidence" [showText]="true" [showBgColor]="true" [name]="'OM013'"
              [value]="item?.confidence" class="me-2 badge badge-light badge-md fs-7">
            </codx-vll>
          </div>
        </div>
      </div>

      <div class="d-flex align-items-center justify-content-end ps-5 col-4">
        <codx-img [width]="30" [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
        <!-- <div class="d-flex flex-column align-items-center kr-process w-100px min-w-100px ps-5">
          <span *ngIf="item?.progress==0" [innerHTML]="(item?.progress)+'%'"></span>
          <span *ngIf="item?.progress!=0"
            [innerHTML]="(item?.progress | formatvalue : okrFM?.obFM : 'progress' | async )+'%'"></span>
          <div class="h-5px w-100 bg-gray-200 rounded-2">
            <div class="bg-color" role="progressbar" [style.width]="item?.progress + '%'" aria-valuenow="50"
              aria-valuemin="0" aria-valuemax="100">
            </div>
          </div>
        </div> -->
        <div class="d-flex ps-5 align-items-end">
          <button class="btn btn-icon btn-sm position-relative ms-2" ngbTooltip="Công việc">
            <span class="icon-content_paste icon-18 text-gray-600 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs"
              [ngClass]="item?.okrTasks  && item?.okrTasks.length>0 ? 'bg-danger': ''">{{
              item?.okrTasks ? item?.okrTasks?.length : '' }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-2" ngbTooltip="Bình luận">
            <span class="icon-chat_bubble_outline icon-18 text-gray-600 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs"
              [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-danger': ''">{{
              item?.notes ? item?.notes?.length : '' }}</span>
          </button>          
        </div>
      </div>
    </div>
  </div>

  <!--KR node-->
  <div class="d-flex align-items-center py-2 kr-background justify-content-between okr-treenode w-100"
    *ngIf="item?.okrType==krType || item?.okrType==skrType">
    <div class="d-flex align-items-center col-6">
      <!-- <span class="me-3" [inlineSVG]="okrVll?.kr?.icon"></span> -->
      <!-- <span class="okr-node border-3px rounded-circle border pe-1 "
        [ngClass]="item?.okrType==krType?'border-warning':'border-primary'"></span> -->
      <span class="icon-brightness_1" [ngClass]="item?.okrType==krType?'text-warning':'text-info'"></span>
      <span class="ps-5 d-flex flex-column">
        <span class="ob-kr text-dark fw-bold kr-name" > {{ item?.okrName }} </span>
        <div class="d-flex flex-wrap">
          <div class="d-flex align-items-center">
            <span class=" text-gray-500 me-1">{{okrGrv?.krGrv?.target?.headerText+':'}}</span>
            <span class="me-1" [innerHTML]="item?.target "></span>
            <span [innerHTML]="getUMName(item?.umid)"></span>
          </div>
          <span class="mx-2 text-gray-400">|</span>
          <div class="d-flex align-items-center">
            <span class="text-gray-500 me-1">{{okrGrv?.krGrv?.current?.headerText+':'}}</span>
            <span class="me-1" [innerHTML]="item?.current "></span>
            <span [innerHTML]="getUMName(item?.umid)"></span>
          </div>
          <span class="mx-2 text-gray-400">|</span>
          <div class="d-flex align-items-center">
            <span class="text-gray-500 me-1">{{okrGrv?.krGrv?.actual?.headerText+':'}}</span>
            <span class="me-1" [innerHTML]="item?.actual "></span>
            <span [innerHTML]="getUMName(item?.umid)"></span>
            <!-- <span [innerHTML]="item?.umid | formatvalue : okrFM?.krFM : 'UMID' | async"></span> -->
          </div>
        </div>

      </span>

    </div>

    <div class="d-flex align-items-center justify-content-end col-6 ps-5">
      <span [innerHTML]="item?.rangeDate"></span>
      <codx-img [width]="30" [objectId]="item?.owner" [objectType]="'AD_Users'" class="ps-5"></codx-img>
      <div class="d-flex ps-5 align-items-end">
        <div class="d-flex flex-column align-items-center kr-process w-150px pe-2  pb-2">
          <span class="mb-1" *ngIf="item?.progress==0" [innerHTML]="(item?.progress)+'%'"></span>
          <span class="mb-1" *ngIf="item?.progress!=0"
            [innerHTML]="(item?.progress | formatvalue : okrFM?.krFM : 'progress' | async )+'%'"></span>
          <div class="h-5px w-100 position-relative bg-gray-200 rounded-4">
            <div class="rounded-4 h-5px " [ngClass]="item?.actual>=item?.current? 'bg-success' :'bg-danger'"
              role="progressbar" [style.width]="item?.progress + '%'" aria-valuenow="50" aria-valuemin="0"
              aria-valuemax="100">
            </div>
            <span class="progress-node border-2px position-absolute rounded-circle border me-1"
              [ngClass]="[item?.actual>=item?.current ?'border-success' :'border-danger']"
              [style.left]="(item?.progress-2) + '%'"></span>
          </div>
        </div>
        <button class="btn btn-icon btn-sm position-relative ms-5" ngbTooltip="Công việc"
          >
          <span class="icon-content_paste icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs"
            [ngClass]="item?.okrTasks  && item?.okrTasks.length>0 ? 'bg-danger': ''">{{
            item?.okrTasks ? item?.okrTasks?.length : '' }}</span>
        </button>

        <button class="btn btn-icon btn-sm position-relative ms-2" ngbTooltip="Bình luận"
          >
          <span class="icon-chat_bubble_outline icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs"
            [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-danger': ''">{{
            item?.notes ? item?.notes?.length : '' }}</span>
        </button>
        
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateTreeView1 let-item>
  <!--OB node-->
  <div class="d-flex align-items-center flex-column justify-content-between " *ngIf="item?.okrType==obType">

    <hr class=" w-100 my-0" *ngIf="isShowBreakLine">
    <div class="w-100 mt-3 mb-2 ob-background d-flex justify-content-between">
      <div class="d-flex align-items-center flex-row cursor-pointer w-100">
        
        <span class="me-3" [inlineSVG]="okrVll?.ob?.icon"></span>
        <span  class="ob-name fs-6 fw-bold me-6" >{{ item?.okrName }}</span>
        <codx-vll *ngIf="item?.category" [showText]="true" [showBgColor]="true" [name]="'OM012'"
          [value]="item?.category" class="me-2 badge badge-light badge-md fs-7">
        </codx-vll>
        <codx-vll *ngIf="item?.confidence" [showText]="true" [showBgColor]="true" [name]="'OM013'"
          [value]="item?.confidence" class="badge badge-light badge-md fs-7">
        </codx-vll>
      </div>
      <div class="d-flex align-items-center justify-content-end ms-6">
        <codx-img [width]="30" [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
        <div class="d-flex flex-column align-items-center kr-process w-100px min-w-100px ms-6">
          
          <span *ngIf="item?.progress!=0" [innerHTML]="(item?.progress | formatvalue :  okrFM?.obFM : 'progress' | async )+'%'"></span>
          
          <span *ngIf="item?.progress==0" [innerHTML]="(item?.progress)+'%'"></span>
          <div class="h-5px w-100 bg-gray-200 rounded-4">
            <div class="bg-color rounded-4 h-5px" role="progressbar" [style.width]="item?.progress + '%'"
              aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
        <div class="d-flex ms-6 align-items-end">
          <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Kết quả">
            <span class="icon-vpn_key icon-18 text-gray-600 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.items && item?.items.length >0 ? 'bg-color': 'bg-gray-300'">{{
              item?.items? item?.items.length :0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Phân công/Phân bổ">
            <span class="icon-link icon-18 text-gray-600 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
              [ngClass]="item?.totalLinkOKR>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.totalLinkOKR ? item?.totalLinkOKR : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Công việc">
            <span class="icon-format_list_bulleted icon-18 text-gray-600 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.okrTasks  && item?.okrTasks.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.okrTasks ? item?.okrTasks.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Bình luận">
            <span class="icon-chat_bubble_outline icon-18 text-gray-600 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.notes ? item?.notes.length : 0 }}</span>
          </button>
          <!-- <codx-mfunc [formModel]="formModelOB" type="view" [dataItem]="item" class="ms-4"
            (clickMF)="clickMF($event,item)"></codx-mfunc>  -->
        </div>
      </div>
    </div>

  </div>

  <!--KR node-->
  <div class="d-flex align-items-center py-3 kr-background justify-content-between me-3" *ngIf="item?.okrType==krType">

    <div class="d-flex align-items-center cursor-pointer  w-100">
      <span class="me-3" [inlineSVG]="okrVll?.kr?.icon"></span>
      <div class="d-flex align-items-top">
        <span  class="fs-6 kr-name fw-bold text-dark" > {{ item?.okrName }} </span>
        <span class="mx-2 text-gray-400">|</span>
        <span class="me-1 text-gray-600" *ngIf="item?.target"> {{item?.target}} </span>
        <span class="text-gray-600" [innerHTML]="item?.umid | formatvalue : okrFM?.krFM : 'UMID' | async"></span>
      </div>
    </div>
    <div class="d-flex align-items-center justify-content-end ms-6">
      <codx-img [width]="30" [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
      <div class="d-flex flex-column align-items-center kr-process w-100px min-w-100px ms-6">
        
        <span  *ngIf="item?.progress!=0" [innerHTML]="(item?.progress | formatvalue :  okrFM?.krFM : 'progress' | async )+'%'"></span>
        
        <span *ngIf="item?.progress==0" [innerHTML]="(item?.progress)+'%'"></span>
        <div class="h-7px w-100 bg-gray-200 rounded-4">
          <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
            aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

      </div>
      <div class="d-flex ms-6 align-items-end">
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Kết quả phụ">
          <span class="icon-vpn_key icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
            [ngClass]="item?.items  && item?.items.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.items ? item?.items.length : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Phân công/Phân bổ">
          <span class="icon-link icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
            [ngClass]="item?.totalLinkOKR>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.totalLinkOKR ? item?.totalLinkOKR : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Công việc">
          <span class="icon-format_list_bulleted icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.okrTasks  && item?.okrTasks.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.okrTasks ? item?.okrTasks?.length : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Bình luận">
          <span class="icon-chat_bubble_outline icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.notes ? item?.notes?.length : 0 }}</span>
        </button>
        <!-- <codx-mfunc [formModel]="formModelKR" type="view" [dataItem]="item" class="ms-4"
          (clickMF)="clickKRMF($event,item,false)" (changeDataMF)="changeDataKRMF($event,item,false)"></codx-mfunc> -->
      </div>
    </div>
  </div>

  <!--SKR node-->
  <div class="d-flex align-items-center border-bottom py-3 skr-background justify-content-between  ms-3"
    *ngIf="item?.okrType==skrType">
    <div class="d-flex align-items-center cursor-pointer w-100">
      <span class="me-3" [inlineSVG]="okrVll?.skr?.icon"></span>
      <div class="d-flex align-items-top">
        <div class="fw-bold text-dark">{{ item?.okrName }} </div>
        <span class="mx-2 text-gray-400">|</span>
        <span class="me-1 text-gray-600" *ngIf="item?.target"> {{item?.target}} </span>
        <span class="text-gray-600" [innerHTML]="item?.umid | formatvalue : okrFM?.skrFM : 'UMID' | async"></span>
      </div>
    </div>
    <div class="d-flex align-items-center justify-content-end ms-6">
      <codx-img [width]="30" [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
      <div class="d-flex flex-column align-items-center kr-process w-100px min-w-100px ms-6">
         <span *ngIf="item?.progress!=0"  [innerHTML]="(item?.progress | formatvalue : okrFM?.skrFM : 'progress' | async )+'%'"></span>
         
         <span *ngIf="item?.progress==0" [innerHTML]="(item?.progress)+'%'"></span>
        <div class="h-7px w-100 bg-gray-200 rounded-4">
          <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
            aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

      </div>
      <div class="d-flex ms-6 align-items-end">
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-vpn_key icon-20 text-gray-300 text-hover-primary"></span>

        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Phân công/Phân bổ">
          <span class="icon-link icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
            [ngClass]="item?.totalLinkOKR>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.totalLinkOKR ? item?.totalLinkOKR : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Công việc">
          <span class="icon-format_list_bulleted icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.okrTasks  && item?.okrTasks.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.okrTasks ? item?.okrTasks?.length : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4" ngbTooltip="Bình luận">
          <span class="icon-chat_bubble_outline icon-18 text-gray-600 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.notes ? item?.notes?.length : 0 }}</span>
        </button>
        <!-- <codx-mfunc [formModel]="formModelSKR" type="view" [dataItem]="item" class="ms-4"
          (clickMF)="clickKRMF($event,item,true)"  (changeDataMF)="changeDataKRMF($event,item,false)"></codx-mfunc> -->
      </div>
    </div>
  </div>

</ng-template>