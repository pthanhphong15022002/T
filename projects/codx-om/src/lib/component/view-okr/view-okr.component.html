<div class="">
  <codx-treeview id="tree" #treeView [itemTemplate]="templateTreeView" [data]="dataOKR" [enableCheck]="false"
    idField="recID" parentIdField="parentID" [autoLoad]="false" [isOutput]="true" [isLoadChild]="true"
    (selectionChange)="selectionChange($event)">
  </codx-treeview>


  <ng-template #templateTreeView1 let-item>
    <!--OB node-->
    <div class="d-flex align-items-center flex-column justify-content-between py-3" *ngIf="item?.okrType==obType">

      <hr class="mt-2 w-100" *ngIf="isShowBreakLine">
      <div class="w-100 d-flex justify-content-between">
        <div class="d-flex align-items-center flex-row cursor-pointer w-100">
          <span class="fa-solid fa-bullseye me-3 fs-2 txt-color-0E4C55"></span>
          <span class="ob-kr">{{ item?.okrName }}</span>
          <codx-vll *ngIf="item?.category" [showText]="true" [showBgColor]="true" [name]="'OM012'"
            [value]="item?.category" class="ms-2 badge badge-light badge-md fs-7">
          </codx-vll>
          <codx-vll *ngIf="item?.confidence" [showText]="true" [showBgColor]="true" [name]="'OM013'"
            [value]="item?.confidence" class="badge badge-light badge-md fs-7">
          </codx-vll>
        </div>
        <div class="d-flex align-items-center justify-content-end ">

          <codx-img [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
          <div class="d-flex flex-column align-items-center kr-process w-200px min-w-200px ms-3">
            <span>{{item?.progress}}%</span>
            <div class="h-7px w-100 bg-gray-200 rounded-4">
              <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
                aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>


          </div>
          <div class="d-flex ms-5">
            <button class="btn btn-icon btn-sm position-relative ms-4">
              <span class="icon-vpn_key icon-20 text-gray-800 text-hover-primary"></span>
              <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
                [ngClass]="item?.child && item?.child.length >0 ? 'bg-color': 'bg-gray-300'">{{
                item?.child? item?.child.length :0 }}</span>
            </button>
            <button class="btn btn-icon btn-sm position-relative ms-4">
              <span class="icon-link icon-20 text-gray-800 text-hover-primary"></span>
              <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
                [ngClass]="item?.shares  && item?.shares.length>0 ? 'bg-color': 'bg-gray-300'">{{
                item?.shares ? item?.shares?.length : 0 }}</span>
            </button>
            <button class="btn btn-icon btn-sm position-relative ms-4">
              <span class="icon-format_list_bulleted icon-20 text-gray-800 text-hover-primary"></span>
              <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
                [ngClass]="item?.updates  && item?.updates.length>0 ? 'bg-color': 'bg-gray-300'">{{
                item?.updates ? item?.updates.length : 0 }}</span>
            </button>
            <button class="btn btn-icon btn-sm position-relative ms-4">
              <span class="icon-chat_bubble_outline icon-20 text-gray-800 text-hover-primary"></span>
              <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
                [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
                item?.notes ? item?.notes.length : 0 }}</span>
            </button>
            <!-- <codx-mfunc [formModel]="formModelOB" type="view" [dataItem]="item" class="ms-4"
                      (clickMF)="clickMF($event,item)"></codx-mfunc> -->
          </div>
        </div>
      </div>
    </div>

    <!--KR node-->
    <div class="d-flex align-items-center justify-content-between  py-3" *ngIf="item?.okrType==krType">

      <div class="d-flex align-items-center cursor-pointer w-100">
        <div class="rounded-circle p-4px w-h-circle bg-2D3958 fw-bold text-white me-2 text-center">
          KR
        </div>
        <span class="ob-kr"> {{ item?.okrName }} </span>
        <span class="mx-2">|</span>
        <span class="me-2" *ngIf="item?.target"> {{item?.target}} </span>
        <span *ngIf="item?.umid"> {{item?.umid}} </span>
      </div>
      <div class="d-flex align-items-center justify-content-end ">
        <div class="d-flex flex-column align-items-center kr-process w-200px min-w-200px ms-3">
          <span>{{item?.progress}}%</span>
          <div class="h-7px w-100 bg-gray-200 rounded-4">
            <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
              aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
          </div>

        </div>
        <div class="d-flex ms-5">
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-vpn_key icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
              [ngClass]="item?.child  && item?.child.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.child ? item?.child.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-link icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
              [ngClass]="item?.shares  && item?.shares.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.shares ? item?.shares?.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-format_list_bulleted icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.updates  && item?.updates.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.updates ? item?.updates?.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-chat_bubble_outline icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.notes ? item?.notes?.length : 0 }}</span>
          </button>
          <!-- <codx-mfunc [formModel]="formModelKR" type="view" [dataItem]="item" class="ms-4"
                    (clickMF)="clickKRMF($event,item,false)"></codx-mfunc> -->
        </div>
      </div>
    </div>

    <!--SKR node-->
    <div class="d-flex align-items-center justify-content-between  ms-3  py-3" *ngIf="item?.okrType==skrType">
      <div class="d-flex align-items-center cursor-pointer w-100">
        <div
          class="rounded-circle p-4px w-h-circle bg-2D3958 text-white me-2 text-center fs-9 d-flex align-items-center justify-content-between ">
          SKR
        </div>
        <div class="ob-kr">
          {{ item?.okrName }}
        </div>
        <span class="mx-2">|</span>
        <span class="me-2" *ngIf="item?.target"> {{item?.target}} </span>
        <span *ngIf="item?.umid"> {{item?.umid}} </span>
      </div>
      <div class="d-flex align-items-center justify-content-end ">
        <div class="d-flex flex-column align-items-center kr-process w-200px min-w-200px ms-3">
          <span>{{item?.progress}}%</span>
          <div class="h-7px w-100 bg-gray-200 rounded-4">
            <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
              aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
          </div>

        </div>
        <div class="d-flex ms-5">
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-vpn_key icon-20 text-gray-300 text-hover-primary"></span>
            <!-- <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                      item?.kRs? item?.kRs : 0 }}</span> -->
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-link icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.shares  && item?.shares.length >0 ? 'bg-color': 'bg-gray-300'">{{
              item?.shares ? item?.shares?.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-format_list_bulleted icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.updates  && item?.updates.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.updates ? item?.updates?.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-chat_bubble_outline icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.notes ? item?.notes?.length : 0 }}</span>
          </button>

        </div>
      </div>
    </div>

  </ng-template>
</div>

<ng-template #templateTreeView let-item>
  <!--OB node-->
  <div class="d-flex align-items-center flex-column justify-content-between " *ngIf="item?.okrType==obType">

    <hr class=" w-100 my-0" *ngIf="isShowBreakLine">
    <div class="w-100 pt-3 pb-2 ob-background d-flex justify-content-between">
      <div class="d-flex align-items-center flex-row cursor-pointer w-100">
        <span class="fa-solid fa-bullseye me-3 fs-2 txt-color-0E4C55"></span>
        <span>{{ item?.okrName }}</span>
        <codx-vll *ngIf="item?.category" [showText]="true" [showBgColor]="true" [name]="'OM012'"
          [value]="item?.category" class="ms-2 badge badge-light badge-md fs-7">
        </codx-vll>
        <codx-vll *ngIf="item?.confidence" [showText]="true" [showBgColor]="true" [name]="'OM013'"
          [value]="item?.confidence" class="badge badge-light badge-md fs-7">
        </codx-vll>
      </div>
      <div class="d-flex align-items-center justify-content-end ">

        <codx-img [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
        <div class="d-flex flex-column align-items-center kr-process w-200px min-w-200px ms-3">
          <span>{{item?.progress}}%</span>
          <div class="h-7px w-100 bg-gray-200 rounded-4">
            <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
              aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
          </div>


        </div>
        <div class="d-flex ms-5 align-items-end">
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-vpn_key icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.child && item?.child.length >0 ? 'bg-color': 'bg-gray-300'">{{
              item?.child? item?.child.length :0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-link icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
              [ngClass]="item?.totalLinkOKR>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.totalLinkOKR ? item?.totalLinkOKR : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-format_list_bulleted icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.updates  && item?.updates.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.updates ? item?.updates.length : 0 }}</span>
          </button>
          <button class="btn btn-icon btn-sm position-relative ms-4">
            <span class="icon-chat_bubble_outline icon-20 text-gray-800 text-hover-primary"></span>
            <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
              [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
              item?.notes ? item?.notes.length : 0 }}</span>
          </button>
          <!-- <codx-mfunc [formModel]="formModelOB" type="view" [dataItem]="item" class="ms-4"
            (clickMF)="clickMF($event,item)"></codx-mfunc>  -->
        </div>
      </div>
    </div>

  </div>
  



  <!--KR node-->
  <div class="d-flex align-items-center  py-2 kr-background justify-content-between  " *ngIf="item?.okrType==krType">

    <div class="d-flex align-items-center cursor-pointer  w-100">
      <div class="rounded-circle p-4px w-h-circle bg-2D3958 fw-bold text-white me-2 text-center">
        KR
      </div>
      <span> {{ item?.okrName }} </span>
      <span class="mx-2">|</span>
      <span class="me-2" *ngIf="item?.target"> {{item?.target}} </span>
      <span *ngIf="item?.umid"> {{item?.umid}} </span>
    </div>
    <div class="d-flex align-items-center justify-content-end ">
      <codx-img [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
      <div class="d-flex flex-column align-items-center kr-process w-200px min-w-200px ms-3">
        <span>{{item?.progress}}%</span>
        <div class="h-7px w-100 bg-gray-200 rounded-4">
          <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
            aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

      </div>
      <div class="d-flex ms-5 align-items-end">
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-vpn_key icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
            [ngClass]="item?.child  && item?.child.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.child ? item?.child.length : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-link icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
            [ngClass]="item?.totalLinkOKR>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.totalLinkOKR ? item?.totalLinkOKR : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-format_list_bulleted icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.updates  && item?.updates.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.updates ? item?.updates?.length : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-chat_bubble_outline icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.notes ? item?.notes?.length : 0 }}</span>
        </button>
        <!-- <codx-mfunc [formModel]="formModelKR" type="view" [dataItem]="item" class="ms-4"
          (clickMF)="clickKRMF($event,item,false)" (changeDataMF)="changeDataKRMF($event,item,false)"></codx-mfunc> -->
      </div>
    </div>
  </div>

  <!--SKR node-->
  <div class="d-flex align-items-center  py-2 skr-background justify-content-between  ms-3" *ngIf="item?.okrType==skrType">
    <div class="d-flex align-items-center cursor-pointer w-100">
      <div
        class="rounded-circle p-4px w-h-circle bg-2D3958 text-white me-2 text-center fs-9 d-flex align-items-center justify-content-between ">
        SKR
      </div>
      <div>{{ item?.okrName }} </div>
      <span class="mx-2">|</span>
      <span class="me-2" *ngIf="item?.target"> {{item?.target}} </span>
      <span *ngIf="item?.umid"> {{item?.umid}} </span>
    </div>
    <div class="d-flex align-items-center justify-content-end ">
      <codx-img [objectId]="item?.owner" [objectType]="'AD_Users'"></codx-img>
      <div class="d-flex flex-column align-items-center kr-process w-200px min-w-200px ms-3">
        <span>{{item?.progress}}%</span>
        <div class="h-7px w-100 bg-gray-200 rounded-4">
          <div class="bg-color rounded-4 h-7px" role="progressbar" [style.width]="item?.progress + '%'"
            aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

      </div>
      <div class="d-flex ms-5  align-items-end">
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-vpn_key icon-20 text-gray-300 text-hover-primary"></span>

        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-link icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs  "
            [ngClass]="item?.totalLinkOKR>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.totalLinkOKR ? item?.totalLinkOKR : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-format_list_bulleted icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.updates  && item?.updates.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.updates ? item?.updates?.length : 0 }}</span>
        </button>
        <button class="btn btn-icon btn-sm position-relative ms-4">
          <span class="icon-chat_bubble_outline icon-20 text-gray-800 text-hover-primary"></span>
          <span class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs "
            [ngClass]="item?.notes  && item?.notes.length>0 ? 'bg-color': 'bg-gray-300'">{{
            item?.notes ? item?.notes?.length : 0 }}</span>
        </button>
        <!-- <codx-mfunc [formModel]="formModelSKR" type="view" [dataItem]="item" class="ms-4"
          (clickMF)="clickKRMF($event,item,true)"  (changeDataMF)="changeDataKRMF($event,item,false)"></codx-mfunc> -->
      </div>
    </div>
  </div>

</ng-template>