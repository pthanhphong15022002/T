<codx-form
    [headerText]="headerText"
    [dialog]="dialogRef"
    [bodyCss]="'bgEDEDED okr-add-body'"
    [body]="alignKR"
>
</codx-form>

<ng-template #alignKR>  
  
  <div class=" w-100 h-100 bg-white px-5">
    <div class="d-flex align-items-center justify-content-end pt-5">      
      <div class="d-flex align-items-center">
          <div class="symbol symbol-30px symbol-circle cursor-pointer me-4">
              <span class="symbol-label bg-om-gray">
                  <i class="icon-create"></i>
              </span>
          </div>
         
          <div class="symbol symbol-30px symbol-circle cursor-pointer me-4">
              <span class="symbol-label bg-om-gray">
                  <i class="icon-bar_chart"></i>
              </span>
          </div>
         
          <codx-dropdown-calendar cssPopup="h-500px w-800px" cssClass="w-100 om-calendar" class="me-4"
          ></codx-dropdown-calendar >
          
          <div class="symbol symbol-30px symbol-circle cursor-pointer">
              <span class="symbol-label bg-om-gray">
                  <i class="fas fa-ellipsis-h "></i>
              </span>
          </div>
      </div>
     
  </div>
    <div class="pt-5 pb-2 text-center">
      <codx-label
        [default]="'Tên KR'"
        fiedName="titleKR"
        class="fw-bold fs-2"
      ></codx-label>
    </div>
    <div>
      <ejs-tab id="om-tab">
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-bullseye me-2"></i>
                <codx-label
                  default="Check-in"
                  fiedName="lbltaget"
                  class="fw-bold"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content> Check-in </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-folder-tree me-2"></i>
                <codx-label
                  default="Liên kết"
                  fiedName="lbltreetaget"
                  class="fw-bold"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content> 
              <!--Filter-->
              <div class="d-flex align-items-center justify-content-end" #titleOKR>
                
                <div class="d-flex align-items-center">
                  <div ngbDropdown [container]="'body'">
                    <div ngbDropdownToggle class="d-flex align-items-center border rounded align-items-center bg-white p-2"  type="button" id="dropdownMenuButton"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                        <i class="icon-filter_alt me-2"></i>
                        <codx-label default="Lọc tình trạng" fiedName="lblFilter"></codx-label>
                        <i class="fas fa-angle-down ms-3"></i>
                    </div>
                    <div ngbDropdownMenu class="dropdown-menu p-2" aria-labelledby="dropdownMenuButton">
                        <div class="dropdown-item py-2 px-4 cursor-pointer" *ngFor="let item of dtStatus">
                          <span>{{item?.text}}</span>
                        </div>
                    </div>
                  </div>
                  <div class="ms-2 me-2" ngbDropdown [container]="'body'">
                    <div ngbDropdownToggle class="d-flex align-items-center border rounded align-items-center bg-white p-2"  type="button" id="dropdownMenuButton"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                        <i class="icon-vertical_align_center me-2"></i>
                        <codx-label default="Collapse" fiedName="lblCollapse"></codx-label>
                        <i class="fas fa-angle-down ms-3"></i>
                    </div>
                    <div ngbDropdownMenu class="dropdown-menu p-5" aria-labelledby="dropdownMenuButton">
                      Collapse
                    </div>
                  </div>
                </div>
              </div>

              <!--Content-->
              <div class="ms-5 ps-5">
                <span class="icon-i-signpost-2 text-primary "></span>
                <codx-label default="Liên kết" class="text-mute ps-2 fs-5 fw-bold" name="lblLink"></codx-label>
              </div>
              <div class="px-10">
                <div *ngFor="let data of dataOKR; let i = index">                  
                  <div class="d-flex align-items-center justify-content-between mt-5">
                      <div class="d-flex align-items-center cursor-pointer w-100" (click)='getItemOKR(i,data.recID)' data-bs-toggle="collapse"
                      [attr.data-target]="'#collapse' + i" aria-expanded="true" [attr.aria-controls]="'collapse' + i">
                        <div class="rounded-circle cursor-pointer me-3 bg-light w-20px h-18px text-center">
                          <i [class]="!this.openAccordion[i]?'icon-navigate_next' : 'fas fa-angle-down'" ></i>
                        </div>
                        <i class="fa-solid fa-bullseye me-3 fs-3 txt-color-0E4C55" ></i>
                        <span>{{ data.okrName }}</span>
                      </div>
                      <div class="d-flex align-items-center justify-content-end">
                        
                        <codx-img [objectId]="data?.createdBy" [objectType]="'AD_Users'" ></codx-img>
                        <div class="d-flex align-items-center kr-process w-200px min-w-200px ms-3">
                          <div class="h-15px w-100 bg-gray-200 rounded-4">
                            <div class="bg-primary rounded-4 h-15px" role="progressbar" [style.width]="(data.progress + '%')" aria-valuenow="50"
                            aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                          
                          <div class="process-per position-absolute top-0 fs-8" style="left:72%">{{data.progress}}%</div>
                          <div class="pic-local" style="left:77%;">
                            <span class="icon-language text-primary icon-20"></span>
                          </div>
                          <div *ngIf="data.confidence" class="pic-face" style="left:90%;">
                            <img class="w-18px h-18px" [src]="'assets/themes/wp/default/img/'+(data.confidence == '2'?'L1480_4':'L1480_3')+'.svg'" >
                          </div>
                         
                        </div>
                        <div class="d-flex ms-9">
                          <button class="btn btn-icon btn-sm position-relative ms-4">
                          <!-- <button class="btn btn-icon btn-sm position-relative ms-4" (click)="addKR(data)"> -->
                            <span class="icon-vpn_key icon-20 text-gray-600 text-hover-primary"></span>
                            <span
                              class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{data.child.length}}</span>
                          </button>
                          <button class="btn btn-icon btn-sm position-relative ms-4">
                            <span class="icon-link icon-20 text-gray-600 text-hover-primary"></span>
                            <span
                              class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{data?.shares ? data?.shares.length : 0}}</span>
                          </button>
                          <button class="btn btn-icon btn-sm position-relative ms-4">
                            <span class="icon-format_list_bulleted icon-20 text-gray-600 text-hover-primary"></span>
                            <span
                              class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{data?.notes ? data?.notes.length : 0}}</span>
                          </button>
                          <button class="btn btn-icon btn-sm position-relative ms-4">
                            <span class="icon-chat_bubble_outline icon-20 text-gray-600 text-hover-primary"></span>
                            <span
                              class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{data?.notes ? data?.notes.length : 0}}</span>
                          </button>
                         <codx-mfunc [formModel]="formModel" type="view" [dataItem]="data" class="ms-4" ></codx-mfunc>
                        </div>
                      </div>
                  </div>
                    <div class="ps-5 mt-2 cursor-pointer w-100 d-flex justify-content-end" *ngFor="let item of data?.child">
                      <div class="d-flex align-items-center justify-content-between w-95">
                        <div class="d-flex align-items-center">
                          <div class="rounded-circle p-4px w-h-circle bg-2D3958 fw-bold text-white me-1 text-center">
                            KR
                          </div>
                          <div class="ps-3">
                            {{item.okrName}}
                          </div>
                        </div>
                        
                        <div class="d-flex align-items-center justify-content-end">
                          <codx-img [objectId]="item?.createdBy" [objectType]="'AD_Users'" ></codx-img>
                          <div class="d-flex align-items-center kr-process w-200px min-w-200px ms-3">
                            <div class="h-15px w-100 bg-gray-200 rounded-4">
                              <div class="bg-primary rounded-4 h-15px" role="progressbar" [style.width]="(data.progress + '%')" aria-valuenow="50"
                              aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="process-per position-absolute top-0 fs-8" style="left:72%">{{data.progress}}%</div>
                            <div class="pic-local" style="left:77%;">
                              <span class="icon-language text-primary icon-20"></span>
                            </div>
                            <div *ngIf="data.confidence" class="pic-face" style="left:90%;">
                              <img class="w-18px h-18px" [src]="'assets/themes/wp/default/img/'+(data.confidence == '2'?'L1480_4':'L1480_3')+'.svg'" >
                            </div>
                           
                          </div>
                          <div class="d-flex ms-9">
                            
                            <button class="btn btn-icon btn-sm position-relative ms-4">
                              <span class="icon-link icon-20 text-gray-600 text-hover-primary"></span>
                              <span
                                class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{item?.shares ? item?.shares.length : 0}}</span>
                            </button>
                            <button class="btn btn-icon btn-sm position-relative ms-4">
                              <span class="icon-format_list_bulleted icon-20 text-gray-600 text-hover-primary"></span>
                              <span
                                class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{item?.notes ? item?.notes.length : 0}}</span>
                            </button>
                            <button class="btn btn-icon btn-sm position-relative ms-4">
                              <span class="icon-chat_bubble_outline icon-20 text-gray-600 text-hover-primary"></span>
                              <span
                                class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{item?.notes ? item?.notes.length : 0}}</span>
                            </button>
                            <button class="btn btn-icon btn-sm position-relative ms-4">
                              <!-- <button class="btn btn-icon btn-sm position-relative ms-4" (click)="addKR(item)"> -->
                                <span class="icon-attach_file icon-20 text-gray-600 text-hover-primary"></span>
                                <span
                                  class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs badge-primary">{{item.attachments? item?.attachments.length : 0}}</span>
                              </button>
                           <codx-mfunc [formModel]="formModel" type="view" [dataItem]="item" class="ms-4" ></codx-mfunc>
                          </div>
                        </div>
                      </div>
                      
                      
                    </div> 
                </div>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-list me-2"></i>
                <codx-label
                  default="Công việc"
                  fiedName="lbljob"
                  class="fw-bold"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content>
              Công việc
              <!-- <lib-okr-tasks></lib-okr-tasks> -->
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-regular fa-calendar me-2"></i>
                <codx-label
                  default="Họp định kỳ"
                  fiedName="lblmeeting"
                  class="fw-bold"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content> Họp định kỳ </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-regular icon-i-chat me-2"></i>
                <codx-label
                  default="Ghi chú"
                  fiedName="lblNote"
                  class="fw-bold"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content> 
              <codx-tree-history [objectID]="dataOKR[0].recID" [objectType]="'OM_OKRCompany'" [actionType]="'C'" [addNew]="true"
            [viewIcon]="false" [viewVote]="true" [funcID]="'OMT01'">

            
          </codx-tree-history>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-clock-rotate-left me-2"></i>
                <codx-label
                  default="Cập nhật"
                  fiedName="lblmeeting"
                  class="fw-bold"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content> Cập nhật </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </div>
</ng-template>
