<codx-views #view [views]="views" (viewChanged)="viewChanged($event)" [autoLoad]="false" [toolbarDisplay]="false">
</codx-views>
<ng-template #panelRight>
  <div class="w-100 h-100 bg-white rounded-2 pt-4 px-6 d-flex flex-column scroll-y">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center col-3 text-white om-switch-room cursor-pointer">
        <div class="w-100px text-center bgC5C7D0 active py-2 om-rounded-pill-left" *ngIf="funcID!=compFuncID">
          <codx-label default="Phòng của tôi" name="lblMyOrgUnit"></codx-label>
        </div>
        <div class="w-100px text-center bgC5C7D0 py-2 om-rounded-pill-right" *ngIf="funcID!=compFuncID">
          <codx-label default="Chia sẻ cho tôi" name="lblShareForMe"></codx-label>
        </div>
      </div>

      <div class="d-flex  align-items-center justify-content-center w-100">
        <div class="text-center" *ngIf="funcID==compFuncID">
          <span class="fw-bold fs-2">{{compName}}</span>
        </div>
        <div class="text-center" *ngIf="funcID == deptFuncID">
          <span class="fw-bold fs-2">{{deptName}}</span>
        </div>
        <div class="text-center" *ngIf="funcID == orgFuncID">
          <span class="fw-bold fs-2">{{orgName}}</span>
        </div>
        <div class="text-center" *ngIf="funcID == persFuncID">
          <span class="fw-bold fs-2">{{persName}}</span>
        </div>
      </div>

      <div class="d-flex align-items-center justify-content-end col-3">
        <codx-vll *ngIf="!planNull" [showText]="true" [showBgColor]="true" [name]="'OM002'"
          [ngbTooltip]="'Tình trạng bộ mục tiêu'" [value]="dataOKRPlans?.status"
          class="me-2 badge badge-light badge-md fs-7">
        </codx-vll>
        <div *ngIf="!planNull && dataOKRPlans?.status=='1'" class="symbol symbol-30px symbol-circle cursor-pointer me-2"
          (click)="addEditOKRPlans(false)" ngbTooltip="Chỉnh sửa bộ mục tiêu">
          <span class="symbol-label bg-om-gray">
            <i class="icon-create text-dark"></i>
          </span>
        </div>
        <div *ngIf="!planNull" class="symbol symbol-30px symbol-circle cursor-pointer me-2"
          (click)="hiddenChartClick(!isHiddenChart)" [ngbTooltip]="isHiddenChart? 'Hiện biểu đồ' :'Ẩn biểu đồ'">
          <span class="symbol-label " [ngClass]="isHiddenChart? 'bg-om-gray' :'bg-color'">
            <i class="icon-bar_chart " [ngClass]="isHiddenChart? 'text-dark' :'text-light'"></i>
          </span>
        </div>
        <codx-dropdown-calendar cssPopup="h-500px w-800px" [value]="date" [selectedType]="'y'" [displayOption]="ops"
          cssClass="w-100 om-calendar" class="me-2" (change)="changeCalendar($event)"></codx-dropdown-calendar>
        <div class="symbol symbol-30px symbol-circle cursor-pointer" *ngIf="formModelPlan">
          <span class="symbol-label bg-om-gray" >
            
              <codx-mfunc [formModel]="formModelPlan" (changeDataMF)="changeDataMF($event)" *ngIf="showPlanMF"
              (clickMF)="clickMF($event)"></codx-mfunc>
            
            
          </span>
        </div>
      </div>

    </div>


    <div class=" mt-2" *ngIf="isAfterRender">
      <ejs-tab id="om-tab">
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-bullseye me-2"></i>
                <codx-label default="Mục tiêu" fiedName="lbltaget" class="fw-bold"></codx-label>
              </div>
            </ng-template>
            <ng-template #content>
              
            <ng-container *ngIf="loadedData">
              <div class="h-100" *ngIf="!planNull ; else elseOKR">
                <div class="h-100" >
                  <lib-okr-targets [dataOKRPlans]="dataOKRPlans" [dataOKR]="dataOKR" [formModel]="view?.formModel"
                    [currentUser]="curUser" [okrFM]="okrFM" [okrVll]="okrVll" [okrGrv]="okrGrv"
                    [isCollapsed]="isCollapsed" [groupModel]="groupModel" [curOrgUnitID]="curOrgID" [funcID]="funcID"
                    [isHiddenChart]="isHiddenChart" [listUM]="listUM"
                    (getOKRPlanForComponent)="getOKRPlanForComponent($event)"></lib-okr-targets>


                </div>
              </div>
            </ng-container>
              
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-folder-tree me-2"></i>
                <codx-label default="Cây mục tiêu" fiedName="lbltreetaget" class="fw-bold"></codx-label>
              </div>
            </ng-template>
            <ng-template #content>
              
            <ng-container *ngIf="loadedDataTree">
              <!-- <div class="w-100 tab-okr-trees" *ngIf="orgUnitTree!=null; else orgUnitTreeNull">
                <lib-okr-trees [okrVll]="okrVll" [okrFM]="okrFM" [funcID]="funcID" [dataOKRPlans]="dataOKRPlans"
                  [orgUnitTree]="orgUnitTree" [okrGrv]="okrGrv" [currentOrgID]="curOrgID"></lib-okr-trees>
              </div> -->
              <div class="okr-treeview w-100 h-100 container "*ngIf="!planNull && orgUnitTree!=null  ;else defaultEmpty">
                <codx-treeview id="tree" #treeView [itemTemplate]="templateTreeView" [data]="orgUnitTree" [enableCheck]="false"
                idField="orgUnitID" parentIdField="parentID" [autoLoad]="false" [isOutput]="true" [isLoadChild]="true"
                >
            </codx-treeview>
            </div>
            
            </ng-container>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-list me-2"></i>
                <codx-label default="Công việc" fiedName="lbljob" class="fw-bold"></codx-label>
              </div>
            </ng-template>
            <ng-template #content>

              <ng-container *ngIf="loadedData">
                <div class="h-100" *ngIf="!planNull ; else defaultEmpty">
                  <codx-tasks-share class="tasks-share-content w-100" [funcID]="'OMT014'" [dataValue]="dataOKRPlans.recID"
                [predicate]="'SessionID==@0'" [showButtonAdd]="true" [showMoreFunc]="true"></codx-tasks-share>
                </div>
              </ng-container>
              
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-regular fa-calendar me-2"></i>
                <codx-label default="Họp định kỳ" fiedName="lblmeeting" class="fw-bold"></codx-label>
              </div>
            </ng-template>
            <ng-template #content>
              <div>
                <ng-container *ngIf="loadedData">
                  <div class="h-100" *ngIf="!planNull ; else defaultEmpty">
                    <codx-tmmeetings funcID="OMT017" [dataObj]="refIDMeeting"
                    [projectID]="dataOKRPlans?.recID"></codx-tmmeetings>
                  </div>
                </ng-container>

                
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-center">
                <i class="fa-solid fa-clock-rotate-left me-2"></i>
                <codx-label default="Cập nhật" fiedName="lblmeeting" class="fw-bold"></codx-label>
              </div>
            </ng-template>
            <ng-template #content>
              <ng-container *ngIf="loadedData">
                <div class="h-100" *ngIf="!planNull ; else defaultEmpty">
                  <div class="h-100  d-block mt-5">
                    <div class="mw-1000px mx-auto">
                      <codx-history [objectID]="dataOKRPlans?.recID" [formModel]="formModelPlan"
                        [funcID]="funcID"></codx-history>
                    </div>
                  </div>
                </div>
              </ng-container>
              

            </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </div>
</ng-template>

<ng-template #elseOKR>
  <div class="w-100 py-10  text-center d-flex flex-row justify-content-center align-item-center">
    <div class="col-2"></div>
    <div
      class=" col-7 pb-10 bg-primary-lighter my-5 text-center d-flex flex-column justify-content-center align-item-center  border border-2 border-primary">

      <span inlineSVG="./assets/themes/om/default/img/OKRs.svg"></span>
      <span *ngIf="funcID==compFuncID" [innerHTML]="compPlanNull"></span>
      <span *ngIf="funcID==deptFuncID" [innerHTML]="deptPlanNull"></span>
      <span *ngIf="funcID==orgFuncID" [innerHTML]="orgPlanNull"></span>
      <span *ngIf="funcID==persFuncID" [innerHTML]="persPlanNull"></span>
      <div class="d-flex justify-content-center">
        <span type="button" (click)="click({ id: 'btnAddPlan' })"
          class="w-110px d-flex mt-3 py-2 px-4 bg-color rounded justify-content-center align-items-center">
          <span class="fa-solid fa-bullseye btn-text-primary text-light me-1"></span>
          <codx-label class="text-light" fiedName="lbl" default="Tạo bộ mục tiêu"></codx-label>
        </span>
      </div>

    </div>
    <div class="col-2"></div>
  </div>
</ng-template>

<ng-template #templateTreeView let-item>
  <div (click)="clickTreeNode($event)" class="mb-2">
      <div class="d-flex flex-row align-items-center h-50px" >
          <div *ngIf="item?.orgUnitType=='1'" class="d-flex justify-content-center align-items-center rounded-1" style="height:30px;width:30px;background:#3699FF">
              <span class="icon-home justify-content-center align-items-center text-light"></span>
          </div>       
          <div *ngIf="item?.orgUnitType=='4'" class="d-flex justify-content-center align-items-center rounded-circle" style="height:30px;width:30px;background:#ff3636">            
              <span class="icon-account_balance_wallet justify-content-center align-items-center text-light"></span>
          </div>  
          <div *ngIf="item?.orgUnitType=='6'" class="d-flex justify-content-center align-items-center rounded-circle" style="height:30px;width:30px;background:#3699FF">            
              <span class="icon-groups justify-content-center align-items-center text-light"></span>
          </div>   
          <span class="ps-3 fs-4 fw-bold">{{item?.orgUnitName}}</span>
      </div>
      <!--Content-->
      <div class="me-2" *ngIf="item?.listOKR !=null && item?.listOKR.length>0">
  
        <view-okr [okrVll]="okrVll" [okrFM]="okrFM" [okrGrv]="okrGrv" [dataOKR]="item?.listOKR" [isCollapsedAll]="false" [allowShowDetail]="true">
        </view-okr>
      </div>
  </div>    
</ng-template>

<ng-template #defaultEmpty>
  <div class="container h-100 ">
    <div class="list-empty card card-flush h-100">
      <div class="d-flex flex-column flex-center justify-content-center  pt-10">
        <img src="../assets/themes/sys/default/img/DataEmpty.svg" class="w-200px" />
        <div class="fw-bold mt-1 text-center">
          {{ "SYS011" | mssg | async }}
        </div>
      </div>
    </div>
  </div>
</ng-template>