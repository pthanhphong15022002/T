<codx-treeview id="tree" #treeView [itemTemplate]="templateTreeView" [data]="orgUnitTree" [enableCheck]="false"
    idField="orgUnitID" parentIdField="parentID" [autoLoad]="false" [isOutput]="true" [isLoadChild]="true"
    (selectionChange)="selectionChange($event)" *ngIf="isAfterRender">
</codx-treeview>
<ng-template #templateTreeView let-item>
    <div class="d-flex flex-row  align-items-center">
        <div class="d-flex justify-content-center align-items-center" style="height:30px;width:30px;background:#3699FF">
            <span class="icon-home justify-content-center align-items-center text-light"></span>
        </div>        
        <span class="ps-2 fs-5 fw-bolder">{{item?.orgUnitName}}</span>
    </div>
    <!--Content-->
    
      <div *ngIf="item?.listOKR" class="px-10">
        <div *ngFor="let data of item.listOKR; let i = index">
          <div class="d-flex align-items-center justify-content-between mt-5">
            <div class="d-flex align-items-center cursor-pointer w-100" (click)="getItemOKRAlign(i, data.recID)"
              data-bs-toggle="collapse" [attr.data-target]="'#collapse' + i" aria-expanded="true"
              [attr.aria-controls]="'collapse' + i">
              <div class="rounded-circle cursor-pointer me-3 bg-light w-20px h-18px text-center">
                <i [class]="
                    !this.openAccordionAlign[i]
                      ? 'icon-navigate_next'
                      : 'fas fa-angle-down'
                  "></i>
              </div>
              <i class="fa-solid fa-bullseye me-3 fs-3 txt-color-0E4C55"></i>
              <span>{{ data.okrName }}</span>
            </div>
            <div class="d-flex align-items-center justify-content-end">
              <codx-img [objectId]="data?.createdBy" [objectType]="'AD_Users'"></codx-img>
              <div class="d-flex align-items-center kr-process w-200px min-w-200px ms-3">
                <div class="h-15px w-100 bg-gray-200 rounded-4">
                  <div class="bg-color rounded-4 h-15px" role="progressbar"
                    [style.width]="data.progress + '%'" aria-valuenow="50" aria-valuemin="0"
                    aria-valuemax="100"></div>
                </div>

                <div class="process-per position-absolute top-0 fs-8" style="left: 72%">
                  {{ data.progress }}%
                </div>
                <div class="pic-local" style="left: 77%">
                  <span class="icon-language text-primary icon-20"></span>
                </div>
                <div *ngIf="data.confidence" class="pic-face" style="left: 90%">
                  <img class="w-18px h-18px" [src]="
                      'assets/themes/wp/default/img/' +
                      (data.confidence == '2'
                        ? 'L1480_4'
                        : 'L1480_3') +
                      '.svg'
                    " />
                </div>
              </div>
              <div class="d-flex ms-9">
                <button class="btn btn-icon btn-sm position-relative ms-4">
                  <!-- <button class="btn btn-icon btn-sm position-relative ms-4" (click)="addKR(data)"> -->
                  <span class="icon-vpn_key icon-20 text-gray-600 text-hover-primary"></span>
                  <span
                    class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                    data?.child ? data?.child.length : 0
                    }}</span>
                </button>
                <button class="btn btn-icon btn-sm position-relative ms-4">
                  <span class="icon-link icon-20 text-gray-600 text-hover-primary"></span>
                  <span
                    class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                    data?.shares ? data?.shares.length : 0
                    }}</span>
                </button>
                <button class="btn btn-icon btn-sm position-relative ms-4">
                  <span class="icon-format_list_bulleted icon-20 text-gray-600 text-hover-primary"></span>
                  <span
                    class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                    data?.notes ? data?.notes.length : 0
                    }}</span>
                </button>
                <button class="btn btn-icon btn-sm position-relative ms-4">
                  <span class="icon-chat_bubble_outline icon-20 text-gray-600 text-hover-primary"></span>
                  <span
                    class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                    data?.notes ? data?.notes.length : 0
                    }}</span>
                </button>
                <codx-mfunc  type="view" [dataItem]="data" class="ms-4"></codx-mfunc> 
              </div>
            </div>
          </div>
          <div [attr.id]="'collapse' + i" class="accordion-collapse w-100 collapse"
            [class.show]="openAccordionAlign[i]" [attr.aria-labelledby]="'heading' + i"
            data-bs-parent="#accordionExample" >
            <div class="ps-5 mt-2 cursor-pointer w-100"
              *ngFor="let item of data?.child">
              <!--show KR-->
              <div class="d-flex align-items-center justify-content-between w-95">
                <div class="d-flex align-items-center">
                  <div
                    class="rounded-circle p-4px w-h-circle bg-2D3958 fw-bold text-white me-1 text-center">
                    KR
                  </div>
                  <div class="ps-3">
                    {{ item.okrName }}
                  </div>
                </div>
                <div class="d-flex align-items-center justify-content-end">
                  <codx-img [objectId]="item?.createdBy" [objectType]="'AD_Users'"></codx-img>
                  <div class="d-flex align-items-center kr-process w-200px min-w-200px ms-3">
                    <div class="h-15px w-100 bg-gray-200 rounded-4">
                      <div class="bg-color rounded-4 h-15px" role="progressbar"
                        [style.width]="item.progress + '%'" aria-valuenow="50" aria-valuemin="0"
                        aria-valuemax="100"></div>
                    </div>
                    <div class="process-per position-absolute top-0 fs-8" style="left: 72%">
                      {{ item.progress }}%
                    </div>
                    <div class="pic-local" style="left: 77%">
                      <span class="icon-language text-primary icon-20"></span>
                    </div>
                    <div *ngIf="item.confidence" class="pic-face" style="left: 90%">
                      <img class="w-18px h-18px" [src]="
                          'assets/themes/wp/default/img/' +
                          (item.confidence == '2'
                            ? 'L1480_4'
                            : 'L1480_3') +
                          '.svg'
                        " />
                    </div>
                  </div>
                  <div class="d-flex ms-9">
                    <button class="btn btn-icon btn-sm position-relative ms-4">
                      <span class="icon-link icon-20 text-gray-600 text-hover-primary"></span>
                      <span
                        class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                        item?.shares ? item?.shares.length : 0
                        }}</span>
                    </button>
                    <button class="btn btn-icon btn-sm position-relative ms-4">
                      <span
                        class="icon-format_list_bulleted icon-20 text-gray-600 text-hover-primary"></span>
                      <span
                        class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                        item?.notes ? item?.notes.length : 0
                        }}</span>
                    </button>
                    <button class="btn btn-icon btn-sm position-relative ms-4">
                      <span
                        class="icon-chat_bubble_outline icon-20 text-gray-600 text-hover-primary"></span>
                      <span
                        class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                        item?.notes ? item?.notes.length : 0
                        }}</span>
                    </button>
                    <button class="btn btn-icon btn-sm position-relative ms-4">
                      <!-- <button class="btn btn-icon btn-sm position-relative ms-4" (click)="addKR(item)"> -->
                      <span class="icon-attach_file icon-20 text-gray-600 text-hover-primary"></span>
                      <span
                        class="position-absolute top-0 start-100 translate-middle badge badge-circle badge-xs bg-color">{{
                        item.attachments
                        ? item?.attachments.length
                        : 0
                        }}</span>
                    </button>
                     <codx-mfunc  type="view" [dataItem]="item"
                      class="ms-4"></codx-mfunc> 
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--Content-->
</ng-template>