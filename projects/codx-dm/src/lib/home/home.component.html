<codx-views id="dm" #view [autoLoad]="true" [entityName]="'DM_FolderInfo'" [method]="'GetFoldersAsync'"
  [className]="'FolderBussiness'" [assemblyName]="'DM'" idField="recID" [views]="views" [orgView]="orgViews"
  [autoSort]="false" [autoSearch]="false" [selectedFirst]="false" (selectedChange)="onSelectionChanged($event)"
  [button]="button" (buttonClick)="addFile($event)" (viewChanged)="changeView($event)"
  (viewChanging)="viewChanging($event)" (filterChange)="filterChange($event)"  [autoFilter]="false"
  (onLoading)="onLoading($event)" (sortChanged)="sortChanged($event)" (requestEnded)="requestEnded($event)" (searchChanged)="searchChange($event)" >
</codx-views>
<ng-template #templateMain let-data>
  <div *ngIf="dmSV.checkUserForder(data); then noContext; else context"></div>
  <ng-template #noContext>
    <div oncontextmenu="return false;" class="d-flex align-items-center px-3 py-1" #item>
      <div class="node" [innerHTML]="dmSV.setFullHtmlNode(data, data.folderName)"></div>
    </div>
  </ng-template>

  <ng-template #context>
    <div appDragDropFileFolder [dataDrapDrop]="data" (fileFolderDropped)="fileFolderDropped($event)"
      class="d-flex align-items-center px-3 py-1 home">
      <div [attr.id]="data.recID" class="leaf d-flex align-items-center" [innerHTML]="dmSV.setFullHtmlNode(data, '')">
      </div>
      <codx-temp-full class="float-start" imgCss="me-3 cursor-pointer" (clickMF)="dmSV.clickMF($event, data , codxview)"
        (changeDataMF)="dmSV.filterMoreFunction($event, data)" [title]="data.folderName" [formModel]="view.formModel"
        [typeMF]="'hover'">
      </codx-temp-full>
    </div>
  </ng-template>
</ng-template>


<!-- view-list -->
<ng-template #templateRight>
 
  <div *ngIf="isSearch">
  </div>
  <div (scroll)="onScroll($event)" appDragDropFileUpload (fileDropped)="fileUploadDropped($event)"
    class="w-100 scroll-y home rounded-2" data-kt-scroll="true" data-kt-scroll-activate="{default: true}"
    data-kt-scroll-height="auto" data-kt-scroll-wrappers=".wrapper, .dm-wrapper, .dms-card-rowS"
    data-kt-scroll-offset="0">
    <ng-container *ngTemplateOutlet="empty"></ng-container>
    <ng-container *ngTemplateOutlet="currView"></ng-container>
    <ng-container *ngTemplateOutlet="nodata"></ng-container>
  </div>
</ng-template>
<ng-template #templateSearch>
  <div *ngFor="let file of data" class="result-group result-group-dm has-action-menu">
    <div class="d-flex align-items-start justify-content-between result-item border-bottom p-5">
      <div class="d-flex flex-column">
        <div class="d-flex align-items-center">
          <codx-temp-full (dblclick)="dbView(file)" appDragDropFileFolder [dataDrapDrop]="file" (fileFolderDropped)="fileFolderDropped($event)"
            [class]="classFile(file, 'float-start')" [imageWidth]="20" [imageSrc]="dmSV.getImage(file)"
            imgCss="w-20px me-3 cursor-pointer" [title]="
              file.folderName != undefined ? file.folderName : file.fileName
            " cardCss="w-250px" [typeMF]="'hover'"
            [baseHeaderRightTmp]="rightSecurity"
          >
          </codx-temp-full>
          <ng-template #rightSecurity>
            <span *ngIf="dmSV.checkView(file?.read) == false" class="icon-security text-primary icon-18"></span>
          </ng-template>
        </div>
        <div class="d-flex align-items-center text-primary font-size-md mt-1">
          <span>{{ file.filePath }}</span>
        </div>
        <div class="text-dark-50 font-size-md mt-1">
          <div class="text-dark" [innerHtml]="file.highlight"></div>
        </div>
        <div class="d-flex align-items-center font-size-md mt-1">
          <div class="d-flex text-dark-75">
            <span class="icon-query_builder icon-16"></span>&nbsp;
            <span class="ml-2">{{ file.createdOn | date: "dd/MM/yyyy" }}</span>
          </div>
          &nbsp;&nbsp;&nbsp;
          <div class="d-flex text-dark-75">
            {{ this.dmSV.getViews(file.history) }}&nbsp;
            <codx-label fiedName="" formName="" gridViewName="" default="lượt xem">
            </codx-label>
          </div>
          &nbsp;&nbsp;
          <!-- <div class="icon-star icon-9 mx-3"></div> -->
          <!-- <codx-label fiedName="" formName="" gridViewName="" default="đánh giá">&nbsp;
                </codx-label> -->
          <div class="rating-group">
            <div class="d-flex">
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
            </div>
            <div [style.width]="this.dmSV.getRating(file.views)" class="d-flex rating-percent">
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="action-menu-item ml-2">
        <codx-mfunc [formModel]="view.formModel" (clickMF)="dmSV.clickMF($event, file)" (changeDataMF)="dmSV.filterMoreFunction($event, file)" [type]="'hover'"></codx-mfunc>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateCard>
    <div class="d-flex flex-wrap dms-card p-5">
      <ng-container  *ngFor="let item of data ; trackBy: trackItem">
        <card appDragDropFileFolder [dataDrapDrop]="item" (fileFolderDropped)="fileFolderDropped($event)"
          [class]="classFile(item, 'pe-6 pb-6')" (viewFile)="viewFile($event)" [data]="item"
          [formModel]="view.formModel" [view]="codxview">
        </card>
      </ng-container>
    </div>
</ng-template>
<ng-template #templateSmallCard>
  <div class="d-flex flex-wrap dms-card-sm p-5">
    <ng-container *ngFor="let item of data">
      <codx-temp-full (dblclick)="dbView(item)" appDragDropFileFolder [dataDrapDrop]="item"
        (fileFolderDropped)="fileFolderDropped($event)"  [class]="classFile(item, 'float-start')"
        [imageSrc]="dmSV.getImage(item)" (clickMF)="dmSV.clickMF($event, item)" imgCss="card-item img-folder me-3"
        [title]="item.folderName != undefined ? item.folderName : item.fileName"
        (changeDataMF)="dmSV.filterMoreFunction($event, item)" [formModel]="view.formModel" [typeMF]="'hover'"
        [bookmark]="dmSV.showBookmark(item)" subTitle="{{ item.createdOn | date: 'dd/MM/yyyy' }} | {{ item.userName }}"
        cardCss="card-item card-template w-300px sm-card rounded-1 p-3 mb-3 me-3"
        [baseHeaderRightTmp]="rightSecurity"
      >
      </codx-temp-full>
      <ng-template #rightSecurity>
        <span *ngIf="dmSV.checkView(item.read) == false" class="icon-security text-primary icon-18"></span>
      </ng-template>
    </ng-container>
    
  </div>
</ng-template>
<ng-template #templateList>
  <ng-container *ngIf="data && data.length > 0">
    <div class="dms-listview h-100 p-2">
      <table class="table tb-dm">
        <thead class="border-top">
          <tr>
            <th scope="col" class="w-30">
              <div class="fw-bold text-dark">{{ titleFileName }}</div>
            </th>
            <th scope="col" class="w-20">
              <div class="fw-bold text-dark">{{ titleCreatedBy }}</div>
            </th>
            <th scope="col" class="w-10">
              <div class="fw-bold text-dark">{{ titleCreatedOn }}</div>
            </th>
            <th scope="col" class="w-10">
              <div class="fw-bold text-dark">{{ titleLength }}</div>
            </th>
            <th scope="col">
              <div class="fw-bold text-dark">{{ titleDisc }}</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr (dblclick)="dbView(item)" class="border-top dms-list" *ngFor="let item of data" [title]="
              item.folderName != undefined ? item.folderName : item.fileName
            ">
            <td class="w-30">
              <codx-temp-full appDragDropFileFolder [dataDrapDrop]="item"
                (fileFolderDropped)="fileFolderDropped($event)" [class]="classFile(item, 'float-start')"
                [imageWidth]="20" [imageSrc]="dmSV.getImage(item)" imgCss="w-20px me-3 cursor-pointer" [title]="
                  item.folderName != undefined ? item.folderName : item.fileName
                " cardCss="w-250px" titleCss="dms-title pe-6" [baseHeaderRightTmp]="rightSecurity">
              </codx-temp-full>
              <ng-template #rightSecurity>
                <span *ngIf="dmSV.checkView(item.read) == false" class="icon-security text-primary icon-18"></span>
              </ng-template>
            </td>
            <td class="w-20">
              <codx-temp-full [imageId]="item.createdBy" imageObjType="AD_Users" imgCss="me-3 cursor-pointer"
                [imageWidth]="25" [subTitle]="item.userName">
              </codx-temp-full>
            </td>
            <td class="w-10">
              <div class="erm-date">
                {{ item.createdOn | date: "dd/MM/yyyy" }}
              </div>
            </td>
            <td class="w-10">
              <codx-temp-full class="float-start" imgCss="me-3" (clickMF)="dmSV.clickMF($event, item)"
                [formModel]="view.formModel" [typeMF]="'hover'" [title]="dmSV.getSizeKB(item)"
                (changeDataMF)="dmSV.filterMoreFunction($event, item)" cardCss="d-flex justify-content-end">
              </codx-temp-full>
            </td>
            <td>

              <span>{{item.description}}</span><!-- item.revisionNote -->
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>
</ng-template>
<ng-template #empty>
  <ng-container *ngIf="data && data[0] != null && data[0].isDelete">
    <div class="nondata-container w-100 mb-2">
      <div class="d-flex justify-content-between page-heading align-items-center p-2">
        <div class="fw-bold ms-2">{{ dmSV.titleEmptyTrash30 }}</div>
        <div class="cursor-pointer">
          <span class="badge badge-light-primary fw-bold me-auto px-4 py-3" (click)="this.dmSV.emptyTrash()">{{ dmSV.titleEmptyAction }}</span>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
<ng-template #nodata>
  <ng-container *ngIf="
      (data === undefined || !data || data.length <= 0)
    ">
    <div class="container h-100">
      <div class="list-empty card card-flush h-100">
        <div class="d-flex flex-column flex-center justify-content-center">
          <img src="../assets/themes/sys/default/img/DataEmpty.svg" class="w-200px" />
          <div class="fw-bold mt-1 text-center">
            {{ "SYS011" | mssg | async }}
          </div>
          <!-- <div class="mt-2 text-center">Chưa có dữ liệu phát sinh.</div> -->
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
<codx-attachment #attachment hideFolder="1" hideUploadBtn="1" hideDes="0" type="inline" hideImageUpload="1"
  hideImageThumb="1" allowMultiFile="1" idBrowse="btn2" [formModel]="view.formModel" displayThumb="simple">
</codx-attachment>
<ng-container *ngIf="visible">
  <lib-dialogthumb [dataFile]="dataFile" (dialogClosed)="dialogClosed()"></lib-dialogthumb>
</ng-container>
