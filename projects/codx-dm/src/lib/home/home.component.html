<codx-views id="dm" #view [autoLoad]="true" [entityName]="'DM_FolderInfo'" [method]="'GetFoldersAsync'"
  [className]="'FolderBussiness'" [assemblyName]="'DM'" idField="recID" [views]="views" [orgView]="orgViews"
  (sortChanged)="sortChanged($event)" [autoSort]="false" [autoSearch]="false" [selectedFirst]="false"
  (selectedChange)="onSelectionChanged($event)" [button]="button" (buttonClick)="addFile($event)"
  (viewChanged)="changeView($event)" (viewChanging)="viewChanging($event)" (filterChange)="filterChange($event)"
  [autoFilter]="false" (onLoading)="onLoading($event)" (requestEnded)="requestEnded($event)"
  (searchChanged)="searchChange($event)"></codx-views>
<ng-template #templateMain let-data>
  <div *ngIf="dmSV.checkUserForder(data); then noContext; else context"></div>
  <ng-template #noContext>
    <div oncontextmenu="return false;" class="d-flex align-items-center px-3 py-1" #item>
      <div class="node" [innerHTML]="dmSV.setFullHtmlNode(data, data.folderName)"></div>
    </div>
  </ng-template>

  <!--
    <div class="card-body p-0" (scroll)="onScroll($event)">
  -->
  <ng-template #context>
    <div appDragDropFileFolder [dataDrapDrop]="data" (fileFolderDropped)="fileFolderDropped($event)"
      class="d-flex align-items-center px-3 py-1 home">
      <div [attr.id]="data.recID" class="leaf d-flex align-items-center" [innerHTML]="dmSV.setFullHtmlNode(data, '')">
      </div>
      <codx-temp-full class="float-start" imgCss="me-3 cursor-pointer" (clickMF)="dmSV.clickMF($event, data)"
        (changeDataMF)="dmSV.filterMoreFunction($event, data)" [title]="data.folderName" [formModel]="view.formModel"
        [typeMF]="'hover'">
      </codx-temp-full>
    </div>
  </ng-template>
</ng-template>

<ng-template #templateRight>
  <!-- <button class="btn btn-outline-primary btn-pill btn-lg" id="kt_demo_panel_toggle" (click)="openFile1()">
    <i class="icon-add"></i>
    <span class="font-size-lg">Open File</span>
  </button>
  <button class="btn btn-outline-primary btn-pill btn-lg" id="kt_demo_panel_toggle" (click)="saveFile1()">
    <i class="icon-add"></i>
    <span class="font-size-lg">save Files</span>
  </button>  -->
  <!-- <codx-attachment
      #attachment1
      [objectType]="'OD_Dispatches'"
      [objectId]="'965e692f-8230-4ad1-b1be-ee68ce010b6f'"
      hideFolder="1"
      hideUploadBtn="0"
      hideDes="0"
      type="inline"
      hideImageUpload="0"
      allowExtensions=".jpg,.png"
      allowMultiFile="1"
      idBrowse="btn1"

      [formModel]="view.formModel"
      [functionID]="'ODT3'"
      (fileAdded)="fileAdded($event)"
      (fileCount)="getfileCount($event)"
      displayThumb="simple"
    >
  </codx-attachment> -->
  <!-- <button class="btn btn-outline-primary btn-pill btn-lg" id="kt_demo_panel_toggle" (click)="openFile2()">
    <i class="icon-add"></i>
    <span class="font-size-lg">Open File</span>
  </button>
  <button class="btn btn-outline-primary btn-pill btn-lg" id="kt_demo_panel_toggle" (click)="saveFile2()">
    <i class="icon-add"></i>
    <span class="font-size-lg">save Files</span>
  </button>
  <codx-attachment
      #attachment2
      [objectType]="'OD_Dispatches'"
      [objectId]="'965e692f-8230-4ad1-b1be-ee68ce010b6f'"
      hideFolder="1"
      hideUploadBtn="0"
      hideDes="0"
      type="inline"
      hideImageUpload="0"
      allowExtensions=".jpg,.png"
      allowMultiFile="1"
      idBrowse="btn2"

      [formModel]="view.formModel"
      [functionID]="'ODT3'"
      (fileAdded)="fileAdded($event)"
      (fileCount)="getfileCount($event)"
      displayThumb="simple"
    >
  </codx-attachment> -->
  <ng-container *ngTemplateOutlet="empty"></ng-container>
  <div *ngIf="isSearch && this.dmSV.loadedFile">
    <h5 class="text-warning">
      <codx-label name="lblSearch1" [formModel]="view.formModel" default="Kết quả tìm kiếm:" class="fw-bold">
      </codx-label>
      {{ this.textSearch }}
      <div class="result-header font-size-h4 text-dark mb-6">
        <codx-label name="lblSearch2" [formModel]="views" default="Khoảng" class="fw-bold"></codx-label>
        {{ this.totalSearch }}
        <codx-label name="lblSearch3" [formModel]="views" default="kết quả được tìm thấy" class="fw-bold"></codx-label>
      </div>
    </h5>
  </div>
  <div (scroll)="onScroll($event)" appDragDropFileUpload (fileDropped)="fileUploadDropped($event)"
    class="w-100 scroll-y home" data-kt-scroll="true" data-kt-scroll-activate="{default: true}"
    data-kt-scroll-height="auto" data-kt-scroll-wrappers=".wrapper, .dm-wrapper, .dms-card-rowS"
    data-kt-scroll-offset="0">
    <ng-container *ngTemplateOutlet="currView"></ng-container>
    <ng-container *ngTemplateOutlet="nodata"></ng-container>
    <ng-container *ngTemplateOutlet="loading"></ng-container>
  </div>
</ng-template>
<ng-template #templateSearch>
  <div *ngFor="let file of data" class="result-group">
    <div class="d-flex align-items-start justify-content-between result-item border-bottom pb-5 mb-5">
      <div class="d-flex flex-column">
        <div class="d-flex align-items-center">
          <codx-temp-full appDragDropFileFolder [dataDrapDrop]="file" (fileFolderDropped)="fileFolderDropped($event)"
            [class]="classFile(file, 'float-start')" [imageWidth]="20" [imageSrc]="dmSV.getImage(file)"
            imgCss="w-20px me-3 cursor-pointer" [title]="
              file.folderName != undefined ? file.folderName : file.fileName
            " cardCss="w-250px" [typeMF]="'hover'">
          </codx-temp-full>
        </div>
        <div class="d-flex align-items-center text-primary font-size-md mt-1">
          <span>{{ file.filePath }}</span>
        </div>
        <div class="text-dark-50 font-size-md mt-1">
          <div class="text-dark" [innerHtml]="file.highlight"></div>
        </div>
        <div class="d-flex align-items-center font-size-md mt-1">
          <div class="d-flex text-dark-75">
            <span class="icon-query_builder icon-16"></span>&nbsp;
            <span class="ml-2">{{ file.createdOn | date: "dd/MM/yyyy" }}</span>
          </div>
          &nbsp;&nbsp;&nbsp;
          <div class="d-flex text-dark-75">
            {{ this.dmSV.getViews(file.history) }}&nbsp;
            <codx-label fiedName="" formName="" gridViewName="" default="lượt xem">
            </codx-label>
          </div>
          &nbsp;&nbsp;
          <!-- <div class="icon-star icon-9 mx-3"></div> -->
          <!-- <codx-label fiedName="" formName="" gridViewName="" default="đánh giá">&nbsp;
                </codx-label> -->
          <div class="rating-group">
            <div class="d-flex">
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
              <span class="icon-star text-muted icon-16 mr-1"></span>
            </div>
            <div [style.width]="this.dmSV.getRating(file.views)" class="d-flex rating-percent">
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
              <span class="icon-star text-warning icon-16 mr-1"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="dropdown ml-2">
        <codx-temp-full class="float-start" imgCss="me-3" (clickMF)="dmSV.clickMF($event, file)"
          [formModel]="view.formModel" [typeMF]="'hover'" [title]=""
          (changeDataMF)="dmSV.filterMoreFunction($event, file)" cardCss="w-150px">
        </codx-temp-full>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateCard>
  <div class="d-flex flex-wrap dms-card p-5">
    <card appDragDropFileFolder [dataDrapDrop]="item" (fileFolderDropped)="fileFolderDropped($event)"
      *ngFor="let item of data" [class]="classFile(item, 'pe-6 pb-6')" [data]="item" [formModel]="view.formModel">
    </card>
  </div>
</ng-template>
<ng-template #templateSmallCard>
  <div class="d-flex flex-wrap dms-card-sm p-5">
    <codx-temp-full appDragDropFileFolder [dataDrapDrop]="item" (fileFolderDropped)="fileFolderDropped($event)"
      *ngFor="let item of data" [class]="classFile(item, 'float-start')" [imageSrc]="dmSV.getImage(item)"
      imgCss="card-item img-folder me-3" (clickMF)="dmSV.clickMF($event, item)"
      [title]="item.folderName != undefined ? item.folderName : item.fileName"
      (changeDataMF)="dmSV.filterMoreFunction($event, item)" [formModel]="view.formModel" [typeMF]="'hover'"
      [bookmark]="dmSV.showBookmark(item)" subTitle="{{ item.createdOn | date: 'dd/MM/yyyy' }} | {{ item.userName }}"
      cardCss="card-item card-template w-300px sm-card rounded-1 p-3 mb-3 me-3">
    </codx-temp-full>
  </div>
</ng-template>
<ng-template #templateList>
  <ng-container *ngIf="data && data.length > 0">
    <div class="dms-listview p-2">
      <table class="table">
        <thead class="border-top">
          <tr>
            <th class="px-0" scope="col"></th>
            <th scope="col">
              <div class="fw-bold text-dark">{{ titleFileName }}</div>
            </th>
            <th scope="col">
              <div class="fw-bold text-dark">{{ titleCreatedBy }}</div>
            </th>
            <th scope="col">
              <div class="fw-bold text-dark">{{ titleCreatedOn }}</div>
            </th>
            <th scope="col">
              <div class="fw-bold text-dark">{{ titleLength }}</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-top dms-list" *ngFor="let item of data" [title]="
              item.folderName != undefined ? item.folderName : item.fileName
            ">
            <td class="w-25px text-center px-0">
              <span [className]="dmSV.getBookmarksClass(item)"></span>
            </td>
            <td>
              <codx-temp-full appDragDropFileFolder [dataDrapDrop]="item"
                (fileFolderDropped)="fileFolderDropped($event)" [class]="classFile(item, 'float-start')"
                [imageWidth]="20" [imageSrc]="dmSV.getImage(item)" imgCss="w-20px me-3 cursor-pointer" [title]="
                  item.folderName != undefined ? item.folderName : item.fileName
                " cardCss="w-250px" titleCss="dms-title">
              </codx-temp-full>
            </td>
            <td>
              <codx-temp-full [imageId]="item.createdBy" imageObjType="AD_Users" imgCss="me-3 cursor-pointer"
                [imageWidth]="25" [subTitle]="item.userName">
              </codx-temp-full>
            </td>
            <td>
              <div class="d-flex align-items-center">
                <div class="erm-date">
                  {{ item.createdOn | date: "dd/MM/yyyy" }}
                </div>
              </div>
            </td>
            <td>
              <codx-temp-full class="float-start" imgCss="me-3" (clickMF)="dmSV.clickMF($event, item)"
                [formModel]="view.formModel" [typeMF]="'hover'" [title]="dmSV.getSizeKB(item)"
                (changeDataMF)="dmSV.filterMoreFunction($event, item)" cardCss="w-150px">
              </codx-temp-full>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>
</ng-template>
<ng-template #empty>
  <ng-container *ngIf="data && data[0] != null && data[0].isDelete">
    <div class="nondata-container w-100 mb-2">
      <div class="d-flex justify-content-between page-heading align-items-center">
        <div>{{ dmSV.titleEmptyTrash30 }}</div>
        <button (click)="this.dmSV.emptyTrash()" class="btn btn-sm btn-secondary">
          {{ dmSV.titleEmptyAction }}
        </button>
      </div>
    </div>
  </ng-container>
</ng-template>
<ng-template #nodata>
  <ng-container *ngIf="
      this.dmSV.loadedFile &&
      this.dmSV.loadedFolder &&
      (data === undefined || !data || data.length <= 0)
    ">
    <div class="w-100 align-items-center mt-20">
      <div class="text-center">
        <img class="mh-200px" src="../../../assets/codx/dms/data-empty.png" />
      </div>
      <div class="text-center">
        <h5 class="text-dark mt-6">{{ dmSV.titleNodaTa }}</h5>
        <div class="mt-3">{{ dmSV.titleNodaTaFolder }}</div>
      </div>
    </div>
  </ng-container>
</ng-template>
<ng-template #loading>
  <ng-container *ngIf="!this.dmSV.loadedFile && !this.dmSV.loadedFolder">
    <div class="w-100 align-items-center mt-20">
      <div class="text-center">
        <img class="mh-200px" src="../../../assets/img/loader.gif" />
      </div>
    </div>
  </ng-container>
</ng-template>
<codx-attachment #attachment hideFolder="1" hideUploadBtn="1" hideDes="0" type="inline" hideImageUpload="1"
  hideImageThumb="1" allowMultiFile="1" idBrowse="btn2" [formModel]="view.formModel" displayThumb="simple">
</codx-attachment>