<div class="d-flex flex-row flex-column-fluid page page-detail">
    <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
        <div id="erm_content" class="d-flex flex-column-fluid setting2">
            <div class="container">
                <div class="d-flex">
                    <div class="aside-detail flex-row-auto w-300px">
                        <div class="aside-menu mr-6 mt-5">
                            <ul class="menu-nav">
                                <li class="menu-item" (click)="redirectPage('notificationFedback')">
                                    <a class="menu-link d-flex align-items-center">
                                        <i class="icon-near_me icon-20 mr-2"></i>
                                        <codx-label fiedName="FeedbackMessage"  default='Thông điệp phản hồi'>
                                    </codx-label>
                                    </a>
                                </li>
                                <li class="menu-item" (click)="redirectPage('itemCategory')">
                                    <a class="menu-link d-flex align-items-center">
                                        <i class="icon-format_list_bulleted icon-20 mr-2"></i>
                                        <codx-label fiedName="Category" [formModel]=""
                                        default='Danh mục'>
                                    </codx-label>
                                    </a>
                                </li>
                                <li class="menu-item menu-item-active">
                                    <a class="menu-link d-flex align-items-center">
                                        <i class="icon-account_balance_wallet icon-20 mr-2"></i>
                                        Ví nhân viên
                                    </a>
                                </li>
                                <li class="menu-item" (click)="redirectPage('itemRankDedication')">
                                    <a class="menu-link d-flex align-items-center">
                                        <i class="icon-credit_card icon-20 mr-2"></i>
                                        Hạng cống hiến
                                    </a>
                                </li>
                                <li class="menu-item" (click)="redirectPage('itemStatiscal')">
                                    <a class="menu-link d-flex align-items-center">
                                        <i class="icon-bar_chart icon-20 mr-2"></i>
                                        Thống kê
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="d-flex flex-column flex-grow-1">
                        <div class="list-group">
                            <div class="list-content">
                                <div class="d-flex justify-content-between mb-6">
                                    <span class="icon-arrow_back icon-22 mr-3 text-hover-primary"
                                        (click)="backLocation()"></span>
                                    <div class="font-size-h3 font-weight-bold text-dark mb-1 flex-grow-1">
                                        {{'Cấu hình ví nhân viên' | lang: 'SettingWallet':'lblSettingWallet' |
                                        async}}
                                    </div>
                                </div>
                                <div class="d-flex align-items-start py-4 border-bottom border-light"
                                    *ngIf="item && item.hasOwnProperty('ActivedOn')">
                                    <div class="d-flex flex-column flex-grow-1">
                                        <div class="text-dark font-weight-bold font-size-h6">
                                            {{'Thời điểm kích hoạt ví' | lang:
                                            'SettingWallet':'lblTimeActive' |async}}
                                        </div>
                                        <div class="text-dark-50">
                                            {{'Ví sẽ được kích hoạt khi là nhân viên chính thức' | lang:
                                            'SettingWallet':'lblTimeActive2'
                                            |async}}
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center ml-4">
                                        <codx-Input type="select" name="select" class="control-vll" placeholder=""
                                            ngDefaultControl refValue="L1475" field="ActivedOn" [value]="item.ActivedOn"
                                            (valueChange)="changValueListPopup($event)">
                                        </codx-Input> 
                                        <span
                                            class="w-20px min-w-20px h-20px ml-3 d-flex justify-content-center"></span>
                                    </div>
                                </div>
                                <div class="font-size-h4 font-weight-bold text-dark mb-6 mt-6">
                                    {{'Quản lý ví' | lang: 'SettingWallet':'lblManageWallet' | async}}
                                </div>
                                <div class="list-setting ml-10">
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('DefaultCoins')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Số dư xu khi khởi tạo ví' | lang:
                                                'SettingWallet':'lblBalanceInitialization' | async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Chương trình tự động thêm ' | lang:
                                                'SettingWallet':'lblAutoAddCoin' | async}}
                                                {{item.DefaultCoins}}
                                                {{' xu vào ví người dùng mới' | lang:
                                                'SettingWallet':'lblAutoAddCoin2' | async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <codx-input type="text" class="form-control w-50px" disabled
                                                [(ngModel)]="item.DefaultCoins" placeholder="">
                                            </codx-input>
                                            <span class="icon-edit_file text-hover-primary icon-20 ml-3"
                                                (click)="openFormChangeCoin(changeCoin, 'DefaultCoins')"></span>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('MaxCoinsForEGiftControl')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Giới hạn số xu đổi E-voucher' | lang:
                                                'SettingWallet':'lblLimitConvertCoin' | async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Giới hạn dùng' | lang: 'SettingWallet':'lblLimitCoinToVoucher' |
                                                async}}
                                                {{item.MaxCoinsForEGift}}
                                                {{'xu đổi E-voucher' | lang: 'SettingWallet':'lblCoinToVoucher' |
                                                async}}
                                                {{item?.MaxCoinsForEGiftPeriod|vll:"L1436":"text"|async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="switch switch-sm ml-3">
                                                <label>
                                                    <codx-input type="switch" name="checkbox" class="" ngDefaultControl
                                                        field="MaxCoinsForEGiftControl"
                                                        (valueChange)="valueChange($event, null)"
                                                        [checked]="item.MaxCoinsForEGiftControl" label="">
                                                    </codx-input>

                                                    <span></span>
                                                </label>
                                            </span>
                                            <span class="icon-edit_file text-hover-primary icon-20 w-20px h-20px ml-3"
                                                (click)="open(content, 2)"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('HasPoints')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">Chính sách cộng xu
                                                theo ngày lễ/kỷ niệm</div>
                                            <div class="text-dark-50">Chương trình tự động cộng xu khi vào ví người
                                                dùng vào những ngày lễ/kỷ niệm như thiết lập
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="switch switch-sm ml-3">
                                                <label>
                                                    <input type="checkbox" checked="checked" name="select" />
                                                    <span></span>
                                                </label>
                                            </span>
                                            <span class="w-20px h-20px ml-3 d-flex justify-content-center">
                                                <span class="icon-keyboard_arrow_right icon-20"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div *ngFor=" let item of getItems('1') ;let last = last">
                                        <ng-container
                                            *ngTemplateOutlet="PolicyItem ;context: {item:item,isLast:last  }">
                                        </ng-container>
                                    </div>
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('PolicyCoins')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <!-- Memo -->
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{listParameter?.PolicyCoins?.memo}}
                                            </div>
                                            <!-- Description -->
                                            <div class="text-dark-50">
                                                {{listParameter?.PolicyCoins?.description}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="icon-keyboard_arrow_right icon-20"
                                                (click)="redirectPageDetailWallet('3')"></span>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="font-size-h4 font-weight-bold text-dark mb-6 mt-6">
                                        {{'Quản lý quỹ cho' | lang: 'SettingWallet':'lblFundManager' |async}}
                                    </div>
                                </div>
                                <div class="list-setting ml-10">
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('ActiveCoCoins')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Sử dụng quỹ cho' | lang:
                                                'SettingWallet':'lblFundBalanceInit' |async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Chương trình kích hoạt quỹ cho' | lang:
                                                'SettingWallet':'lblAutoAddCointToNewUser' |async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <!-- <input type="text" class="form-control w-50px"
                                                    [(ngModel)]="item.DefaultCoCoins" placeholder="" /> -->

                                            <span class="switch switch-sm ml-3">
                                                <label>
                                                    <codx-input type="switch" name="checkbox" class="" ngDefaultControl
                                                        field="ActiveCoCoins" (valueChange)="valueChange($event, null)"
                                                        [checked]="item.ActiveCoCoins" label="">
                                                    </codx-input>
                                                    <!-- [checked]="item.ActiveCoCoins == '1' ? true : false" -->
                                                </label>
                                            </span>
                                            <span class="w-20px h-20px ml-3 d-flex justify-content-center"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('DefaultCoCoins')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Số dư quỹ cho khi khởi tạo ví' | lang:
                                                'SettingWallet':'lblFundBalanceInit' |async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Chương trình tự động thêm ' | lang:
                                                'SettingWallet':'lblAutoAddCointToNewUser' |async}}
                                                {{item.DefaultCoCoins}}
                                                {{' xu vào quỹ cho người dùng mới' | lang:
                                                'SettingWallet':'lblAutoAddCointToNewUser2' |async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <codx-input type="text" class="form-control w-50px" disabled
                                                [(ngModel)]="item.DefaultCoCoins" placeholder="">
                                                </codx-input>
                                            <span class="icon-edit_file text-hover-primary icon-20 ml-3"
                                                (click)="!disableGroupFund && openFormChangeCoin(changeCoin, 'DefaultCoCoins')"></span>
                                        </div>
                                    </div>

                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('ExchangeRateCoinsControl')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Tỷ lệ quy đổi 1 xu ví nhân viên thành xu quỹ cho' | lang:
                                                'SettingWallet':'lblRateExchangeCoin' | async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Cho phép đổi 1 xu từ ví nhân viên sang '| lang:
                                                'SettingWallet':'lblAcceptExchangeCoin' |
                                                async}}
                                                {{item.ExchangeRateCoins}}
                                                {{' xu quỹ cho để tặng trên phiếu phản hồi'| lang:
                                                'SettingWallet2':'lblAcceptExchangeCoin' | async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="switch switch-sm ml-3">
                                                <label>
                                                    <codx-input type="switch" name="checkbox" class="" ngDefaultControl
                                                        field="ExchangeRateCoinsControl"
                                                        (valueChange)=" valueChange($event, null)"
                                                        [checked]="item.ExchangeRateCoinsControl"
                                                        [disabled]="disableGroupFund" label="">
                                                    </codx-input>
                                                    <span></span>
                                                </label>
                                            </span>
                                            <span class="icon-edit_file text-hover-primary icon-20 w-20px h-20px ml-3"
                                                (click)="!disableGroupFund && openFormChangeCoin(changeCoin, 'ExchangeRateCoins')"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start py-4" *ngIf="scheduledTasks_CoCoin">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Refresh số dư quỹ cho' | lang: 'SettingWallet':'lblRefreshGive'
                                                |async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Chương trình tự động refresh lại quỹ cho về số quy định theo chu kỳ đã thiết lập' | lang: 'SettingWallet':'lblAutoRefreshSetting'
                                                |async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="switch switch-sm ml-3">
                                                <label>
                                                    <codx-input type="switch" name="checkbox" class="" ngDefaultControl
                                                        field="ResetCoCoinsControl"
                                                        (valueChange)="valueChangePolicyCoin('4')"
                                                        [checked]="!scheduledTasks_CoCoin?.stop" label="">
                                                    </codx-input>
                                                    <span></span>
                                                </label>
                                            </span>
                                            <span class="icon-edit_file text-hover-primary icon-20 w-20px h-20px ml-3"
                                                (click)="openPopupSettingCycleRun('4')"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('PolicyCoCoins')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{listParameter?.PolicyCoCoins?.memo}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{listParameter?.PolicyCoCoins?.description}}

                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="icon-keyboard_arrow_right icon-20"
                                                (click)="redirectPageDetailWallet('4')"></span>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="font-size-h4 font-weight-bold text-dark mb-6 mt-6">
                                        {{'Quản lý điểm cống hiến' | lang: 'SettingWallet':'lblManagePointDedicate'
                                        |async}}
                                    </div>
                                </div>
                                <div class="list-setting ml-10">
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('DefaultMyKudos')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Số dư điểm cống hiến khi khởi tạo ví' | lang:
                                                'SettingWallet':'lblDedicationPointInit' |async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Chương trình tự động thêm ' | lang:
                                                'SettingWallet':'lblProgramAutoAddPoint' |async}}
                                                {{item.DefaultMyKudos}}
                                                {{' điểm cống hiến người dùng mới' | lang:
                                                'SettingWallet':'lblProgramAutoAddPoint2' |async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <cdox-input type="text" class="form-control w-50px" disabled
                                                [(ngModel)]="item.DefaultMyKudos" placeholder="">
                                                </cdox-input>
                                            <span class="icon-edit_file text-hover-primary icon-20 ml-3"
                                                (click)="openFormChangeCoin(changeCoin, 'DefaultMyKudos')"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="scheduledTasks_KuDos">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{'Refresh số dư điểm cống hiến' | lang:
                                                'SettingWallet':'lblRefreshBalanceDedicate' |async}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{'Chương trình tự động refresh lại điểm cống hiến về số quy định theo chu kỳ đã thiết lập' | lang: 'SettingWallet':'lblResetMyKudos'
                                                |async}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="switch switch-sm ml-3">
                                                <label>
                                                    <codx-input type="switch" name="checkbox" class="" ngDefaultControl
                                                        field="scheduledTasks_KuDos?.recID"
                                                        (valueChange)="valueChangePolicyCoin('5')"
                                                        [checked]="!scheduledTasks_KuDos?.stop" label="">
                                                    </codx-input>
                                                    <span></span>
                                                </label>
                                            </span>
                                            <span class="icon-edit_file text-hover-primary icon-20 w-20px h-20px ml-3"
                                                (click)="openPopupSettingCycleRun('5')"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-setting ml-10">
                                    <div class="d-flex align-items-start py-4 border-bottom border-light"
                                        *ngIf="item && item.hasOwnProperty('PolicyKudos')">
                                        <div class="d-flex flex-column flex-grow-1">
                                            <div class="text-dark font-weight-bold font-size-h6">
                                                {{listParameter?.PolicyKudos?.memo}}
                                            </div>
                                            <div class="text-dark-50">
                                                {{listParameter?.PolicyKudos?.description}}
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center ml-4">
                                            <span class="icon-keyboard_arrow_right icon-20"
                                                (click)="redirectPageDetailWallet('5')"></span>
                                        </div>
                                    </div>
                                    <div *ngFor=" let item of getItems('2') ;let last = last">
                                        <ng-container
                                            *ngTemplateOutlet="PolicyItem ;context: {item:item,isLast:last  }">
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--modal Cap nhat so luong  -->

        </div>
    </div>
</div>
<ng-template #content let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">
                {{'Giới hạn xu đổi E-voucher' | lang: 'SettingWallet':'lblLimitCointToVoucher' |async}}
            </h4>
            <button type="button" class="close" aria-label="Close">
                <i class="icon-close icon-20 text-dark text-hover-primary" (click)="modal.dismiss('Cross click')"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group row mt-3">
                <label class="col-3 col-form-label">
                    {{'Số lượng' | lang: 'SettingWallet':'lblQuanlity' |async}}
                </label>
                <div class="col-9">
                    <cdox-input type="number" class="form-control" [(ngModel)]="item.MaxCoinsForEGift"
                        onkeypress="return event.charCode >= 48 && event.charCode <= 57" placeholder="10">
                        </cdox-input>
                </div>
            </div>
            <div class="form-group row mt-3">
                <label class="col-3 col-form-label">
                    {{'Chu kỳ' | lang: 'SettingWallet':'lblCycle' |async}}
                </label>
                <div class="col-9">
                    <codx-input type="select" name="select" class="control-vll" placeholder="" ngDefaultControl
                        refValue="L1436" field="MaxCoinsForEGiftPeriod" [value]="item.MaxCoinsForEGiftPeriod"
                        (valueChange)="changValueListPopup($event)">
                    </codx-input>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="onSavePopupCombobx()">
                {{'Lưu' | lang: 'SettingWallet':'lblSave' |async}}
            </button>
        </div>
    </div>
</ng-template>
<ng-template #PolicyItem let-item="item">
    <div class="d-flex align-items-start py-4">
        <div class="d-flex flex-column flex-grow-1">
            <div class="text-dark font-weight-bold font-size-h6">{{item.policyName}}
            </div>
            <div class="text-dark-50">{{item.memo}}</div>
        </div>
        <div class="d-flex align-items-center ml-4">
            <span class="switch switch-sm ml-3">
                    <codx-input type="switch" name="checkbox" class="" ngDefaultControl [field]="item.recID"
                        (valueChange)="onSaveStatusPolicy($event, null)" [checked]="item.actived" label="">
                    </codx-input>
            </span>
            <span class="w-20px h-20px ml-3 d-flex justify-content-center">
                <span class="icon-keyboard_arrow_right icon-20" style="cursor: pointer;"
                    (click)="item.actived && LoadDetailPolicy(item.category,item.recID)"></span>
            </span>
        </div>
    </div>
</ng-template>
<ng-template #changeCoin let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title" *ngIf="this.fieldUpdateCoin !='DefaultMyKudos'">
                {{'Thay đổi số lượng xu' | lang: 'SettingWallet':'lblLimitCointToVoucher' |async}}
            </h4>
            <h4 class="modal-title" id="modal-basic-title" *ngIf="this.fieldUpdateCoin =='DefaultMyKudos'">
                {{'Thay đổi số dư điểm cống hiến' | lang: 'SettingWallet':'lblLimitCointToVoucher' |async}}
            </h4>
            <button type="button" class="close" aria-label="Close">
                <i class="icon-close icon-20 text-dark text-hover-primary" (click)="emptyObjectUpdate()"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group row mt-3">
                <label class="col-3 col-form-label">
                    {{'Số lượng' | lang: 'SettingWallet':'lblQuanlity' |async}}
                </label>
                <div class="col-9">
                    <codx-input type="number" class="form-control" [(ngModel)]="objectUpdateCoin[this.fieldUpdateCoin]"
                        onkeypress="return event.charCode >= 48 && event.charCode <= 57" placeholder="10">
                        </codx-input>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="handleSaveParameter()">
                {{'Lưu' | lang: 'SettingWallet':'lblSave' |async}}
            </button>
        </div>
    </div>
</ng-template>
<!-- <lv-setting-cycle #settingCycle [applyFor]="applyFor" [scheduledTasks]="scheduledTasks"
    (onSaveModel)="saveSettingCycleRun()"></lv-setting-cycle> -->