<codx-views [views]="views" #viewbase [funcID]="funcID" [entityName]="functionList?.entityName"
    (buttonClick)="openFormCreate($event, true)" [button]="button" service="FD" assemblyName="ERM.Business.FD"
    className="GiftsBusiness" method="LoadDataGiftAsync" [predicate]="predicate" [dataValue]="dataValue"
    idField="recID">
</codx-views>
<ng-template #template let-data>
    <div class="container-listview category-gift">
        <div class="list-table" *ngIf="this.searchType == '0' || this.searchType == '1' ">
            <codx-temp-full [typeMF]="'hover'" [dataItem]="data" [formModel]="formModel"
                (clickMF)="clickMF($event, data)" typeMF="hover" [titleTmp]="itemGift" [imgOn]="data.modifiedOn">
            </codx-temp-full>
        </div>
        <div class="list-table" *ngIf="this.searchType == '2'">
        </div>
    </div>
</ng-template>

<ng-template #itemGift let-dataItem>
    <div class="list-item d-flex align-items-start">
        <div class="img">
            <codx-img [funcId]="funcID" aria-disabled="true" [objectType]="functionList?.formName" [width]="35"
                [objectId]="dataItem?.giftID">
            </codx-img>
        </div>
        <div class="d-flex flex-column flex-grow-1 infor">
            <div class="text-dark font-weight-bold font-size-h6">{{dataItem?.giftName}}</div>
            <div class="d-flex align-items-center font-size-md">
                <div class="d-flex text-dark mr-2">{{dataItem?.giftID}}</div>
                <span class="text-muted font-size-sm">|</span>
                <div class="d-flex ml-2">
                    <span class="text-dark-50 mr-1 left-5">
                        <codx-label name="lblGroup" [formName]="functionList?.formName" default="Nhóm:">
                        </codx-label>
                    </span>
                    <span class="text-dark font-weight-bold left-5">{{dataItem?.groupName}}</span>
                </div>
            </div>
            <div class="text-dark">
                <span class="text-dark-50 mr-1 text-nowrap">
                    <codx-label name="lblDescription" [formName]="functionList?.formName" default="Mô tả:">
                    </codx-label>
                </span>
                <span [innerHTML]="dataItem?.memo"></span>
            </div>
            <div class="d-flex align-items-center">
                <div class="d-flex align-items-center mr-4">
                    <span class="text-dark-50 mr-1">
                        <codx-label name="lblStorage" [formName]="functionList?.formName" default="Tồn kho:">
                        </codx-label>
                    </span>
                    <span class="text-primary font-size-h4 font-weight-bold left-5">{{dataItem?.onhand}}</span>
                </div>
                <div class="d-flex align-items-center mr-4">
                    <span class="text-dark-50 mr-1 left-10">
                        <codx-label name="lbl" [formName]="functionList?.formName" default="Đã giành hàng:">
                        </codx-label>
                    </span>
                    <span class="text-warning font-size-h4 font-weight-bold left-5">{{dataItem?.reservedQty}}</span>
                </div>
                <div class="d-flex align-items-center mr-4">
                    <span class="text-dark-50 mr-1 left-10">
                        <codx-label name="lblExport" [formName]="functionList?.formName" default="Sẵn sàng xuất:">
                        </codx-label>
                    </span>
                    <span class="text-success font-size-h4 font-weight-bold left-5">{{dataItem?.availableQty}}</span>
                </div>
                <div ngbDropdown class="d-inline-block" container="body">
                    <button type="button" class="btn btn-icon btn-sm" id="dropdownShowDescription" ngbDropdownToggle
                        ata-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                        *ngIf="dataItem?.description != null && dataItem?.description.length > 0 ">
                        <span class="icon-assignment icon-18 text-dark-75"></span>
                    </button>
                    <div ngbDropdownMenu aria-labelledby="dropdownShowDescription">
                        <div [innerHTML]="dataItem?.description" class="w-500px p-6"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex align-items-center justify-content-end w-100px">
            <div class="font-size-h4 text-dark font-weight-bold">{{dataItem?.price}}</div>
            <span class="text-warning ml-2 icon-20 icon-monetization_on"></span>
        </div>
    </div>
    <hr>
</ng-template>

<ng-template #formChange let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">
                <codx-label name="lblUpdateStorage" [formName]="functionList?.formName"
                    default="Cập nhật số lượng tồn kho">
                </codx-label>
            </h4>
            <button type="button" class="close" aria-label="Close">
                <i class="icon-close icon-20 text-dark text-hover-primary" (click)="modal.dismiss('Cross click')"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="text-dark-75 mb-3">
                {{onHandForm.controls['giftName'].value}}
                <br>
                <div [innerHTML]="onHandForm.controls['memo'].value"></div>
            </div>
            <div class="form-group mt-3">
                <label #Onhand>{{ 'Tồn kho hiện tại' | lang:
                    'Gifts':'Onhand':'grvGifts': Onhand| async}}</label>
                <codx-input type="number" class="form-control" placeholder="" formControlName='onhand'
                    [crrValue]="onHandForm.controls['onhand'].value" [attr.disabled]="true">
                </codx-input>
            </div>
            <div class="form-group mt-3">
                <label #NewOnhand>{{ 'Tồn kho mới' | lang:
                    'Gifts':'NewOnhand':'grvGifts': NewOnhand| async}}</label>
                <codx-input type="number" min="0" class="form-control" placeholder="" formControlName='newOnhand'
                    onkeypress="return event.charCode >= 48 && event.charCode <= 57" (valueChange)="changeHand($event)"
                    [ngClass]="{'is-invalid': onHandForm.controls['newOnhand'].invalid}">
                </codx-input>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="onChangeOnHandOfGift()">
                <codx-label name="lblSave" [formName]="functionList?.formName" default="Lưu"></codx-label>
            </button>
        </div>
    </div>
    <!-- </form> -->
</ng-template>

<ng-template #panelRightRef>
    <div id="update_infor" class="offcanvas offcanvas-md offcanvas-right">
        <div class="offcanvas-header" kt-hidden-height="46">
            <div class="d-flex align-items-center justify-content-between header">
                <h2 class="m-0">
                    <codx-label *ngIf="isAddMode" name="lblAddGift" [formName]="functionList?.formName"
                        default="Thêm mới">
                    </codx-label>
                    <codx-label *ngIf="!isAddMode" name="lblUpdateGift" [formName]="functionList?.formName"
                        default="Chỉnh sửa">
                    </codx-label>
                </h2>
                <!-- Cập nhật thông tin -->
                <a class="btn btn-xs btn-icon btn-light btn-hover-primary" id="dms_properties_close">
                    <span (click)="clickClosePopup()" class="icon-close icon-18"></span>
                </a>
            </div>
            <div class="btn-extand mt-2 d-flex justify-content-end h-30">
                <a class="text-dark-75 text-hover-primary d-flex align-items-center" (click)="extendShow2()">
                    <span class="mr-2 text-dark">
                        <codx-label name="lblExtent" [formName]="functionList?.formName" default="Mở rộng">
                        </codx-label>
                    </span>
                    <span class="icon-login icon-20 ml-1"></span>
                </a>
            </div>
        </div>
        <div class="offcanvas-content offcanvas-extend content">
            <div class="offcanvas-wrapper">
                <div class="d-flex">
                    <div class="flex-grow-1 extend-main border-right">
                        <div class="form-group">
                            <div class="font-w500 font-1rem">
                                <codx-label name="lblGiftName" [formName]="functionList?.formName"
                                    default="Tên quà tặng"></codx-label>
                                <span class="required"></span>
                            </div>
                            <codx-input type="text" class="form-control" placeholder="Tên quà tặng" ngDefaultControl
                                [crrValue]="addEditForm.controls['giftName'].value" (valueChange)="valueChange($event)"
                                field="giftName" autocomplete="off"></codx-input>
                        </div>
                        <div class="form-group row mt-3">
                            <div class="col-lg-6 col-md-6">
                                <div class="font-w500 font-1rem">
                                    <codx-label name="lblGiftCode" [formName]="functionList?.formName"
                                        default="Mã quà tặng">
                                    </codx-label>
                                    <span class="required"></span>
                                </div>
                                <codx-input type="text" [disabled]="isAddMode ? false : true" class="form-control"
                                    ngDefaultControl [crrValue]="addEditForm.controls['giftID'].value"
                                    placeholder="ITEM20210206001" (valueChange)="valueChange($event)" field="giftID">
                                </codx-input>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <div class="font-w500 font-1rem">
                                    <codx-label name="lblGiftGroup" [formName]="functionList?.formName"
                                        default="Nhóm quà tặng">
                                    </codx-label>
                                </div>
                                <codx-input (valueChange)="changeCombobox($event, 'groupID')" id="edit-usergroups"
                                    ngDefaultControl type="combobox" name="combobox"
                                    [crrValue]="addEditForm.controls['groupID'].value"
                                    class=" form-control borderless p-0" style="border: none;" placeholder="{{'Nhóm quà tặng' | lang:
                        '':'':'' | async}}" refValue="GiftGroup" [predicate]="predicate" loadFull="false"
                                    field="groupID" service="FD">
                                </codx-input>
                            </div>
                        </div>
                        <div class="form-group row mt-3">
                            <div class="col-lg-6 col-md-6">
                                <div class="font-w500 font-1rem">
                                    <codx-label name="lblOwner" [formName]="functionList?.formName"
                                        default="Chủ sở hữu"></codx-label>
                                </div>
                                <codx-input id="edit-usergroups" type="combobox" name="combobox" ngDefaultControl #owner
                                    [crrValue]="addEditForm.controls['owner'].value"
                                    (valueChange)="changeCombobox($event, 'owner')" class=" form-control borderless p-0"
                                    style="border: none;" refValue="Users" [predicate]="" field="owner" service="AD">
                                </codx-input>
                            </div>
                        </div>
                        <div class="form-group mt-3" style="width: 490px;">
                            <div class="font-w500 font-1rem">
                                <codx-label name="lblMemo" [formName]="functionList?.formName" default="Mô tả">
                                </codx-label>
                                <span class="required"></span>
                            </div>
                            <codx-input type="text" class="form-control text" rows="3"
                                (valueChange)="valueChange($event)" ngDefaultControl
                                [crrValue]="addEditForm.controls['memo'].value" field="memo">
                            </codx-input>
                        </div>
                        <div class="form-group mt-3" style="width: 490px;">
                            <div class="font-w500 font-1rem">
                                <codx-label name="lblDescription" [formName]="functionList?.formName"
                                    default="Mô tả khác">
                                </codx-label>
                            </div>
                            <codx-input dataformat="ed" name="editor" class="w-490px test-textarea" placeholder=""
                                ngDefaultControl [crrValue]="addEditForm.controls['description'].value"
                                (valueChange)="valueChange($event)" type="textarea" field="description">
                            </codx-input>
                        </div>
                        <div class="form-group row mt-3">
                            <div class="col-lg-6 col-md-6">
                                <div class="font-w500 font-1rem">
                                    <codx-label name="lblPrice" [formName]="functionList?.formName"
                                        default="Đơn giá (xu)">
                                    </codx-label>
                                    <span class="required"></span>
                                </div>
                                <codx-input type="number" class="form-control" placeholder="21" type="text"
                                    onkeypress="return event.charCode >= 48 && event.charCode <= 57" field="price"
                                    (valueChange)="valueChange($event)" ngDefaultControl
                                    [crrValue]="addEditForm.controls['price'].value"></codx-input>
                            </div>
                        </div>
                        <div class="d-flex align-items-start pic-grif">
                            <div class="pic-edit mr-5 upload-img" style="border: none;">
                                <codx-img funcId="FDS0122" #imageUpLoad aria-disabled="true" objectType="FD_Gifts"
                                    [isAllowEdit]="true" [width]="90" [objectId]="addEditForm.controls['giftID'].value">
                                </codx-img>
                            </div>
                            <div class="d-flex flex-column mt-4">
                                <div class="d-flex align-items-center mr-6">
                                    <span class="text-dark-75 mr-2">
                                        <codx-label name="lblStorage" [formName]="functionList?.formName"
                                            default="Tồn kho:">
                                        </codx-label>
                                    </span>
                                    <span
                                        class="text-dark font-weight-bold left-5">{{addEditForm?.controls['onhand'].value}}</span>
                                </div>
                                <div class="d-flex align-items-center mr-6">
                                    <span class="text-dark-75 mr-2">
                                        <codx-label name="lblPrice" [formName]="functionList?.formName"
                                            default="Đã giành hàng:">
                                        </codx-label>
                                    </span>
                                    <span
                                        class="text-dark font-weight-bold left-5">{{addEditForm?.controls['reservedQty'].value}}</span>
                                </div>
                                <div class="d-flex align-items-center mr-6">
                                    <span class="text-dark-75 mr-2">
                                        <codx-label name="lblPrice" [formName]="functionList?.formName"
                                            default="Sẵn sàng xuất:">
                                        </codx-label>
                                    </span>
                                    <span
                                        class="text-dark font-weight-bold left-5">{{addEditForm?.controls['availableQty'].value}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer pt-4 footer">
                <button type="submit" class="btn btn-primary btn-footer" (click)="onSaveGift()">
                    <codx-label name="lblSave" [formName]="functionList?.formName" default="Lưu"></codx-label>
                </button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #moreFunction>
    <div class="flex" (mouseleave)="PopoverEmpLeave(empPopover)" #empPopover="ngbPopover" [ngbPopover]=""
        autoClose="outside">
        <a class="action-item d-flex align-items-center" placement="top" [ngbTooltip]="update">
            <span class="icon-edit icon-18 ml-2 mr-2 active" (click)="openFormCreate(dataItem, false)"></span>
            <ng-template #update>
                <span class="tooltip-black">
                    <codx-label name="lblUpdate" [formName]="functionList?.formName" default="Cập nhật">
                    </codx-label>
                </span>
            </ng-template>
        </a>
        <a class="action-item d-flex align-items-center" (click)="deleteGift(dataItem)" placement="bottom"
            [ngbTooltip]="delete">
            <span class="icon-close icon-18 text-danger mx-2"></span>
            <ng-template #delete>
                <span class="tooltiptext">
                    <codx-label name="lblDelete" [formName]="functionList?.formName" default="Xóa">
                    </codx-label>
                </span>
            </ng-template>
        </a>
        <a class="action-item d-flex align-items-center" *ngFor="let item of lstMoreFunction"
            (click)="clickMoreFuntion(item.functionID,dataItem,formChange)" placement="bottom" [ngbTooltip]="more">
            <span class=" icon-update icon-18 mx-2 active"></span>
            <ng-template #more><span class="tooltiptext">{{item.customName}}</span></ng-template>
        </a>
    </div>
</ng-template>