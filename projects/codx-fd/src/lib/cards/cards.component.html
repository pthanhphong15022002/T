
<codx-views #codxViews  
    [entityName]="entityName" 
    [views]="views" 
    [idField]="'recID'"
    [autoLoad]="true"
    [button]="buttonAdd" 
    service="FD"
    assemblyName="ERM.Business.FD" 
    className="CardsBusiness" 
    method="GetListDataByWebAsync"
    [predicate]="predicate" 
    [dataValue]="dataValue" 
    [entityName]="entityName"
    (buttonClick)="clickShowAssideRight()">
</codx-views>

<ng-template #templateItem let-item>
    <div id="listItemOfGifts" (click)="clickItem(item.recID)">
        <div class="list-item d-flex master-item" #row [attr.data-_id]="item.recID">
            <div *ngIf="cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share">
                <codx-img class="symbol symbol-40 symbol-circle mr-3" [objectId]="item.sender"
                    objectType="AD_Users" [width]="60">
                </codx-img>
                
            </div>
            <div *ngIf="cardType == CARDTYPE_EMNUM.SuggestionImprovement">
                <codx-img class="symbol symbol-40 symbol-circle mr-3" *ngIf="tabActive == STATUS_ACTIVE.CARD"
                    [objectId]="item.sender" objectType="AD_Users" [width]="60">
                </codx-img>
                
            </div>
            <div *ngIf="cardType == CARDTYPE_EMNUM.Share && tabActive == STATUS_ACTIVE.CARD">
                <ng-container *ngIf="item.countComments > 1; else elsImg">
                    <img class="symbol symbol-40 symbol-circle mr-3 w-40px h-40px" src="../../../../assets/img/AvatarGroup.png">
                </ng-container>
                <ng-template #elsImg>
                    <codx-img class="symbol symbol-40 symbol-circle mr-3" 
                        [objectId]="item.receiver" 
                        objectType="AD_Users">
                    </codx-img>
                </ng-template>
            </div>
            <div class="d-flex flex-column flex-grow-1 ms-4">
                <div class="d-flex justify-content-between">
                    <ng-container *ngIf="cardType !== CARDTYPE_EMNUM.Share">
                        <div class="text-dark fw-bolder">
                            {{item.senderName}}
                        </div>
                    </ng-container>
                    <ng-container *ngIf="cardType == CARDTYPE_EMNUM.Share">
                        <div class="text-dark fw-bolder" *ngIf="tabActive == STATUS_ACTIVE.CARD">
                            {{ item.tagType | displayname:item.receiverName:item.countComments }}
                        </div>
                        
                    </ng-container>

                </div>
                <div class="d-flex justify-content-between">
                    <div class="text-dark font-weight-italic">{{item.postionName}}</div>
                </div>
                <div class="fed-des text-dark" [innerHTML]="item?.situation"></div>
                <div class="d-flex align-items-center">
                    <div *ngIf="cardType != CARD_TYPE.SHARE"
                        class="px-2 b rounded-pill"
                        [style.border-color]="(item[TypeValuelistStatus]|vll:NameValuelistStatus:'color'|async)+'30'"
                        [style.background-color]="(item[TypeValuelistStatus]|vll:NameValuelistStatus:'color'|async)+'30'"
                        [style.color]="item[TypeValuelistStatus]|vll:NameValuelistStatus:'color'|async">
                        {{item[TypeValuelistStatus]|vll:NameValuelistStatus:"text"|async}}
                    </div>
                    <div class="text-muted ms-4">
                        {{item.createdOn | fmDT:'dmy'}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #cardDisplay>
</ng-template>
<ng-template #templateloading let-data>
    <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
    <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
    <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
</ng-template>
<ng-template #templateGift let-item>
    <div class="row">
        <div class="col-3">
            <codx-img class="max-h-80px w-80px h-80px" [objectId]="item.giftID"
            objectType="FD_Gifts" [width]="200">
        </codx-img>
        </div>
        <div class="col-9 d-flex flex-column">
            <div class="text-dark font-weight-bold">{{item.giftName}}</div>
            <div class="text-dark">
                <span class="font-weight-normal text-dark-50">
                    <codx-label formName=""name="lblPrice" default="Giá:"></codx-label>
                </span>
                <span class="ms-1">{{item.price}}</span>
                <span class="ms-1">
                    <codx-label formName="" name="lblCoin" default="xu"></codx-label>
                </span> 
            </div>
            <div class="text-dark">
                <span class="font-weight-normal text-dark-50 mr-1">
                    <codx-label formName="" name="lblNotes" default="Chú thích:"></codx-label>
                </span>
                <span [innerHTML]="item.memo"></span>
            </div>
            <div class="text-dark">
                <span class="font-weight-normal text-dark-50 mr-1">
                    <codx-label formName="" name="lblCount" default="Số lượng:"></codx-label>
                </span>
                <span>{{item.quantity}}</span>
            </div>
            <div class="d-flex mt-2">
                <div class="px-2 b rounded-pill"
                    [style.color]="item.status|vll:'L1428':'color'|async"
                    [style.background-color]="(item.status|vll:'L1428':'color'|async)+'30'">
                    {{item.status|vll:"L1428":"text"|async}}
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #templateFile let-item>

    <div class="d-flex">
        <div class="mr-3">
            <img class="max-h-40px" src="../../../../assets/demos/dms/{{getAvatar(item.extension)}}" />
        </div>
        <div class="d-flex flex-column flex-grow-1">
            <div class="text-dark">{{item.fileName}}</div>
            <div class="text-dark-50 font-size-sm">{{item.createdOn | fmDT:'dmy'}}</div>
        </div>
        <div class="icon-download text-hover-primary icon-20 ml-2" (click)="downloadFile(item)"></div>
    </div>
</ng-template>
<ng-template #templateShare let-item="item">
    <div class="d-flex align-items-center">
        <codx-img objectType="AD_Users" [objectId]="item.objectID"
            class="symbol symbol-circle symbol-30 mr-3" [width]="40">
        </codx-img>
        <div class="text-dark font-weight-bold">{{item.objectName}}</div>
    </div>
</ng-template>
<ng-template #emptySelected>
    <div class="empty-data"></div>
</ng-template>

<ng-template #sideBarRightRef>
    <div class="p-9">
        <div id="FormEdit" class="offcanvas offcanvas-md offcanvas-right">
            <div class="offcanvas-header" kt-hidden-height="46">
                <div class="d-flex align-items-center justify-content-between">
                    <h2 class="m-0"> {{title}}</h2>
                    <a class="btn btn-xs btn-icon btn-light btn-hover-primary">
                        <span (click)="clickCloseAssideRight()" class="icon-close icon-18"></span>
                    </a>
                </div>
                <div class="btn-extand mt-2 d-flex justify-content-end">
                    <a class="text-dark-75 text-hover-primary d-flex align-items-center">
                        <span class="mr-2 text-dark"><codx-label formName="" name="lblExtend" default="Mở rộng"></codx-label></span>
                        <span class="icon-login icon-20 ml-1"></span>
                    </a>
                </div>
            </div>
            <div class="offcanvas-content">
                <div class="row">
                    <div class="offcanvas-content">
                        <div class="w-100 edit-info">
                            <div class="offcanvas-wrapper">
                                <div class="content d-flex flex-column flex-column-fluid py-0">
                                    <div class="extend-main border-right">
                                        <ng-container *ngIf="cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share">
                                            <div class="form-group">
                                                <codx-label fiedName="Receiver" formName="" name="lblfReciver" default="Người nhận quà">
                                                </codx-label>
                                                <codx-input 
                                                    type="combobox"
                                                    class=" form-control borderless p-0"
                                                    [crrValue]="form.value.receiver"
                                                    [loadFull]="true"
                                                    ngDefaultControl
                                                    field="receiver"
                                                    #comboboxUserReciver
                                                    (valueChange)="valueChange($event,comboboxUserReciver)"
                                                    refValue="Users"
                                                    service="SYS"
                                                ></codx-input>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="refValue != '' && cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share && cardType != CARDTYPE_EMNUM.Radio">
                                            <div class="form-group">
                                                <codx-label fiedName="Behavior" formName="" name="lblfBehavior" default="Qui tắc ứng xử" >
                                                </codx-label>
                                                <codx-input type="combobox" name="combobox" 
                                                    class=" form-control borderless p-0"
                                                    [crrValue]="form.value.behavior"
                                                    field="behavior"
                                                    #comboboxBehavior
                                                    ngDefaultControl [refValue]="refValue"
                                                    (valueChange)="valueChange($event,comboboxBehavior)"
                                                    loadFull="true"
                                                ></codx-input>
                                        </div>
                                        </ng-container>
                                        <ng-container *ngIf="cardType == CARDTYPE_EMNUM.SuggestionImprovement || cardType == CARDTYPE_EMNUM.Share">
                                            <div class="form-group">
                                                <codx-label fiedName="Industry" formName="" name="lblfIndustry" default="Lĩnh vực"></codx-label>
                                                <codx-input type="combobox" name="combobox" 
                                                    [class]="'mt-2'"
                                                    field="industry"
                                                    #industry
                                                    [crrValue]="form.value.industry"
                                                    ngDefaultControl  [refValue]="'Industries'" service="BS" 
                                                    (valueChange)="valueChange($event,industry)"
                                                    [loadFull]="true">
                                                </codx-input>
                                            </div>
                                            <div class="form-group">
                                                <codx-label name="lblOwner" formName="" name="lblfOwner" default="Người nhận phiếu">
                                                </codx-label>
                                                <div class="mt-2">
                                                    <div class="d-flex align-items-center">
                                                        <codx-img class="symbol symbol-35 symbol-circle mr-3"
                                                        [objectId]="userReciver" objectType="AD_Users">
                                                        </codx-img>
                                                        <div class="ms-3 text-dark font-size-lg">{{userReciverName}}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <div class=" form-group" #situation>
                                                <codx-label fiedName="Situation" formName="" name="lblfStuation" default="Nội dung gửi">
                                                </codx-label>
                                            <codx-input class="form-control p-0"
                                                type="textarea"
                                                [crrValue]="form.value.situation"
                                                field="situation"
                                                #inputContents
                                                (valueChange)="valueChange($event,inputContents)"
                                                placeholder="" ngDefaultControl>
                                            </codx-input>
                                        </div>
                                        <ng-container *ngIf="cardType == CARDTYPE_EMNUM.Thankyou ||  cardType == CARDTYPE_EMNUM.CommentForChange">
                                            <div class="checkbox-inline mb-3 check-1 d-flex">
                                                <div class="me-3" *ngFor="let item of vllData">
                                                    <codx-input class="rounded-circle mr-1i"  
                                                        [crrValue]="item.value"
                                                        [label]="item.text" type="radio"
                                                        field="rating"
                                                        #checkboxRating
                                                        name="radio"
                                                        (valueChange)="valueChange(item.value, checkboxRating)" ngDefaultControl>
                                                    </codx-input>
                                                </div>
                                            </div>
                                        </ng-container>
                                        
                                        <ng-container *ngIf="cardType != CARDTYPE_EMNUM.Radio">
                                            <div class="form-group" >
                                                <div class="d-flex align-items-center justify-content-between mt-4">
                                                        <codx-label name="share" formName="" name="lblfShare" default="Chia sẻ đến"></codx-label>
                                                    <a class="btn btn-icon btn-xs btn-light-primary">
                                                        <span class="icon-person_add_alt_1 icon-18"></span>
                                                    </a>
                                                </div>
                                                <div class="{{lstUser.length <= 0 ? '' : 'user-mini-group'}}">
                                                    <div class="user-mini-item" *ngFor="let item of lstUser; index as i;">
                                                        <div class="d-flex align-items-center">
                                                            <div class="symbol symbol-30 symbol-circle mr-2">
                                                                <ng-container *ngIf="item.objectID == null || item.objectID == '';else elsethenAvatar1">
                                                                    <div>
                                                                        <img class="symbol symbol-30 symbol-circle"
                                                                            src="../../../assets/demos/user/user-admin.svg">
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #elsethenAvatar1>
                                                                    <div>
                                                                        <codx-img class="symbol symbol-30 symbol-circle" [objectId]="item.objectID" objectType="AD_Users">
                                                                        </codx-img>
                                                                    </div>
                                                                </ng-template>
                                                            </div>
                                                            <div class="text-dark-75">{{item.objectName}}</div>
                                                            <span class="icon-close icon-16 ml-2 text-danger"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share && cardType != CARDTYPE_EMNUM.Radio">
                                            <div class="d-flex align-items-center justify-content-between mt-4 mb-3">
                                                <div class="text-dark font-weight-bold">
                                                    <codx-label formName="" name="lblfSelectCard" default="Chọn thiệp:"></codx-label>
                                                </div>
                                                <div class="text-right text-primary text-italic pr-2">
                                                <a class="text-right text-primary text-italic pr-2" (click)="open(cardDisplay)">
                                                    <codx-label formName="" name="lblViewCard" default="Xem trước"></codx-label>
                                                </a>
                                            </div>
                                            </div>
                                            <div class="card-slider d-flex align-items-center mt-6 w-100">
                                                <ngb-carousel #carousel [wrap]="false" [interval]="0" [keyboard]="false" [pauseOnHover]="false" [showNavigationArrows]="showNavigationArrows" [showNavigationIndicators]="false">
                                                    <ng-container  *ngFor="let item of lstCard; let i = index;">
                                                        <ng-template ngbSlide *ngIf="i * 4 < lstCard.length">
                                                            <div class="d-flex">
                                                                <ng-container *ngFor="let itemChild of lstCard; let idxChild = index;">
                                                                    <ng-container *ngIf="idxChild >= (i * 4) && idxChild < (i + 1 * 4)">
                                                                        <ng-container *ngIf="!itemChild.backgroundColor;else haveBackGround" >
                                                                            <div [class.item-card]="form.value.pattern == itemChild.patternID" class=" mx-5 radio-box d-flex justify-content-between align-items-center item-card-gift h-120px w-80px border ">
                                                                                <codx-img
                                                                                    class=" h-120px w-80px border-radius-large"
                                                                                    [objectId]="itemChild.patternID" [funcId]="functionID"
                                                                                    objectType="FD_Patterns" [width]="164"
                                                                                    (click)="selectCard(itemChild,element)" #element>
                                                                                </codx-img>
                                                                            </div>
                                                                        </ng-container>
                                                                        <ng-template #haveBackGround>
                                                                            <div class="mx-5 radio-box d-flex justify-content-between align-items-center item-card-gift"
                                                                                [style.background-color]="itemChild.backgroundColor"
                                                                                style="height: 120px; width: 80px;"
                                                                                (click)="selectCard(itemChild,element)" #element
                                                                                [class.item-card]="form.value.pattern == itemChild.patternID">
                                                                            </div>
                                                                        </ng-template>
                                                                    </ng-container>
                                                                </ng-container>
                                                            </div>
                                                        </ng-template>
                                                    </ng-container>
                                                </ngb-carousel>
                                            </div>
                                        </ng-container>

                                        <ng-container *ngIf="parameter">
                                            <ng-container *ngIf="parameter.HasGifts == '1' ">
                                                <div class="form-group mt-6">
                                                    <codx-label fiedName="ItemID" formName="" name="lblfGift" default="Quà tặng"></codx-label>
                                                    <!-- <codx-input service="FD" type="combobox" name="combobox"
                                                        class=" form-control borderless p-0" placeholder="{{'Tên quà tặng' | lang:
                                                        'Gift':'tblGiftName' | async}}" ngDefaultControl refValue="FDGifts"
                                                        loadFull="false" #gift field="giftID" [crrValue]="itemIDNew"
                                                        (valueChange)="valueChange($event,gift.field)"></codx-input> -->
                                                        <codx-combobox service="FD" name="combobox"
                                                        class=" form-control borderless p-0" placeholder="{{'Tên quà tặng' | lang:
                                                        'Gift':'tblGiftName' | async}}" ngDefaultControl refValue="FDGifts"
                                                        loadFull="false" #gift field="giftID" [value]="itemIDNew"
                                                        (valueChange)="valueChange($event, gift)">
                                                        </codx-combobox>
                                                </div>
                                                <div class="d-flex form-group row mt-3">
                                                    <div class="col-lg-6 col-md-6" >
                                                        <codx-label name="Quantity" formName="" name="lblfNumber" default="Số lượng"></codx-label>
                                                        <codx-input type="number" [min]="0" class="form-control"
                                                            [crrValue]="form.value.quanlity" field="quantity" #fquantity
                                                            ngDefaultControl (valueChange)="valueChange($event,fquantity)">
                                                        </codx-input>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6" #TotalPrice>
                                                        <codx-label formName="" name="lblfTotalPrice" default="Tổng xu"></codx-label>
                                                        <codx-input class="form-control" type="text" placeholder="{{'Tổng xu' | lang:
                                                        'Gift':'TotalPrice' | async}}" [crrValue]="totalCoint" [disabled]="true">
                                                        </codx-input>
                                                    </div>
                                                </div>
                                                
                                            </ng-container>
                                            <ng-container *ngIf="parameter.HasPoints == '1'">
                                                <div class="row border border-primary rounded ms-1">
                                                    <div class="col-6 bg-primary text-white d-flex align-items-center justify-content-center">
                                                        <codx-label formName="" name="lblfGivePrice" default="Tặng xu"></codx-label>
                                                    </div>
                                                    <div class="col-6 d-flex justify-content-evenly align-items-center ">
                                                        <button class="btn bg-transparent" type="button" (click)="subPoint()">
                                                            <span class="icon-remove icon-18"></span>
                                                        </button>
                                                        <input type="text" min="1" class="text-center" [value]="givePrice" readonly style="outline: none; border: none;"/>
                                                        <button class="btn bg-transparent" type="button" (click)="addPoint()">
                                                            <span  class="icon-add icon-18 "></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="offcanvas-footer mt-10">
                        <div class="d-flex align-items-center justify-content-end">
                            <button type="button"class="btn btn-primary" (click)="Save()"><codx-label formName="" name="lblSave" default="Lưu"  ></codx-label></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #panelLeftRef>
    <div class="page-home page-master">
        <div class="d-flex flex-row">
            <div id="erm_tree" class="min-w-350px w-350px">
                <div class="tab-horizone">
                    <ul class="nav nav-tabs nav-tabs-line row">
                        <li class="nav-item col">
                            <a class="nav-link " *ngIf="tabApproval" [class.active]="tabActive == STATUS_ACTIVE.CARD"
                                data-toggle="tab" href="#gift_1" (click)="changeOptionStatus(STATUS_ACTIVE.CARD)">
                                <span class="nav-text">{{functionID == functionName.Share ?
                                    'Nhận chia sẻ':"Phiếu"}}</span>
                            </a>
                        </li>
                        <li class="nav-item col" *ngIf="tabApproval">
                            <a class="nav-link" [class.active]="tabActive == STATUS_ACTIVE.APPROVER" data-toggle="tab"
                                href="#gift_3" (click)="changeOptionStatus(STATUS_ACTIVE.APPROVER)">
                                <span class="nav-text">
                                    <codx-label formName="" name="lblApprove" default="Xét duyệt"></codx-label>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="gift_1" role="tabpanel">
                        </div>
                        <div class="tab-pane fade" id="gift_2" role="tabpanel">
                        </div>
                        <div class="tab-pane fade" id="gift_3" role="tabpanel">
                        </div>
    
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="offcanvas-overlay"></div>
</ng-template>

<ng-template #itemTemplate let-data>
    <div (click)="selectedItem(data)">
        <codx-temp-full 
        [dataItem]="data"
        [typeMF]="'hover'" 
        [formModel]="codxViews.formModel"
        imgCss="me-2"
        cardCss="card-template border-bottom px-2 py-3" 
        [title]="data.senderName"
        [date]="data.createdOn"
        [bookmark]="false">
    </codx-temp-full>
    </div>
</ng-template>


<ng-template #panelRightRef>
    <ng-container *ngIf="itemSelected">
        <lib-view-detail-cards [itemSelected]="itemSelected" [cardType]="itemSelected.cardType"></lib-view-detail-cards>
    </ng-container>
</ng-template>