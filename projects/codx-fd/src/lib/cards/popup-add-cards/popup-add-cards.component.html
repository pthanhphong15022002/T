<codx-form [dialog]="dialog" [body]="body" [subHeader]="subheader"></codx-form>
<ng-template #subheader>
    <div class="offcanvas-header mx-4 d-flex align-items-center justify-content-between w-100" kt-hidden-height="46">
        <div class="">
            <h2 class="m-0"> {{title}}</h2>
        </div>
        <div class="btn-extand mt-2 d-flex justify-content-end">
            <a class="text-dark-75 text-hover-primary d-flex align-items-center">
                <span class="mr-2 text-dark">
                    <codx-label formName="" name="lblExtend" default="Mở rộng"></codx-label>
                </span>
                <span class="icon-login icon-20 ml-1"></span>
            </a>
        </div>
    </div>
</ng-template>
<ng-template #body>
    <div class="p-4">
        <div id="FormEdit" class="offcanvas offcanvas-md offcanvas-right">
            <div class="offcanvas-content">
                <div class="row">
                    <div class="offcanvas-content">
                        <div class="w-100 edit-info">
                            <div class="offcanvas-wrapper">
                                <div class="content d-flex flex-column flex-column-fluid py-0">
                                    <div class="extend-main">
                                        <ng-container *ngIf="cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share">
                                            <div class="form-group">
                                                <codx-label fiedName="Receiver" formName="" name="lblfReciver" default="Người nhận quà">
                                                </codx-label>
                                                <codx-input 
                                                    type="combobox"
                                                    class=" form-control borderless p-0"
                                                    [crrValue]="form.value.receiver"
                                                    [loadFull]="true"
                                                    ngDefaultControl
                                                    field="receiver"
                                                    #comboboxUserReciver
                                                    (valueChange)="valueChange($event,comboboxUserReciver)"
                                                    refValue="Users"
                                                    service="SYS"
                                                ></codx-input>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="refValue != '' && cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share && cardType != CARDTYPE_EMNUM.Radio">
                                            <div class="form-group">
                                                <codx-label fiedName="Behavior" formName="" name="lblfBehavior" default="Qui tắc ứng xử" >
                                                </codx-label>
                                                <codx-input type="combobox" name="combobox" 
                                                    class=" form-control borderless p-0"
                                                    [crrValue]="form.value.behavior"
                                                    field="behavior"
                                                    #comboboxBehavior
                                                    ngDefaultControl [refValue]="refValue"
                                                    (valueChange)="valueChange($event,comboboxBehavior)"
                                                    loadFull="true"
                                                ></codx-input>
                                        </div>
                                        </ng-container>
                                        <ng-container *ngIf="cardType == CARDTYPE_EMNUM.SuggestionImprovement || cardType == CARDTYPE_EMNUM.Share">
                                            <div class="form-group">
                                                <codx-label fiedName="Industry" formName="" name="lblfIndustry" default="Lĩnh vực"></codx-label>
                                                <codx-input type="combobox" name="combobox" 
                                                    [class]="'mt-2'"
                                                    field="industry"
                                                    #industry
                                                    [crrValue]="form.value.industry"
                                                    ngDefaultControl  [refValue]="'Industries'" service="BS" 
                                                    (valueChange)="valueChange($event,industry)"
                                                    [loadFull]="true">
                                                </codx-input>
                                            </div>
                                            <div class="form-group">
                                                <codx-label name="lblOwner" formName="" name="lblfOwner" default="Người nhận phiếu">
                                                </codx-label>
                                                <div class="mt-2">
                                                    <div class="d-flex align-items-center">
                                                        <codx-img class="symbol symbol-35 symbol-circle mr-3"
                                                        [objectId]="userReciver" objectType="AD_Users">
                                                        </codx-img>
                                                        <div class="ms-3 text-dark font-size-lg">{{userReciverName}}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <div class=" form-group" #situation>
                                                <codx-label fiedName="Situation" formName="" name="lblfStuation" default="Nội dung gửi">
                                                </codx-label>
                                            <codx-input class="form-control p-0"
                                                type="textarea"
                                                [crrValue]="form.value.situation"
                                                field="situation"
                                                #inputContents
                                                (valueChange)="valueChange($event,inputContents)"
                                                placeholder="" ngDefaultControl>
                                            </codx-input>
                                        </div>
                                        <ng-container *ngIf="cardType == CARDTYPE_EMNUM.Thankyou ||  cardType == CARDTYPE_EMNUM.CommentForChange">
                                            <div class="checkbox-inline mb-3 check-1 d-flex">
                                                <div class="me-3" *ngFor="let item of vllData">
                                                    <codx-input class="rounded-circle mr-1i"  
                                                        [crrValue]="item.value"
                                                        [label]="item.text" type="radio"
                                                        field="rating"
                                                        #checkboxRating
                                                        name="radio"
                                                        (valueChange)="valueChange(item.value, checkboxRating)" ngDefaultControl>
                                                    </codx-input>
                                                </div>
                                                
                                            </div>
                                        </ng-container>
                                        
                                        <ng-container *ngIf="cardType != CARDTYPE_EMNUM.Radio">
                                            <div class="form-group" >
                                                <div class="d-flex align-items-center justify-content-between mt-4">
                                                        <codx-label name="share" formName="" name="lblfShare" default="Chia sẻ đến"></codx-label>
                                                    <a class="btn btn-icon btn-xs btn-light-primary" (click)="openFormShare(controlShare)">
                                                        <span class="icon-person_add_alt_1 icon-18"></span>
                                                    </a>
                                                </div>
                                                <div class="{{lstUser.length <= 0 ? '' : 'user-mini-group'}}">
                                                    <div class="user-mini-item" *ngFor="let item of lstUser; index as i;">
                                                        <div class="d-flex align-items-center">
                                                            <div class="symbol symbol-30 symbol-circle mr-2">
                                                                <ng-container *ngIf="item.objectID == null || item.objectID == '';else elsethenAvatar1">
                                                                    <div>
                                                                        <img class="symbol symbol-30 symbol-circle"
                                                                            src="../../../assets/demos/user/user-admin.svg">
                                                                    </div>
                                                                </ng-container>
                                                                <ng-template #elsethenAvatar1>
                                                                    <div>
                                                                        <codx-img class="symbol symbol-30 symbol-circle" [objectId]="item.objectID" objectType="AD_Users">
                                                                        </codx-img>
                                                                    </div>
                                                                </ng-template>
                                                            </div>
                                                            <div class="text-dark-75">{{item.objectName}}</div>
                                                            <span class="icon-close icon-16 ml-2 text-danger" (click)="removeUser(item)"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="cardType != CARDTYPE_EMNUM.SuggestionImprovement && cardType != CARDTYPE_EMNUM.Share && cardType != CARDTYPE_EMNUM.Radio">
                                            <div class="d-flex align-items-center justify-content-between mt-4 mb-3">
                                                <div class="text-dark font-weight-bold">
                                                    <codx-label formName="" name="lblfSelectCard" default="Chọn thiệp:"></codx-label>
                                                </div>
                                                <div class="text-right text-primary text-italic pr-2">
                                                <a class="text-right text-primary text-italic pr-2" (click)="open(cardDisplay)">
                                                    <codx-label formName="" name="lblViewCard" default="Xem trước"></codx-label>
                                                </a>
                                            </div>
                                            </div>
                                            <div class="card-slider d-flex align-items-center mt-6 w-100">
                                                <ngb-carousel #carousel [wrap]="false" [interval]="0" [keyboard]="false" [pauseOnHover]="false" [showNavigationArrows]="showNavigationArrows" [showNavigationIndicators]="false">
                                                    <ng-container  *ngFor="let item of lstCard; let i = index;">
                                                        <ng-template ngbSlide *ngIf="i * 4 < lstCard.length">
                                                            <div class="d-flex">
                                                                <ng-container *ngFor="let itemChild of lstCard; let idxChild = index;">
                                                                    <ng-container *ngIf="idxChild >= (i * 4) && idxChild < (i + 1 * 4)">
                                                                        <ng-container *ngIf="!itemChild.backgroundColor;else haveBackGround" >
                                                                            <div [class.item-card]="form.value.pattern == itemChild.patternID" class=" mx-5 radio-box d-flex justify-content-between align-items-center item-card-gift h-120px w-80px border ">
                                                                                <codx-img
                                                                                    class=" h-120px w-80px border-radius-large"
                                                                                    [objectId]="itemChild.patternID" [funcId]="funcID"
                                                                                    objectType="FD_Patterns" [width]="164"
                                                                                    (click)="selectCard(itemChild,element)" #element>
                                                                                </codx-img>
                                                                            </div>
                                                                        </ng-container>
                                                                        <ng-template #haveBackGround>
                                                                            <div class="mx-5 radio-box d-flex justify-content-between align-items-center item-card-gift"
                                                                                [style.background-color]="itemChild.backgroundColor"
                                                                                style="height: 120px; width: 80px;"
                                                                                (click)="selectCard(itemChild,element)" #element
                                                                                [class.item-card]="form.value.pattern == itemChild.patternID">
                                                                            </div>
                                                                        </ng-template>
                                                                    </ng-container>
                                                                </ng-container>
                                                            </div>
                                                        </ng-template>
                                                    </ng-container>
                                                </ngb-carousel>
                                            </div>
                                        </ng-container>
    
                                        <ng-container *ngIf="parameter">
                                            <ng-container *ngIf="parameter.HasGifts == '1' ">
                                                <div class="form-group mt-6">
                                                    <codx-label fiedName="ItemID" formName="" name="lblfGift" default="Quà tặng"></codx-label>
                                                    <!-- <codx-input service="FD" type="combobox" name="combobox"
                                                        class=" form-control borderless p-0" placeholder="{{'Tên quà tặng' | lang:
                                                        'Gift':'tblGiftName' | async}}" ngDefaultControl refValue="FDGifts"
                                                        loadFull="false" #gift field="giftID" [crrValue]="itemIDNew"
                                                        (valueChange)="valueChange($event,gift.field)"></codx-input> -->
                                                        <codx-combobox service="FD" name="combobox"
                                                        class=" form-control borderless p-0" placeholder="{{'Tên quà tặng' | lang:
                                                        'Gift':'tblGiftName' | async}}" ngDefaultControl refValue="FDGifts"
                                                        loadFull="false" #gift field="giftID" [value]="itemIDNew"
                                                        (valueChange)="valueChange($event, gift)">
                                                        </codx-combobox>
                                                </div>
                                                <div class="d-flex form-group row mt-3">
                                                    <div class="col-lg-6 col-md-6" >
                                                        <codx-label name="Quantity" formName="" name="lblfNumber" default="Số lượng"></codx-label>
                                                        <codx-input type="number" [min]="0" class="form-control"
                                                            [crrValue]="form.value.quanlity" field="quantity" #fquantity
                                                            ngDefaultControl (valueChange)="valueChange($event,fquantity)">
                                                        </codx-input>
                                                    </div>
                                                    <div class="col-lg-6 col-md-6" #TotalPrice>
                                                        <codx-label formName="" name="lblfTotalPrice" default="Tổng xu"></codx-label>
                                                        <codx-input class="form-control" type="text" placeholder="{{'Tổng xu' | lang:
                                                        'Gift':'TotalPrice' | async}}" [crrValue]="totalCoint" [disabled]="true">
                                                        </codx-input>
                                                    </div>
                                                </div>
                                                
                                            </ng-container>
                                            <ng-container *ngIf="parameter.HasPoints == '1'">
                                                <div class="row border border-primary rounded ms-1">
                                                    <div class="col-6 bg-primary text-white d-flex align-items-center justify-content-center">
                                                        <codx-label formName="" name="lblfGivePrice" default="Tặng xu"></codx-label>
                                                    </div>
                                                    <div class="col-6 d-flex justify-content-evenly align-items-center ">
                                                        <button class="btn bg-transparent" type="button" (click)="subPoint()">
                                                            <span class="icon-remove icon-18"></span>
                                                        </button>
                                                        <input type="text" min="1" class="text-center" [value]="givePrice" readonly style="outline: none; border: none;"/>
                                                        <button class="btn bg-transparent" type="button" (click)="addPoint()">
                                                            <span  class="icon-add icon-18 "></span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="offcanvas-footer mt-10">
                        <div class="d-flex align-items-center justify-content-end">
                            <button type="button"class="btn btn-primary" (click)="Save()"><codx-label formName="" name="lblSave" default="Lưu"  ></codx-label></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #cardDisplay>
    
</ng-template>
<ng-template #controlShare let-dialog>
    <codx-share [dialog]="dialog" 
    [multiple]="false" 
    listName="WP001" 
    (eventApply)="eventApply($event)">
    </codx-share>
</ng-template>
