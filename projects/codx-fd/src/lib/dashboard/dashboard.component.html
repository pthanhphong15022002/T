
<ng-template #panelContent>
    <div class="page-home" [style]="'margin-top:50px'">
        <div class="d-flex flex-column-fluid" id="erm_content">
            <div class="container p-0">
                <div class="d-flex">
                    <div class="w-100 pr-6 home-center pt-5 pl-6">
                        <codx-listview [itemTemplate]="tmpPortal" #listview funcId="FDT01" [pageSize]="10"
                            service="WP" assemblyName="ERM.Business.WP" className="CommentsBusiness" 
                            [predicate]="predicate" 
                            [dataValue]="dataValue"
                            method="GetListFeedBackAsync" entityName="WP_Comments">
                        </codx-listview>
                    </div>
                    <div class="home-right pt-5 pr-2">
                        <div class="card-box border-bottom mb-6">
                            <div class="box-header d-flex justify-content-between align-items-center mb-4">
                                <h4 class="box-title">
                                    <codx-label name="lblFeedbackMessage" default="Thông điệp phản hồi" formName="">
                                    </codx-label>
                                </h4>
                            </div>
                            <div class="box-body">
                                <div class="thongdiep-group px-5">
                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="text-dark fw-bolder">
                                            <codx-label formName="" name="lblCommendation" default="Tuyên dương"></codx-label>
                                        </div>
                                        <div class="d-flex w-100px justify-content-end">
                                            <div class="d-flex align-items-center mr-6">
                                                <span class="text-dark mr-2">{{ reciver['1'] ?? 0}}</span>
                                                <span class="icon-doc_in icon-18 text-primary"></span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span class="text-dark mr-2">{{sender['1'] ?? 0}}</span>
                                                <span class="icon-doc_out icon-16 text-warning"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="text-dark fw-bolder">
                                            <codx-label formName="" name="lblThankYouNot" default="Lời cảm ơn"></codx-label>
                                        </div>
                                        <div class="d-flex w-100px justify-content-end">
                                            <div class="d-flex align-items-center mr-6">
                                                <span class="text-dark mr-2">{{ reciver['2'] ?? 0}}</span>
                                                <span class="icon-doc_in icon-18 text-primary"></span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span class="text-dark mr-2">{{sender['2'] ?? 0}}</span>
                                                <span class="icon-doc_out icon-16 text-warning"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="text-dark fw-bolder">
                                            <codx-label formName="lblCommentForChange" name="" default="Góp ý thay đổi"></codx-label>
                                        </div>
                                        <div class="d-flex w-100px justify-content-end">
                                            <div class="d-flex align-items-center mr-6">
                                                <span class="text-dark mr-2">{{ reciver['3'] ?? 0}}</span>
                                                <span class="icon-doc_in icon-18 text-primary"></span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span class="text-dark mr-2">{{sender['3'] ?? 0}}</span>
                                                <span class="icon-doc_out icon-16 text-warning"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="text-dark fw-bolder">
                                            <codx-label formName="" name="lblImprovement" default="Đề xuất cải tiến"></codx-label>
                                        </div>
                                        <div class="d-flex w-100px justify-content-end">
                                            <div class="d-flex align-items-center mr-6">
                                                <span class="text-dark mr-2">{{ reciver['4'] ?? 0}}</span>
                                                <span class="icon-doc_in icon-18 text-primary"></span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span class="text-dark mr-2">{{sender['4'] ?? 0}}</span>
                                                <span class="icon-doc_out icon-16 text-warning"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-box mt-6">
                            <div class="box-header d-flex align-items-center justify-content-between mb-5">
                                <h4 class="box-title mb-0">
                                    <codx-label name="lblEmpWalletHistory" default="Giao dịch phát sinh gần nhất" formName="FD">
                                    </codx-label>
                                </h4>
                            </div>
                            <div class="box-body">
                                <div class="history-box">
                                    <codx-listview [itemTemplate]="templateItemCoin" #listviewCoins [pageSize]=12
                                        service="FD" assemblyName="ERM.Business.FD" className="KudosTransBusiness"
                                        method="HistoryWalletAsync" [predicate]="predicateCoins"
                                        [dataValue]="dataValueCoins" entityName="FD_KudosTrans" height="300"
                                        [itemTemplateLoading]="templateloading">
                                    </codx-listview>
    
                                    <ng-template #templateItemCoin let-item>
                                        <div class="d-flex align-items-start wallet-item me-2" (click)="clickShowItem(item)">
                                            <div class="me-3 max-h-40">
                                                <img class="w-40px"
                                                    src="../../../assets/demos/svg/{{item.transType | avatarCard:item.cardType }}">
                                            </div>
                                            <div class="d-flex flex-column flex-grow-1">
                                                <div class="text-dark fw-bolder">{{item?.userName}}</div>
                                                <div class="text-dark-75 font-size-sm">{{item?.cardType|
                                                    vll:'L1422':'text'|async}}</div>
                                                <div class="text-muted font-size-sm">{{item?.createdOn | fmDT:'dmy'}}</div>
                                            </div>
                                            <div class="d-flex align-items-center text-center">
                                                <ng-container *ngIf="item.transType =='4';else elsTmp">
                                                    <span
                                                        [ngClass]="item?.coCoins > 0 ? 'text-success':'text-danger'">{{item?.coCoins
                                                        > 0?"+":""}}{{item?.coCoins}}
                                                    </span>
                                                    <span [ngClass]="item?.coCoins > 0 ? 'text-success ml-1':'text-danger ml-1'">
                                                        <codx-label formName="" name="lblCoins" default="xu"></codx-label>
                                                    </span>
                                                </ng-container>
                                                <ng-template #elsTmp>
                                                    <span [ngClass]="item?.coins > 0 ? 'text-success':'text-danger'">{{item?.coins
                                                        > 0?"+":""}}{{item?.coins}}
                                                    </span>
                                                    <span
                                                        [ngClass]="item?.coins > 0 ? 'text-success ml-1':'text-danger ml-1'">
                                                        <codx-label formName="" name="lblCoins" default="xu"></codx-label>
                                                    </span>
                                                </ng-template>
                                            </div>
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #tmpPortal let-item>
    <div class="row" (click)="clickShowItem(item)">
        <div class="d-flex align-items-center" >
            <div class="symbol symbol-40 symbol-circle mr-3">
                <codx-img [objectId]="item.createdBy" objectType="AD_Users" [width]="40"
                    class="symbol symbol-40 symbol-circle">
                </codx-img>
            </div>
            <div class="d-flex flex-column flex-grow-1">
                <div class="d-flex align-items-center mb-1 ms-2">
                    <span class="text-dark-75 font-size-h6 fw-bolder">{{item.createdName}}</span>
                    <span class="label label-inline label-light-primary ms-2" *ngIf="item.tag > 0">
                        <img class="mr-2 w-13px" src="../../../../assets/img/fed/user-tag.png" />
                        <span class="text-primary" (click)="showWith(item.id,'3')"> {{item.tag}}</span>
                    </span>
                </div>
                <div class="text-info-date">
                    <span class="text-muted font-size-sm">{{item.createdOn | timefrom}}</span>
                    <span class="label label-xxs label-inline label-light-primary ms-2">{{item.shareControl |
                        sharedControl:'wp' | async}}</span>
                    <span class="mr-2 text-primary text-underline" (click)="item.shared > 1 ? showWith(item.id,'2') : false"
                        href="javascript:void(0)" *ngIf="item.tmp">
                        <ng-container *ngIf="item.shared -1 > 0; else elseDisplay">
                            <codx-label formName="" name="lblWiths" default="cùng với ">
                                <span>{{item.tmp}}</span>
                            </codx-label>
                            <codx-label formName="" name="lblAnd" default="và">
                                <span>{{item.shared}}</span>
                            </codx-label>    
                            <codx-label formName="" name="lblPeople" default="người khác"></codx-label>
                        </ng-container>
                        <ng-template #elseDisplay>
                            <codx-label formName="" name="lblWiths" default="cùng với">
                                <span>{{item.tmp}}</span>
                            </codx-label> 
                        </ng-template>
                    </span>
                </div>
            </div>
            <div class="more">
                <div class="dropdown dropdown-inline" data-toggle="tooltip" title="" data-placement="left">
                    <a href="javascript:void(0)" class="btn btn-clean btn-hover-light-primary btn-sm btn-icon"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-h"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                        <ul class="navi navi-hover">
                            <li class="navi-item" *ngIf="user.userID == item.createdBy">
                                <a href="javascript:void(0)" class="navi-link" (click)="removePost(item)">
                                    <span class="navi-text">
                                        <codx-label formName="" name="lblDeletedPost" default="Xóa bài viết"></codx-label>
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row p-4">
            <div [innerHTML]="item.content"></div>
        </div>
        <div class="pt-4 card d-flex justify-content-center align-items-center">
            <ng-container *ngIf="item.card.cardType == '4' || item.card.cardType=='5';else haveBg">
                <div class="p-0 m-0">
                    <read-more [content]="item.content" [textColor]="item.card.pattern.textColor"
                        [maxmimun]="1003" [limit]="1000" [completeWords]="true">
                    </read-more>
                </div>
            </ng-container>
            <ng-template #haveBg>
                <div class="card-img w-300px h-450px"
                    [style.background]="item.card.background| backgroundImage:item.card?.backgroundColor"
                    style="background-size: 100% auto;">
                    <!--begin::Body-->
                    <div class="card-body text-center">
                        <div color="bg-transparent" class="text-center">
                            <h2 class="fw-bolderer mb-6 mt-3" [ngStyle]="{'color':item.card.pattern.headerColor}">
                                {{item.card?.cardType | vll:'L1422':'text' | async}}
                            </h2>
                        </div>
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="symbol symbol-40 symbol-circle" *ngIf="item.card">
                                <codx-img class="symbol symbol-40 symbol-circle" [width]="40"
                                    [objectId]=" item.card.senderID" objectType="AD_Users">
                                </codx-img>
                            </div>
                            <div style="width: 50px;" class="mar-auto text-center ion-justify-content-between">
                                <img src="../../../../assets/themes/fd/default/img/img_SendCard.svg" class="mt-4 icon-32"/>
                            </div>
                            <div class="symbol symbol-40 symbol-circle " *ngIf="item.card.receiverID">
                                <codx-img class="symbol symbol-40 symbol-circle" [width]="40"
                                    [objectId]=" item.card.receiverID" objectType="AD_Users">
                                </codx-img>
                            </div>
                        </div>
                        <div class="text-dark text-feed mt-6">
                            <read-more #readmore2 [content]="item.card.situation"
                                [textColor]="item.card.pattern.textColor" [limit]="800" [completeWords]="true"
                                (click)="showContent(readmore2)">
                            </read-more>
                        </div>
                        <div class="d-flex align-items-center group-hasGift mt-6">
    
                            <div class="d-flex align-items-center ion-wrap mr-2"
                                *ngIf="item?.card?.cardType=='2' || item.card.cardType =='3'">
                                <div class=" symbol symbol-30 mr-2">
                                    <img class="w-100" src="../../../../assets/demos/card/rating/{{ item.card.rating | vll:item.card.cardType=='2' ?'L1419':'L1424':'icon'| async}}" />
                                </div>
                            </div>
                            <ng-container *ngIf="item.card.hasGift || item.card.hasPoint">
                                <div class="d-flex align-items-center ion-wrap mar-auto">
                                    <img src="../../../../assets/img/feedback/gift 1.png" *ngIf="item.card.hasGift"
                                        class="symbol-image icon-surface1 mr-1" />
                                    <img src="../../../../assets/img/feedback/money-1.png" *ngIf="item.card.hasPoint"
                                        class="symbol-image icon-money-1" />
                                </div>
                            </ng-container>
                        </div>
                    </div>
                    <!--end::Body-->
                </div>
            </ng-template>
        </div>
        <div class="row">
            <!-- <treeview-comment [rootData]="item"></treeview-comment> -->
            <treeview-comment 
                [funcID]="codxViews.formModel.funcID" 
                [fromModel]="codxViews.formModel"
                [objectType]="'WP_Comments'" 
                [dataComment]="item">
            </treeview-comment>
        </div>
    </div>
</ng-template>

<ng-template #empty>
    <div class="text-center">
        <img style="max-width:700px" src="../../../../assets/img/EmptyDataPortal.png" />
    </div>
</ng-template>
<ng-template #templateloading let-data>
    <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
    <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
    <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
</ng-template>

<codx-views #codxViews
[views]="views"
entityName="WP_Comments"
[idField]="'recID'"
[button]="buttonAdd"
(buttonClick)="clickShowPupopAdd($event)">
</codx-views>