<codx-views #view [funcID]="funcID" service="FD" entityName="FD_KudosTrans" [showToolBar]="false" [views]="views"
  [autoLoad]="false">
</codx-views>

<ng-template #templateLeft>
  <div class="page-home page-master">
    <div class="d-flex flex-row w-100">
      <div class="d-flex flex-column w-100" id="erm_content">
        <div class="container d-flex pb-0">
          <div class="w-100 pr-9 mt-3">
            <div class="d-flex align-items-top">
              <div class="mr-3 w-150px">
                <div class="d-flex flex-column" #ToDate>
                  <codx-label name="lblToDate" formName="FD_KudosTrans" default="Đến ngày" class="font-weight-bold">
                  </codx-label>
                  <codx-input type="datetime" format="d" class="form-control" [crrValue]="toDate" field="toDate"
                    ngDefaultControl (valueChange)="valueChange($event)">
                  </codx-input>
                </div>
              </div>
              <div class="mr-3 left-5">
                <div class="d-flex flex-column" #Organize>
                  <codx-label name="lblOrganize" formName="FD_KudosTrans" default="Cơ cấu tổ chức"
                    class="font-weight-bold"></codx-label>
                  <div class="d-flex header-combo">
                    <codx-input class="form-control mr-2" type="valuelist" field="vllOrganize" refValue="L1483"
                      (valueChange)="valueChange($event)">
                    </codx-input>
                    <div class="organize left-5">
                      <codx-input class="form-control" type="combobox" field="Organize" [refValue]="comboboxName"
                        (valueChange)="valueChange($event)">
                      </codx-input>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mr-3 w-200px left-5">
                <div class="d-flex flex-column" #Employee>
                  <codx-label name="lblEmployee" formName="FD_KudosTrans" default="Nhân viên" class="font-weight-bold">
                  </codx-label>
                  <codx-input class="form-control" type="combobox" field="Employee" refValue="Employees"
                    (valueChange)="valueChange($event)">
                  </codx-input>
                </div>
              </div>
            </div>
            <div class="d-flex align-items-center mt-3 mb-3 chart-circle">
              <div class="d-flex mr-9 pd-r-30" *ngFor="let item of chartLabels; let i = index">
                <span class="square-status" [style.background-color]="colors[0].backgroundColor[i]"></span>
                <span class="text-dark-75 ml-2 left-5">{{ item ? item : '...' }}</span>
              </div>
            </div>
            <div class="row">
              <div class="col-4" *ngFor="let item of lstDataChart">
                <!-- <canvas baseChart [plugins]="item.plugin" [data]="
                  item.chartDatas.length > 0
                    ? item.chartDatas
                    : chartDatas_empty
                " [options]="optionsChart" [labels]="
                  item.chartDatas.length > 0 ? chartLabels : labels_empty
                " [chartType]="chartType" [colors]="item.chartDatas.length > 0 ? colors : colors_empty">
              </canvas> -->
              </div>
            </div>
            <div class="mt-6">
              <div class="box-wallets">
                <div class="text-dark font-size-h4">
                  <codx-label name="lbl" formName="FD_KudosTrans" default="Bảng thành tích theo bộ phận" class="font-weight-bold"></codx-label>
                </div>

                <!-- <span class="icon-open_in_new icon-20 ml-2"></span> -->

                <div class="d-flex align-items-center mt-3">
                  <div class="d-flex mr-9 pd-r-30" *ngFor="let item of dataProcess">
                    <span class="square-status" [style.background-color]="item.color"></span>
                    <span class="text-dark-75 ml-2 left-5">{{item.breakName}}</span>
                  </div>
                </div>
                <hr class="gray">
                <div class="list-table list-achiev mt-4">
                  <table class="table">
                    <tbody>
                      <tr *ngFor="let item of dataTable">
                        <td>
                          {{item.name}}
                        </td>
                        <td>
                          <div style="height: 30px; width: 100px;">
                            <!-- <canvas baseChart
                            [plugins]="setValueChartTable((dicEmployeeByOrg ? dicEmployeeByOrg[item.id]:''))"
                            [data]="chartDatas_empty" [options]="optionsChart" [labels]="labels_empty"
                            [chartType]="chartType" [colors]="colors_empty">
                          </canvas> -->
                          </div>
                        </td>
                        <td *ngFor="let itemline of dataProcess; let i = index">
                          <div class="d-flex flex-column">
                            <div class="d-flex justify-content-center">
                              <span>
                                <img alt="Pic" src="../../../../../src/assets/Icons_Final/{{itemline.image}}"
                                  *ngIf="itemline.image; else imageviewer" />
                                <ng-template #imageviewer>
                                  <codx-img [objectId]="itemline.recID" objectType="BS_RangeLines" funcId="FED2044">
                                  </codx-img>
                                </ng-template>

                              </span>
                              <span
                                class="text-dark font-size-h4 font-weight-bold ml-1">{{item.dicLine[itemline.breakName].countEmp}}</span>
                            </div>
                            <div class="symbol-group symbol-hover mt-1 justify-content-center">
                              <ng-container
                                *ngFor="let itemid of item.dicLine[itemline.breakName].lstEmployee; let i = index">
                                <div class="" *ngIf="i < 3">
                                  <codx-img class="symbol symbol-24 symbol-circle" [objectId]="itemid"
                                    objectType="AD_Users">
                                  </codx-img>
                                </div>
                              </ng-container>
                              <div class="symbol symbol-24 symbol-circle symbol-light"
                                *ngIf="item.dicLine[itemline.breakName].countEmp > 3">
                                <span class="symbol-label font-weight-bold">+{{item.dicLine[itemline.breakName].countEmp
                                  -
                                  3}}</span>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="min-w-400px w-400px pl-3">
            <div class="master-more">
              <div class="d-flex align-items-top mt-3 top-champion" *ngIf="reloadTop && lstRate">
                <div class="top-item top2">
                  <div class="top-pic w-100">
                    <div class="">
                      <codx-img [objectId]="lstRate[1]?.userID" [objectName]="lstRate[1]?.employeeName"
                        objectType="AD_Users" width="40">
                      </codx-img>
                    </div>
                  </div>
                  <div class="top-name w-100 text-center">
                    <div class="text-dark font-size-sm font-weight-bold">
                      {{ lstRate[1]?.employeeName }}
                    </div>
                    <div class="text-dark-50">{{ lstRate[1]?.totalCoreEmp }}</div>
                  </div>
                </div>
                <div class="top-item top1">
                  <div class="top-pic w-100">
                    <div class="">
                      <codx-img [objectId]="lstRate[0]?.userID" [objectName]="lstRate[0]?.employeeName"
                        objectType="AD_Users" width="50">
                      </codx-img>
                    </div>
                  </div>
                  <div class="top-name w-100 text-center">
                    <div class="text-dark font-size-sm font-weight-bold">
                      {{ lstRate[0]?.employeeName }}
                    </div>
                    <div class="text-dark-50">{{ lstRate[0]?.totalCoreEmp }}</div>
                  </div>
                </div>
                <div class="top-item top3">
                  <div class="top-pic w-100">
                    <div class="">
                      <codx-img [objectId]="lstRate[2]?.userID" [objectName]="lstRate[2]?.employeeName"
                        objectType="AD_Users" width="40">
                      </codx-img>
                    </div>
                  </div>
                  <div class="top-name w-100 text-center">
                    <div class="text-dark font-size-sm font-weight-bold">
                      {{ lstRate[2]?.employeeName }}
                    </div>
                    <div class="text-dark-50">{{ lstRate[2]?.totalCoreEmp }}</div>
                  </div>
                </div>
              </div>
              <div class="process-performance" style="display: flex">
                <div class="bg-platinum"></div>
                <div class="process-item" *ngFor="let item of dataProcess; let i = index">
                  <div class="process-bar" [style.background-color]="dataProcess[i + 1]?.color"
                    [style.width]="item.width + '%'"></div>
                  <div class="process-value" [style.width]="item.width + '%'">
                    <div class="text-dark font-size-sm"> <span style="cursor: pointer;"
                        (click)="ReloadListByRank(item?.breakValue, dataProcess[dataProcess.length - 2]?.breakValue)">{{
                        item?.breakName
                        }}</span></div>
                    <div class="text-muted"><span style="cursor: pointer;"
                        (click)="ReloadListByRank(item?.breakValue, dataProcess[dataProcess.length - 2]?.breakValue)">{{
                        item?.breakValue
                        }}</span></div>
                  </div>
                  <div class="process-number" [style.width]="item.width + '%'">
                    <span style="cursor: pointer;"
                      (click)="ReloadListByRank(item?.breakValue, dataProcess[dataProcess.length - 2]?.breakValue)">{{
                      item?.countEmp
                      }}</span>
                  </div>
                </div>
              </div>
              <div class="list-performance">
                <codx-listview #listview service="FD" assemblyName="ERM.Business.FD"
                  className="KudosTransBusiness" method="GetDataAchievementAsync" [predicate]="options.predicate"
                  [dataValue]="options.dataValue" entityName="FD_KudosTrans" [itemTemplate]="TemplateList"
                  [height]="heightList">
                </codx-listview>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>


<ng-template #TemplateList let-item>
  <div class="d-flex align-items-center user-card list-item mb-3">
    <div class="symbol symbol-40 symbol-circle with-number mr-4">
      <codx-img class="symbol symbol-40 symbol-circle mr-2" [objectId]="item?.userID" [objectName]="item?.employeeName"
        objectType="AD_Users">
      </codx-img>
      <span class="list-number top-premium">{{ item?.rate }}</span>
    </div>
    <div class="d-flex flex-column flex-grow-1 left-15">
      <div class="text-dark font-weight-bold">
        {{ item?.employeeName }}
      </div>
      <div class="text-dark-50">{{ item?.orgUnitName }}</div>
    </div>
    <div class="d-flex flex-column pr-3">
      <span class="label label-inline label-light-primary">{{
        item.textRate
        }}</span>
      <div class="text-dark font-size-h4 text-right font-weight-bold mt-1">
        {{ item?.totalCoreEmp }}
      </div>
    </div>
  </div>
</ng-template>