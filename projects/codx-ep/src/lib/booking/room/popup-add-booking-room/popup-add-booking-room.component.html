<codx-layout-add
  #form
  [title]="title"
  [tabInfo]="tabInfo"
  [formModel]="dialogRef.formModel"
  [subHeader]=""
  [footer]="footer"
  [dialog]="dialogRef"
  [openMore]="false"
  (buttonClick)="buttonClick($event)"
  [tabContent]="[tabGeneralInfo, tabPeopleInfo, tabStationery, tabMoreInfo]"
  (setTitle)="setTitle($event)"
  [data]="data"

>
  <ng-template #tabGeneralInfo>
    <div id="GeneralInfo">
      <codx-label
        class="mb-3 fs-5 fw-bold"
        name="lblGeneralInfo"
        default="Thông tin chung"
      >
      </codx-label>
    </div>
    <div class="form-group mb-2">
      <div class="d-flex justify-content-between align-items-center">
        <codx-label
          default="Phòng"
          fieldName="ResourceID"
          [formModel]="form.formModel"
        >
        </codx-label>
        <span class="label-status text-primary">{{
          fGroupAddBookingRoom.value.status
            | vll: CbxName["Status"]:"text"
            | async
        }}</span>
      </div>
      <codx-input
        type="combobox"
        refValue="EP_Rooms"
        ControlName="resourceID"
        [formModel]="form.formModel"   
        [multiple]="false"     
        [Group]="fGroupAddBookingRoom"      
        (valueChange)="valueCbxRoomChange($event)"
      >
      </codx-input>        
    </div>
    <div class="row">
      <div class="d-flex flex-row justify-content-between">
        <div class="d-flex justify-content-start">
          <div
            class="d-flex justify-content-start"
            *ngFor="let item of tmplstDevice"
          >
            <span
              class="d-flex align-items-center me-2"
              [ngClass]="item.isSelected ? 'text-primary' : 'text-muted'"
            >
              <span
                class="me-1 ps-2"
                [ngClass]="[
                  item.isSelected ? 'text-primary' : 'text-muted',
                  item.id == '1'
                    ? 'icon-wifi'
                    : item.id == '2'
                    ? 'icon-personal_video'
                    : item.id == '3'
                    ? 'icon-videocam'
                    : item.id == '4'
                    ? 'icon-video_settings'
                    : ' icon-thermostat'
                ]"
              >
              </span
              >{{ item.text }}
            </span>
          </div>
        </div>
        <span class="text-end" *ngIf="tmplstDevice.length > 0">
          <button
            type="button"
            class="btn btn-clean btn-sm btn-icon btn-icon-md"
            data-dismiss="modal"
            (click)="openPopupDevice(popupDevice)"
          >
            <i
              class="icon-select_all text-primary text-hover-primary-dark icon-24"
            ></i>
          </button>
        </span>
      </div>
    </div>

    <div class="row">
      <div class="col-4 form-group">
        <codx-label
          default="Ngày"
          fiedName="ResourceID"
          [formModel]="form.formModel"
        >
        </codx-label>
        <codx-input
          type="datetime"
          class="form-control test-datetime"
          format="d"
          field="bookingOn"
          [crrValue]="fGroupAddBookingRoom.value.bookingOn"
          (valueChange)="valueDateChange($event)"
        >
        </codx-input>
      </div>
      <div class="col-3 form-group">
        <codx-label
          default="Từ giờ"
          fiedName="StartDate"
          aria-disabled="false"
          [formModel]="dialogRef.formModel"
        >
        </codx-label>
        <codx-input
          type="datetime"
          class="test-datetime"
          field="startTime"
          placeholder="datetime"
          [crrValue]="startTime"
          format="t"
          (valueChange)="valueTimeChange($event)"
        >
        </codx-input>
      </div>
      <div class="col-3 form-group">
        <codx-label
          default="Đến giờ"
          fiedName="EndDate"
          [formModel]="dialogRef.formModel"
        >
        </codx-label>
        <codx-input
          type="datetime"
          class="test-datetime"
          field="endTime"
          placeholder="datetime"
          [crrValue]="endTime"
          format="t"
          (valueChange)="valueTimeChange($event)"
        >
        </codx-input>

      </div>

      <div class="col-2 d-flex flex-column justify-content-center">
        <codx-input
          #checkbox
          type="checkbox"
          label="Cả ngày"
          labelPosition="after"
          field="day"
          class="test-check"
          (valueChange)="valueAllDayChange($event)"
          [checked]="fGroupAddBookingRoom.value.isFullDay"
        >
        </codx-input>
      </div>
    </div>

    <div class="form-group">
      <codx-label
        default="Mục đích sử dụng"
        fiedName="ReasonID"
        [formModel]="dialogRef.formModel"
      >
      </codx-label>
      <!-- <codx-input
        type="combobox"
        refValue="ReasonCodes"
        placeholder="Chọn mục đích"
        ControlName="reasonID"  
        [formModel]="dialogRef.formModel"  
        [Group]="fGroupAddBookingRoom"          
      >
      </codx-input> -->
      <codx-input
        type="combobox"
        refValue="ReasonCodes"
        placeholder="Chọn mục đích"
        [multiple]="false"
        field="reasonID"        
        [crrValue]="fGroupAddBookingRoom.value.reasonID"
        (valueChange)="valueChange($event)"        
      >
      </codx-input>
    </div>

    <div class="form-group">
      <codx-label
        default="Tiêu đề"
        fiedName="Title"
        [formModel]="dialogRef.formModel"
      >
      </codx-label>
      <codx-input
        type="text"
        ControlName="title"
        [formModel]="form.formModel"
        [Group]="fGroupAddBookingRoom"
      ></codx-input>
    </div>

    <div class="d-flex flex-column mb-4">
      <codx-label
        default="Nội dung buổi họp"
        fiedName="Memo"
        [formModel]="form.formModel"
      >
    </codx-label>
      <codx-input        
        type="textarea" format="ed2" rows="3"
        field="memo"
        placeholder="Diễn giải"
        [crrValue]="fGroupAddBookingRoom.value.memo"
        (valueChange)="valueChange($event)"
      >
      </codx-input>
    </div>

    <div class="d-flex flex-column mb-4">
      <div
        class="d-flex justify-content-between align-items-center mb-2"
      >
        <div class="form-switch1">
          <codx-input
            #checkbox
            field="online"
            type="switch"
            [checked]="fGroupAddBookingRoom.value.online"
            labelPosition="After"
            [disabled]="false"
            class="test-switch"
            (valueChange)="valueChange($event)"
          >
          </codx-input>
          <span class="fw-bold ms-2"
            ><label for="switchOnl">
                <codx-label
                  fiedName="Online"
                  default="Họp online"
                  [formModel]="form.formModel"
                >
                </codx-label> 
              </label>
          </span>
        </div>
        <span class="text-end align-items-end">
          <button
            type="button"
            class="btn btn-clean btn-sm btn-icon btn-icon-md"
            (click)="openPopupLink()"
            *ngIf="fGroupAddBookingRoom.value.online"
          >
            <i
              class="icon-insert_link text-primary text-hover-primary-dark icon-24"
            ></i>
          </button>
        </span>
      </div>
      <div class="d-flex align-items-center fw-bold">
        <a href="" *ngIf="fGroupAddBookingRoom.value.online">{{
          fGroupAddBookingRoom.value.onlineUrl
        }}</a>
      </div>
    </div>   
    
    <div class="d-flex flex-column mb-8">
      <div
        class="d-flex justify-content-between align-items-center mb-2 form-group"
      >
        <codx-label default="Người tham dự" fiedName="Note">
        </codx-label>
        <div class="d-flex flex-row text-end align-items-end">
          <span class="mx-2">
            <codx-input
              type="Combobox"
              name="combobox"
              [refValue]="'Users'"
              [multiple]="true"
              [showInput]="false"
              refType="P"
              field="popup"
              (valueChange)="valueCbxUserChange($event)"
            >
            </codx-input>
          </span>
        </div>
      </div>

      <div class="symbol-group symbol-group-check symbol-hover flex-nowrap">     

        <div class="symbol-group"  *ngIf="curUser!=null" >
          <div class="symbol symbol-35px symbol-circle">
            <codx-img
              [objectId]="curUser.id"
              objectName="curUser.text"
              objectType="AD_Users"
            ></codx-img>
            <span class="symbol-badge badge badge-circle bg-primary top-100 start-100 icon-check text-white" ></span>
          </div>
        </div>

        <div class="symbol-group" *ngIf="lstPeople.length >= 1">
          <div class="symbol symbol-35px symbol-circle" >
            <codx-img
              [objectId]="lstPeople[0].id"
              objectName="lstPeople[0].text"
              objectType="AD_Users"
            ></codx-img>
            <span class="symbol-badge badge badge-circle bg-primary top-100 start-100 icon-check text-white"></span>
          </div>
        </div>

        <div class="symbol-group" *ngIf="lstPeople.length >= 2">
          <div class="symbol symbol-35px symbol-circle" >
            <codx-img
              [objectId]="lstPeople[1].id"
              objectName="lstPeople[1].text"
              objectType="AD_Users"
            ></codx-img>
            <span class="symbol-badge badge badge-circle bg-primary top-100 start-100 icon-check text-white"></span>
          </div>          
        </div>

        <div class="symbol-group" *ngIf="lstPeople.length >= 3">
          <span
            class="symbol symbol-35px symbol-circle"
            data-bs-toggle="modal"
            data-bs-target="#kt_modal_view_users"
          >
            <span class="symbol-label bg-light-primary text-primary fs-8 fw-bolder" >+{{ lstPeople.length - 2 }}</span>
          </span>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column mb-4">
      <div class="d-flex justify-content-between align-items-center mb-2 form-group">
        <codx-label
          default="Tài liệu tham khảo"
          fiedName="Attachments"            
          [formModel]="dialogRef.formModel"
        >
        </codx-label>
        <a class="btn btn-sm btn-outline btn-outline-primary btn-active-light-primary d-flex flex-row">
          <span class="icon-cloud_upload btn-text-primary me-2"  (click)="popupUploadFile($event)" ></span>
          <codx-label fiedName="Upload" default="Upload file" [formModel]="dialogRef.formModel"></codx-label>
        </a>
      </div>
      <!--end::Title-->
      <div class="AttachmentFile-group flex-nowrap">
        <!-- <codx-attachment
            #attSignature1
            idBrowse="attSignature1"
            [objectType]="dialogRef.formModel.entityName"
            [objectId]="data.recID"
            hideBtnSave="1"
            hideFolder="1"
            hideUploadBtn="0"
            [functionID]="dialogRef.formModel.funcID"
            (fileAdded)="fileAdded($event)"
            type="inline"
            hideImageUpload="0"
            (fileCount)="fileCount($event)"
            allowMultiFile="0"
          >
          </codx-attachment> -->
          
          <codx-attachment
            #attachment
            [objectType]="'EP_BookingRooms'"
            [functionID]="dialogRef.formModel.funcID"
            [objectId]="data.recID"
            hideBtnSave="1"
            hideFolder="1"
            hideUploadBtn="1"
            hideDes="1"
            hideImageUpload="0"
            hideImageThumb="1"
            [allowMultiFile]="0"
            [idBrowse]="'add'"
            allowExtensions=""
            type="inline" 
            (fileCount)="fileCount($event)"
            (fileAdded)="fileAdded($event)"
          >
          </codx-attachment> 

        <!-- <div class="d-flex align-items-center mb-2">
          <span class="me-4 icon-file-excel"> </span>
          <a href="#" class="text-gray-800 text-hover-primary"
            >Báo cáo doanh số tháng 3 <span>(1MB)</span></a
          >
        </div>
        <div class="d-flex align-items-center mb-2">
          <span class="me-4 icon-file-excel">
          </span>
          <a href="#" class="text-gray-800 text-hover-primary"
            >Báo cáo doanh số tháng 3 <span>(1MB)</span></a  >
        </div> -->
      </div>
    </div>
  </ng-template>

  <ng-template #tabPeopleInfo>
    <div class="d-flex justify-content-between align-items-center mb-2" id="PeopleInfo" >
      <div class="mb-3 fs-5 fw-bold">
        <codx-label name="lblPeopleInfo" default="Người tham dự"> </codx-label>
      </div>
      <div class="d-flex flex-row text-end align-items-end">
        <codx-input
          type="combobox"
          name="combobox"
          [refValue]="'Users'"
          [multiple]="true"
          [showInput]="false"
          refType="P"
          (valueChange)="valueCbxUserChange($event)"
        >
        </codx-input>
      </div>
    </div>
    
    <div class="d-flex align-items-center mb-4" *ngIf="curUser!=null">
      <div class="symbol symbol-35px symbol-circle me-4">
        <codx-img
          [objectId]="curUser.id"
          objectName="curUser.text"
          objectType="AD_Users"
        ></codx-img>
        <span
          class="symbol-badge badge badge-circle bg-primary top-100 start-100 text-white fs-8"
          >P</span
        >
      </div>

      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fs-6 fw-bolder">
          {{ curUser.text }}
        </div>
        <span class="text-muted fw-bold">Người tham dự</span>
      </div>

      <div class="d-flex flex-column justify-content-end">
        <span class="badge badge-light-success fs-7 fw-bold mb-1"
          >Chưa xác định</span
        >
        <span class="text-muted fw-bold text-center"> 1 ngày trước </span>
      </div>
    </div>
    
    <div class="d-flex align-items-center mb-4" *ngFor="let item of lstPeople">
      <div class="symbol symbol-35px symbol-circle me-4">
        <codx-img
          [objectId]="item.id"
          objectName="item.text"
          objectType="AD_Users"
        ></codx-img>
        <span
          class="symbol-badge badge badge-circle bg-primary top-100 start-100 text-white fs-8"
          >P</span
        >
      </div>

      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fs-6 fw-bolder">
          {{ item.text }}
        </div>
        <span class="text-muted fw-bold">Người tham dự</span>
      </div>

      <div class="d-flex flex-column justify-content-end">
        <span class="badge badge-light-success fs-7 fw-bold mb-1"
          >Chưa xác định</span
        >
        <span class="text-muted fw-bold text-center"> 1 ngày trước </span>
      </div>
    </div>
  </ng-template>

     

  <ng-template #tabStationery>
    <div class="d-flex justify-content-between align-items-center mb-2" id="Stationery" >
      <div class="mb-3 fs-5 fw-bold">
        <codx-label name="lblPeopleInfo" default="Văn phòng phẩm"> </codx-label>
      </div>
      <div class="d-flex flex-row text-end align-items-end">
        <codx-input
          type="combobox"
          name="combobox"
          [refValue]="'EP_Stationery'"
          [multiple]="true"
          [showInput]="false"
          refType="P"
          (valueChange)="valueCbxStationeryChange($event)"
        >
        </codx-input>
      </div>
    </div>     

    <div class="form-group row d-flex flex-row justify-content-start align-items-center"> 
      <div class="col-4">
        <codx-label
          default="Số người tham dự"
          fiedName="Attendees"          
          [formModel]="form.formModel"
        >
        </codx-label> 
      </div>     
      <div class="col-4">
        <codx-input
          type="number"
          class="test-number min-w-50px"
          field="attendees"
          [crrValue]="fGroupAddBookingRoom.value.attendees"
          [cusButton]="true"
          [min]="0"
          [max]="50"
          (valueChange)="valueAttendeesChange($event)"
          >
        </codx-input> 
      </div> 
    </div>

    <div class="separator my-5"></div>
    <div class="d-flex flex-stack mb-4" *ngFor="let item of lstStationery">
      <div class="d-flex align-items-center me-3">
        <div class="pe-4">
          <codx-img
            [objectId]="item.id"
            objectName="item.text"
            objectType="EP_Stationery"
          ></codx-img>
        </div>
        <div class="ps-4 flex-grow-2">
          <a
            href="#"
            class="text-gray-800 text-hover-primary fw-bolder lh-0"
            >{{item.text}}</a
          >
          <span class="text-gray-400 fw-bold d-block fs-6"
            >Đơn vị tính : ???</span
          >
        </div>
      </div>
      <codx-input
          type="number"
          class="test-number min-w-50px"
          [field]="item.id"
          placeholder="0"
          [crrValue]="item.quantity"
          [cusButton]="true"
          [min]="0"
          [max]="50"
          (valueChange)="valueQuantityChange($event)"
          >
        </codx-input> 
    </div>
    
  </ng-template>

  <ng-template #tabMoreInfo>
    <div id="MoreInfo">
      <div class="mb-3 fs-5 fw-bold">
        <codx-label name="lblMoreInfo" default="Thông tin khác"> </codx-label>
      </div>
    </div>
    <div class="form-group col-3">
      <codx-label default="Số người tham dự" fiedName="Attendees"> </codx-label>
      <codx-input
        type="number"
        field="attendees"
        [crrValue]="fGroupAddBookingRoom.value.attendees"     
        (valueChange)="valueChange($event)"
        >      
      </codx-input>
    </div>    

    <div class="form-group">
      <codx-label default="Phân loại" fiedName="Category"> </codx-label>
      <codx-input 
        type="valuelist"
        refValue="VL005"
        field="category"
        [crrValue]="fGroupAddBookingRoom.value.category"
        (valueChange)="valueChange($event)">
      </codx-input>
    </div>

    <div class="form-group">
      <codx-label default="Ghi chú" fiedName="Note"> </codx-label>
      <codx-input
        type="textarea" format="ed2" rows="3"
        field="note"
        placeholder="Ghi chú"
        [crrValue]="fGroupAddBookingRoom.value.note"
        (valueChange)="valueChange($event)"
      >
      </codx-input>
    </div>

    <div class="row form-group d-flex flex-row justify-content-start align-items-center">            
      <div class="col-1 ">    
        <codx-input  #checkbox
          class="test-switch"
          type="switch"
          field="repeat"
          [disabled]="false"
          [checked]="fGroupAddBookingRoom.value.repeat"
          (valueChange)="valueChange($event)"
          >
        </codx-input>
      </div>
      <div class="col-2">          
        <codx-label
          fiedName="Repeat"
          default="Lặp lại"
          [formModel]="dialogRef.formModel"
        ></codx-label>  
      </div> 

      <div class="col-5">
        <codx-input
          type="valuelist"
          [refValue]="CbxName['Interval']"
          field="interval"
          [crrValue]="fGroupAddBookingRoom.value.interval"
          (valueChange)="valueChange($event)"
          [disabled]="!fGroupAddBookingRoom.value.repeat"
        ></codx-input>        
      </div> 
    </div>
    
  </ng-template>

  <ng-template #footer>
    <div class="d-flex justify-content-end">
      <button class="btn btn-light-primary" (click)="onSaveForm()">Lưu</button>
    </div>
  </ng-template>
</codx-layout-add>

<ng-template #popupDevice let-dialog>
  <div class="modal-header">
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex justify-content-between align-items-center">
        <h2 id="modal-basic-title">
          <codx-label
            name="lblEquipment"
            default="Thiết bị"
            [formModel]="dialog.formModel"
          ></codx-label>
        </h2>
        <button
          type="button"
          class="btn btn-xs btn-icon btn-light btn-hover-primary"
          aria-label="Close"
          (click)="dialog.close()"
        >
          <span class="icon-close icon-20 text-dark text-hover-primary"></span>
        </button>
      </div>
      <div class="text-dark-50">
        <codx-label
          name="lblChooseEquipments"
          default="Chọn các thiết bị đã tích hợp sẵn trong xe"
          [formModel]="dialog.formModel"
        ></codx-label>
      </div>
    </div>
  </div>
  <div class="modal-body">
    <div class="py-2" *ngFor="let item of tmplstDevice">
      <div class="d-flex flex-stack">
        <div class="d-flex">
          <span
            class="text-dark me-2 p-1"
            [ngClass]="[
              item.isSelected ? 'text-primary' : 'text-muted',
              item.id == '1'
                ? 'icon-wifi'
                : item.id == '2'
                ? 'icon-personal_video'
                : item.id == '3'
                ? 'icon-videocam'
                : item.id == '4'
                ? 'icon-video_settings'
                : ' icon-thermostat'
            ]"
          >
          </span>
          <div class="d-flex flex-column justify-content-center">
            <span href="#" class="text-dark fw-bolder">{{ item.text }}</span>
          </div>
        </div>
        <div class="d-flex justify-content-end">
          <div class="form-check form-check-solid form-switch">
            <codx-input
              class="form-check-input w-35px h-20px"
              type="switch"
              id="googleswitch"
              [checked]="item.isSelected"
              (valueChange)="checkedChange($event, item)"
            ></codx-input>
            <label class="form-check-label" for="googleswitch"></label>
          </div>
        </div>
      </div>
    </div>
  </div> 
  <div class="modal-footer" (click)="dialog.close()">
    <button type="button" class="btn btn-primary">
      <codx-label
        name="lblSave"
        default="Lưu"
        [formModel]="dialog.formModel"
      ></codx-label>
    </button>
  </div>
</ng-template>

<ng-template #addLink let-dialog>
  <div class="card-header d-flex flex-row justify-content-between">
    <h4 class="card-title" id="card-basic-title">
      <codx-label
        fiedName="Link"
        default="Link cuộc họp"
        [formModel]="dialog.formModel"
      ></codx-label>
    </h4>    
    <button
      type="button"
      class="btn btn-xs btn-icon btn-light btn-hover-primary"
      aria-label="Close"
      (click)="dialog.close()"
      >
      <span class="icon-close icon-20"></span>
    </button>
  </div>

  <div class="card-body ">
    <div class="form-group"></div>
    <div class="form-group">
      <codx-label
        fiedName="Path"
        default="Đường dẫn"
        [formModel]="dialog.formModel"
      ></codx-label>
    </div>
    <div class="form-group">
      <codx-input
        type="text"
        class="form-control"
        field="onlineUrl"
        placeholder="https://home.suremeet.vn/"
        [crrValue]="fGroupAddBookingRoom.value.onlineUrl"
        (valueChange)="valueChange($event)"
      ></codx-input>
    </div>
  </div>
  <div class="card-footer" (click)="dialog.close()">
    <div class="form-group d-flex justify-content-end flex-row">

      <button type="button" class="btn btn-primary">
        <codx-label
          name="lblSave"
          default="Lưu"
          [formModel]="dialog.formModel"
        ></codx-label>
      </button>
    </div>
  </div>
</ng-template>
