<codx-layout-add
  #form
  [title]="title"
  [tabInfo]="tabInfo"
  [formModel]="formModel"
  [footer]="footer"
  [dialog]="dialogRef"
  (setTitle)="setTitle($event)"
  [tabContent]="[tabGeneralInfo, tabPeopleInfo, tabMoreInfo]"
  [data]="data"
>
</codx-layout-add>

<ng-template #tabGeneralInfo>
  <ng-container *ngIf="form && form.formGroup">
    //Ngày bắt đầu & Ngày kết thúc
    <div class="row form-group">
      <div class="col-6" *ngIf="grView?.startDate?.allowPopup">
        <codx-label fiedName="StartDate" [formModel]="form.formModel">
        </codx-label>
        <codx-input
          field="startDate"
          format="F"
          type="datetime"
          class="test-datetime"
          [crrValue]="data?.startDate"
          (valueChange)="startDateChange($event)"
        >
        </codx-input>
      </div>
      <div class="col-6" *ngIf="grView?.endDate?.allowPopup">
        <codx-label fiedName="EndDate" [formModel]="form.formModel">
        </codx-label>
        <codx-input
          field="endDate"
          format="F"
          type="datetime"
          class="test-datetime"
          [crrValue]="data?.endDate"
          (valueChange)="endDateChange($event)"
        >
        </codx-input>
      </div>
    </div>

    //Địa điểm
    <div class="form-group" *ngIf="grView?.location?.allowPopup">
      <codx-label fiedName="Location" [formModel]="form.formModel">
      </codx-label>
      <codx-input
        type="text"
        ControlName="location"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      >
      </codx-input>
    </div>

    //Ghi chú
    <div class="form-group" *ngIf="grView?.memo?.allowPopup">
      <codx-label fiedName="Memo" [formModel]="form.formModel"> </codx-label>
      <codx-input
        ControlName="memo"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    //Người đi công tác
    <div class="d-flex flex-column mb-8">
      <div class="d-flex justify-content-between align-items-center form-group">
        <codx-label
          default="Lái xe & người đi cùng"
          name="lblAttendeesAndDriver"
        >
        </codx-label>
        <div class="d-flex flex-row text-end align-items-end">
          <div class="mx-2">
            <!-- <codx-input
              type="Share"
              refValue="TM003"
              (valueChange)="shareInputChange($event)"
              field="resources"
              [dataShared]="[]"
              [multiple]="true"
              [showInput]="false"
            >
            </codx-input> -->
            <codx-input
              type="Share"
              refValue="TM003"
              field="resources"
              [dataShared]="[]"
              [multiple]="true"
              [showInput]="false"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <span class="flex-nowrap">
        <!-- <span
          class="symbol-group-badge pe-2"
          *ngIf="resources != null && resources?.length >= 1"
        >
          <span class="symbol symbol-30px symbol-circle position-relative">
            <codx-img
              [width]="30"
              [objectId]="resources[0]?.userID"
              objectType="AD_Users"
            ></codx-img>
            <span
              class="position-absolute attendees-tag"
              [inlineSVG]="
                './assets/themes/ep/default/img/' + resources[0]?.icon
              "
            ></span>
          </span>
        </span>
        <span class="symbol-group-badge pe-2" *ngIf="resources?.length >= 2">
          <span class="symbol symbol-30px symbol-circle position-relative">
            <codx-img
              [width]="30"
              [objectId]="resources[1]?.userID"
              objectType="AD_Users"
            ></codx-img>
            <span
              class="position-absolute attendees-tag"
              [inlineSVG]="
                './assets/themes/ep/default/img/' + resources[1]?.icon
              "
            ></span>
          </span>
        </span>

        <span class="symbol-group-badge pe-2" *ngIf="resources.length > 2">
          <span
            class="symbol symbol-30px symbol-circle"
            data-bs-toggle="modal"
            data-bs-target="#kt_modal_view_users"
          >
            <span
              class="symbol-label bg-light-primary text-primary fs-8 fw-bolder"
              >+{{ resources.length - 2 }}</span
            >
          </span>
        </span> -->
      </span>
    </div>
  </ng-container>
</ng-template>

<ng-template #tabPeopleInfo>
  <!-- <div class="d-flex justify-content-start align-items-center">
    <div class="">
      <codx-label
        name="lblAttendees"
        default="Số người đi xe"
        [formModel]="form.formModel"
      >
      </codx-label>
    </div>
    <div class="">
      <span class="me-2">:</span>
      <span class="fw-bold">{{ data?.attendees }}</span>
    </div>
  </div>

  <div class="separator my-5"></div>
  <div class="d-flex flex-row justify-content-between">
    <div class="d-flex flex-row justify-content-start">
      <ng-container *ngFor="let item of listRoles">
        <div class="d-flex align-items-center justify-content-start me-4">
          <span
            inlineSVG="./assets/themes/ep/default/img/{{ item?.icon }}"
          ></span>
          <div class="fs-8 text-gray-500 ms-1">{{ item?.text }}</div>
        </div>
      </ng-container>
    </div>
    <div class="mx-2">
      <codx-input
        type="Share"
        refValue="TM003"
        (valueChange)="shareInputChange($event)"
        field="resources"
        [dataShared]="[]"
        [multiple]="true"
        [showInput]="false"
      >
      </codx-input>
    </div>
  </div>

  <div
    class="d-flex justify-content-between align-items-center mt-4 mb-2"
    id="PeopleInfo"
  >
    <div class="fw-bold">
      <codx-label name="lblPeopleInfo" default="Người đi cùng"></codx-label>
    </div>
  </div>
  <div
    class="d-flex align-items-center mb-4 position-relative"
    *ngIf="driver != null"
  >
    <div class="symbol symbol-30px symbol-circle me-4">
      <codx-img
        [objectId]="driver?.objectID"
        [objectName]="driver?.driverName"
        [width]="30"
        [objectType]="driver?.objectType"
      ></codx-img>
      <span
        class="position-absolute attendees-tag"
        inlineSVG="./assets/themes/ep/default/img/{{ driver?.icon }}"
      ></span>
    </div>

    <div class="d-flex flex-column flex-grow-1">
      <div class="text-dark fw-bold fs-6 fw-bolder">
        {{ driver?.userName }}
      </div>
      <span class="text-muted fw-bold">{{
        "2" | vll : "EP010" : "text" | async
      }}</span>
    </div>
  </div>

  <div *ngIf="resources != null">
    <div
      class="d-flex align-items-center mb-4 position-relative"
      *ngFor="let item of resources"
    >
      <div class="symbol symbol-30px symbol-circle me-4">
        <codx-img
          [objectId]="item?.userID"
          [width]="30"
          objectType="AD_Users"
        ></codx-img>
        <span
          class="attendees-tag position-absolute"
          inlineSVG="./assets/themes/ep/default/img/{{ item?.icon }}"
        ></span>
      </div>

      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fw-bold">
          {{ item?.userName }}
        </div>
        <span class="text-muted fw-bold">{{
          item?.roleType | vll : "EP010" : "text" | async
        }}</span>
      </div>
      <div
        class="d-flex flex-column justify-content-center align-items-center me-5"
      >
        <span
          *ngIf="item?.userName != curUser?.userName || item?.roleType != '1'"
          class="icon-close"
          role="button"
          (click)="deleteAttender(item?.userID)"
        ></span>
      </div>
    </div>
  </div> -->
</ng-template>

<ng-template #tabMoreInfo>
  <ng-container *ngIf="form && form.formGroup">
    <div class="form-group" *ngIf="grView?.note.allowPopup">
      <codx-label fiedName="Note" [formModel]="form.formModel"> </codx-label>
      <codx-input
        field="note"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      >
      </codx-input>
    </div>
    <div class="form-group">
      <codx-label
        name="lblCardInfo"
        default="Thông tin thẻ"
        class="text-primary"
      >
      </codx-label>
    </div>
    <!-- <div class="form-group">
      <codx-label name="lblCardInfo" default="Tên thẻ"> </codx-label>
      <codx-input
        type="text"
        [disabled]="true"
        [crrValue]="cardTransInfo?.resourceName"
      >
      </codx-input>
    </div>
    <div class="form-group row mx-0">
      <div class="col-6 ps-0">
        <codx-label name="lblUserGetCard" default="Người nhận thẻ">
        </codx-label>
        <codx-input
          type="combobox"
          [disabled]="true"
          [refValue]="'Users'"
          [crrValue]="cardTransInfo?.userGetCard"
        >
        </codx-input>
      </div>

      <div class="col-6 pe-0">
        <codx-label name="lblDateGetCard" default="Ngày cấp thẻ"> </codx-label>
        <codx-input
          type="datetime"
          [disabled]="true"
          format="F"
          class="test-datetime"
          [crrValue]="cardTransInfo?.dateGetCard"
        >
        </codx-input>
      </div>
    </div>
    <div class="form-group row mx-0">
      <div class="col-6 ps-0">
        <codx-label name="lblUserReturnCard" default="Người trả thẻ">
        </codx-label>
        <codx-input
          type="combobox"
          [disabled]="true"
          [refValue]="'Users'"
          [crrValue]="cardTransInfo?.userReturnCard"
        >
        </codx-input>
      </div>

      <div class="col-6 pe-0">
        <codx-label name="lblDateReturnCard" default="Ngày trả thẻ">
        </codx-label>
        <codx-input
          type="datetime"
          [disabled]="true"
          format="F"
          class="test-datetime"
          [crrValue]="cardTransInfo?.dateReturnCard"
        >
        </codx-input>
      </div>
    </div> -->
  </ng-container>
</ng-template>

<ng-template #footer>
  <div class="d-flex justify-content-between align-items-center">
    <button class="btn btn-outline-primary me-2" (click)="onSaveForm()">
      <codx-label
        name="lblUpload"
        default="Đính kèm"
        [formModel]="formModel"
      ></codx-label>
    </button>
    <button class="btn btn-primary" (click)="onSaveForm()">
      <codx-label
        name="lblSave"
        default="Lưu"
        [formModel]="formModel"
      ></codx-label>
    </button>
  </div>
</ng-template>

<ng-template #popupDevice let-dialog>
  <div class="modal-header p-5">
    <div class="d-flex justify-content-between align-items-center flex-grow-1">
      <div class="d-flex flex-column">
        <div class="fw-bold fs-4 mb-1" id="modal-basic-title">
          <codx-label
            name="lblEquipment"
            default="Cài đặt thiết bị"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblChooseCarEquipments"
            default="Chọn các thiết bị đã tích hợp sẵn trong xe"
          >
          </codx-label>
        </div>
      </div>
      <button
        type="button"
        class="btn btn-sm btn-icon btn-light-primary"
        aria-label="Close"
        (click)="dialog.close()"
      >
        <span class="icon-close icon-18"></span>
      </button>
    </div>
  </div>
  <!-- <div
    class="modal-body pt-0 overflow-auto h-300px"
    *ngIf="tmplstDevice != null"
  >
    <div class="mb-1 px-5" *ngFor="let item of tmplstDevice">
      <div class="d-flex flex-stack py-3 rounded-2 bg-hover">
        <div class="d-flex">
          <span
            class="me-1 ps-2"
            [className]="item?.icon"
            [ngClass]="[item?.isSelected ? 'text-primary' : 'text-muted']"
          ></span>
          <div class="d-flex flex-column justify-content-center">
            <span class="ms-2 text-dark fw-bolder">{{ item?.text }}</span>
          </div>
        </div>
        <div class="d-flex justify-content-end align-items-center">
          <div class="form-check form-check-solid form-switch">
            <codx-input
              class="form-check-input w-35px h-20px"
              type="switch"
              id="googleswitch"
              [checked]="item?.isSelected"
              (valueChange)="checkedChange($event, item)"
            ></codx-input>
            <label class="form-check-label" for="googleswitch"></label>
          </div>
        </div>
      </div>
    </div>
  </div> -->
</ng-template>
