<codx-layout-add
  #form
  [title]="title"
  [tabInfo]="tabInfo"
  [formModel]="formModel"
  [footer]="footer"
  [dialog]="dialogRef"
  (setTitle)="setTitle($event)"
  [openMore]="false"
  [templateExtend]="expand"
  [tabContent]="[tabGeneralInfo, tabPeopleInfo, tabReminder]"
  [data]="data"
>
</codx-layout-add>

<ng-template #expand>
  <codx-tabs
    #tabModel
    [entityName]="'EP_Bookings'"
    [objectID]="data?.recID"
    [funcID]="formModel?.funcID"
    [dataTree]="[]"
    [TabControl]="tabControl"
    [transID]="data?.recID"
    [dataTree]="data?.tasks ? data?.tasks : []"
    [approveStatus]="data?.approveStatus"
    [addPermissions]="listFilePermission"
    [isEdit]="true"
  ></codx-tabs>
</ng-template>

<ng-template #tabGeneralInfo>
  <ng-container *ngIf="form && form?.formGroup">
    //Tên buổi họp
    <div class="form-group" *ngIf="grView?.meetingName?.allowPopup">
      <codx-label fiedName="MeetingName" [formModel]="form.formModel">
      </codx-label>
      <codx-input
        ControlName="meetingName"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    //Ngày
    <div class="row mx-0">
      <div class="col-4 form-group ps-0" *ngIf="grView?.bookingOn?.allowPopup">
        <codx-label fiedName="BookingOn" [formModel]="form.formModel">
        </codx-label>
        <codx-input
          field="bookingOn"
          [crrValue]="data?.bookingOn"
          format="d"
          type="datetime"
          class="test-datetime"
          (valueChange)="valueDateChange($event)"
        >
        </codx-input>
      </div>

      <div class="col-3 form-group" *ngIf="grView?.startDate?.allowPopup">
        <codx-label
          name="lblStatTime"
          default="Từ giờ"
          [formName]="formModel.formName"
          [gridViewName]="formModel.gridViewName"
        >
        </codx-label>
        <codx-input
          type="datetime"
          class="test-datetime"
          field="startTime"
          [crrValue]="startTime"
          format="t"
          (valueChange)="valueStartTimeChange($event)"
          [disabled]="false"
        >
        </codx-input>
      </div>

      <div class="col-3 form-group" *ngIf="grView?.endDate?.allowPopup">
        <codx-label
          name="lblEndTime"
          default="Đến giờ"
          [formName]="formModel.formName"
          [gridViewName]="formModel.gridViewName"
        ></codx-label>
        <codx-input
          type="datetime"
          class="test-datetime"
          field="endTime"
          [crrValue]="endTime"
          format="t"
          (valueChange)="valueEndTimeChange($event)"
          [disabled]="false"
        >
        </codx-input>
      </div>

      <div class="col-2 d-flex flex-column justify-content-center pe-0">
        <codx-input
          #checkbox
          type="checkbox"
          label="Cả ngày"
          labelPosition="after"
          field="day"
          class="test-check"
          (valueChange)="valueAllDayChange($event)"
          [disabled]="false"
          [checked]="isFullDay"
        >
        </codx-input>
      </div>
    </div>

    //Địa điểm
    <div class="form-group" *ngIf="grView?.location?.allowPopup">
      <codx-label fiedName="Location" [formModel]="form.formModel">
      </codx-label>
      <codx-input
        type="text"
        ControlName="location"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      >
      </codx-input>
    </div>

    //Nội dung họp
    <div class="form-group" *ngIf="grView?.memo?.allowPopup">
      <div class="d-flex align-items-end justify-content-between mb-2">
        <div class="d-flex me-2">
          <codx-label fiedName="Memo" [formModel]="form.formModel">
          </codx-label>
        </div>
        <!-- <button
          type="button"
          (click)="openPopupTemplate(meeting)"
          class="btn btn-icon btn-light"
        >
          <span class="icon-check_box icon-18"></span>
        </button> -->
        <button type="button" class="btn btn-icon btn-light">
          <span class="icon-check_box icon-18"></span>
        </button>
      </div>
      <codx-input
        ControlName="memo"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
        class="h-105px"
      >
      </codx-input>
      <!-- <div class="d-flex justify-content-end" *ngIf="data.templateID">
        <div class="font-italic">
          {{ templateName }}
        </div>
      </div> -->
    </div>

    //Họp online
    <div
      class="d-flex flex-column form-group"
      *ngIf="grView?.isOnline?.allowPopup"
    >
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <codx-input
            #checkbox
            type="switch"
            field="isOnline"
            [checked]="data?.isOnline"
            [crrValue]="data?.isOnline"
            (valueChange)="valueChange($event)"
            labelPosition="After"
          >
          </codx-input>
          <span class="fw-bold ms-2 mt-2"
            ><label for="switchOnl">
              <codx-label fiedName="IsOnline" [formModel]="form.formModel">
              </codx-label>
            </label>
          </span>
        </div>
        <ng-container class="text-end align-items-end" *ngIf="data?.isOnline">
          <!-- <button
            type="button"
            class="btn btn-clean btn-sm btn-icon btn-icon-md"
            (click)="openPopupLink()"
          >
            <i
              class="icon-insert_link text-primary text-hover-primary-dark icon-24"
            ></i>
          </button> -->
          <button
            type="button"
            class="btn btn-clean btn-sm btn-icon btn-icon-md"
          >
            <i
              class="icon-insert_link text-primary text-hover-primary-dark icon-24"
            ></i>
          </button>
        </ng-container>
      </div>
      <ng-container
        class="d-flex align-items-center fw-bold"
        *ngIf="data?.isOnline && data?.link"
      >
        <button class="bg-transparent border-0 text-start">
          <span class="text-decoration-underline text-primary fw-bold">{{
            data?.link
          }}</span>
        </button>
      </ng-container>
    </div>

    //Người tham gia
    <div class="d-flex flex-column mb-8">
      <div
        class="d-flex justify-content-between align-items-center mb-2 form-group"
      >
        <codx-label
          name="lblAttendees"
          default="Người tham gia"
          [formName]="formModel.formName"
          [gridViewName]="formModel.gridViewName"
        >
        </codx-label>
        <div class="d-flex flex-row text-end align-items-end">
          <div class="mx-2">
            <!-- <codx-input
              type="Share"
              refValue="TM003"
              (valueChange)="shareInputChange($event)"
              field="resources"
              [dataShared]="[]"
              [multiple]="true"
              [showInput]="false"
            >
            </codx-input> -->
            <codx-input
              type="Share"
              refValue="TM003"
              field="resources"
              [dataShared]="[]"
              [multiple]="true"
              [showInput]="false"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <span class="flex-nowrap">
        <!-- <span
          class="symbol-group-badge pe-2"
          *ngIf="resources != null && resources?.length >= 1"
        >
          <span class="symbol symbol-30px symbol-circle position-relative">
            <codx-img
              [width]="30"
              [objectId]="resources[0]?.userID"
              objectType="AD_Users"
            ></codx-img>
            <span
              class="position-absolute attendees-tag"
              [inlineSVG]="
                './assets/themes/ep/default/img/' + resources[0]?.icon
              "
            ></span>
          </span>
        </span>
        <span class="symbol-group-badge pe-2" *ngIf="resources?.length >= 2">
          <span class="symbol symbol-30px symbol-circle position-relative">
            <codx-img
              [width]="30"
              [objectId]="resources[1]?.userID"
              objectType="AD_Users"
            ></codx-img>
            <span
              class="position-absolute attendees-tag"
              [inlineSVG]="
                './assets/themes/ep/default/img/' + resources[1]?.icon
              "
            ></span>
          </span>
        </span>

        <span class="symbol-group-badge pe-2" *ngIf="resources.length > 2">
          <span
            class="symbol symbol-30px symbol-circle"
            data-bs-toggle="modal"
            data-bs-target="#kt_modal_view_users"
          >
            <span
              class="symbol-label bg-light-primary text-primary fs-8 fw-bolder"
              >+{{ resources.length - 2 }}</span
            >
          </span>
        </span> -->
      </span>
    </div>
  </ng-container>
</ng-template>

<ng-template #tabPeopleInfo>
  <!-- <ng-container *ngIf="form && form.formGroup">
    <div
      class="d-flex justify-content-start align-items-center"
      *ngIf="grView?.attendees?.allowPopup"
    >
      <div class="">
        <codx-label fiedName="Attendees" [formModel]="form.formModel">
        </codx-label>
      </div>
      <div class="">
        <span class="me-2">:</span>
        <span class="fw-bold">{{ attendeesNumber }}</span>
      </div>
    </div>

    <div class="separator my-5"></div>
    <div class="d-flex justify-content-between">
      <div class="d-flex flex-row justify-content-start">
        <ng-container *ngFor="let item of listRoles">
          <div class="d-flex align-items-center justify-content-start me-4">
            <span
              [inlineSVG]="'./assets/themes/ep/default/img/' + item?.icon"
            ></span>
            <div class="fs-8 text-gray-500 ms-1">{{ item?.text }}</div>
          </div>
        </ng-container>
      </div>

      <div class="d-flex flex-row text-end align-items-end">
        <div class="mx-2">
          <codx-input
            type="Share"
            refValue="TM003"
            (valueChange)="shareInputChange($event)"
            field="resources"
            [dataShared]="[]"
            [multiple]="true"
            [showInput]="false"
          >
          </codx-input>
        </div>
      </div>
    </div>
    <div
      class="d-flex justify-content-between align-items-center mt-4 mb-2"
      id="PeopleInfo"
    >
      <div class="fw-bold">
        <codx-label name="lblPeopleInfo" default="Người tham dự"> </codx-label>
      </div>
      <div class="fw-bold me-5 pe-3">
        <span>
          {{ "1" | vll : "EP017" : "text" | async }}
        </span>
      </div>
    </div>

    <div
      class="d-flex align-items-center mb-4 pb-2 position-relative"
      *ngFor="let item of resources"
    >
      <div class="symbol symbol-30px symbol-circle me-4">
        <codx-img
          [width]="30"
          [objectId]="item?.userID"
          objectType="AD_Users"
        ></codx-img>
        <div
          role="button"
          class="pe-auto"
          (click)="showPopover(p, item?.userID)"
        >
          <span
            popoverClass="userPopoverClass"
            [ngbPopover]="!viewOnly ? popoverSelectRoles : null"
            placement="right"
            #p="ngbPopover"
            autoClose="outside"
            class="position-absolute attendees-tag"
            [inlineSVG]="'./assets/themes/ep/default/img/' + item?.icon"
          >
          </span>
        </div>
      </div>

      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold fs-6 fw-bolder">
          {{ item?.userName }}
        </div>
        <div>
          <span class="text-muted">{{
            item?.roleType | vll : "EP009" : "text" | async
          }}</span>
        </div>
      </div>

      <div
        class="d-flex flex-column justify-content-center align-items-center me-5"
      >
        <codx-input
          type="checkbox"
          [checked]="item?.optional"
          (valueChange)="attendeesCheckChange($event, item?.userID)"
        >
        </codx-input>
      </div>

      <div
        class="d-flex flex-column justify-content-center align-items-center me-5"
        *ngIf="item?.roleType != '1' && item?.userID != curUser?.userID"
      >
        <span
          class="icon-close"
          role="button"
          (click)="deleteAttender(item?.userID)"
        ></span>
      </div>
      <div
        class="d-flex flex-column justify-content-center align-items-center me-5"
        *ngIf="item?.roleType == '1' || item?.userID == curUser?.userID"
      >
        <span class="icon-close" style="visibility: hidden"></span>
      </div>
    </div>
    <div
      class="d-flex align-items-center mb-4 pb-2 position-relative"
      *ngIf="guestControl == true"
    >
      <div class="symbol symbol-30px symbol-circle me-4">
        <codx-img
          [width]="30"
          [objectId]="'G'"
          [objectName]="'G'"
          objectType="AD_Users"
        ></codx-img>
        <div role="button" class="pe-auto">
          <span
            class="position-absolute attendees-tag"
            inlineSVG="./assets/themes/ep/default/img/EP009_A.svg"
          >
          </span>
        </div>
      </div>

      <div class="d-flex flex-column flex-grow-1">
        <codx-label
          name="lblGuestTitle"
          default="Guest"
          class="text-dark fw-bold fs-6 fw-bolder"
        >
        </codx-label>
        <div>
          <codx-label
            class="text-muted"
            name="lblGuest"
            default="Khách mời"
          ></codx-label>
        </div>
      </div>

      <div
        class="d-flex flex-column justify-content-center align-items-center me-5"
      >
        <codx-input
          [cusButton]="true"
          [min]="0"
          [max]="50"
          type="number"
          [crrValue]="guestNumber"
          (valueChange)="guestChange($event)"
        >
        </codx-input>
      </div>
    </div>
  </ng-container> -->
</ng-template>

<ng-template #tabReminder>
  <!-- <ng-container *ngIf="form && form.formGroup">
    <div class="form-group col-5">
      <codx-label [formModel]="form.formModel" fiedName="Reminder"></codx-label>
      <codx-input
        ControlName="reminder"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      >
      </codx-input>
      <codx-input
        field="reminder"
        type="number"
        [min]="0"
        [crrValue]="data?.reminder"
        (valueChange)="reminderChange($event)"
      >
      </codx-input>
    </div>
  </ng-container> -->
</ng-template>

<ng-template #footer>
  <ng-container *ngIf="form && form.formGroup">
    <div class="d-flex justify-content-between">
      <!-- <button
        (click)="popupUploadFile()"
        class="btn btn-sm btn-outline btn-outline-primary btn-active-light-primary d-flex flex-row"
      >
        <span class="icon-cloud_upload btn-text-primary me-2"></span>
        <codx-label
          fiedName="lblUploadFile"
          default="Đính kèm"
          [formModel]="form.formModel"
        ></codx-label>
      </button> -->
      <button
        class="btn btn-sm btn-outline btn-outline-primary btn-active-light-primary d-flex flex-row"
      >
        <span class="icon-cloud_upload btn-text-primary me-2"></span>
        <codx-label
          fiedName="lblUploadFile"
          default="Đính kèm"
          [formModel]="form.formModel"
        ></codx-label>
      </button>
      <div class="btn-group">
        <button class="btn btn-outline-primary me-2" (click)="onSaveForm()">
          <codx-label
            name="lblApprove"
            default="Gửi duyệt"
            [formModel]="formModel"
          ></codx-label>
        </button>
        <button class="btn btn-primary" (click)="onSaveForm()">
          <codx-label
            name="lblSave"
            default="Lưu"
            [formModel]="formModel"
          ></codx-label>
        </button>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #popupDevice let-dialog>
  <!-- <div class="modal-header p-5">
    <div class="d-flex justify-content-between align-items-center flex-grow-1">
      <div class="d-flex flex-column">
        <div class="fw-bold fs-4 mb-1" id="modal-basic-title">
          <codx-label
            name="lblEquipment"
            default="Cài đặt thiết bị"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblChooseRoomEquipments"
            default="Chọn các thiết bị đã tích hợp sẵn trong phòng"
          >
          </codx-label>
        </div>
      </div>
      <button
        type="button"
        class="btn btn-sm btn-icon btn-light-primary"
        aria-label="Close"
        (click)="dialog.close()"
      >
        <span class="icon-close icon-18"></span>
      </button>
    </div>
  </div>
  <div
    class="modal-body pt-0 overflow-auto h-300px"
    *ngIf="tmplstDevice != null"
  >
    <div class="mb-1 px-5" *ngFor="let item of tmplstDevice">
      <div class="d-flex flex-stack py-3 rounded-2 bg-hover">
        <div class="d-flex">
          <span
            class="me-1 ps-2"
            [className]="item?.icon"
            [ngClass]="[item?.isSelected ? 'text-primary' : 'text-muted']"
          ></span>
          <div class="d-flex flex-column justify-content-center">
            <span class="ms-2 text-dark fw-bolder">{{ item?.text }}</span>
          </div>
        </div>
        <div class="d-flex justify-content-end align-items-center">
          <div class="form-check form-check-solid form-switch">
            <codx-input
              class="form-check-input w-35px h-20px"
              type="switch"
              id="googleswitch"
              [checked]="item?.isSelected"
              (valueChange)="checkedChange($event, item)"
            ></codx-input>
            <label class="form-check-label" for="googleswitch"></label>
          </div>
        </div>
      </div>
    </div>
  </div> -->
</ng-template>

<ng-template #addLink let-dialog>
  <!-- <codx-meeting-online
    #suremeet
    [dialog]="dialog"
    [meetingTitle]="data?.title"
    [meetingDescription]="data?.memo"
    [meetingStartDate]="data?.startDate"
    [meetingStartTime]="startTime"
    [meetingDuration]="60"
    [meetingPassword]="null"
    [meetingUrl]="data?.onlineUrl"
    [userName]="user.userName"
    [mail]="user.email"
    [isManager]="true"
  ></codx-meeting-online> -->
</ng-template>

<ng-template #popoverSelectRoles>
  <!-- <div class="d-flex flex-column mb-1 w-150px">
    <ng-container *ngIf="resources && resources.length > 0">
      <ng-container *ngFor="let item of listRoles">
        <div
          class="d-flex align-items-center btn btn-sm btn-white cursor-pointer"
          (click)="selectRoseType(idUserSelected, item?.value)"
        >
          <span
            [inlineSVG]="'./assets/themes/ep/default/img/' + item?.icon"
          ></span>
          <div class="fs-7 ms-2 text-gray-600">
            {{ item?.text }}
          </div>
        </div>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="resources && resources?.length == 0">
      <ng-container>
        <div
          class="d-flex align-items-center btn btn-sm btn-white cursor-pointer"
          (click)="selectRoseType(idUserSelected, listRoles[0]?.value)"
        >
          <span
            [inlineSVG]="'./assets/themes/ep/default/img/' + listRoles[0]?.icon"
          ></span>
          <div class="fs-7 ms-2 text-gray-600">
            {{ listRoles[0].text }}
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div> -->
</ng-template>
