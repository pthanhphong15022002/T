<codx-form #form [headerText]="headerText" [subHeaderText]="subHeaderText" [subHeader]="subHeader" [body]="body"
  [footer]="footer" [dialog]="dialog" [formModel]="formModel" [data]="dispatch">
</codx-form>
<ng-template #subHeader>
  <div class="d-flex align-items-center">
    <div *ngIf="this.dispatch?.status=='1'||this.dispatch?.status=='2' ; else elseSelected">
      <span class="btn btn-sm btn-primary btn-pill" (click)="openFormUploadFile()">
        <i class="icon-cloud_upload icon-16 me-2"></i>Chọn file
      </span>
    </div>
    <ng-template #elseSelected>
      <span class="btn btn-sm btn-light btn-pill">
        <i class="icon-cloud_upload icon-16 me-2"></i>Chọn file
      </span>
    </ng-template>
  </div>
  <div>
  </div>
</ng-template>
<ng-template popup adde #body>
  <div class="py-2">
    <codx-attachment #attachment [objectType]="formModel?.entityName" hideImageUpload="0" showMessage="0" hideBtnSave="1" hideFolder="1" hideUploadBtn="1"
      hideDes="1" [functionID]="formModel?.funcID" (fileAdded)="fileAdded($event)" (fileDelete)="handleDelete($event)" (fileCount)="getfileCount($event)" (fileGet)="getfileCount($event)" isDeleteTemp = '1'
      [objectId]="dispatch?.recID" [allowMultiFile]="0" [idBrowse]="'add'" [hideDelete]="(this.dispatch?.status=='1'||this.dispatch?.status=='2')?'1':'0'" hideMoreF="0">
    </codx-attachment>
  </div>
  <div class="tab-horizone">
    <div class="d-flex align-items-center mb-1">
      <codx-label class="me-2 cursor-pointer fw-bold" [formModel]="formModel" [fiedName]="'agencyName'" [class.text-primary]="activeDiv == 'dv'"
        (click)="hideDept('dv')">
      </codx-label>
      <ng-container *ngIf="!hidepb">
        <span class="me-2">|</span>
        <codx-label class="cursor-pointer text-primary fw-bold" [class.text-primary]="activeDiv == 'pb'" default="Phòng ban"
          (click)="hideDept('pb')"></codx-label>
      </ng-container>
    </div>
    <div class="align-items-start" style="display:flex"  [hidden]="showAgency">
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="agencyName" style="width:100%"
        (valueChange)="changeValueAgency($event)">
      </codx-input>
      <!--  (valueChange)="changeValueAgency($event)" -->
      <!--   <codx-input
        placeholder="Nhập đơn vị"
        style="width:100%"
        type="text"
        [crrValue]="this.dispatch?.agencyName"
        (valueChange)="changeValueAgencyText($event)"
      >
      </codx-input> -->
      <span class="btn btn-primary ms-3" (click)="openFormAgency('agency')">Add</span>
    </div>
    <div class="align-items-start" style="display:flex" [hidden]="!showAgency">
      <codx-combobox refValue="AgencyDepts" type="combobox" placeholder="Phòng ban" [value]="dispatch?.agencyID"
        style="width:100%" (valueChange)="changeValueDept($event)" field="agencyName">
      </codx-combobox>
      <span class="btn btn-primary ms-3" (click)="openFormAgency('dept')">Add</span>
    </div>

  </div>

  <!-- <div class="mt-2">
    <div class="d-flex align-items-center btn-group">
      <div class="p-2"><span class="btn-link active" (click)="changeFormAgency(1)">Đơn vị</span></div>
      <div class="p-2" *ngIf="showAgency"><span class="btn-link" (click)="changeFormAgency(9)">Phòng ban</span></div>
    </div>
    <div class="form-group mt-2 d-flex align-items-center">
      <codx-input
        refValue="Agencies"
        type="combobox"
        placeholder="Chọn đơn vị"
        ngDefaultControl
        style="width:100%"
        >
      </codx-input>
        <span class="btn btn-primary ms-3" (click)="openFormAgency()">Add</span>
        <ejs-combobox *ngIf="!showCbxAgency" id='games' #sample [dataSource]='lstAgency'  [fields]='fieldAgency' [placeholder]="'Chọn đơn vị'" (change)="changeValueAgency($event)" style="width:100%"></ejs-combobox>
        <ejs-combobox *ngIf="showCbxAgency"  id='games' #sample [dataSource]='lstDept'  [fields]='fieldAgency' [placeholder]="'Chọn phòng ban'" (change)="changeValueDept($event)" style="width:100%"></ejs-combobox>
        <span class="btn btn-primary ms-3" (click)="openFormAgency()">Add</span>
      </div>

  </div>
  <div class="form-group mt-3">
    <label>Đơn vị | Phòng ban</label>
    <div class="d-flex flex-stack">
      <div class="w-100">
        <codx-combobox
            service="OD"
            assemblyName="ERM.Business.OD"
            className="DispatchesBusiness"
            method=""
            name="combobox"
            placeholder="Default combobox"
            ngDefaultControl
            refValue="<ComboboxName>"
            field="<FieldValue>"
            [pageSize]="5"
            [allowFilter]=true>
        </codx-combobox>
      </div>
      <span class="btn btn-primary ms-3">Add</span>
    </div>
  </div>  -->
  <div class="row mt-3">
    <div class="col-6">
      <codx-label [formModel]="form.formModel" fiedName="Category" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="category">
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label [formModel]="form.formModel" fiedName="Source" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="source">
      </codx-input>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-4">
      <codx-label [formModel]="form.formModel" fiedName="RefNo" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="refNo" ControlName="refNo" >
      </codx-input>
    </div>
    <div class="col-4">
      <codx-label [formModel]="form.formModel" fiedName="RefDate" class="fw-bold"></codx-label>
      <!-- Bùa r nhờ Quang fix sau -->
      <!-- <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="refDate" [format]="'d'">   </codx-input>-->
        <codx-input type="datetime" format="d" field="refDate" 
        [crrValue]="dispatch?.refDate" (valueChange)="valueChangeDate($event)">
      </codx-input>
    
    </div>
    <div class="col-2">
      <codx-label [formModel]="form.formModel" fiedName="Pages" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="pages" [min]="0"
        [showSpinButton]="false">
      </codx-input>
    </div>
    <div class="col-2">
      <codx-label [formModel]="form.formModel" fiedName="Copies" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="copies" [min]="0"
        [showSpinButton]="false">
      </codx-input>
    </div>
  </div>
  <div class="form-group mt-3">
    <codx-label [formModel]="form.formModel" fiedName="Title" class="fw-bold"></codx-label>
    <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="title" class="h-105px">
    </codx-input>
  </div>
  <div class="form-group row mt-3">
    <div class="col-6">
      <codx-label [formModel]="form.formModel" fiedName="Urgency" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="urgency">
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label [formModel]="form.formModel" fiedName="Security" class="fw-bold"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="security">
      </codx-input>
    </div>
  </div>
  <div class="form-group">
    <codx-label [formModel]="form.formModel" fiedName="DeptID" class="fw-bold"></codx-label>
    <div class="d-flex">
      <codx-input type="Combobox" name="combobox"
        [refValue]="gridViewSetup!=null?gridViewSetup['DeptID']['referedValue']:null" refType="P" field="deptID"
        [showInput]="true" [crrValue]="dispatch?.deptID" [ngClass]="'w-100'" (valueChange)="changeValueBUID($event)">
      </codx-input>
    </div>
  </div>
  <div class="form-group">
    <codx-label [formModel]="form.formModel" fiedName="Owner" [default]="form.formModel.funcID =='ODT41'?'Người gửi':null" ></codx-label>
    <div class="d-flex">
      <codx-input type="Combobox" name="combobox"
        [refValue]="gridViewSetup!=null?gridViewSetup['Owner']['referedValue']:null" [multiple]="false" [crrValue]="this.dispatch.owner"
        [showInput]="true" refType="P" field="popup" [ngClass]="'w-100'" (valueChange)="changeValueOwner($event)">
      </codx-input>
    </div>
  </div>
  <div class="form-group row mt-3">
    <div class="col">
      <codx-label [formModel]="form.formModel" fiedName="SendMode"></codx-label>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="sendMode"></codx-input>
    </div>
    <div class="col">
      <codx-label [formModel]="form.formModel" fiedName="DispatchOn"></codx-label>
      <!-- <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="dispatchOn" [format]="'d'">     </codx-input>-->
        <codx-input type="datetime" format="d" field="dispatchOn" 
        [crrValue]="dispatch?.dispatchOn" (valueChange)="valueChangeDate($event)">
      </codx-input>
  
    </div>
    <div class="col" *ngIf="form.formModel.funcID != 'ODT41'">
      <codx-label [formModel]="form.formModel" fiedName="Deadline"></codx-label>
      <!-- <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="deadline" [format]="'d'">
      </codx-input> -->
      <codx-input type="datetime" format="d" field="deadline" 
      [crrValue]="dispatch?.deadline" (valueChange)="valueChangeDate($event)">
    </codx-input>
    </div>
  </div>
  
</ng-template>
<ng-template #footer>
  <div class="d-flex justify-content-end">
    <button class="btn btn-primary" (click)="onSave()">
      Lưu
    </button>
  </div>
</ng-template>
<ng-template #tmpagency let-dialog>
  <app-od-agency [dialog]="dialog" [data]="data"></app-od-agency>
</ng-template>
<ng-template #tmpdept let-dialog>
  <app-od-department></app-od-department>
</ng-template>
