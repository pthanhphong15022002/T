<codx-detail-tmp [header]="header" [formModel]="formModel"  [body]="body" [footer]="footer" (clickMF)="openFormFuncID($event)">
  <ng-template #header>
    <div class="d-flex justify-content-between">
      <div class="w-100">
        <div>
          <codx-temp-full 
            [title]="extractContent(data?.title)"  
            [desc]="desc"
            [bookmark]="false"
          >
          </codx-temp-full>
        </div>
        <div class="d-flex mt-2">
          <div class="d-flex me-6">
            <span class="text-dark me-2">Phân loại:</span>
            <span class="text-gray-600">{{fmTextValuelist(data?.category,"4")}}</span>
          </div>
          <div class="d-flex align-items-center text-dark me-6">
            <span class="text-dark me-2">Mức độ khẩn:</span>
            <ng-container *ngIf="data?.urgency">
              <span class="icon-flag icon-16 me-2" [style.color]="getTextColor(data?.urgency,'2')"></span>
              <span class="text-gray-600">{{fmTextValuelist(data?.urgency,"2")}}</span>
            </ng-container>
            <!-- icon-flag -->
          </div>
          <div class="d-flex align-items-center">
            <span class="text-dark me-2">Độ bảo mật:</span>
            <ng-container *ngIf="data?.security">
              <span class="icon-security icon-14 me-1" [style.color]="getTextColor(data?.security,'1')"></span>
              <span class="text-gray-600">{{fmTextValuelist(data?.security,"1")}}</span>
            </ng-container>
          </div>
        </div>
        <div class="d-flex mt-3">
          <div class="d-flex me-6">
            <span class="text-dark me-2">Ngày gửi:</span>
            <span class="text-gray-600">{{data?.createdOn | date:"dd/MM/yyyy"}}</span>
          </div>
          <div class="d-flex align-items-center text-dark me-6">
            <span class="text-dark me-2">Ngày nhận:</span>
            <span class="text-gray-600">{{data?.dispatchOn | date:"dd/MM/yyyy"}}</span>
            <!-- icon-flag -->
          </div>
          <div class="d-flex">
            <span class="text-dark me-2">Ngày hết hạn:</span>
            <span class="text-gray-600">{{data?.deadline | date:"dd/MM/yyyy"}}</span>
          </div>
        </div>
        <div class="d-flex mt-3">
          <div class="d-flex me-6">
            <span class="text-dark me-2">Số văn bản:</span>
            <span class="text-gray-600">{{data?.refNo}}</span>
          </div>
          <div class="d-flex align-items-center text-dark me-6">
            <span class="text-dark me-2">Ngày:</span>
            <span class="text-gray-600">{{data?.refDate | date:"dd/MM/yyyy"}}</span>
            <!-- icon-flag -->
          </div>
        </div>
        <div class="d-flex mt-1">
          <ng-container *ngIf="data && data?.files">
            <thumbnail
              [data]="getJSONString(data?.files)"
            ></thumbnail>
          </ng-container>
        </div>
      </div>
      <div class="d-flex flex-column justify-content-start w-100px pt-2">
        <div class="d-flex justify-content-end">
          <span 
            class="badge badge-light badge-square badge-md fs-7 " 
              [style.color]="getTextColor(data?.status,'3')" 
              [style.backgroundColor]="getBgColor(data?.status,'3')"
          >
            {{fmTextValuelist(data?.status,"3")}}
          </span>
        </div>
        <div class="d-flex justify-content-end mt-2">
          <codx-imgs [objectId]="data?.lstUserID" [numberImages]="3" [width]="30" [mode]="false"></codx-imgs>
        </div>
      </div>
     
    </div>
  </ng-template>
  <ng-template #body>
    <div class="tab-horizone">
      <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
        <li [ngbNavItem]="1">
          <a ngbNavLink>Chi tiết</a>
          <ng-template ngbNavContent>
            <!-- <p>Chi tiết</p> -->
            <!-- <attachment  objectType="TM_Tasks" objectId="TSK2205-0506" functionID="TM001" ></attachment> -->
          </ng-template>
        </li>
        <li [ngbNavItem]="2">
          <a ngbNavLink>Công việc</a>
          <ng-template ngbNavContent>
            <ng-container *ngIf="data?.tasks[0].length>0">
              <codx-treeview #treeAdd id="treeAdd" [data]="data?.tasks[0]" [showSearch]="false" [itemTemplate]="templateorg" [autoLoad]="false" [isOutput]="true" [isLoadChild]="false"></codx-treeview>
            </ng-container>
          </ng-template>
        </li>
        <li [ngbNavItem]="3">
          <a ngbNavLink>Nơi nhận</a>
          <ng-template ngbNavContent>
            <ng-container *ngFor="let item of data?.listInformationRel">
              <div class="list-item has-action-menu  mb-6">
                <div class="d-flex align-items-center">
                  <div class="w-120px me-6">
                    <div class="text-primary d-flex justify-content-center fw-bold fs-4">{{(item.date !=undefined ? item.date : item.createdOn) | date:'shortTime'}}</div>
                    <div class="text-dark d-flex justify-content-center">{{(item.date !=undefined ? item.date : item.createdOn) | date :  "dd/MM/yyyy"}}</div>
                  </div>
                  <div class="d-flex align-items-center">
                    <codx-img #image class="symbol symbol-50px symbol-circle me-4" [objectId]="item.employeeID"></codx-img>
                    <div class="d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="text-dark fw-bold me-2">{{item.employeeName}}</div>
                        <span class="badge badge-light-primary" [style.color]="getTextColor(item.status,'4')" [style.backgroundColor]="getBgColor(item.status,'4')">{{fmTextValuelist(item.status,"5")}}</span>
                        <span class="badge badge-light" [style.color]="getTextColor(item.reCall,'6')" [style.backgroundColor]="getBgColor(item.reCall,'5')" *ngIf="item.reCall">Đã thu hồi</span>
                      </div>
                      <div class="text-gray-600 fs-7">{{item.positionName}}</div>
                      <div class="text-muted fs-8" *ngIf="item.relationType == '1'; else elseDiv">{{fmTextValuelist(item.relationType,"6")}} bởi {{data?.agencyName}}</div>
                      <ng-template #elseDiv>
                        <div class="text-muted fs-8">{{fmTextValuelist(item.relationType,"6")}} bởi {{item.shareBy !=undefined ? item.shareBy : item.createdBy }}</div>
                      </ng-template>
                    </div>
                  </div>
                </div>
                <div class="action-menu d-flex align-items-center cursor-pointer" *ngIf="item.relationType != '1' && !item.reCall && item.employeeID != data?.owner && formModel.userPermission?.refer != 0 && (checkUserPer?.created || checkUserPer?.owner)"><!--  -->
                  <div class="btn btn-sm btn-icon btn-white" (click)="openFormFuncID({functionID:'recallUser',relID: item.recID})"><!-- (click)="openFormRecallSharing(data?.recID,item.recID)" -->
                    <i class="icon-redo text-primary icon-18"></i>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-template>
        </li>
      </ul>
      <div [ngbNavOutlet]="nav" class="py-5"></div>
    </div>
  </ng-template>
  <ng-template #footer>
  </ng-template>
  <ng-template #templateorg let-data>
    <div class="container-fluid justify-content-between d-flex">
      <div class="d-flex align-items-top mt-5" >
          <div class="symbol symbol-40px symbol-circle me-4">
              <codx-img #image [objectId]="data?.userID"></codx-img>
          </div>
          <div class="d-flex flex-column flex-grow-1">
              <div class="d-flex align-items-center mb-1">
                  <span class="text-dark fw-bold">{{data?.userName}}</span>
              </div>
              <div class="text-gray-600 fs-7">{{data?.positionNameCreate}}</div>
              <div class="text-gray-600 fs-7">{{data?.taskName}}</div>
              <div class="d-flex align-items-center mt-2">
                <div class="d-flex align-items-center">
                    <span class="icon-person me-1" [class.text-muted]="data?.items.length == 0" [class.text-primary]="data?.items.length > 0"></span>
                    <span class="text-dark" *ngIf="data?.items.length > 0">{{data?.items.length}}</span>
                </div>
                <div class="d-flex align-items-center ms-6">
                    <span class="icon-chat_bubble_outline me-1 text-muted"></span>
                    <span class="text-dark"></span>
                </div>
                <div class="d-flex align-items-center ms-6">
                    <span class="icon-attach_file me-1 text-muted"></span>
                    <span class="text-dark"></span>
                </div>
            </div>
          </div>
      </div>
      <div class="mt-5 ms-5 justify-content-end w-120px text-center" *ngIf="data?.items.length == 0">
        <span class="fs-8" [style.color]="getTextColor(data?.status,'5')" >{{fmTextValuelist(data?.status,"7")}}</span>
        <div class="progress h-6px w-100 mt-2">
          <div class="progress-bar bg-primary" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="d-flex mt-2">
          <span class="icon-schedule icon-16 text-gray-600"></span>
          <span class="ms-2 text-dark">{{data?.dueDate | date: "dd/MM/yyyy"}}</span>
        </div>
      </div>
    </div>
  </ng-template>
</codx-detail-tmp>
<ng-template #tmpupdate let-dialog>
  <app-od-update [dialog]="dialog" [view]="view"></app-od-update>
</ng-template>
<ng-template #tmpdeadline let-dialog>
  <app-od-deadline [dialog]="dialog" [data]="data" [formModel]="formModel"></app-od-deadline>
</ng-template>
<ng-template #tmpFolderCopy let-dialog>
  <app-od-folder [dialog]="dialog" [data]="data"></app-od-folder>
</ng-template>