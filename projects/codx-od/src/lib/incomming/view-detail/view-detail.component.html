<codx-detail-tmp [header]="header" [dataItem]="dataItem" [formModel]="formModel"  [body]="body" [footer]="footer" (clickMF)="openFormFuncID($event)" class="h-100">
  <ng-template #header>
    <div class="d-flex justify-content-between">
      <div class="w-100">
        <div>
          <codx-temp-full 
            [title]="extractContent(data?.title)"  
            [desc]="convertHtmlAgency(data?.agencyName,data?.txtLstAgency)"
            [bookmark]="false"
            [titleLine]="2"
          >
          </codx-temp-full>
        </div>
        <div class="d-flex flex-wrap mt-2">
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.Category?.headerText +' : '" class="me-2"></codx-label>
            <codx-vll
              [formModel]="formModel"
              [field]="'Category'"
              [value]="data?.category"
              [showText]="true"
              class="text-gray-600"
            >
            </codx-vll>
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.Urgency?.headerText +' : '" [ngClass]="'me-1'"></codx-label>
            <codx-vll
              [formModel]="formModel"
              [field]="'Urgency'"
              [value]="data?.urgency"
              [showText]="true"
              [showIcon]="true"
              class="text-gray-600 d-flex"
            >
            </codx-vll>
            <!-- icon-flag -->
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.Security?.headerText +' : '" [ngClass]="'me-1'"></codx-label>
            <codx-vll
              [formModel]="formModel"
              [field]="'Security'"
              [value]="data?.security"
              [showText]="true"
              [showIcon]="true"
              class="text-gray-600 d-flex"
            >
            </codx-vll>
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.CreatedOn?.headerText +' : '" ngClass="me-2"></codx-label>
            <span class="text-gray-600">{{data?.createdOn ? (data?.createdOn | date:'dd/MM/yyyy') : gridViewSetup?.CreatedOn?.headerText}}</span>
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.DispatchOn?.headerText +' : '" ngClass="me-2"></codx-label>
            <span class="text-gray-600">{{data?.dispatchOn ? (data?.dispatchOn | date:'dd/MM/yyyy') : gridViewSetup?.DispatchOn?.headerText}}</span>
            <!-- <codx-label [default]="data?.dispatchOn | date:'dd/MM/yyyy'" ngClass="text-gray-600"></codx-label> -->
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.Deadline?.headerText +' : '" ngClass="me-2"></codx-label>
            <codx-label [default]="data?.deadline ? (data?.deadline | date:'dd/MM/yyyy') : gridViewSetup?.Deadline?.headerText" ngClass="text-gray-600"></codx-label>
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.RefNo?.headerText +' : '" ngClass="me-2"></codx-label>
            <span class="text-gray-600">{{data?.refNo | formatvalue:formModel:'refNo':'headerText' | async}}</span>
          </div>
          <div class="d-flex align-items-center me-5 mb-2">
            <codx-label [default]="gridViewSetup?.RefDate?.headerText +' : '" ngClass="me-2"></codx-label>
<!--             <span class="text-gray-600">{{data?.refDate | formatvalue:formModel:'refDate':'headerText' | async | date: 'dd/MM/yyyy'}}</span> -->
            <span class="text-gray-600">{{data?.refDate ? (data?.refDate | date:'dd/MM/yyyy') : gridViewSetup?.RefDate?.headerText}}</span>
          </div>
        </div>
      </div>
      <div class="d-flex flex-column justify-content-start w-100px pt-2">
        <div class="d-flex justify-content-end">
          <codx-vll 
            [showText]="true" 
            [formModel]="formModel" 
            [field]="'Status'" 
            [value]="data?.status" 
            class="badge badge-light badge-square badge-md fs-7">
          </codx-vll>
        </div>
        <div class="d-flex justify-content-end mt-2">
          <codx-imgs [objectId]="data?.lstUserID" [numberImages]="3" [width]="30" [mode]="false" ></codx-imgs>
        </div>
      </div>
     
    </div>
    <ng-container *ngIf="data && data?.files">
      <codx-thumbnail
        [files]="data?.files"
        displayThumb="simple"
      >
      </codx-thumbnail>
    </ng-container>
  </ng-template>
  <ng-template #body>
    <div class="tab-horizone h-od-tab  ">
      <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
        <li [ngbNavItem]="1">
          <a ngbNavLink>Nơi nhận</a>
          <ng-template ngbNavContent>
            <ng-container *ngFor="let item of data?.listInformationRel">
              <div class="list-item has-action-menu-1 mb-6">
                <div class="d-flex align-items-top">
                  <div class="w-120px me-6">
                    <div class="text-primary d-flex justify-content-center fw-bold fs-4">{{(item.date ? item.date : item.createdOn) | date:'shortTime'}}</div>
                    <div class="text-dark d-flex justify-content-center text-gray-400 fs-6">{{(item.date ? item.date : item.createdOn) | date :  "dd/MM/yyyy"}}</div>
                  </div>
                  <div class="d-flex align-items-center">
                   <!--  <codx-img #image class="symbol symbol-50px symbol-circle me-4" [objectId]="item.employeeID"></codx-img>
                    <div class="d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="text-dark fw-bold me-2">{{item.employeeName}}</div>
                        <span class="badge badge-light-primary" [style.color]="getTextColor(item.status,'4')" [style.backgroundColor]="getBgColor(item.status,'4')">{{fmTextValuelist(item.status,"5")}}</span>
                        <span class="badge badge-light" [style.color]="getTextColor(item.reCall,'6')" [style.backgroundColor]="getBgColor(item.reCall,'5')" *ngIf="item.reCall">Đã thu hồi</span>
                      </div>
                      <div class="text-gray-600 fs-7">{{item.positionName}}</div>
                      <div class="text-muted fs-8" *ngIf="item.relationType == '1'; else elseDiv">{{fmTextValuelist(item.relationType,"6")}} bởi {{data?.agencyName}}</div>
                      <ng-template #elseDiv>
                        <div class="text-muted fs-8">{{fmTextValuelist(item.relationType,"6")}} bởi {{item.shareBy !=undefined ? item.shareBy : item.createdBy }}</div>
                      </ng-template>
                    </div> -->
                    <codx-temp-full
                      [imageId]="item.userID"
                      [imageObjType]="'AD_Users'"
                      [title]="item.employeeName"
                      [desc]="getSubTitle(item.relationType,data?.agencyName,item?.shareBy , item?.createdBy)"
                      [descLine]="1"
                    >
                    </codx-temp-full>
                  </div>
                  <div class="ms-2">
                  <!--   <codx-vll
                      [name]="'OD009'"
                      [value]="item['status']"
                      [showText]="true"
                      class="badge badge-light-primary"
                    >
                    </codx-vll>
                    <codx-vll
                    [name]="'L0614'"
                    [value]="item['reCall']"
                    [showText]="true"
                    class="badge badge-light"
                  >
                  </codx-vll> -->
                    <span class="badge badge-light-primary" [style.color]="getTextColor(item.status,'4')" [style.backgroundColor]="getBgColor(item.status,'4')">{{fmTextValuelist(item.status,"5")}}</span>
                    <span class="badge badge-light" [style.color]="getTextColor(item.reCall,'6')" [style.backgroundColor]="getBgColor(item.reCall,'5')" *ngIf="item.reCall">Đã thu hồi</span>
                  </div>
                  <ng-container *ngIf="item.relationType != '1' && !item.reCall && item.userID != data?.owner && formModel.userPermission?.refer != 0 && (checkUserPer?.created || checkUserPer?.owner)">
                    <div class="action-menu-1 d-flex justify-content-center align-items-center cursor-pointer" (click)="openFormFuncID({functionID:'recallUser',relID: item.recID})"><!--  -->
                      <i class="icon-redo text-primary icon-18"></i>
                    </div>
                  </ng-container>
                </div>
               
              </div>
            </ng-container>
          </ng-template>
        </li>
        <li [ngbNavItem]="2">
          <a ngbNavLink>Công việc</a>
          <ng-template ngbNavContent>
         <!--    <ng-container *ngIf="data?.tasks[0].length>0">
              <codx-treeview #treeAdd id="treeAdd" [data]="data?.tasks[0]" [showSearch]="false" [itemTemplate]="templateorg" [autoLoad]="false" [isOutput]="true" [isLoadChild]="false"></codx-treeview>
            </ng-container> -->
          </ng-template>
        </li>
        <li [ngbNavItem]="3">
          <a ngbNavLink>Chi tiết</a>
          <ng-template ngbNavContent>
         <!--    <ng-container *ngIf="data?.tasks[0].length>0">
              <codx-treeview #treeAdd id="treeAdd" [data]="data?.tasks[0]" [showSearch]="false" [itemTemplate]="templateorg" [autoLoad]="false" [isOutput]="true" [isLoadChild]="false"></codx-treeview>
            </ng-container> -->
          </ng-template>
        </li>
      </ul>
      <div [ngbNavOutlet]="nav" class="py-5"></div>
    </div>
  </ng-template>
  <ng-template #footer>
    <app-od-tabs></app-od-tabs>
  </ng-template>
  <ng-template #templateorg let-data>
    <div class="container-fluid justify-content-between d-flex">
      <div class="d-flex align-items-top mt-5" >
          <div class="symbol symbol-40px symbol-circle me-4">
              <codx-img #image [objectId]="data?.userID" [objectType]="'AD_Users'"></codx-img>
          </div>
          <div class="d-flex flex-column flex-grow-1">
              <div class="d-flex align-items-center mb-1">
                  <span class="text-dark fw-bold">{{data?.userName}}</span>
              </div>
              <div class="text-gray-600 fs-7">{{data?.positionNameCreate}}</div>
              <div class="text-gray-600 fs-7">{{data?.taskName}}</div>
              <div class="d-flex align-items-center mt-2">
                <div class="d-flex align-items-center">
                    <span class="icon-person me-1" [class.text-muted]="data?.items.length == 0" [class.text-primary]="data?.items.length > 0"></span>
                    <span class="text-dark" *ngIf="data?.items.length > 0">{{data?.items.length}}</span>
                </div>
                <div class="d-flex align-items-center ms-6">
                    <span class="icon-chat_bubble_outline me-1 text-muted"></span>
                    <span class="text-dark"></span>
                </div>
                <div class="d-flex align-items-center ms-6">
                    <span class="icon-attach_file me-1 text-muted"></span>
                    <span class="text-dark"></span>
                </div>
            </div>
          </div>
      </div>
      <div class="mt-5 ms-5 justify-content-end w-120px text-center" *ngIf="data?.items.length == 0">
        <span class="fs-8" [style.color]="getTextColor(data?.status,'5')" >{{fmTextValuelist(data?.status,"7")}}</span>
        <div class="progress h-6px w-100 mt-2">
          <div class="progress-bar bg-primary" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="d-flex mt-2">
          <span class="icon-schedule icon-16 text-gray-600"></span>
          <span class="ms-2 text-dark">{{data?.dueDate | date: "dd/MM/yyyy"}}</span>
        </div>
      </div>
    </div>
  </ng-template>
</codx-detail-tmp>
<ng-template #tmpdeadline let-dialog>
  <app-od-deadline [dialog]="dialog" [data]="data" [formModel]="formModel"></app-od-deadline>
</ng-template>
<ng-template #tmpFolderCopy let-dialog>
  <app-od-folder [dialog]="dialog" [data]="data"></app-od-folder>
</ng-template>