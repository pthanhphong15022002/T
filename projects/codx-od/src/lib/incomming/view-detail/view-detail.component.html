<codx-detail-tmp [header]="header" [dataItem]="dataItem" [formModel]="formModel" [body]="body"
  [footer]="!hideFooter ? footer : null" [hideMF]="hideMF" (clickMF)="openFormFuncID($event)"
  (changeDataMF)="changeDataMF($event, dataItem)" class="h-100">
  <ng-template #header>
    <div class="d-flex justify-content-between">
      <div class="w-100">
        <div>
          <codx-temp-full [title]="data?.title" [titleCss]="'fs-5'"
            [desc]="convertHtmlAgency(data?.agencyName, data?.departmentName)" [bookmark]="false" [titleLine]="2">
          </codx-temp-full>
        </div>
        <div class="d-flex flex-wrap mt-2">
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label
              [gridViewName]="formModel['gridViewName']"
              [formName]="formModel['formName']"
              fiedName="CategoryID"
              class="me-2 fw-bold"
            ></codx-label>
           <span [class.text-gray-600]="!data?.category">{{data?.category?data?.category:gridViewSetup["CategoryID"]["headerText"]}}</span>
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']" fiedName="Urgency"
              [ngClass]="'me-1 fw-bold'"></codx-label>
            <codx-vll [formModel]="formModel" [field]="'Urgency'" [value]="data?.urgency" [showText]="true"
              [showIcon]="true" class="text-gray-600 d-flex">
            </codx-vll>
            <!-- icon-flag -->
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']"
              fiedName="Security" [ngClass]="'me-1 fw-bold'"></codx-label>
            <codx-vll [formModel]="formModel" [field]="'Security'" [value]="data?.security" [showText]="true"
              [showIcon]="true" class="text-gray-600 d-flex">
            </codx-vll>
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']"
              fiedName="CreatedOn" ngClass="me-2 fw-bold"></codx-label>
            <span class="text-gray-600">{{
              data?.createdOn
              ? (data?.createdOn | date: "dd/MM/yyyy")
              : gridViewSetup?.CreatedOn?.headerText
              }}</span>
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']"
              fiedName="DispatchOn" ngClass="me-2 fw-bold"></codx-label>
            <span class="text-gray-600">{{
              data?.dispatchOn
              ? (data?.dispatchOn | date: "dd/MM/yyyy")
              : gridViewSetup?.DispatchOn?.headerText
              }}</span>
            <!-- <codx-label [default]="data?.dispatchOn | date:'dd/MM/yyyy'" ngClass="text-gray-600"></codx-label> -->
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']"
              fiedName="Deadline" ngClass="me-2 fw-bold"></codx-label>
            <span class="text-gray-600">{{
              data?.deadline
              ? (data?.deadline | date: "dd/MM/yyyy")
              : gridViewSetup?.Deadline?.headerText
              }}</span>
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']" fiedName="RefNo"
              ngClass="me-2 fw-bold"></codx-label>
            <span class="text-gray-600">{{
              data?.refNo ? data?.refNo : gridViewSetup?.RefNo?.headerText
              }}</span>
          </div>
          <div class="d-flex align-items-center me-5 mb-3">
            <codx-label [gridViewName]="formModel['gridViewName']" [formName]="formModel['formName']" fiedName="RefDate"
              ngClass="me-2 fw-bold"></codx-label>
            <!--             <span class="text-gray-600">{{data?.refDate | formatvalue:formModel:'refDate':'headerText' | async | date: 'dd/MM/yyyy'}}</span> -->
            <span class="text-gray-600">{{
              data?.refDate
              ? (data?.refDate | date: "dd/MM/yyyy")
              : gridViewSetup?.RefDate?.headerText
              }}</span>
          </div>
        </div>
      </div>
      <div class="d-flex flex-column justify-content-start w-100px pt-2">
        <div class="d-flex justify-content-end">
          <codx-vll [showText]="true" [showBgColor]="true" [formModel]="formModel" [field]="'Status'"
            [value]="data?.status" class="badge badge-light badge-square badge-md fs-7 p-2">
          </codx-vll>
        </div>
        <div class="d-flex justify-content-end mt-2">
          <codx-imgs [objectId]="data?.lstUserID" [numberImages]="3" [width]="30" [mode]="false"></codx-imgs>
        </div>
      </div>
    </div>
    <ng-container *ngIf="data && data?.files">
      <codx-thumbnail [files]="data?.files" displayThumb="simple" [hideDelete]="'0'" [hideMoreF]="'0'"
        (viewFile)="handleViewFile($event)">
      </codx-thumbnail>
    </ng-container>
  </ng-template>
  <ng-template #body>
    <div class="tab-horizone h-od-tab h-100">
      <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
        <li [ngbNavItem]="1">
          <a ngbNavLink>
            <div class="d-flex align-item-center">
              <i class="fa-solid fa-user-tag me-2 mt-1" [ngClass]="{ 'text-primary': active === 1 }"></i><span>Nơi
                nhận</span>
            </div>
          </a>
          <ng-template ngbNavContent>
            <ng-container *ngIf="data?.listInformationRel; else defaulEmpt">
              <ng-container *ngFor="let item of data?.listInformationRel">
                <div class="list-item has-action-menu-od mb-6">
                  <div class="d-flex align-items-start">
                    <div class="w-120px me-6">
                      <div class="text-primary d-flex justify-content-center fw-bold fs-4">
                        {{
                        (item.date ? item.date : item.createdOn)
                        | date: "shortTime"
                        }}
                      </div>
                      <div class="text-dark d-flex justify-content-center text-gray-400 fs-6">
                        {{
                        (item.date ? item.date : item.createdOn)
                        | date: "dd/MM/yyyy"
                        }}
                      </div>
                    </div>
                    <div class="d-flex align-items-center">
                      <codx-temp-full [imageId]="item?.userID" [imageObjType]="'AD_Users'" [title]="item?.employeeName"
                        [subTitle]="item?.positionName" [desc]="
                          getSubTitle(
                            item.relationType,
                            data?.agencyName,
                            item?.shareBy
                          )
                        " [descLine]="1" [dataItem]="item" [baseHeaderRightTmp]="baseTmpRight"
                        [cardCss]="'justify-content-center align-items-center'">
                      </codx-temp-full>
                    </div>
                    <ng-container *ngIf="
                        item.relationType != '1' &&
                        !item.reCall &&
                        formModel.userPermission?.refer != 0 &&
                        (checkUserPer?.created || checkUserPer?.owner)
                      ">
                      <ng-container *ngIf="
                          item.userID != data?.owner || item.relationType != '2'
                        ">
                        <div class="action-menu-od d-flex justify-content-center align-items-center cursor-pointer"
                          (click)="
                            openFormFuncID({
                              functionID: 'recallUser',
                              relID: item.recID
                            })
                          ">
                          <!--  -->
                          <i class="icon-redo text-primary icon-18"></i>
                        </div>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </ng-template>
        </li>
        <li [ngbNavItem]="2">
          <a ngbNavLink>
            <div class="d-flex align-item-center">
              <i class="icon-format_list_numbered me-2" [ngClass]="{ 'text-primary': active === 2 }"></i><span>Công
                việc</span>
            </div>
          </a>
          <ng-template ngbNavContent>
            <ng-container *ngIf="data?.tasks && data?.tasks.length > 0; else defaulEmpt">
              <codx-treeview #treeAdd id="treeAdd" [data]="data?.tasks" [itemTemplate]="templateorg"
                [enableCheck]="true" idField="recID" parentIdField="parentID" [autoLoad]="false" [isOutput]="true"
                [isLoadChild]="false"></codx-treeview>
            </ng-container>
          </ng-template>
        </li>
        <li [ngbNavItem]="3">
          <a ngbNavLink>
            <div class="d-flex align-item-center">
              <i class="icon-info me-2" [ngClass]="{ 'text-primary': active === 3 }"></i><span>Chi tiết</span>
            </div>
          </a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="defaulEmpt"></ng-container>
          </ng-template>
        </li>
      </ul>
      <div [ngbNavOutlet]="nav" class="pt-5"></div>
    </div>
  </ng-template>
  <ng-template #footer>
    <codx-tabs [entityName]="formModel?.entityName" [objectID]="data?.recID" [funcID]="formModel?.funcID"></codx-tabs>
  </ng-template>

  <ng-template #templateorg let-item>
    <div class="container-fluid justify-content-between d-flex">
      <div class="d-flex align-items-top mt-5">
        <codx-temp-full [imageId]="item?.userID" [imageObjType]="'AD_Users'" [title]="item?.userName" [titleLine]="2"
          [subTitle]="item?.positionNameCreate" [desc]="item?.taskName" [dataItem]="item" [footer]="footerTask">
        </codx-temp-full>
      </div>
      <div class="mt-5 ms-5 justify-content-end w-120px text-center">
        <codx-vll
          [name]="item?.category=='3'? vllStatusAssign:vllStatus"
          [value]="item?.status"
          [showText]="true"
          [showBgColor]="true"
          class="badge badge-light badge-md fs-7 ms-2"
        ></codx-vll>
        <div class="progress h-6px w-100 mt-2">
          <div class="fs-7 text-gray-600 mb-1">
            {{ data?.percentage.toFixed(2) }}%
          </div>
          <div class="progress w-100 h-5px">
            <div class="progress-bar progress-bar-done" role="progressbar" [style.width.%]="data?.percentage"></div>
          </div>
        </div>
        <div class="d-flex justify-content-between align-item-center mt-2">
          <!-- <span class="icon-schedule icon-16 text-gray-600"></span> -->
          <span *ngIf="data?.isTimeOut" class="icon-notifications expired icon-16 ms-1"></span>
          <span class="ms-2 text-dark" #dueDate>{{
            item?.dueDate
            | formatvalue: formModel:"dueDate":dueDate:"Tasks":"grvTasks"
            | async
            }}</span>
        </div>
      </div>
    </div>
  </ng-template>
</codx-detail-tmp>
<ng-template #tmpdeadline let-dialog>
  <app-od-deadline [dialog]="dialog" [data]="data" [formModel]="formModel"></app-od-deadline>
</ng-template>
<ng-template #tmpFolderCopy let-dialog>
  <app-od-folder [dialog]="dialog" [data]="data"></app-od-folder>
</ng-template>

<ng-template #footerTask let-item>
  <div class="d-flex align-items-center ms-7" (click)="clickTemp($event)">
    <span class="me-4">
      <codx-assign-temp [objectID]="item.taskID"></codx-assign-temp>
    </span>
    <span class="me-4">
      <codx-comment-temp [objectID]="item.recID"></codx-comment-temp>
    </span>
    <span class="me-4">
      <codx-attachment-temp [objectID]="item.recID" [formModel]="formModel"></codx-attachment-temp>
    </span>
  </div>
</ng-template>

<ng-template #baseTmpRight let-data>
  <ng-container *ngIf="data?.relationType != '1' && !data?.reCall">
    <codx-vll [showText]="true" [showBgColor]="true" [name]="'OD009'" [value]="data?.view"
      class="badge badge-light badge-md fs-7 ms-2">
    </codx-vll>
  </ng-container>

  <ng-container *ngIf="data?.reCall">
    <codx-vll [showText]="true" [showBgColor]="true" [name]="'OD010'" [value]="data?.reCall"
      class="badge badge-light badge-md fs-7 ms-2">
    </codx-vll>
  </ng-container>
</ng-template>
<ng-template #defaulEmpt>
  <div class="container h-100">
    <div class="list-empty card card-flush h-100">
      <div class="d-flex flex-column flex-center justify-content-center">
        <img src="../assets/themes/sys/default/img/DataEmpty.svg" class="w-200px" />
        <div class="fw-bold mt-1 text-center">
          {{ "SYS011" | mssg | async }}
        </div>
        <!-- <div class="mt-2 text-center">Chưa có dữ liệu phát sinh.</div> -->
      </div>
    </div>
  </div>
</ng-template>