<codx-form
  #form
  [headerText]="headerText + ' template'"
  [body]="body"
  [footer]="footer"
  [dialog]="dialog"
  [data]="data"
  [formModel]="formModels"
></codx-form>
<ng-template popup adde #body>
  <div class="py-2">
    <div class="py-2">
      <codx-label  default="Tên mapping" class="fw-bold"></codx-label>
      <codx-input type="combobox" [refValue]="'MappingTemplate'" [crrValue]="dataIETable?.mappingName" [field]="'mappingName'"  (valueChange)="changeValueCBB($event,true)"></codx-input>
    </div>
    <div class="d-flex align-items-center justify-content-between row py-2">
      <div class="col-2">
        <codx-label [formModel]="formModels" [fiedName]="'ProcessIndex'"  class="fw-bold"></codx-label>
        <codx-input type="number" [min]="0" [showSpinButton]="false" [Group]="addMappingForm" ControlName="processIndex"></codx-input>
      </div>
      <div class="col-3">
        <codx-label [formModel]="formModels" [fiedName]="'DestinationTable'" class="fw-bold"></codx-label>
        <codx-input type="text" [Group]="addMappingForm" ControlName="destinationTable"></codx-input>
      </div>
      <div class="col-3">
        <codx-label [formModel]="formModels" [fiedName]="'ParentEntity'" class="fw-bold"></codx-label>
        <codx-input type="combobox" [Group]="addMappingForm" ControlName="parentEntity"></codx-input>
      </div>
      <div class="col-2">
        <codx-label [formModel]="formModels" [fiedName]="'ImportRule'" class="fw-bold"></codx-label>
        <codx-input type="valuelist" refValue="SYS010" [crrValue]="dataIETable?.importRule" [field]="'importRule'" (valueChange)="changeValueCBB($event)"></codx-input>
      </div>
      <div class="col-2 d-flex align-items-center">
        <codx-input type="switch" [Group]="addMappingForm" ControlName="isSummary" style="margin-top:6px"></codx-input>
        <codx-label [formModel]="formModels" [fiedName]="'IsSummary'" class="ms-2" ></codx-label>
      </div>
    </div>
  </div>
  <div class="h-feildImport">
    <!-- <table class="table d-inline-block w-100">
      <thead>
        <tr>
          <th scope="col"><codx-label default="Trường nhận" class="fw-bold"></codx-label></th>
          <th scope="col" *ngFor="let item of fieldImport"><codx-label [default]="item?.headerText" class="fw-bold"></codx-label></th>
        </tr>
      </thead>
      <tbody>
        Chưa làm được form group huhu nhớ làm nha-->
        <!-- <tr *ngFor="let item of dataImport">
          <td>{{item?.destinationField}}</td>
          <ng-container *ngTemplateOutlet="tmpTable; context: { $implicit: item}"></ng-container> -->
         
         <!--  <td><codx-input type="text" (valueChange)="changeValueText(item,'dataType',$event)"></codx-input></td>
          <td class="w-80px text-center"><codx-input type="checkbox"></codx-input></td>
          <td><codx-input type="text"></codx-input></td>
          <td  class="w-140px"><codx-input type="text"></codx-input></td>
          <td><codx-input type="text"></codx-input></td>
          <td><codx-input type="text"></codx-input></td>
          <td><codx-input type="text"></codx-input></td> 
        </tr>
      </tbody>
    </table> -->
        <!--   (contextMenuOpen)="contextMenuOpen($event)" 
      (contextMenuClick)="contextMenuClick($event)"
    [contextMenuItems]="contextMenuItems" -->
    <ejs-grid #grid 
      [dataSource]='dataImport2' 
      height="500" width="100%" 
      [editSettings]='editSettings' 
      (load)='load($event)'
      [selectionSettings]='selectionOptions'
      (actionComplete)="onActionComplete($event)"
      > 
      <e-columns>
        <e-column *ngFor="let item of fieldImport ; let i = index" 
        [field]='item?.text' 
        width="200"  
        [isPrimaryKey]='i==0?true:false'
        [headerText]="getHeaderText(item?.text)"
        [editType]="getEditType(item?.controlType)" 
        [type]="getType(item?.controlType)" 
        [edit]="getEdit(item?.type,item?.text)" 
    
        [displayAsCheckBox]="true"
        [validationRules]="item?.require ?customerIDRules:null"
        [textAlign]="getTextAligin(item?.controlType)"
        >
        </e-column>
        <!--   -->
    </e-columns>   
  </ejs-grid> 
  </div>
</ng-template>
<ng-template #footer>
    <div class="d-flex justify-content-end">
      <button type="button" class="btn btn-outline-primary me-2" >
        <codx-label [formModel]="formModel" [fiedName]="'saveTemplate'" [default]="'Lưu làm template'"></codx-label>
      </button>
      <button class="btn btn-primary" (click)="onSave()">
        <codx-label [formModel]="formModel" [fiedName]="'save'" [default]="'Lưu'"></codx-label>
      </button>
    </div>
</ng-template>
<ng-template #tmpTable let-item>
  <ng-container *ngFor="let item2 of fieldImport">
    <td >
      <ng-container [ngSwitch]="item2?.controlType">
        <ng-container *ngSwitchCase="'TextBox'">
          <codx-input type="text" (valueChange)="changeValueText(item,item2?.fieldName,$event)"></codx-input>
        </ng-container>
        <ng-container *ngSwitchCase="'CheckBox'">
          <codx-input type="checkbox" (valueChange)="changeValueText(item,item2?.fieldName,$event)"></codx-input>
        </ng-container>
        <ng-container *ngSwitchCase="'ComboBox'">
          <ng-container *ngIf="item2?.referedType == 2; else elseCBB">
            <codx-input type="valuelist"  [refValue]="item2?.referedValue" ></codx-input>
          </ng-container>
          <ng-template #elseCBB>
            <codx-input type="combobox"  [refValue]="item2?.referedValue" ></codx-input>
          </ng-template>
        </ng-container>
        <ng-container *ngSwitchCase="'MaskBox'">
        </ng-container>
      </ng-container>
    </td>
  </ng-container>
</ng-template>


