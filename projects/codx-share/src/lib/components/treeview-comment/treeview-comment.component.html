<div class="d-flex align-items-center justify-content-between mt-3 mb-3">
    <div class="d-flex align-items-center">
        <ng-container *ngIf="rootData.totalVote == 0;else Vote">
            <div class="flex align-items-center">
                <span class="me-2">
                    <img src="assets/themes/wp/default/img/L1480_None.svg" alt="Kiwi standing on oval"
                        style="width: 20px; height: 20px;">
                </span>
                <span class="ms-2">{{rootData.totalVote}}</span>
            </div>
        </ng-container>
        <ng-template #Vote>
            <div class="flex align-items-center">
                <div *ngFor="let votedType of rootData.listVoteType">
                    <a class="me-2" (click)="showVotes(popContentListVoted, rootData.recID)">
                        <img src="/assets/themes/wp/default/img/{{(votedType | vll:'L1480':'icon' | async)}}"
                            alt="Kiwi standing on oval" style="width: 20px; height: 20px;">
                    </a>
                </div>
            </div>
            <span class="ms-2">{{rootData.totalVote}}</span>
        </ng-template>
    </div>
    <div class="d-flex align-items-center text-hover-underline" (click)="showComments(rootData)">
        <span>{{rootData.totalComment}}</span>
        <span class="text-dark-75 ms-2">
            <codx-label formName="WP_Comments" name="lblComments" default="Bình luận"></codx-label>
        </span>
    </div>
</div>
<div class="row m-0 btn-comment pt-2 border-top">
    <div class="col-6 p-0">
        <div class="btn-like {{rootData.myVoted ? 'liked' : ''}} delay-500">
            <div *ngIf="rootData.myVotedType == null && checkVoted == false">
                <div class="d-flex align-items-center justify-content-center text-hover-primary">
                    <img src="/assets/themes/wp/default/img/L1480_None.svg" alt="Kiwi standing on oval"
                        style="width: 20px; height: 20px;">
                    <span class="font-weight-bold ms-2" style="color: gray;">
                        <codx-label formName="WP_Comments" name="lblLike" default="Thích"></codx-label>
                    </span>
                </div>
            </div>
            <div class="d-flex mod icon-like">
                <ng-container *ngFor="let item of lstData">
                    <a class="mod-icon" (click)="votePost(rootData, item.value)">
                        <img src="/assets/themes/wp/default/img/{{item.icon}}" alt="Kiwi standing on oval"></a>
                </ng-container>
            </div>
            <ng-container *ngIf="rootData.myVotedType">
                <div class="d-flex align-items-center justify-content-center text-hover-primary">
                    <img src="/assets/themes/wp/default/img/{{(rootData.myVotedType | vll:'L1480':'icon' | async)}}"
                        alt="Kiwi standing on oval" style="width: 22px; height: 22px">
                    <div *ngIf="rootData.myVotedType == '1'">
                        <span class="font-weight-bold ms-2" style="color: #0057FF;">
                            <codx-label formName="WP_Comments" name="lblLike" default="Thích"></codx-label>
                        </span>
                    </div>
                    <div *ngIf="rootData.myVotedType == '2'">
                        <span class="font-weight-bold ms-2" style="color: #FFA800;">
                            <codx-label formName="WP_Comments" name="lblPerfect" default="Tuyệt vời"></codx-label>

                        </span>
                    </div>
                    <div *ngIf="rootData.myVotedType == '3'">
                        <span class="font-weight-bold ms-2" style="color: #FFA800;">
                            <codx-label formName="WP_Comments" name="lblHaha" default="Haha"></codx-label>
                        </span>
                    </div>
                    <div *ngIf="rootData.myVotedType == '4'">
                        <span class="font-weight-bold ms-2" style="color: #FFA800;">
                            <codx-label formName="WP_Comments" name="lblSad" default="Buồn"></codx-label>
                        </span>
                    </div>
                    <div *ngIf="rootData.myVotedType == '5'">
                        <span class="font-weight-bold ms-2" style="color: #E96200;">
                            <codx-label formName="WP_Comments" name="lblAmgry" default="Tức giận"></codx-label>

                        </span>
                    </div>
                </div>
            </ng-container>
        </div>

    </div>
    <div class="col-6 p-0">
        <div class="btn-com" (click)="showComments(rootData)">
            <div class="d-flex align-items-center justify-content-center text-hover-primary">
                <span class="icon-chat_bubble_outline icon-18"></span>
                <span class="text-dark font-weight-bold ms-2">
                    <codx-label formName="WP_Comments" name="lblComments" default="Bình luận"></codx-label>
                </span>
            </div>
        </div>
    </div>
</div>
<div class="isHiden border-top" [class.isShow]="rootData.isShowComment">
    <div class="position-relative cmt c1 feed-box my-3" (keyup.enter)="sendComment(rootData,comments)">
        <codx-input class="border-0 bg-transparent" type="text" placeholder="Bình luận" [crrValue]="comments"
            (valueChange)="valueChange($event,'comments')">
        </codx-input>
        <div class="feed-icon btn-send">
            <span class="btn btn-icon btn-sm px-0 text-dark-50 text-hover-primary "
                (click)="sendComment(rootData,comments)">
                <span class="icon-send icon-18"></span>
            </span>
        </div>
    </div>

    <ng-container *ngFor="let cm of rootData.listComment">
        <ng-container *ngTemplateOutlet="parentComment; context: { $implicit: cm }">

        </ng-container>
    </ng-container>

    <ng-template #parentComment let-data>
        <div class="d-flex pt-2" [attr.dt]="setDicData(data)" id="{{data.recID}}">
            <div class="me-4">
                <codx-img [width]="35" objectType="AD_Users" [objectId]="data?.createdBy">
                </codx-img>
            </div>
            <div class="d-flex flex-column w-100">
                <div class="d-flex comments">
                    <div class="comment-content level-1">
                        <div class="d-flex align-items-center flex-wrap">
                            <div class="d-flex">
                                <a href="#" class="text-dark-75 text-hover-primary font-weight-bold">
                                    {{data.createdName}}</a>
                            </div>
                            <div class="d-flex ms-4">
                                <!-- <span class="text-muted font-weight-normal flex-grow-1 font-size-sm"
                                    data-toggle="tooltip"
                                    title="{{data.createdOn | date:'dd/MM/yyyy HH:mm'}}">{{data.createdOn |
                                    timefrom}}</span> -->
                            </div>
                        </div>
                        <div class="text-dark text-comment" [innerHTML]="data?.content"></div>
                        <div class="d-flex align-items-center comment-thumb {{data.myVoted ? 'liked' : ''}}"
                            *ngIf="data.totalVote > 0">
                            <span class="icon-thumb_up icon-14 text-hover-primary"></span>
                            <span class="ms-2">{{data.totalVote}}</span>
                        </div>
                    </div>
                </div>
                <div class="mt-2 d-flex justify-content-between align-items-center">
                    <div class="d-flex flex-grow-1">
                        <span class="text-muted font-size-sm text-hover-primary " [class.liked]="data.myVoted"
                            (click)="voteComment(data)">
                            <div class="btn-like delay-500">
                                <codx-label formName="WP_Comments" name="lblLike" default="Thích"></codx-label>
                                <div class="d-flex mod icon-like">
                                    <ng-container *ngFor="let item of lstData">
                                        <a class="mod-icon">
                                            <img src="/assets/themes/wp/default/img/{{item.icon}}" alt="Kiwi standing on oval"></a>
                                    </ng-container>
                                </div>
                            </div>
                        </span>
                        <span class="text-muted font-size-sm text-hover-primary ms-2" (click)="replyTo(data)">
                            <codx-label formName="WPW_Comments" name="lblReply" default="Trả lời"></codx-label>
                        </span>
                    </div>

                </div>
                <ng-container *ngFor="let item of data.listComment">
                    <!-- <ng-container *ngTemplateOutlet="parentComment; context: { $implicit: item }">
                </ng-container> -->
                    <ng-container *ngTemplateOutlet="childComment context: { $implicit: item }">

                    </ng-container>
                </ng-container>
                <ng-container *ngIf="data.showReply">
                    <div class="position-relative cmt feed-box cmt-cmt mt-4 c3"
                        (keyup.enter)="replyComment(data,repComment)">
                        <codx-input type="text" placeholder="Trả lời" [crrValue]="repComment"
                            (valueChange)="valueChange($event,'repComment')">
                        </codx-input>
                        <div class="feed-icon btn-send">
                            <span class="btn btn-icon btn-sm px-0 text-dark-50 text-hover-primary "
                                (click)="replyComment(data,repComment)">
                                <span class="icon-send icon-18"></span>
                            </span>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </ng-template>
    <!-- comments lv2  -->
    <ng-template #childComment let-childData>
        <div class="d-flex mt-2" [attr.dt]="setDicData(childData)">
            <div class="me-3">
                <codx-img [width]="40" objectType="AD_Users" [objectId]="childData?.createdBy">
                </codx-img>
            </div>
            <div class="d-flex flex-column w-100  ms-4">
                <div class="d-flex comments">
                    <div class="comment-content level-1">
                        <div class="d-flex align-items-center flex-wrap">
                            <div class="d-flex">
                                <a href="#" class="text-dark-75 text-hover-primary font-weight-bold">
                                    {{childData.createdName}}</a>
                            </div>
                            <div class="d-flex ms-4">
                                <!-- <span class="text-muted font-weight-normal flex-grow-1 font-size-sm"
                                    childData-toggle="tooltip"
                                    title="{{childData.createdOn | date:'dd/MM/yyyy HH:mm'}}">{{childData.createdOn |
                                    timefrom}}</span> -->
                            </div>
                        </div>
                        <div class="text-dark text-comment" [innerHTML]="childData?.content"></div>
                        <div class="d-flex align-items-center comment-thumb {{childData.myVoted ? 'liked' : ''}}"
                            *ngIf="childData.totalVote > 0">
                            <span class="icon-thumb_up icon-14 text-hover-primary"></span>
                            <span class="ms-2">{{childData.totalVote}}</span>
                        </div>
                    </div>
                </div>
                <div class="mt-2 d-flex justify-content-between align-items-center">
                    <div class="d-flex flex-grow-1">
                        <span class="text-muted font-size-sm text-hover-primary " [class.liked]="childData.myVoted"
                            (click)="voteComment(childData)">
                            <codx-label formName="WP_Comments" name="lblLike" default="Thích"></codx-label>
                        </span>
                        <span class="text-muted font-size-sm text-hover-primary ms-2" (click)="replyTo(childData)">
                            <codx-label formName="WP_Comments" name="lblReply" default="Trả lời"></codx-label>
                        </span>
                    </div>
                </div>
                <ng-container *ngIf="childData.totalRecord > 0">
                    <div class="align-items-center" [class]="childData.isShowComment?'isHiden':'isShow'">
                        <span (click)="loadSubComment(childData)" type="button" class="btn btn-icon rotate-180">
                            <span class="icon-reply icon-18"></span>
                        </span>
                        <span class="text-dark-75" (click)="loadSubComment(childData)">
                            {{childData.totalRecord}}
                            <codx-label formName="WP_Comments" name="lblReply" default="Trả lời"></codx-label>
                        </span>
                    </div>
                </ng-container>
                <ng-container *ngFor="let item of childData.listComment">
                    <ng-container *ngTemplateOutlet="parentComment context: { $implicit: item }">
                    </ng-container>
                </ng-container>
                <ng-container *ngIf="childData.showReply">
                    <div class="position-relative cmt feed-box cmt-cmt mt-4 c3"
                        (keyup.enter)="replyComment(childData,repComment)">
                        <codx-input type="text" placeholder="Trả lời" [crrValue]="repComment"
                            (valueChange)="valueChange($event,'repComment')">
                        </codx-input>
                        <div class="feed-icon btn-send">
                            <span class="btn btn-icon btn-sm px-0 text-dark-50 text-hover-primary "
                                (click)="replyComment(childData,repComment)">
                                <span class="icon-send icon-18"></span>
                            </span>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </ng-template>
</div>


<ng-template #popContentListVoted let-dialog>
    <codx-form headerText="Danh sách" [body]="body" [dialog]="dialog" >

    </codx-form>
    <ng-template #body>
        <div class="card-body">
            <div class="tab-horizone mt-2">
                <ul class="nav nav-tabs nav-tabs-line">
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab">
                            <div class="flex">
                                <div class="" style="margin-left: 5px">
                                    <span class="nav-text d-block h-20px">
                                        <codx-label formName="Comments" name="lblTotal" default="Tất cả"></codx-label>
                                    </span>
                                </div>
                                <div class="" style="margin-left: 5px">
                                    <span class="nav-text d-block h-20px">{{rootData.totalVote}}</span>
                                </div>
                            </div>
                        </a>
                    </li>
                    
                    <li *ngFor="let vote of votes" class="nav-item" (click)="getUserVotes(rootData.recID,vote)">
                        <a class="nav-link" data-toggle="tab">
                            <div class="flex">
                                <div class="">
                                    <img class="h-20px w-20px"
                                        src="/assets/themes/wp/default/img/{{(vote | vll:'L1480':'icon' | async)}}">
                                </div>
                                <div class="" style="margin-left: 5px">
                                    <span class="nav-text d-block h-20px">
                                        <codx-label formName="Comments" name="lblLike" default="Thích"></codx-label>
                                    </span>
                                </div>
                                <div class="" style="margin-left: 5px">
                                    <span class="nav-text d-block h-20px">{{vote.length}}</span>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <div class="tab-content mt-2">
                    <div class="tab-pane">
                        <div *ngFor="let item of lstUserVote" class="d-flex align-items-center user-card py-4">
                            <div class="me-4">
                                <codx-img [width]="40" [objectId]="item.CreatedBy" objectType="HR_Employees">
                                </codx-img>
                            </div>
                            <div class="d-flex flex-column flex-grow-1">
                                <div class="text-dark font-weight-bold">{{item.createdName}}</div>
                                <div class="text-dark-75 font-weight-bold">{{item.positionName}}</div>
                                <div class="text-muted">{{item.createdOn | date:'dd-MM-yyy HH:mm:ss'}}</div>
                            </div>
                            <div class="ms-6" style="margin-right: 45px">
                                <img src="/assets/themes/wp/default/img/{{(item.voteType|vll:'L1480':'icon'|async)}}"
                                    alt="Kiwi standing on oval" style="width: 20px; height: 20px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>
    
</ng-template>