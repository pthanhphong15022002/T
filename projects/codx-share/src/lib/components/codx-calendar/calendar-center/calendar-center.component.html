<codx-views
  #view
  [views]="views"
  [button]="btnAdd"
  [autoLoad]="false"
  [toolbarDisplay]="false"
  (onActions)="onAction($event)"
  [viewActiveType]="7"
>
</codx-views>

<ng-template #cellTemplate let-data>
  <div [innerHtml]="getCellContent(data.date)"></div>
</ng-template>

<ng-template #contentTmp let-data>
  <ng-container #tmpTM_Tasks *ngIf="data?.transType == 'TM_MyTasks'">
    <div>
      <h5>{{ data.title }}</h5>
    </div>
    <div class="d-flex mt-1 flex-grow-1 mb-2 me-6">
      <i class="icon-person me-1"></i>
      <span class="text-gray-600 text-break">
        {{ data.userNameCreate }}
      </span>
    </div>
    <div class="d-flex justify-content-between mt-1 flex-grow-1 mb-2 me-6">
      <div class="d-flex mt-1 flex-grow-1">
        <div *ngIf="data.priority">
          <codx-vll
            [showText]="true"
            [showBgColor]="true"
            [showIcon]="true"
            name="TM005"
            [value]="data.priority"
            class="icon-14 me-1"
          >
          </codx-vll>
        </div>
        <div
          #priority
          *ngIf="!data.priority"
          [innerHTML]="
            data.priority
              | formatvalue
                : view.formModel
                : 'priority'
                : priority
                : 'Tasks'
                : 'grvTasks'
              | async
          "
        ></div>
      </div>
      <div *ngIf="data.alert">
        <span
          class="icon-notifications expired"
          [ngbPopover]="popOverDue"
          #popOver="ngbPopover"
          [openDelay]="500"
          (mouseenter)="popOver.open()"
          (mouseleave)="popOver.close()"
          placement="top right bottom"
        ></span>
      </div>
    </div>
    <div class="d-flex mt-1 flex-grow-1 mb-2">
      <div class="d-flex me-6">
        <i class="icon-calendar_today icon-16 me-2"></i>
        <span class="text-gray-600">
          {{ data?.startDate | fmDT }}
        </span>
      </div>
      <div class="d-flex me-6">
        <i class="icon-access_time me-1"></i>
        <span class="text-gray-600">
          {{ showHour(data?.startDate) }}
        </span>
        <span
          *ngIf="data?.startDate && data?.endDate"
          class="text-gray-600 ms-1 me-1"
          >{{ "-" }}</span
        >
        <span class="text-gray-600">
          {{ showHour(data?.endDate) }}
        </span>
      </div>
    </div>
    <hr />
    <div class="mb-2 text-dark me-6">
      <span>
        <codx-label
          default="Nội dung công việc:"
          name="lblMemo"
          [formModel]="view.formModel"
          class="fw-bold text-nowrap"
        >
        </codx-label>
      </span>
      <span class="ms-2 fw-bold">
        <span class="text-gray-700 size-content-schedule cursor-pointer">
          <ng-container [ngTemplateOutlet]="tempHtml"></ng-container>
        </span>
      </span>
    </div>
    <div class="d-flex mb-2">
      <div class="d-flex text-dark me-6">
        <codx-label
          fiedName="Owner"
          formName="Tasks"
          gridViewName="grvTasks"
          default="Người thực hiện"
          class="fw-bold text-nowrap"
        >
        </codx-label>
        <div class="d-flex justify-content-end">
          <codx-imgs
            [objectId]="data.owner"
            objectType="AD_Users"
            [numberImages]="4"
            [width]="30"
          >
          </codx-imgs>
        </div>
      </div>
    </div>
    <ng-template #tempHtml>
      <ng-container *ngIf="data.category == '2'">
        <span
          [innerHTML]="data.memo2"
          (mouseenter)="popoverMemo2.open()"
          (mouseover)="popoverMemo2.close()"
          [ngbPopover]="tooltipMemo2"
          popoverClass="empPopoverClass"
          #popoverMemo2="ngbPopover"
          placement="left bottom top right"
          container="body"
        ></span>
        <span
          #memo2
          *ngIf="!data.memo2"
          [innerHTML]="
            data.memo2
              | formatvalue
                : view.formModel
                : 'memo2'
                : memo2
                : 'Tasks'
                : 'grvTasks'
              | async
          "
        ></span>
      </ng-container>
      <ng-container *ngIf="data.category != '2'">
        <span
          [innerHTML]="data.memo"
          (mouseenter)="popoverMemo.open()"
          (mouseover)="popoverMemo.close()"
          [ngbPopover]="tooltipMemo"
          popoverClass="empPopoverClass"
          #popoverMemo="ngbPopover"
          placement="left bottom top right"
          container="body"
        ></span>
        <span
          #memo
          *ngIf="!data.memo"
          [innerHTML]="
            data.memo
              | formatvalue
                : view.formModel
                : 'memo'
                : memo
                : 'Tasks'
                : 'grvTasks'
              | async
          "
        ></span>
      </ng-container>
    </ng-template>
    <ng-template #tooltipMemo>
      <div [innerHTML]="data.memo"></div>
    </ng-template>
    <ng-template #tooltipMemo2>
      <div [innerHTML]="data.memo2"></div>
    </ng-template>
  </ng-container>

  <ng-container #EP_BookingCars *ngIf="data?.transType == 'EP_BookingCars'">
    <codx-booking-car-schedule-content
      [recID]="data?.transID"
    ></codx-booking-car-schedule-content>
  </ng-container>
  <ng-container
    #tmpEP_BookingRooms
    *ngIf="data?.transType == 'EP_BookingRooms'"
  >
    <codx-booking-room-schedule-content
      [recID]="data?.transID"
    ></codx-booking-room-schedule-content>
  </ng-container>

  <ng-container #CO_Meetings *ngIf="data?.transType == 'CO_Meetings'">
    <div>
      <h5>{{ data.title }}</h5>
    </div>

    <div class="d-flex mt-1 flex-grow-1 mb-2">
      <div class="d-flex me-6">
        <i class="icon-calendar_today icon-16 me-2"></i>
        <span class="ms-1 fw-bold">
          <span class="text-gray-700">
            {{ showHour(data?.startDate) }}
          </span>

          <span *ngIf="data.endDate" class="fw-bold p-2">{{
            showHour(data?.endDate)
          }}</span>
        </span>
      </div>
    </div>

    <hr />

    <div class="mb-2 text-dark me-6">
      <span>
        <codx-label
          default="Nội dung cuộc họp :"
          name="lblMemo"
          [formModel]="view.formModel"
          class="text-gray-600"
        >
        </codx-label>
      </span>
      <span class="ms-2 fw-bold">
        <span class="text-gray-700 size-content-schedule cursor-pointer">
          <span
            [innerHTML]="data?.memo"
            (mouseenter)="popoverMemo.open()"
            (mouseover)="popoverMemo.close()"
            [ngbPopover]="tooltipMemo"
            popoverClass="empPopoverClass"
            #popoverMemo="ngbPopover"
            placement="left bottom top right"
            container="body"
          ></span>
          <span
            *ngIf="!data?.memo"
            [innerHTML]="
              data.memo | formatvalue : view.formModel : 'Memo' | async
            "
          ></span>
        </span>
      </span>
    </div>
    <div class="d-flex mb-2">
      <div class="d-flex text-dark me-6">
        <codx-label
          name="lblPermissions"
          default="Người tham gia : "
          class="text-gray-600 me-4"
        >
        </codx-label>
        <div class="d-flex justify-content-end">
          <codx-imgs
            [objectId]="getResourceID(data)"
            objectType="AD_Users"
            [width]="30"
            [numberImages]="3"
          >
          </codx-imgs>
        </div>
      </div>
    </div>

    <ng-template #tooltipMemo>
      <div
        [innerHTML]="data.memo | formatvalue : view.formModel : 'Memo' | async"
      ></div>
    </ng-template>
  </ng-container>
  <ng-container #WP_Notes *ngIf="data?.transType == 'WP_Notes'">
    <div class="checkbox-list">
      <div *ngIf="data.noteType == 'text'">
        <div *ngIf="data.isPin == true || data.isPin == '1'" class="active">
          <span class="icon-push_pin icon-16" type="button"></span>
        </div>
        <div class="d-flex flex-column note-option">
          <span [innerHTML]="data.memo"></span>
        </div>
      </div>
      <div *ngIf="data.noteType != 'text'">
        <div *ngIf="data.isPin == true || data.isPin == '1'" class="active">
          <span class="icon-push_pin icon-16" type="button"></span>
        </div>
        <div class="d-flex flex-column note-option">
          <div *ngFor="let itemList of data.checkList; index as i">
            <div *ngIf="itemList.status == null">
              <div class="my-2 note-list">
                <ul>
                  <li>{{ itemList.listNote }}</li>
                </ul>
              </div>
            </div>
            <div *ngIf="itemList.status != null">
              <div class="my-2 note-list">
                <codx-input
                  #checkBoxNote
                  id="checkBoxNote"
                  type="checkbox"
                  label="{{ itemList.listNote }}"
                  [disabled]="false"
                  [checked]="
                    itemList?.status == 'true' || itemList?.status == '1'
                  "
                  labelPosition="After"
                  class="test-check"
                ></codx-input>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #headerTemp>
  <div class="mt-6"></div>
</ng-template>

<ng-template #eventTemplate let-data>
  <ng-container *ngIf="data.transType == 'EP_BookingCars'">
    <div class="d-flex flex-column w-100">
      <span class="d-flex flex-start"
        >{{ showHour(data.startDate) }} - {{ showHour(data.endDate) }}</span
      >
      <span
        class="d-flex flex-start fw-bold"
        style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis"
        >{{ data.title }}</span
      >
    </div>
  </ng-container>
  <ng-container *ngIf="data.transType == 'EP_BookingRooms'">
    <div class="d-flex flex-column w-100">
      <span class="d-flex flex-start"
        >{{ showHour(data.startDate) }} - {{ showHour(data.endDate) }}</span
      >
      <span
        class="d-flex flex-start fw-bold"
        style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis"
        >{{ data.title }}</span
      >
    </div>
  </ng-container>
  <ng-container
    *ngIf="data.transType == 'TM_MyTasks' || data.transType == 'CO_Meetings'"
  >
    <div class="d-flex flex-column w-100">
      <span class="d-flex flex-start"
        >{{ showHour(data.startDate) }} - {{ showHour(data.endDate) }}</span
      >
      <span
        class="d-flex flex-start fw-bold"
        style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis"
        >{{ data.title }}</span
      >
    </div>
  </ng-container>
  <ng-container *ngIf="data.transType == 'WP_Notes'">
    <codx-label
      default="Ghi chú cá nhân"
      fiedName="lblMyNote"
      class="d-flex flex-start fw-bold"
      style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis"
    ></codx-label>
  </ng-container>
</ng-template>

<ng-template #popOverDue>
  <span>
    <codx-label name="lblOverDue" default="Đã quá hạn!"></codx-label>
  </span>
</ng-template>
