<div
  class="d-flex justify-content-between main-pane stepper-body tab-custom w-100"
>
  <div class="main-content d-flex flex-column-fluid h-100">
    <div
      class="flex-column flex-lg-row-auto main-left w-250px w-xxl-275px"
      [class.hideCol]="hideThumbnail"
    >
      <ejs-tab
        #leftToolbar
        [class.d-none]="hideThumbnail"
        heightAdjustMode="Fill"
        (selected)="changeLeftTab($event)"
      >
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              <codx-label
                name="lblHeaderLeft0"
                [formModel]=""
                [default]="headerLeftName[0].text"
                class="text-header d-block"
              ></codx-label>
            </ng-template>
            <ng-template #content>
              <div #thumbnailTab id="thumbnailTab"></div>
              <div id="sidebarContent">
                <div id="thumbnailView" style="width: 100%; height: 100%"></div>
                <div id="outlineView" class="d-none"></div>
                <div id="attachmentsView" class="d-none"></div>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <codx-label
                name="lblHeaderLeft1"
                [formModel]=""
                [default]="headerLeftName[1].text"
                class="text-header d-block"
              ></codx-label>
            </ng-template>
            <ng-template #content>
              <ng-container>
                <div
                  class="ca-space d-flex align-items-start cursor-pointer px-2 pb-3"
                  *ngFor="let ca of lstCA; let idx = index"
                >
                  <div class="position-relative symbol me-3">
                    <span class="icon-24 icon-gesture"></span>
                    <div
                      class="symbol-badge badge badge-sm badge-circle top-100 start-100 text-white ms-n1 mt-n2"
                      [ngClass]="{
                        icon: true,
                        'icon-priority_high bg-warning':
                          !ca.isVerified && ca.certificate_IsValidNow,
                        'icon-clear bg-danger': !ca.certificate_IsValidNow,
                        'icon-check bg-success':
                          ca.isVerified && ca.certificate_IsValidNow
                      }"
                    ></div>
                  </div>

                  <div class="ca-memo">
                    <codx-label
                      [name]="'lblCAMemo' + idx"
                      [formModel]=""
                      [default]="'Certified by ' + ca.signerName"
                      class="fw-bold mb-2 text-hover-primary"
                      (click)="goToSelectedCA(ca, idx)"
                    ></codx-label>
                    <div
                      class="ca-more_Info"
                      *ngIf="lstCACollapseState[idx]?.open"
                    >
                      <codx-label
                        [name]="'lblCAMoreInfo'"
                        [formModel]=""
                        [default]="'Signing Time: '"
                        class="fw-bold mb-2"
                      >
                        {{ ca.signedDate }}</codx-label
                      >
                      <div *ngIf="!ca.isVerified">
                        <ng-container
                          [ngTemplateOutlet]="failReasons"
                          [ngTemplateOutletContext]="{ ca: ca }"
                        >
                        </ng-container>
                      </div>
                      <button
                        (click)="openPopUpCAProps(ca)"
                        class="btn btn-link btn-color-gray-800 btn-active-color-primary"
                      >
                        <codx-label
                          [name]="'lblCAProps'"
                          [formModel]=""
                          [default]="'Signature Properties'"
                          class="fw-bold mb-2 fst-italic text-decoration-underline"
                        ></codx-label>
                      </button>
                      <div class="ca_Details">
                        <codx-label
                          [name]="'lblCADetails'"
                          [formModel]=""
                          [default]="'Signature Detail'"
                          class="text-header d-block fw-bold"
                        ></codx-label>

                        <codx-label
                          [name]="'lblCADetails_Contact'"
                          [formModel]=""
                          [default]="'Contact Information: '"
                          class="text-header"
                        >
                          {{ ca.certificate_IssuedBy.commonName }}
                        </codx-label>

                        <codx-label
                          [name]="'lblCADetails_Location'"
                          [formModel]=""
                          [default]="'Location: '"
                          class="text-header"
                          >{{ +ca.signedLocation }}</codx-label
                        >

                        <codx-label
                          [name]="'lblCADetails_Reason'"
                          [formModel]=""
                          [default]="'Reason: '"
                          class="text-header"
                          >{{ ca.signedComment }}</codx-label
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <ng-template #failReasons let-ca="ca">
                  <codx-label
                    [name]="'lblFailed'"
                    [formModel]=""
                    [default]="'Certificate verification failed'"
                    class="text-header d-block fw-bold"
                  ></codx-label>
                  <div
                    class="fail_Reasons ms-2"
                    *ngFor="let reason of ca.vertifications"
                  >
                    <div
                      class="reason_Info ms-2"
                      *ngIf="!reason.isVerified && reason.message != ''"
                    >
                      <p>{{ reason.message }}</p>
                    </div>
                  </div>
                </ng-template>
                <ng-template #groupTemplate let-dataSource="">
                  <div class="e-list-wrapper">
                    <span class="e-list-item-content">{{
                      dataSource.items[0].location.pageNumber + 1
                    }}</span>
                  </div>
                </ng-template>
              </ng-container>
            </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
    <div class="d-flex flex-column flex-row-fluid main-center">
      <div
        class="d-flex d-flex align-items-center justify-content-between stepper-toolbar"
      >
        <div
          class="left_Toolbar d-flex justify-content-start align-items-center"
        >
          <ejs-toolbar>
            <e-items>
              <e-item
                [prefixIcon]="
                  hideThumbnail
                    ? 'btn btn-icon btn-light btn-sm border-0 btn-active-primary   icon-arrow_forward'
                    : 'btn btn-icon btn-light btn-sm border-0 btn-active-primary icon-arrow_back rotate-180'
                "
                (click)="changeShowThumbnailState()"
              ></e-item>
              <e-item
                prefixIcon="icon-skip_previous icon-18 btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                id="firstPage"
              >
              </e-item>
              <e-item
                prefixIcon="icon-navigate_before icon-18 btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                id="previous"
              >
              </e-item>
              <e-item [template]="pageInput" type="Input"></e-item>
              <e-item
                prefixIcon="icon-navigate_next icon-18 btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                id="next"
              >
              </e-item>
              <e-item
                prefixIcon="icon-skip_next icon-18 btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                id="lastPage"
              >
              </e-item>

              <e-item
                id="viewThumbnail"
                prefixIcon="icon-article icon-18 btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                (click)="show($event)"
              >
              </e-item>
            </e-items>
          </ejs-toolbar>
        </div>

        <div
          class="chooseSignFile w-100 d-flex justify-content-center align-items-center"
          #pdfToolbar
        >
          <ejs-dropdownlist
            id="signfilesDropdownList"
            [(dataSource)]="lstFiles"
            [fields]="file"
            (change)="changeSignFile($event)"
            [(value)]="curFileID"
          ></ejs-dropdownlist>
        </div>
        <div
          class="right_Toolbar d-flex justify-content-end align-items-center"
        >
          <ejs-toolbar>
            <e-items>
              <e-item
                id="zoomOut"
                (click)="changeZoom('in', $event)"
                prefixIcon="e-zoom-out btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
              >
              </e-item>
            </e-items>
          </ejs-toolbar>
          <ejs-dropdownlist
            style="width: 100%; min-width: 70px"
            id="zoomValuesDropdownList"
            [(dataSource)]="lstZoomValue"
            [(placeholder)]="zoomValue"
            [fields]="zoomFields"
            (change)="changeZoom('to', $event)"
          >
          </ejs-dropdownlist>

          <ejs-toolbar>
            <e-items>
              <e-item
                id="zoomIn"
                prefixIcon="e-zoom-in btn btn-icon btn-white btn-sm border-0  btn-tool-custom"
                (click)="changeZoom('in', $event)"
              >
              </e-item>
            </e-items>
          </ejs-toolbar>
          <ejs-toolbar class="border-start">
            <e-items>
              <e-item
                *ngIf="isEditable"
                prefixIcon="e-print btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                id="print"
              >
              </e-item>
              <e-item
                *ngIf="isEditable"
                prefixIcon="e-download btn btn-icon btn-white btn-sm border-0 btn-tool-custom"
                id="download"
              >
              </e-item>
              <e-item
                *ngIf="isEditable"
                [prefixIcon]="
                  !hideActions
                    ? 'btn btn-icon btn-light btn-sm border-0 btn-active-primary icon-arrow_forward'
                    : 'icon-arrow_back btn btn-icon btn-light btn-sm border-0 btn-active-primary  rotate-180'
                "
                (click)="changeShowActionsState()"
              ></e-item>
            </e-items>
          </ejs-toolbar>
        </div>
        <ng-container *ngIf="isConfirm" [ngTemplateOutlet]="confirmCheckbox">
        </ng-container>
      </div>
      <ngx-extended-pdf-viewer
        *ngIf="curFileUrl"
        #ngxPdfView
        [(src)]="curFileUrl"
        [(zoom)]="zoomValue"
        [(page)]="curPage"
        [customToolbar]="pdfToolbar"
        [showHandToolButton]="false"
        [showUnverifiedSignatures]="true"
        [sidebarVisible]="!hideThumbnail"
        [showSidebarButton]="false"
        (pdfLoaded)="loadedPdf($event)"
        (pageRendered)="pageRendered($event)"
        [showBookmarkButton]="false"
        [showPropertiesButton]="false"
        [customSidebar]="withoutSidebar"
        [customThumbnail]="ngxThumbnail"
        [enableDragAndDrop]="false"
        [handTool]="false"
        [contextMenuAllowed]="false"
        [enablePinchOnMobile]="false"
        (currentZoomFactor)="('1')"
        pageViewMode="vertical"
      >
      </ngx-extended-pdf-viewer>

      <ng-template #ngxThumbnail let-PAGE_NUMBER>
        <a class="pdf-viewer-template">
          <div
            class="thumbnail"
            [classList]="PAGE_NUMBER == curPage ? 'border border-primary' : ''"
            data-page-number="PAGE_NUMBER"
            (click)="goToPage(PAGE_NUMBER)"
          >
            <div class="image-container d-flex mb-2"></div>
          </div>
        </a>
      </ng-template>
      <ng-template #withoutSidebar>
        <div id="sidebarContainer" class="d-flex w-0 h-0 d-none">
          <pdf-sidebar-content></pdf-sidebar-content>
          <div id="sidebarResizer" class="d-none"></div>
        </div>
      </ng-template>
    </div>
    <div
      class="actions flex-column flex-lg-row-auto main-right"
      [class.hideCol]="hideActions"
    >
      <ejs-tab
        #rightToolbar
        id="rightToolbar"
        [class.d-none]="hideActions"
        heightAdjustMode="Fill"
        (selecting)="changeRightTab($event)"
      >
        <e-tabitems>
          <e-tabitem *ngIf="isEditable">
            <ng-template #headerText>
              <codx-label
                name="lblHeaderRight0"
                [formModel]=""
                [default]="headerRightName[0].text"
                class="text-header d-block"
              ></codx-label>
            </ng-template>

            <ng-template #content>
              <div style="padding: 0 20px">
                <div class="position-relative" *ngIf="!isApprover">
                  <div class="mt-3 mb-3 text-primary fw-bold">
                    <codx-label
                      name="lblChooseSigner"
                      [formModel]=""
                      default="Chọn người kí cần thiết lập"
                      class="text-header d-block"
                    ></codx-label>
                  </div>
                  <ejs-dropdownlist
                    id="signatureDropdownList"
                    [dataSource]="lstSigners"
                    [(fields)]="person"
                    (change)="changeSigner($event)"
                    [itemTemplate]="signer"
                    [valueTemplate]="signer"
                    [(value)]="curSignerRecID"
                  >
                    <ng-template #signer let-approver>
                      <codx-temp-full
                        cardCss="card-select  px-2 pt-3 pb-2"
                        [(imageId)]="approver.authorID"
                        [imageObjType]="'AD_Users'"
                        [imageWidth]="35"
                        imgCss="me-2"
                        [title]="
                          approver.roleType == 'U'
                            ? approver.fullName
                            : (approver.roleType | vll: 'ES014':'text' | async)
                        "
                        [subTitle]="approver.position ?? 'Vị trí công việc'"
                        [baseHeaderRightTmp]="footer"
                        [dataItem]="approver"
                      >
                      </codx-temp-full>
                    </ng-template>
                  </ejs-dropdownlist>
                </div>
                <div class="mt-3 mb-3 text-primary fw-bold">
                  <codx-label
                    name="lblDragAction"
                    [formModel]=""
                    default="Kéo & thả chữ ký vào tài liệu"
                    class="text-header d-block"
                  >
                  </codx-label>
                </div>

                <div class="d-flex flex-wrap d-grid align-items-center">
                  <div
                    class="card-item me-6 mb-6"
                    #actions
                    *ngFor="let action of vllActions; let index = index"
                    [class.active]="holding == action?.value"
                    (click)="changeAnnotationItem(action)"
                  >
                    <codx-card-center
                      *ngIf="!isApprover || (isApprover && index != 8)"
                      cardCss="border h-100 w-125px pt-4 pb-2 "
                      icoCss="icon-30 mb-1 {{ action?.icon }}"
                      content="{{ action?.text }}"
                    >
                    </codx-card-center>
                  </div>
                </div>

                <!--begin::Item-->
                <div class="d-flex align-items-center my-2">
                  <div class="d-flex justify-content-start me-2">
                    <!--begin::Switch-->
                    <codx-input
                      type="switch"
                      labelPosition="After"
                      field=""
                      [disabled]="isEditable"
                      [crrValue]="needSuggest"
                      (valueChange)="changeSuggestState($event)"
                    >
                    </codx-input>
                    <!--end::Switch-->
                  </div>
                  <div class="text-gray-800 text-nowrap">
                    <codx-label
                      name="lblSuggestSignArea"
                      default="Gợi ý trang ký"
                      class="fw-bold"
                    ></codx-label>
                  </div>
                </div>
                <!--end::Item-->
                <!--begin::Item-->
                <div class="autoSign_Space d-flex align-items-center my-2">
                  <div class="d-flex justify-content-start me-2">
                    <!--begin::Switch-->
                    <codx-input
                      type="switch"
                      field="autoSignLastLine"
                      [disabled]="isEditable"
                      [(crrValue)]="autoSignState"
                      (valueChange)="changeAutoSignState($event, 0)"
                    ></codx-input>
                    <!--end::Switch-->
                  </div>
                  <div class="text-gray-800 text-nowrap">
                    <codx-label
                      name="lblSignLastLine"
                      default="Chèn chữ ký tự động"
                      class="fw-bold"
                    ></codx-label>
                  </div>
                </div>
                <!--end::Item-->
              </div>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="inputUrl == null">
            <ng-template #headerText>
              <codx-label
                name="lblHeaderRight1"
                [formModel]=""
                [default]="headerRightName[1].text"
                class="text-header d-block"
              ></codx-label>
            </ng-template>
            <ng-template #content>
              <ng-container>
                <ejs-listview
                  id="groupedList"
                  [(dataSource)]="lstAreas"
                  [cssClass]="cssClass"
                  [showHeader]="true"
                >
                  <ng-template #template let-area="">
                    <div
                      class="annotationItem py-3 px-3"
                      *ngIf="
                        !this.isApprover ||
                        (this.isApprover &&
                          area.signer == this.curSignerID &&
                          area.stepNo == this.stepNo)
                      "
                      (click)="goToSelectedAnnotation(area)"
                    >
                      <codx-temp-full
                        [title]="
                          (area.labelType | vll: 'ES015':'text' | async) +
                          ' - ' +
                          getAreaOwnerName(area.signer)
                        "
                        [resourceObjType]="'AD_Users'"
                        [icoCss]="
                          'symbol symbol-icon symbol-circle symbol-32px me-2 ' +
                          (area.labelType | vll: 'ES015':'icon' | async)
                        "
                        [iconCss2]="
                          area.recID != curSelectedAnnotID
                            ? 'icon-expand_more'
                            : 'icon-expand_less'
                        "
                        [subTitle]="'Trang ' + (+area.location.pageNumber + 1)"
                        [subTitleCss]="'page-end'"
                      >
                      </codx-temp-full>
                      <div
                        [class.d-none]="
                          inputUrl != null ||
                          area.recID != curSelectedAnnotID ||
                          area.labelType == '1' ||
                          area.labelType == '2' ||
                          area.isLock == true
                        "
                        [formGroup]="formAnnot"
                      >
                        <!-- <div
                          class="qr-switch"
                          *ngIf="!isApprover && area.labelType == 8"
                        >
                          <codx-input
                            class="form-control me-2"
                            type="switch"
                            [crrValue]="renderQRAllPage"
                            (valueChange)="changeQRRenderState($event)"
                          >
                            <codx-label
                              name="lblSave"
                              default="Lặp lại cho tất cả các trang"
                              [formModel]=""
                            >
                            </codx-label>
                          </codx-input>
                        </div> -->
                        <div
                          class="text-content form-control my-2 ms-12"
                          *ngIf="area.labelType == 6"
                        >
                          <input
                            type="text"
                            formControlName="content"
                            class="w-100 d-block"
                            [style]="
                              'font-size: ' +
                              curAnnotFontSize +
                              'px;' +
                              'font-family: ' +
                              curAnnotFontStyle +
                              ';'
                            "
                            [ngClass]="{
                              'fw-bolder': isBold,
                              'fst-italic': isItalic,
                              'text-decoration-underline': isUnd
                            }"
                            [defaultValue]="'area.labelValue'"
                          />
                        </div>

                        <div
                          class="date-content my-2 ms-12"
                          *ngIf="area.labelType == 5"
                        >
                          <ejs-dropdownlist
                            class="me-2 min-w-70px"
                            id="dateFormatsDropdownList"
                            [dataSource]="lstAnnotDateFormat"
                            [(value)]="curAnnotDateFormat"
                            formControlName="dateFormat"
                          >
                          </ejs-dropdownlist>
                        </div>
                        <div class="d-flex my-2 ms-12">
                          <div
                            class="text-format d-flex align-items-center"
                            *ngIf="!imgConfig.includes(area.labelType)"
                          >
                            <ejs-dropdownlist
                              class="me-2 min-w-70px"
                              id="fontStylesDropdownList"
                              [dataSource]="lstAnnotFontStyle"
                              [value]="curAnnotFontStyle"
                              formControlName="fontStyle"
                            >
                            </ejs-dropdownlist>
                            <ejs-dropdownlist
                              class="me-2 w-100px"
                              id="fontSizesDropdownList"
                              [dataSource]="lstAnnotFontSize"
                              [value]="curAnnotFontSize"
                              formControlName="fontSize"
                            >
                            </ejs-dropdownlist>
                          </div>
                          <div
                            class="btn-format d-flex align-items-center"
                            *ngIf="!imgConfig.includes(area.labelType)"
                          >
                            <button
                              type="button"
                              class="btn btn-sm btn-icon me-1"
                              [ngClass]="{
                                btn: true,
                                'bg-white border': !isBold,
                                'btn-success': isBold
                              }"
                              (click)="changeFontWeight(1)"
                            >
                              <span class="icon-format_bold"></span>
                            </button>
                            <button
                              type="button"
                              class="btn btn-sm btn-icon me-1"
                              [ngClass]="{
                                btn: true,
                                'bg-white border': !isItalic,
                                'btn-success': isItalic
                              }"
                              (click)="changeFontWeight(2)"
                            >
                              <span class="icon-format_italic"></span>
                            </button>
                            <button
                              type="button"
                              class="btn btn-sm btn-icon"
                              [ngClass]="{
                                btn: true,
                                'bg-white border': !isUnd,
                                'btn-success': isUnd
                              }"
                              (click)="changeFontWeight(3)"
                            >
                              <span class="icon-format_underlined"></span>
                            </button>
                          </div>
                        </div>
                        <div class="d-flex ms-12" *ngIf="area.labelType == 5">
                          <codx-input
                            class="me-4 date-Type"
                            name="date-Type"
                            type="radio"
                            [(checked)]="chooseSignDate"
                            labelPosition="After"
                          >
                          </codx-input
                          ><codx-label
                            name="lblReleaseDay"
                            default="Ngày phát hành"
                            [formModel]=""
                          ></codx-label>
                          <codx-input
                            class="me-4 date-Type"
                            type="radio"
                            name="date-Type"
                            [(checked)]="!chooseSignDate"
                            labelPosition="After"
                          >
                          </codx-input>
                          <codx-label
                            name="lblSignDate"
                            default="Ngày ký"
                            [formModel]=""
                          ></codx-label>
                        </div>
                        <div class="btn-apply d-flex justify-content-end">
                          <button
                            type="button"
                            class="btn btn-sm btn-primary"
                            (click)="removeArea()"
                          >
                            <codx-label
                              name="lblSave"
                              default="Xóa"
                              [formModel]=""
                            ></codx-label>
                          </button>
                          <button
                            type="button"
                            class="btn btn-sm btn-primary"
                            *ngIf="imgConfig.includes(area.labelType)"
                          >
                            <codx-label
                              name="lblSave"
                              default="Thay đổi"
                              [formModel]=""
                            ></codx-label>
                          </button>
                          <button
                            *ngIf="!imgConfig.includes(area.labelType)"
                            type="button"
                            class="btn btn-sm btn-primary"
                            (click)="changeAnnotPro(area.labelType, area.recID)"
                          >
                            <codx-label
                              name="lblSave"
                              default="OK"
                              [formModel]=""
                            ></codx-label>
                          </button>
                        </div>
                      </div>
                    </div>
                  </ng-template>
                  <ng-template #groupTemplate let-dataSource="">
                    <div class="e-list-wrapper">
                      <span class="e-list-item-content">{{
                        dataSource.items[0].location.pageNumber + 1
                      }}</span>
                    </div>
                  </ng-template>
                </ejs-listview>
              </ng-container>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="isApprover">
            <ng-template #headerText>
              <codx-label
                name="lblHeaderRight2"
                [formModel]=""
                [default]="headerRightName[2].text"
                class="text-header d-block"
              ></codx-label>
            </ng-template>
            <ng-template #content></ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="isApprover">
            <ng-template #headerText>
              <codx-label
                name="lblHeaderRight3"
                [formModel]=""
                [default]="headerRightName[3].text"
                class="text-header d-block"
              ></codx-label>
            </ng-template>
            <ng-template #content></ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </div>
</div>

<ng-template #footer let-data>
  <codx-vll
    class="footer-left"
    [showText]="true"
    name="ES002"
    [value]="data.stepType"
  ></codx-vll>
</ng-template>

<ng-template #pageInput>
  <codx-input
    type="number"
    id="pageNumber"
    [min]="1"
    [max]="pageMax"
    [(crrValue)]="curPage"
    (valueChange)="goToPage($event)"
    [showSpinButton]="false"
  >
  </codx-input>
</ng-template>

<ng-template #panelLeft> </ng-template>
<ng-template #confirmCheckbox>
  <div class="pdf-check-add btn-flex flex-center btn-white">
    <codx-input
      type="checkbox"
      class="check-add me-2"
      name="select"
      (valueChange)="changeConfirmState($event)"
    >
    </codx-input>
    {{ "ES011" | mssg | async }}
    <!-- <codx-label
      name="lblConfirmSeen"
      [formModel]=""
      [default]="'Xác nhận đã xem văn bản'"
      class="text-header"
    ></codx-label> -->
  </div>
</ng-template>

<div id="contextMenu" style="display: none; position: absolute">
  <div style="z-index: 2">
    <button id="delete-btn">
      <codx-label
        name="lblAreaDeleteBtn"
        [formModel]=""
        [default]="'Delete'"
        class="text-header d-block"
      ></codx-label>
    </button>
  </div>
</div>
