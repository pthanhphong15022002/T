<div class="request-to">
  <div id="box_from" *ngIf="showFrom">
    <!-- <div class="d-flex justify-content-between border-bottom mb-2 pb-1">
        <div class="d-flex align-items-top flex-grow-1">
          <div class="w-50px fw-bold">
            <codx-label
              name="lblTitleFrom"
              default="Từ:"
              formName="EmailTemplates"
              gridViewName="grvEmailTemplates"
            >
            </codx-label>
          </div>
          <div class="w-100 me-2">
            <div class="float-left align-items-center">
              <ng-container *ngFor="let item of lstFrom">
                <div
                  class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                  *ngIf="item.objectType == 'U'"
                >
                  <div class="me-2">
                    <codx-img
                      [objectId]="item.objectID"
                      objectType="AD_Users"
                      width="20"
                    ></codx-img>
                  </div>
                  <div class="text-gray-600 flex-grow-1 me-2">
                    {{ item.text }}
                  </div>
                  <a
                    class="text-hover-danger d-flex align-items-center"
                    (click)="deleteItem(item, 1)"
                    ><span class="icon-close icon-16"></span
                  ></a>
                </div>
                <div
                  class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                  *ngIf="item.objectType != 'U'"
                >
                  <div class="me-2 user-mini-icon w-20px h-20px">
                    <img
                      class="w-20px h-20px"
                      [src]="
                        './assets/themes/sys/default/img/' +
                        (item.icon ??
                          (item.objectType
                            | vll : vllShare : 'icon'
                            | async) ??
                          'share_default.svg')
                      "
                    />
                  </div>
                  <div class="text-gray-600 flex-grow-1 me-2">
                    {{
                      item.text ??
                        (item.objectType | vll : vllShare : "text" | async)
                    }}
                  </div>
                  <a
                    class="text-hover-danger d-flex align-items-center"
                    (click)="deleteItem(item, 1)"
                    ><span class="icon-close icon-16"></span
                  ></a>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        <span class="btn btn-icon btn-sm btn-light">
          <i
            class="icon-person_add_alt_1 icon-18"
            (click)="testdata(controlShare1)"
          ></i
        ></span>
      </div> -->
  </div>
  <div class="d-flex justify-content-between border-bottom mb-2 pb-1">
    <div class="d-flex align-items-top flex-grow-1">
      <div class="w-50px fw-bold">
        <codx-label
          default="Đến:"
          name="lblTitleTo"
          formName="EmailTemplates"
          gridViewName="grvEmailTemplates"
        >
        </codx-label>
      </div>
      <div class="w-100 me-2">
        <div class="float-left align-items-center">
          <ng-container *ngFor="let item of lstTo">
            <div
              class="d-flex justify-content-between user-mini-nav-custom align-items-center"
              *ngIf="item.objectType == 'U'"
            >
              <div class="me-2">
                <codx-img
                  [objectId]="item.objectID"
                  objectType="AD_Users"
                  width="20"
                ></codx-img>
              </div>
              <div
                class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                *ngIf="item.objectType != 'U'"
              >
                <div class="me-3 user-mini-icon w-20px h-20px">
                  <img
                    [src]="
                      './assets/themes/sys/default/img/' +
                      (item.icon ??
                        (item.objectType | vll : vllShare : 'icon' | async) ??
                        'share_default.svg')
                    "
                  />
                </div>
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{
                    item.text != null
                      ? item.text
                      : (item.objectType | vll : vllShare : "text" | async)
                  }}
                </div>
                <a
                  class="text-hover-danger d-flex align-items-center"
                  (click)="deleteItem(item, 2)"
                  ><span class="icon-close icon-16"></span
                ></a>
              </div>
              <a
                class="text-hover-danger d-flex align-items-center"
                (click)="deleteItem(item, 2)"
                ><span class="icon-close icon-16"></span
              ></a>
            </div>
            <div
              class="d-flex justify-content-between user-mini-nav-custom align-items-center"
              *ngIf="item.objectType != 'U'"
            >
              <ng-container *ngIf="item.objectType != 'Email'">
                <div class="me-3 user-mini-icon w-20px h-20px">
                  <img
                    [src]="
                      './assets/themes/sys/default/img/' +
                      (item.icon ??
                        (item.objectType | vll : vllShare : 'icon' | async) ??
                        'share_default.svg')
                    "
                  />
                </div>
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{
                    item.text != null
                      ? item.text
                      : (item.objectType | vll : vllShare : "text" | async)
                  }}
                </div>
              </ng-container>
              <ng-container *ngIf="item.objectType == 'Email'">
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{ item.objectID }}
                </div>
              </ng-container>
              <a
                class="text-hover-danger d-flex align-items-center"
                (click)="deleteItem(item, 2)"
                ><span class="icon-close icon-16"></span
              ></a>
            </div>
          </ng-container>
          <input
            class="border-0"
            [attr.noenter]="1"
            (change)="toChange($event, '2')"
            (keyup.enter)="toChange($event, '2')"
            (keydown)="onKeydown($event, '2')"
          />
        </div>
      </div>
    </div>
    <div class="d-flex align-items-end">
      <span
        class="btn btn-sm fw-bold text-hover-primary"
        *ngIf="
          !showCC &&
          !showBCC &&
          !(showBCC || lstBcc.length > 0) &&
          !(showCC || lstCc.length > 0)
        "
        (click)="changeSendType('cc')"
        >Cc</span
      >
      <span
        class="btn btn-sm fw-bold text-hover-primary"
        *ngIf="
          !showCC &&
          !showBCC &&
          !(showCC || lstCc.length > 0) &&
          !(showBCC || lstBcc.length > 0)
        "
        (click)="changeSendType('bcc')"
        >Bcc</span
      >
      <span class="btn btn-icon btn-sm btn-light">
        <i
          class="icon-person_add_alt_1 icon-18"
          (click)="testdata(controlShare2)"
        ></i
      ></span>
    </div>
  </div>
  <div id="box_cc" *ngIf="showCC || lstCc.length > 0">
    <div class="d-flex justify-content-between border-bottom mb-2 pb-1">
      <div class="d-flex align-items-top flex-grow-1">
        <div class="w-50px fw-bold">Cc:</div>
      </div>
      <div class="w-100 me-2">
        <div class="float-left align-items-center">
          <ng-container *ngFor="let item of lstCc">
            <div
              class="d-flex justify-content-between user-mini-nav-custom align-items-center"
              *ngIf="item.objectType == 'U'"
            >
              <div class="me-2">
                <codx-img
                  [objectId]="item.objectID"
                  objectType="AD_Users"
                  width="20"
                ></codx-img>
              </div>
              <div class="text-gray-600 flex-grow-1 me-2">
                {{ item.text }}
              </div>
              <a
                class="text-hover-danger d-flex align-items-center"
                (click)="deleteItem(item, 3)"
                ><span class="icon-close icon-16"></span
              ></a>
            </div>
            <div
              class="d-flex justify-content-between user-mini-nav-custom align-items-center"
              *ngIf="item.objectType != 'U'"
            >
              <ng-container *ngIf="item.objectType != 'Email'">
                <div class="me-2 user-mini-icon w-20px h-20px">
                  <img
                    class="w-20px h-20px"
                    [src]="
                      './assets/themes/sys/default/img/' +
                      (item.icon ??
                        (item.objectType | vll : vllShare : 'icon' | async) ??
                        'share_default.svg')
                    "
                  />
                </div>
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{
                    item.text ??
                      (item.objectType | vll : vllShare : "text" | async)
                  }}
                </div>
              </ng-container>
              <ng-container *ngIf="item.objectType == 'Email'">
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{ item.objectID }}
                </div>
              </ng-container>
              <a
                class="text-hover-danger d-flex align-items-center"
                (click)="deleteItem(item, 3)"
                ><span class="icon-close icon-16"></span
              ></a>
            </div>
          </ng-container>
          <input
            class="border-0"
            [attr.noenter]="1"
            (change)="toChange($event, '3')"
            (keyup.enter)="toChange($event, '3')"
            (keydown)="onKeydown($event, '3')"
          />
        </div>
      </div>
      <div class="d-flex align-items-end">
        <span
          class="btn btn-sm fw-bold"
          *ngIf="!showBCC && !(showBCC || lstBcc.length > 0)"
          (click)="changeSendType('bcc')"
          >Bcc</span
        >
        <span class="btn btn-icon btn-sm btn-light">
          <i
            class="icon-person_add_alt_1 icon-18"
            (click)="testdata(controlShare3)"
          ></i
        ></span>
      </div>
    </div>
  </div>
  <div id="box_bcc" *ngIf="showBCC || lstBcc.length > 0">
    <div class="d-flex justify-content-between border-bottom mb-2 pb-1">
      <div class="d-flex align-items-top flex-grow-1">
        <div class="w-50px fw-bold">Bcc:</div>
      </div>
      <div class="w-100 me-2">
        <div class="float-left align-items-center">
          <ng-container *ngFor="let item of lstBcc">
            <div
              class="d-flex justify-content-between user-mini-nav-custom align-items-center"
              *ngIf="item.objectType == 'U'"
            >
              <div class="me-2">
                <codx-img
                  [objectId]="item.objectID"
                  objectType="AD_Users"
                  width="20"
                ></codx-img>
              </div>
              <div class="text-gray-600 flex-grow-1 me-2">
                {{ item.text }}
              </div>
              <a
                class="text-hover-danger d-flex align-items-center"
                (click)="deleteItem(item, 4)"
                ><span class="icon-close icon-16"></span
              ></a>
            </div>
            <div
              class="d-flex justify-content-between user-mini-nav-custom align-items-center"
              *ngIf="item.objectType != 'U'"
            >
              <ng-container *ngIf="item.objectType != 'Email'">
                <div class="me-2 user-mini-icon w-20px h-20px">
                  <img
                    class="svg-icon w-20px h-20px"
                    [src]="
                      './assets/themes/sys/default/img/' +
                      (item.icon ??
                        (item.objectType | vll : vllShare : 'icon' | async) ??
                        'share_default.svg')
                    "
                  />
                </div>
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{
                    item.text != null
                      ? item.text
                      : (item.objectType | vll : vllShare : "text" | async)
                  }}
                </div>
              </ng-container>
              <ng-container *ngIf="item.objectType == 'Email'">
                <div class="text-gray-600 flex-grow-1 me-2">
                  {{ item.objectID }}
                </div>
              </ng-container>
              <a
                class="text-hover-danger d-flex align-items-center"
                (click)="deleteItem(item, 4)"
                ><span class="icon-close icon-16"></span
              ></a>
            </div>
          </ng-container>
          <input
            class="border-0"
            [attr.noenter]="1"
            (change)="toChange($event, '4')"
            (keyup.enter)="toChange($event, '4')"
            (keydown)="onKeydown($event, '4')"
          />
        </div>
      </div>
      <div class="d-flex align-items-end">
        <span
          class="btn btn-sm fw-bold"
          *ngIf="!showCC && !(showCC || lstCc.length > 0)"
          (click)="changeSendType('cc')"
          >Cc</span
        >
        <span class="btn btn-icon btn-sm btn-light">
          <i
            class="icon-person_add_alt_1 icon-18"
            (click)="testdata(controlShare4)"
          ></i
        ></span>
      </div>
    </div>
  </div>
</div>
<div class="d-flex justify-content-between border-bottom mt-4">
  <div class="mb-1 w-100 pe-5">
    <codx-input
      type="text"
      class="borderless"
      field="subject"
      [formModel]="formModel"
      [Group]="dialogETemplate"
    >
    </codx-input>
  </div>
  <div class="d-flex align-items-center mb-1 input-sm">
    <codx-input
      class="w-400px"
      type="combobox"
      field="template"
      refValue="EmailTemplates"
      placeholder="Chọn mẫu"
      (valueChange)="valueChange($event)"
      [formModel]="formModel"
    ></codx-input>
    <div class="ms-2 cursor-pointer" (click)="showHide()">
      <img src="./assets/themes/sys/default/img/chatbot.svg" class="w-30px" />
    </div>
  </div>
</div>
<div
  class="d-flex align-items-center w-100 mt-4"
  [ngClass]="showAI ? 'visible' : 'invisible h-0px'"
>
  <codx-input
    ngClass="w-100"
    type="textarea"
    format="ed2"
    [crrValue]="''"
    placeholder="Nhập yêu cầu nội dung cần tạo"
    (valueChange)="valueChangeContentEmail($event)"
  ></codx-input>
  <span *ngIf="isLoadingAI" class="ms-2 w-100px">Đang xử lý ...</span>
  <button
    *ngIf="!isLoadingAI"
    type="button"
    class="btn btn-outline-primary ms-2"
    (click)="createContentEmail()"
  >
    <codx-label formName="EmailTemplates" default="Tạo"></codx-label>
  </button>
</div>
<div class="d-flex justify-content-between align-items-end mt-4">
  <div *ngIf="showAttachment">
    <div
      class="d-flex align-items-center cursor-pointer"
      (click)="openFormUploadFile()"
    >
      <span class="icon-attach_email icon-18 me-2 text-primary"></span>
      <span class="text-primary fw-bold">
        <codx-label
          default="Đính kèm file"
          name="lblAttachment"
          formName="EmailTemplates"
          gridViewName="grvEmailTemplates"
        ></codx-label>
      </span>
    </div>
    <div>
      <codx-attachment
        #attachment
        [objectType]="'BG_Alerts'"
        referType="Alert"
        hideBtnSave="1"
        hideFolder="1"
        hideUploadBtn="1"
        hideDes="1"
        [functionID]=""
        (fileAdded)="fileAdded($event)"
        (fileCount)="getfileCount($event)"
        [objectId]="idAlert"
        [allowMultiFile]="1"
        isSaveSelected="0"
        [idBrowse]="'add'"
      >
      </codx-attachment>
    </div>
  </div>

  <div #dataView id="dataView" (click)="clickDataView()">
    <button
      class="btn btn-sm btn-light d-flex align-items-center"
      type="button"
      aria-expanded="false"
    >
      <span>
        <codx-label
          default="Chọn trường dữ liệu"
          name="lblChooseField"
          [formModel]="formModel"
        ></codx-label>
      </span>
      <span class="icon-keyboard_arrow_down icon-16 ms-2"></span>
    </button>
  </div>
</div>

<div
  #textarea
  class="request-box d-flex justify-content-between mt-3 h-250px"
  (click)="click()"
>
  <div class="message w-100">
    <codx-input
      #richtexteditor
      type="textarea"
      field="message"
      format="ed"
      [crrValue]="data.message"
      height="250"
      (valueChange)="valueChange($event)"
    ></codx-input>
  </div>
  <div class="ms-4 scroll-y border" [style.width.px]="200" *ngIf="show">
    <div class="col-lg-12 control-section">
      <div class="my-1 mx-2">
        <input
          #textbox
          class="codx-text default e-input form-control ng-pristine ng-valid ng-touched"
          type="text"
          id="textbox"
          placeholder="Tìm kiếm"
          title="Type in a name"
          (keyup)="onkeyup($event)"
        />
      </div>
      <ejs-listview
        id="listview_template"
        #listviewInstance
        [dataSource]="dataSource"
        [cssClass]="cssClass"
        (actionComplete)="onActionComplete($event)"
        [showHeader]="false"
      >
        <ng-template #template let-dataSource="">
          <button
            (click)="clickItem(dataSource)"
            class="card-template p-2 text-dark bg-transparent w-100 text-start border-0"
          >
            {{ dataSource?.headerText }}
          </button>
          <!-- <div
              class="card-template p-2 text-dark"
              (click)="clickItem(dataSource)"
            >
              {{ dataSource?.headerText }}
            </div> -->
        </ng-template>
      </ejs-listview>
    </div>
  </div>
</div>

<ng-template #controlShare1 let-dialog>
  <codx-share
    [dialog]="dialog"
    [multiple]="true"
    (eventApply)="applyShare($event, 1)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #controlShare2 let-dialog>
  <codx-share
    [dialog]="dialog"
    [multiple]="true"
    (eventApply)="applyShare($event, 2)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #controlShare3 let-dialog>
  <codx-share
    [dialog]="dialog"
    [multiple]="true"
    (eventApply)="applyShare($event, 3)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #controlShare4 let-dialog>
  <codx-share
    [dialog]="dialog"
    [multiple]="true"
    (eventApply)="applyShare($event, 4)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #addTemplateName let-dialog1>
  <div class="codx-form card w-100 h-100 rounded-0 border-0">
    <div class="card-header flex-column">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="card-title">
          <div class="d-flex flex-column">
            <codx-label
              class="dialog-title line-clamp line-clamp-1"
              name="lblEquipment"
              default="Nhập tên"
              [formModel]="formModel"
            ></codx-label>
          </div>
        </div>
        <div class="card-toolbar">
          <button
            type="button"
            class="btn btn-flex text-dark-75 text-hover-primary px-0"
            (click)="closePopup(dialog1)"
          >
            <span class="icon-close icon-18"></span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="d-flex align-items-center me-3 mt-10">
        <label class="ms-2 me-2">
          <codx-label [formModel]="formModel" fiedName="TemplateName">
          </codx-label>
        </label>
        <codx-input
          type="text"
          [crrValue]="dialogETemplate.value.templateName"
          field="templateName"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
    </div>
    <div class="card-footer border-0">
      <div class="d-flex justify-content-end">
        <a
          class="btn btn-primary fw-bold"
          (click)="onSaveForm(dialog1)"
          *ngIf="saveIsTemplate"
        >
          <codx-label name="lblSave" default="Lưu" [formModel]="formModel">
          </codx-label>
        </a>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #template let-data>
  <div class="e-list-wrapper e-list-avatar">
    <span class="e-list-content">{{ data.name }}</span>
  </div>
</ng-template>

<ng-template #headerSearch>
  <div class="mb-1 mx-3">
    <codx-input
      type="text"
      [disabled]="false"
      placeholder="Tìm kiếm"
      (valueChange)="valueChange($event)"
    >
    </codx-input>
  </div>
</ng-template>
