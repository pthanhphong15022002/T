<codx-form headerText="{{title}}" subHeaderText="" [body]="body" [footer]="footer" [dialog]="dialog">
  <ng-template #body>
    <!-- <div class="card-body">-->
    <div>
      <div class="d-flex justify-content-between mb-2 p-2">
        <div class="d-flex align-items-center flex-grow-1">
          <div class="w-100px">
            <codx-label fiedName="CreatedBy" formName="Tasks" gridViewName="grvTasks" default="Người giao việc">
            </codx-label>
          </div>
          <div class="d-flex align-items-center me-2 mail-user">
            <div class="symbol symbol-20px symbol-circle me-2">
              <codx-img #image [objectId]="'ADMIN'"></codx-img>
            </div>
            <div class="text-dark-75">{{user.userName}}</div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between p-2">
        <div class="d-flex align-items-center justify-content-start flex-grow-1">
          <div class="w-100px fw-bold">
            <codx-label fiedName="AssignTo" formName="Tasks" gridViewName="grvTasks" default="Giao cho"></codx-label>
          </div>
          <div class="d-flex align-items-center w-100">
            <ng-container [ngTemplateOutlet]="templetUserDetail"></ng-container>
            <!-- <codx-input
                                [refValue]="'Users'"
                                [crrValue]="task.assignTo"
                                placeholder="Chọn tài khoản"
                                type="combobox"
                                style="width:100%"
                                (valueChange)="changeUser($event)"
                                >
                        </codx-input>  -->

          </div>
          <codx-input type="Share" [refValue]="vllShare" field="AssignTo" [dataShared]="[]" multiple="true"
            [showInput]="false" (valueChange)="eventApply($event)"></codx-input>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-end me-2">
      <ng-container *ngFor="let item of listRoles">
        <div class="d-flex align-items-center ms-4">
          <span><img src="/assets/themes/tm/default/img/{{item.icon}}" alt=""></span>
          <div class="fs-8 text-gray-500">{{item.text}}</div>
        </div>
      </ng-container>
    </div>
    <div class="d-flex justify-content-between mb-2 p-2">
      <div class="d-flex align-items-center flex-grow-1">
        <div class="w-100px">
          <codx-label fiedName="TaskName" formName="Tasks" gridViewName="grvTasks" default="Tên công việc">
          </codx-label>
        </div>
        <div class="d-flex align-items-center w-100">
          <codx-input type="text" style="width:100%" name="taskName" field="taskName" [crrValue]="task.taskName"
            (valueChange)="changText($event)"></codx-input>
        </div>
      </div>
      <div class="dropdown">
        <button class="btn btn-xs btn-secondary d-flex align-items-center border-0 dropdown-toggle height" type="button"
          id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span>Chọn mẫu</span>
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <a class="dropdown-item">
            <div class="d-flex flex-column">
              <span class="text-dark">Cấp quyền xem tài liệu</span>
              <i class="tex font-size-sm mt-1">Xin cấp quyền full xem tài liệu</i>
            </div>
          </a>
          <div class="subheader-separator subheader-separator-ver mt-1 ms-1 bg-gray-400"></div>
          <a class="dropdown-item">
            <span class="text-primary">Thêm mẫu mail</span>
          </a>
        </div>
      </div>
      <!-- <div class="d-flex align-items-center flex-grow-1">
                    <div class="w-110px fw-bold">Người giao việc:</div>
                    <codx-input
                        style="width:90%"
                        [refValue]="gridViewSetup['Owner']['referedValue']"
                        type="combobox"
                        (valueChange)="changeValueChangeFrom($event)"
                        [multiple]="true"
                    >
                    </codx-input>
                </div> -->
    </div>
    <div class="d-flex justify-content-between  mb-2 p-2">
      <!-- <div class="fw-bold">Công việc:</div>
                <div class="d-flex align-items-center flex-grow-1">
                    <input class="form-control borderless" type="text" placeholder="Nhập lý do" />
                </div>
                <div class="dropdown">
                    <button class="btn btn-xs btn-secondary d-flex align-items-center border-0 dropdown-toggle height"
                        type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <span>Mail mẫu</span>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item">
                            <div class="d-flex flex-column">
                                <span class="text-dark">Cấp quyền xem tài liệu</span>
                                <i class="tex font-size-sm mt-1">Xin cấp quyền full xem tài liệu</i>
                            </div>
                        </a>
                        <div class="subheader-separator subheader-separator-ver mt-1 ms-1 bg-gray-400"></div>
                        <a class="dropdown-item">
                            <span class="text-primary">Thêm mẫu mail</span>
                        </a>
                    </div>
                </div> -->
    </div>
    <!-- <div class="p-2">
                <thumbnail data="{{getJSONString(data.files)}}"></thumbnail>
            </div> -->
    <div class="form-group mt-3 p-2">
      <div class="d-flex align-items-center justify-content-between">
        <codx-label fiedName="Memo" formName="Tasks" gridViewName="grvTasks" default="Nội dung chi tiết">
        </codx-label>
        <div class="dropdown">
          <button class="btn btn-xs btn-secondary d-flex align-items-center border-0 dropdown-toggle" type="button"
            id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span>Chon trường dữ liệu</span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item">
              <div class="d-flex flex-column">
                <span class="text-dark">Cấp quyền xem tài liệu</span>
                <i class="tex font-size-sm mt-1">Xin cấp quyền full xem tài liệu</i>
              </div>
            </a>
            <div class="subheader-separator subheader-separator-ver mt-1 ms-1 bg-gray-400">
            </div>
            <a class="dropdown-item">
              <span class="text-primary">Thêm mẫu mail</span>
            </a>
          </div>
        </div>
      </div>
      <codx-input type="textarea" field="memo" [crrValue]="task.memo" class="form-control"
        (valueChange)="changeMemo($event)"></codx-input>
    </div>
    <div class="row p-4">
      <div class="d-flex align-items-center flex-grow-1">
        <div class="w-100px">
          <codx-label fiedName="DueDate" formName="Tasks" gridViewName="grvTasks" default="Thời hạn xử lý">
          </codx-label>
        </div>
        <codx-input type="datetime" class="test-datetime" field="dueDate" placeholder="datetime"
          [crrValue]="task.dueDate" format="F" (valueChange)="changeTime($event)">
        </codx-input>

        <div class="col-6 d-flex align-items-center">
          <div class="d-flex flex-stack l-30px ms-3">
            <codx-input #report type="switch" id="switch" [checked]="false" labelPosition="Before" [disabled]="false"
              class="test-switch"></codx-input>
            <div class="ms-2">Yêu cầu báo cáo</div>
          </div>

          <!-- <div class="d-flex flex-stack l-30px ms-3">
                            <codx-input #email type="switch" id="switch" [checked]="false" labelPosition="Before"
                            [disabled]="false" class="test-switch"></codx-input>
                            <div class="ms-2">Gởi email thông báo</div>
                        </div>  -->
        </div>
      </div>
    </div>
    <div class="row ">
      <codx-attachment #attachment [objectType]="dialog.formModel.entityName" [objectId]="task.taskID" hideFolder="1"
        hideImageUpload="0" hideImageThumb="1" hideUploadBtn="1" hideDes="1" type="inline" allowMultiFile="1"
        [formModel]="dialog.formModel" [functionID]="functionID" (fileAdded)="fileAdded($event)"
        (fileCount)="getfileCount($event)" displayThumb="full">
      </codx-attachment>
    </div>
    <!-- </div> -->
  </ng-template>
  <ng-template #footer>
    <div class="d-flex justify-content-between">
      <div class="d-flex flex-stack">
        <button type="button" class="btn btn-light-primary me-3" (click)="addFile($event)">
          <i class="icon-cloud_upload fs-5"></i>Upload file
        </button>
        <codx-input #saveTemplate class="test-switch" type="switch" [checked]="false" [disabled]="false"
          labelPosition="Before"></codx-input>
        <div class="ms-2">Lưu làm template</div>
      </div>
      <div class="d-flex">
        <button type="button" class="btn btn-primary me-3" (click)="saveAssign(task.taskID,true)">Lưu và tiếp
          tục</button>
        <button type="button" class="btn btn-primary" (click)="saveAssign(task.taskID,false)">Lưu</button>
      </div>
    </div>
  </ng-template>
</codx-form>


<ng-template #templetUserDetail>
  <ng-container *ngFor="let item of listTaskResources">
    <div class="d-flex py-2 border-bottom justify-content-between list-title" popoverClass="userPopoverClass"
      [ngbPopover]="popContent" placement="bottom" #p="ngbPopover" (mouseenter)="showPopover(p,item.resourceID)"
      autoClose="outside">
      <div class="d-flex align-items-top">
        <div style=" position: relative">
          <codx-img class="" [objectId]="item?.resourceID" objectType="AD_Users">
          </codx-img>
          <div style="position: absolute; right: 0px;bottom: 0px">
            <ng-container *ngFor="let role of listRoles">
              <ng-container *ngIf="role.value== item.roleType">
                <span><img src="/assets/themes/tm/default/img/{{role.icon}}" alt=""></span>
              </ng-container>
            </ng-container>
          </div>
        </div>
        <div class="d-flex flex-column me-2 ">
          <div class="text-dark fw-bold fs-6">
            {{item?.resourceName}}
          </div>
          <div class="text-gray-700">{{item.positionName}}</div>
        </div>
      </div>
      <div *ngIf="!readOnly">
        <a (click)="onDeleteUser(item.resourceID)" style="cursor: pointer">
          <div class="d-flex align-item-center">
            <span class="icon-close icon-16 text-danger me-2"></span>
          </div>
        </a>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #popContent>
  <div class="d-flex">
    <ng-container *ngFor="let item of listRoles">
      <div class="d-flex align-items-center text-hover-primary btn-light-primary ms-4"
        (click)="selectRoseType(idUserSelected,item.value)" style="cursor: pointer;">
        <span><img src="/assets/themes/tm/default/img/{{item.icon}}" alt=""></span>
        <div class="fs-8 text-gray-500">{{item.text}}</div>
      </div>
    </ng-container>
  </div>
</ng-template>


<!-- New Form  -->
<!-- <codx-form headerText="{{title}}" subHeaderText="" [body]="bodyLater" [footer]="footer" [dialog]="dialog"></codx-form>
<ng-template #subHeader>

</ng-template>
<ng-template #bodyLater>
  <div>
    <div class="d-flex justify-content-between mb-2 p-2">
      <div class="d-flex align-items-center flex-grow-1">
        <div class="w-100px">
          <codx-label fiedName="TaskName" formName="Tasks" gridViewName="grvTasks" default="Tên công việc">
          </codx-label>
        </div>
        <codx-input field="taskName" type="text" [crrValue]="task?.taskName" placeholder="Tên công việc"
        (valueChange)="changText($event)">
      </codx-input>
      </div>
    </div>
    <div class="d-flex justify-content-between p-2">
      <div class="w-100px">
        <codx-label name="TaskGroups" formName="Tasks" default="Nhóm công việc">
        </codx-label>
      </div>
      <codx-input service="TM" type="combobox" [disabled]="readOnly" name="combobox"
        placeholder="Nhóm công việc" refValue="TaskGroups" loadFull="true" field="taskGroupID"
        (valueChange)="cbxChange($event)" [multiple]="false" [crrValue]="task?.taskGroupID">
      </codx-input>
      </div>
  </div>
  <div>
    <codx-input type="textarea" field="memo" [crrValue]="task.memo" class="form-control"
    (valueChange)="changeMemo($event)"></codx-input>
  </div>
  <div>
    <codx-label fiedName="DueDate" formName="Tasks" gridViewName="grvTasks" default="Ngày hết hạn">
    </codx-label>
    <codx-input type="datetime" class="test-datetime" field="dueDate" format="F" placeholder="datetime"
    [crrValue]="task?.dueDate" (valueChange)="changeTime($event)">
  </codx-input>
  <div>
    <codx-label fiedName="Priority"  formName="Tasks" gridViewName="grvTasks" default="Độ ưu tiên">
    </codx-label>
  </div>
  <codx-input type="valuelist" ngDefaultControl field="priority" [crrValue]="task?.priority"
    refValue="L0186" placeholder="Độ ưu tiên" (valueChange)="changeVLL($event)">
  </codx-input>
  </div>
 

</ng-template> -->