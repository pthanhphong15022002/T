<div class="codx-approval step-signature-temp" *ngIf="process?.length > 0 && lstSttApproveStep.includes(approveStatus)">
  <ng-container *ngFor="let item of process; let index = index">
    <div class="codx-approval-step pb-3 step-approve">
      <div class="codx-approval-header d-flex align-items-center mb-3">
        <div class="step-number border-success">{{ item?.stepNo }}</div>
        <div class="step-title text-gray-700 fw-bold fs-6 me-2">
          {{ item?.stepName ?? (item?.stepType | vll : "ES002" : "text" | async ) }}
          <!-- {{ item?.stepType | vll : "ES002" : "text" | async }} -->
        </div>
        <!-- <div class="step-title text-gray-700 fw-bold fs-6 me-2" *ngIf="item?.signatureType">|</div>
        <div *ngIf="eSign" class="step-title text-gray-700 fw-bold fs-6 me-2" [innerHTML]="
            item?.signatureType| vll : 'ES001' : 'text' | async
          "></div>
        <div class="text-gray-500 fs-6 me-2"> - </div>
        <div class="text-gray-500 fs-6">
          {{ item?.stepName ?? item?.stepNote }}
        </div> -->
      </div>
      <div class="codx-approval-content ms-12 ps-1">
        <ng-container *ngFor="let approver of item?.approvers">
          <div class="d-flex justify-content-between align-items-start">

            <codx-temp-full
            [imageId]=" approver?.roleType =='U' ? approver?.approver : approver?.userID" [imageObjType]="'AD_Users'" [imageWidth]="30" 
            [title]="approver?.userName ? approver?.userName : approver?.name ? approver?.name : approver?.approver ? (approver?.approver | vll : 'ES014' : 'text' | async) : (approver?.roleType | vll : 'ES014' : 'text' | async)"
            [subTitle]="approver?.position ? approver?.position: approver?.roleType | vll : 'ES014' : 'text' | async"            
            [imageSrc]="(approver?.roleType !='U' && !approver?.userID) || approver?.roleType =='PA' ? './assets/themes/sys/default/img/' + (approver?.icon ? approver?.icon : 'share_default.svg') : null"
            [imgCss]="(approver?.roleType !='U' && !approver?.userID) || approver?.roleType =='PA' ? 'w-30px p-2 me-3 user-mini-icon' :'w-35px me-3'"                          
            
            >
            </codx-temp-full>
            
            
            <div class="d-flex align-items-center ms-6 flex-column flex-column">
              <div class="d-flex align-items-center ms-6 flex-column">
                <codx-vll [value]="approver?.actived ? '1' : '0'" [name]="'ES031'" [showIcon]="true" [showText]="true"
                  [showBgColor]="true" class="badge">
                </codx-vll>
                <div class="text-dark fs-7"></div>
              </div>
            </div>
          </div>                
          <div class="ps-45px mb-2 pt-1" *ngIf="approver?.userIDs">
            <codx-imgs [objectId]=" approver?.userIDs"
            objectType="AD_Users"
            [numberImages]="3"
            [width]="30"></codx-imgs>
          </div>    
          <div class="d-flex align-items-center justify-content-between mb-3" *ngIf="approver?.leadtime != 0">
            <div class="d-flex w-250px">
              <div class="progress h-6px w-100 me-3" style="background-color: #e9ecef">
                <div role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" class="progress-bar"
                  [ngClass]="
                    approver?.leadtime < approver?.duration
                      ? 'bg-danger'
                      : 'bg-success'
                  " [style]="
                    'width:' +
                    getPercent(approver?.leadtime, approver?.duration) +
                    '%'
                  "></div>
              </div>
            </div>
            <ng-container>
              <div class="d-flex me-3">
                <div class="d-flex text-nowrap me-3">
                  <span class="fw-bold me-1">
                    <codx-label></codx-label>
                  </span>
                  <span class="fw-bold me-1">
                    <codx-label name="lblLeadtime" default="Dự kiến" formName="ApprovalSteps" gridViewName="grvApprovalSteps">
                    </codx-label>
                    :
                  </span>
                  <span class="text-gray-600">
                    {{ approver?.leadtime | number : ".2-2" }} h</span>
                </div>

                |
                <div class="d-flex text-nowrap ms-3">
                  <span class="fw-bold me-1">
                    <codx-label name="lblDuration" default="Thực tế"  formName="ApprovalSteps" gridViewName="grvApprovalSteps">
                    </codx-label>
                    :
                  </span>
                  <span class="text-gray-600">{{ approver?.duration ?? 0 | number : ".2-2" }} h</span>
                </div>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </div>
  </ng-container>
</div>


<div class="codx-approval step-signature-temp"
  *ngIf="process?.length > 0 && !lstSttApproveStep.includes(approveStatus)">
  <ng-container *ngFor="let item of process; let index = index">
    <div class="codx-approval-step pb-3 step-approve">
      <div class="codx-approval-header d-flex align-items-center mb-3">
        <div class="step-number border-success">{{ item?.stepNo }}</div>
        <div class="step-title text-gray-700 fw-bold fs-6 me-2">
          {{ item?.stepName  ?? (item?.stepType | vll : "ES002" : "text" | async )}}
        </div>
      </div>
      <div class="codx-approval-content ms-17">
        <ng-container *ngFor="let approver of item?.approvers">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <codx-temp-full [imageId]="approver?.approverType !='PA' ? approver?.approver :null" [imageObjType]="'AD_Users'" [imageWidth]="35" 
            [imageSrc]="approver?.approverType =='PA' ? './assets/themes/sys/default/img/' + (approver?.icon ? approver?.icon : 'share_default.svg') : null"
            [imgCss]="approver?.approverType =='PA' ? 'w-30px p-2 me-3 user-mini-icon' :'w-35px me-3'"                          
            
            [title]="
                approver?.name ??
                approver?.approverName ??
                (approver?.approver | vll : 'ES014' : 'text' | async)
              " [desc]="
                approver?.position ??
                approver?.approverPosition ??
                positionDefault
              ">
            </codx-temp-full>
            
            <div class="d-flex justify-content-between">
              <div class="text-dark fs-7 me-4 mt-1" *ngIf="approver?.status == '3'">
                {{ approver?.activedOn | amTimeAgo }}
              </div>
              <div class="d-flex flex-wrap">
                <div class="d-flex mt-1" *ngIf="approver?.status == '5'">
                  <!-- <codx-label
                    fiedName="ApprovedOn"
                    [formModel]="fmApprovalTrans"
                  ></codx-label> -->
                  <div class="d-flex text-dark fs-7 me-4">
                    {{ approver?.approvedOn | fmDT }}
                  </div>
                </div>

                <codx-vll *ngIf="approver?.status != '1'" [value]="approver?.status + approver?.stepType"
                  [name]="'ES030'" [showIcon]="true" [showText]="true" [showBgColor]="true" class="badge">
                </codx-vll>
              </div>

              <div *ngIf="approver?.status == '1'"
                class="d-flex align-items-center justify-content-between ms-6 flex-column">
                <codx-vll [value]="approver?.actived ? '1' : '0'" [name]="'ES031'" [showIcon]="true" [showText]="true"
                  [showBgColor]="true" class="badge">
                </codx-vll>
              </div>
            </div>
          </div>
          
          <div class="d-flex align-items-center justify-content-between mb-3" *ngIf="approver?.leadtime != 0">
            <div class="d-flex w-250px">
              <div class="progress h-6px w-100 me-3" style="background-color: #e9ecef">
                <div role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" class="progress-bar"
                  [ngClass]="
                    approver?.leadtime < approver?.duration
                      ? 'bg-danger'
                      : 'bg-success'
                  " [style]="
                    'width:' +
                    getPercent(approver?.leadtime, approver?.duration) +
                    '%'
                  "></div>
              </div>
            </div>
            <ng-container>
              <div class="d-flex me-3">
                <div class="d-flex text-nowrap me-3">
                  <span class="fw-bold me-1">
                    <codx-label></codx-label>
                  </span>
                  <span class="fw-bold me-1">
                    <codx-label name="lblLeadtime" default="Dự kiến" formName="ApprovalSteps" gridViewName="grvApprovalSteps">
                    </codx-label>
                    :
                  </span>
                  <span class="text-gray-600">
                    {{ approver?.leadtime | number : ".2-2" }} h</span>
                </div>

                |
                <div class="d-flex text-nowrap ms-3">
                  <span class="fw-bold me-1">
                    <codx-label name="lblDuration" default="Thực tế"  formName="ApprovalSteps" gridViewName="grvApprovalSteps">
                    </codx-label>
                    :
                  </span>
                  <span class="text-gray-600">{{ approver?.duration ?? 0 | number : ".2-2" }} h</span>
                </div>
              </div>
            </ng-container>
          </div>
          <div class="bg-gray-100 bg-opacity-70 rounded-2 px-3 py-4 mb-3" *ngIf="
              approver?.status != '3' &&
              approver?.comment != '' &&
              approver?.comment
            ">
            <div class="text-comment">
              {{ approver?.comment }}
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </ng-container>
</div>


<div class="codx-approval step-signature-temp" *ngIf="canceledProcess?.length > 0 ">
  <div class="mb-4">
    <codx-label class="fw-bold fs-6 text-primary py-2 cursor-pointer" default="Quy trình duyệt đã hủy"
      name="lblCanceledTrans" (click)="showCanceledTrans(showCanceled)"></codx-label>
  </div>
  <ng-container *ngIf="showCanceled">
    <ng-container *ngFor="let gr of canceledProcess">
      <ng-container *ngFor="let item of gr; let index = index">
        <div class="codx-approval-step pb-3 step-approve opacity-50">
          <div class="codx-approval-header d-flex align-items-center mb-3">
            <div class="step-number border-success">{{ item?.stepNo }}</div>
            <div class="step-title text-gray-700 fw-bold fs-6 me-2">
              {{ item?.stepName  ?? (item?.stepType | vll : "ES002" : "text" | async )}}
            </div>            
          </div>
          <div class="codx-approval-content ms-17">
            <ng-container *ngFor="let approver of item?.approvers">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <codx-temp-full [imageId]="approver?.approverType !='PA' ? approver?.approver :null" [imageObjType]="'AD_Users'" [imageWidth]="35" 
                [imageSrc]="approver?.approverType =='PA' ? './assets/themes/sys/default/img/' + (approver?.icon ? approver?.icon : 'share_default.svg') : null"
            [imgCss]="approver?.approverType =='PA' ? 'w-30px p-2 me-3 user-mini-icon' :'w-35px me-3'"                          
            [title]="
                  approver?.name ??
                  approver?.approverName ??
                  (approver?.approver | vll : 'ES014' : 'text' | async)
                " [desc]="
                  approver?.position ??
                  approver?.approverPosition ??
                  positionDefault
                ">
                </codx-temp-full>
                
                <div class="d-flex justify-content-between">
                  <div class="text-dark fs-7 me-4 mt-1" *ngIf="approver?.status == '3'">
                    {{ approver?.activedOn | amTimeAgo }}
                  </div>
                  <div class="d-flex flex-wrap">
                    <div class="d-flex mt-1" *ngIf="approver?.status == '5'">
                      <div class="d-flex text-dark fs-7 me-4">
                        {{ approver?.approvedOn | fmDT }}
                      </div>
                    </div>
                    <codx-vll *ngIf="approver?.status != '1'" [value]="approver?.status + approver?.stepType"
                      [name]="'ES030'" [showIcon]="true" [showText]="true" [showBgColor]="true" class="badge">
                    </codx-vll>
                  </div>

                  <div *ngIf="approver?.status == '1'"
                    class="d-flex align-items-center justify-content-between ms-6 flex-column">
                    <codx-vll [value]="approver?.actived ? '1' : '0'" [name]="'ES031'" [showIcon]="true"
                      [showText]="true" [showBgColor]="true" class="badge">
                    </codx-vll>
                  </div>
                </div>
              </div>
              <div class="d-flex align-items-center justify-content-between mb-3" *ngIf="approver?.leadtime != 0">
                <div class="d-flex w-250px">
                  <div class="progress h-6px w-100 me-3" style="background-color: #e9ecef">
                    <div role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                      class="progress-bar" [ngClass]="
                      approver?.leadtime < approver?.duration
                        ? 'bg-danger'
                        : 'bg-success'
                    " [style]="
                      'width:' +
                      getPercent(approver?.leadtime, approver?.duration) +
                      '%'
                    "></div>
                  </div>
                </div>
                <ng-container>
                  <div class="d-flex me-3">
                    <div class="d-flex text-nowrap me-3">
                      <span class="fw-bold me-1">
                        <codx-label></codx-label>
                      </span>
                      <span class="fw-bold me-1">
                        <codx-label name="lblLeadtime" default="Dự kiến" formName="ApprovalSteps" gridViewName="grvApprovalSteps">
                        </codx-label>
                        :
                      </span>
                      <span class="text-gray-600">
                        {{ approver?.leadtime | number : ".2-2" }} h</span>
                    </div>

                    |
                    <div class="d-flex text-nowrap ms-3">
                      <span class="fw-bold me-1">
                        <codx-label name="lblDuration" default="Thực tế"  formName="ApprovalSteps" gridViewName="grvApprovalSteps">
                        </codx-label>
                        :
                      </span>
                      <span class="text-gray-600">{{ approver?.duration ?? 0 | number : ".2-2" }} h</span>
                    </div>
                  </div>
                </ng-container>
              </div>
              <div class="bg-gray-100 bg-opacity-70 rounded-2 px-3 py-4 mb-3" *ngIf="
                approver?.status != '3' &&
                approver?.comment != '' &&
                approver?.comment
              ">
                <div class="text-comment">
                  {{ approver?.comment }}
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</div>