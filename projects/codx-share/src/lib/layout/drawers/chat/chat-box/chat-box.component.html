<ng-container *ngIf="group">
    <div class="chat-box">
        <div class="chat-box-header">
            <div class="group-avatar">
                <codx-img 
                    [funcId]="funcID"
                    [objectId]="group.groupType == '1' ? group.groupID2 : group.groupID" 
                    [objectName]="group.groupType == '1' ? group.groupName2 : group.groupName" 
                    [objectType]="group.groupType == '1'? 'AD_Users' : 'WP_Groups'"
                    [width]="35"
                    [updateDirect]="true"
                    [isAllowEdit]="group.groupType == '2'">
                </codx-img>
                <ng-container *ngIf="group.isOnline">
                    <div class="status">
                        <span class="icon-online"></span>
                    </div>
                </ng-container>
            </div>
            <div class="group-infor w-100">
                <div class="group-infor_name w-100">
                    <div class="fw-bold fs-6">{{group.groupType == '1' ? group.groupName2 : group.groupName}}</div>
                    <div class="mt-1">
                        <codx-tag 
                            [isEdit]="false" 
                            [disabled]="true"  
                            [value]="group.tagValue" 
                            [entityName]="'WP_Groups'">
                        </codx-tag>
                    </div>
                </div>
                <div class="d-flex align-items-center morefc-list ms-3">
                    <ng-container *ngIf="group.groupType == '2'">
                        <button type="button" class="btn btn-icon btn-sm btn-light" (click)="clickAddMemeber()">
                            <span class="icon-group_add icon-16"></span>
                        </button>    
                    </ng-container>
                    <button type="button" class="btn-light btn btn-icon btn-sm ms-1">
                        <span class="icon-launch icon-16"></span>
                    </button>
                    <button type="button" class="btn-light btn btn-icon btn-sm ms-1" (click)="collapsed()">
                        <span class="icon-horizontal_rule icon-16" ></span>
                    </button>
                    <button type="button" class="btn-light btn btn-icon btn-sm ms-1" (click)="closeChatBox()">
                        <span class="icon-close icon-16"></span>
                    </button>
                </div>   
            </div>
        </div>
        <div #chatBoxBody class="chat-box-body" (scroll)="scroll(chatBoxBody)">
            <ng-container *ngFor="let item of arrMessages; let i = index">
                <!-- <ng-container [ngSwitch]="">
                    <ng-container *ngSwitchCase="'3'"></ng-container>
                    <ng-container *ngSwitchCase="'5'"></ng-container>
                    <ng-container *ngSwitchDefault>
                        
                    </ng-container>

                </ng-container> -->
                <ng-container *ngIf="item.messageType == '3';else tmpMessage">
                    <div class="message-system" [id]="item.recID">
                        {{item | mssgSYS:mssgType5 | async}}
                    </div>
                </ng-container>
                <ng-template #tmpMessage>
                    <div class="message"  [attr.scroll]="i == arrMessages.length - 1 ? (chatBoxBody | srollPipe) : null">
                        <ng-container *ngIf="user.userID == item.createdBy;else reciverMssg">
                            <div class="message-send">
                                <ng-container *ngIf="item.messageType != '5'">
                                    <div class="message-function cursor-pointer text-gray-600">
                                        <span
                                            class="icon-more_vert me-2"
                                            #ngbPopover0="ngbPopover"
                                            placement="top"
                                            [autoClose]="true"
                                            triggers="manual"
                                            [ngbPopover]="tooltipMfc"
                                            (click)="openTooltipEmoji(ngbPopover0,item)">
                                        </span>
                                        <ng-container *ngIf="item.refType != 'm'">
                                            <span class="icon-undo me-2" (click)="clickReplyMssg(item)"></span>
                                        </ng-container>
                                        <span class="icon-tag_faces me-2"
                                            #ngbPopover1="ngbPopover"
                                            placement="top"
                                            [autoClose]="true"
                                            triggers="manual"
                                            container="body"
                                            [ngbPopover]="tooltipEmojiMssg"
                                            (click)="openTooltipEmoji(ngbPopover1,item)">
                                        </span>
                                    </div>
                                </ng-container>
                                <div class="message-send-message">
                                    <ng-container *ngIf="item.messageType == '5';else tmpSendContent">
                                        <span>{{mssgDeleted}}</span>
                                    </ng-container>
                                    <ng-template #tmpSendContent>
                                        <!-- message reply -->
                                        <ng-container *ngIf="item.refID">
                                            <div class="message-reft">
                                                <span class="d-block">{{item.refContent.createdName}}</span>
                                                <ng-container *ngIf="item.refContent.content">
                                                    <span class="d-block text-gray-500">{{item.refContent.content}}</span>
                                                </ng-container>
                                                <ng-container *ngIf="item.refContent.type == '2'">
                                                    <codx-temp-full 
                                                        [dataItem]="item"
                                                        [imageId]="item.refID" 
                                                        imageObjType="WP_Messages"
                                                        [imageReferType]="item.fileType"
                                                        [title]="item.fileName"
                                                        [desc]="formatBytes(item.fileSize)">
                                                    </codx-temp-full>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="item.message">
                                            <div class="message-send_content">
                                                <span>{{item.message}}</span>
                                                <!-- time -->
                                                <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                                    <span class="d-block">{{item.createdOn | date:'hh:mm'}}</span>
                                                </ng-container>
                                            </div>
                                        </ng-container>     
                                    </ng-template>
                                </div>
                                <!-- files -->
                                <ng-container *ngIf="item.messageType == '2'" >
                                    <div class="message-files">
                                        <codx-view-files 
                                            [objectID]="item.recID" 
                                            [objectType]="'WP_Messages'" 
                                            [formModel]="formModel"
                                            [format]="'grid'"
                                            (selectFile)="clickViewFile($event)">
                                        </codx-view-files>
                                        <!-- time -->
                                        <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                            <div class="d-block text-end">{{item.createdOn | date:'hh:mm'}}</div>
                                        </ng-container>
                                    </div>
                                </ng-container>
                                <!-- votes -->
                                <ng-container *ngIf="item.lstVote">
                                    <div class="emoji-message message-emoji" (click)="clickShowVote(item)">
                                        <ng-container *ngFor="let voteItem of item.lstVote">
                                            <ng-container *ngIf="voteItem.count > 0">
                                                <codx-vll 
                                                    [path]="'assets/themes/wp/default/img/'"
                                                    [name]="'L1480'" 
                                                    [value]="voteItem.voteType" 
                                                    [showIcon]="true" 
                                                    [icoCss]="'w-15px h-15px'">
                                                </codx-vll>
                                            <span *ngIf="voteItem.count > 1">{{voteItem.count}}</span>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                         <!-- reciver message -->
                        <ng-template #reciverMssg>
                            <div class="message-reciver">
                                <div class="message-reciver-avatar">
                                    <codx-img 
                                        [objectId]="item.createdBy" 
                                        [width]="30"
                                        [objectType]="'AD_Users'">
                                    </codx-img>
                                </div>
                                <!-- text -->
                                <div class="message-reciver-message">
                                    <ng-container *ngIf="item.messageType == '5';else tmpReciveContent">
                                        <span>{{mssgDeleted}}</span>
                                    </ng-container>
                                    <ng-template #tmpReciveContent>
                                        <!-- message reply -->
                                        <ng-container *ngIf="item.refID">
                                            <div class="message-reft">
                                                <span class="d-block">{{item.refContent.createdName}}</span>
                                                <ng-container *ngIf="item.refContent.content">
                                                    <span class="d-block text-gray-500">{{item.refContent.content}}</span>
                                                </ng-container>
                                                <ng-container *ngIf="item.refContent.type == '2'">
                                                    <codx-temp-full 
                                                        [dataItem]="item"
                                                        [imageId]="item.refID" 
                                                        imageObjType="WP_Messages"
                                                        [imageReferType]="item.fileType"
                                                        [title]="item.fileName"
                                                        [desc]="formatBytes(item.fileSize)">
                                                    </codx-temp-full>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="item.message">
                                            <div class="reciver-message">
                                                <span>{{item.message}}</span>
                                                <!-- time -->
                                                <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                                    <span class="d-block text-start">{{item.createdOn | date:'hh:mm'}}</span>
                                                </ng-container>
                                            </div>
                                        </ng-container>      
                                    </ng-template>
                                </div>
                                <!-- files -->
                                <ng-container *ngIf="item.messageType == '2'">
                                    <div class="message-files">
                                        <codx-view-files 
                                            [objectID]="item.recID" 
                                            [objectType]="'WP_Messages'" 
                                            [formModel]="formModel"
                                            [format]="'grid'"
                                            (selectFile)="clickViewFile($event)">
                                        </codx-view-files>
                                        <!-- time -->
                                        <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                            <div class="d-block text-start">{{item.createdOn | date:'hh:mm'}}</div>
                                        </ng-container>
                                    </div>
                                </ng-container>
                                <!-- votes -->
                                <ng-container *ngIf="item.lstVote">
                                    <div class="emoji-message message-emoji" (click)="clickShowVote(item)">
                                        <ng-container *ngFor="let voteItem of item.lstVote">
                                            <ng-container *ngIf="voteItem.count > 0">
                                                <div class="d-flex">
                                                    <codx-vll 
                                                        [path]="'assets/themes/wp/default/img/'"
                                                        [name]="'L1480'" 
                                                        [value]="voteItem.voteType" 
                                                        [showIcon]="true" 
                                                        [icoCss]="'w-15px h-15px'">
                                                    </codx-vll>
                                                    <span *ngIf="voteItem.count > 1">{{voteItem.count}}</span>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </div>
                            <ng-container *ngIf="item.messageType != '5'">
                                <div class="message-function cursor-pointer text-gray-600">
                                    <span class="icon-tag_faces me-2"
                                        #ngbPopover1="ngbPopover"
                                        placement="top"
                                        [autoClose]="true"
                                        triggers="manual"
                                        [ngbPopover]="tooltipEmojiMssg"
                                        (click)="openTooltipEmoji(ngbPopover1,item)">
                                    </span>
                                    <ng-container *ngIf="item.refType != 'm'">
                                        <span class="icon-undo me-2 " (click)="clickReplyMssg(item)"></span>
                                    </ng-container>
                                    <ng-container *ngIf="item.createdBy == user.userID" >
                                        <span
                                            class="icon-more_vert me-2"
                                            #ngbPopover0="ngbPopover"
                                            placement="top"
                                            [autoClose]="true"
                                            triggers="manual"
                                            container="body"
                                            [ngbPopover]="tooltipMfc"
                                            (click)="openTooltipEmoji(ngbPopover0,item)">
                                        </span>
                                    </ng-container>
                                </div>
                            </ng-container>
                        </ng-template>  
                    </div>
                </ng-template>  
                <ng-container *ngIf="checkDate(i)">
                    <div class="d-block text-center">
                        <span>{{item.createdOn | fmDT: 'dmy' : true}}</span>
                    </div>
                </ng-container>
            </ng-container>
        </div>
        <div class="chat-box-footer border-top bg-body">
            <div class="footer-emoji me-2" ngbDropdown>
                <span class="icon-tag_faces icon-20 text-hover-primary" ngbDropdownToggle></span>
                <div ngbDropdownMenu class="dropdown-menu p-3 mb-3" aria-labelledby="dropdownMenuButton">
                    <emoji-mart 
                        [set]="emojiMode" 
                        [perLine]="emojiPerLine"
                        [showSingleCategory]="true" 
                        [showPreview]="emojiReview" 
                        (emojiSelect)="addEmoji($event)">
                    </emoji-mart>
                </div>
            </div>
            <div class="footer-attachments me-2">
                <span class="icon-photo icon-20 text-hover-primary" (click)="clickUploadImages()"></span>
                <div class="d-none">
                    <codx-attachment 
                        #codxATMImages 
                        [functionID]="funcID"
                        [allowMultiFile]="'1'"
                        allowExtensions=".png, .jpg, .jpeg"
                        [objectType]="'WP_Messages'" 
                        [showMessage]="'0'"
                        [hideImageUpload]="'1'" 
                        [hideUploadBtn]="'1'" 
                        [hideBtnSave]="'1'" 
                        [hideImageThumb]="'1'"
                        [hideUploadBtn]="'1'"
                        [addPermissions]="permissions" 
                        (fileAdded)="addFileImages($event)">
                    </codx-attachment>
                </div>
            </div>
            <div class="footer-attachments">
                <span class="icon-attach_file icon-20 text-hover-primary" (click)="clickUploadFiles()"></span>
                <div class="d-none">
                    <codx-attachment 
                        #codxATM 
                        [functionID]="funcID"
                        [allowMultiFile]="'1'"
                        [objectType]="'WP_Messages'" 
                        [showMessage]="'0'"
                        [hideImageUpload]="'1'" 
                        [hideUploadBtn]="'1'" 
                        [hideBtnSave]="'1'" 
                        [hideImageThumb]="'1'"
                        [hideUploadBtn]="'1'" 
                        (fileAdded)="addFiles($event)">
                    </codx-attachment>
                </div>
            </div>
            <div class="footer-message">
                <ng-container *ngIf="isReply">
                    <div class="footer-message-reply">
                        <div class="reply-content">
                            <div class="d-block fw-bold">
                                {{replyTo}}
                            </div>
                            <ng-container *ngIf="mssgReply.message">
                                <div class="line-clamp line-clamp-1 text-gray-600">{{mssgReply.message}}</div>
                            </ng-container>
                            <ng-container *ngIf="mssgReply.messageType == '2'">
                                <codx-temp-full 
                                    [dataItem]="mssgReply"
                                    [imageId]="mssgReply.recID" 
                                    imageObjType="WP_Messages"
                                    [imageReferType]="mssgReply.fileType"
                                    [title]="mssgReply.fileName"
                                    [desc]="formatBytes(mssgReply.fileSize)">
                                </codx-temp-full>
                            </ng-container>
                        </div>
                        <div class="reply-colse">
                            <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light" (click)="clickReplyMssg()">
                                <span class="icon-close text-danger"></span>
                            </button>
                        </div>
                    </div>
                </ng-container>
                <div class="footer-message-text" >
                    <input type="textarea" class="input"
                     (keyup.enter)="sendMessage()"  
                     [(ngModel)]="data.message">
                </div>
            </div>
            <button type="button" class="footer-button btn btn-icon btn-light-primary" (click)="sendMessage()">
                <span class="icon-send icon-16"></span>
            </button>
        </div>
    </div>
</ng-container>
<ng-template #tmpMssgFile>
    
</ng-template>
<!-- more function -->
<ng-template #tooltipMfc let-mssg="mssg">
    <div class="row">
        <span class="d-block" *ngIf="mssg.messageType != '5'">
            <span class="icon-close icon-16 text-danger me-2" (click)="deleteMessage(mssg)"></span>
            <codx-label [formModel]="formModel" name="lblDelete_comments" default="Xóa"></codx-label>
        </span>
    </div>
</ng-template>
<!-- vote -->
<ng-template #tooltipEmojiMssg let-mssg="mssg">
    <div class="row">
        <ng-container *ngFor="let item of vllL1480">
            <div (click)="clickVoteMssg(mssg,item)" class="col cursor-pointer" *ngIf="item.value">
                <codx-vll 
                    [path]="'assets/themes/wp/default/img/'"
                    [name]="'L1480'" 
                    [value]="item.value" 
                    [showIcon]="true" 
                    [icoCss]="'w-15px h-15px'">
                </codx-vll>
            </div>
        </ng-container>
    </div>
</ng-template>
<ng-container *ngIf="showCBB">
    <codx-combobox-popup 
        [comboboxName]="'Share_Users'" 
        [multiple]="true" 
        [width]="width"
        [height]="height" 
        [value]="crrMembers"
        [allowRemove]="false"
        (clickSave)="addMemeber($event)">
    </codx-combobox-popup>
</ng-container>
<ng-template #templateVotes let-dialog>
    <div class="popup-vote">
        <div class="popup-title">
            <span>
                <codx-label classList="fw-bolder" [formModel]="formModel" name="lblPopupVote" default="Biểu cảm"></codx-label>
            </span>            
            <span>
                <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light ms-1" (click)="closePopupVote(dialog)">
                    <span class="icon-close icon-16"></span>
                </button>
            </span>
        </div>
        <div class="popup-voteType">
            <ul ngbNav #nav="ngbNav" class="nav-tabs">
                <ng-container *ngFor="let item of lstVoted">
                    <li ngbNavItem>
                        <a ngbNavLink class="d-flex">
                            <ng-container *ngIf="item.voteType == '0';else tmpVoteType">
                                <codx-label classList="fw-bolder" [formModel]="formModel" name="lblPopupVote" default="Tất cả"></codx-label>
                            </ng-container>
                            <ng-template #tmpVoteType>
                                <div>
                                    <codx-vll 
                                        name="L1480" 
                                        [value]="item.voteType" 
                                        [path]="'assets/themes/wp/default/img/'"
                                        [showIcon]="true" 
                                        [icoCss]="'w-15px h-15px'">
                                    </codx-vll>
                                </div>
                            </ng-template>    
                            <div>{{item.listVote.length}}</div>
                        </a>
                        <ng-template ngbNavContent>
                            <ng-container *ngFor="let member of item.listVote">
                                <div class="user-item">
                                    <div class="d-flex">
                                        <codx-img [objectId]="member.createdBy" objectType="AD_Users" [width]="30"></codx-img>
                                        <span>{{member.createdName}}</span>
                                    </div>
                                    <div>
                                        <codx-vll 
                                            name="L1480" 
                                            [value]="member.voteType" 
                                            [path]="'assets/themes/wp/default/img/'"
                                            [showIcon]="true" 
                                            [icoCss]="'w-15px h-15px'">
                                        </codx-vll>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-template>
                    </li>
                </ng-container>
            </ul>
        </div>
        <div class="popup-users">
            <div [ngbNavOutlet]="nav"></div>
        </div>
    </div>
</ng-template>

<ng-template #tmpMssg1 let-data>
    <ng-container *ngFor="let item of data">
        <span class="mssg-item" (click)="clickViewMember(item)">
            <codx-img 
                [objectId]="item.UserID" 
                [objectName]="item.UserName" 
                [objectType]="'AD_Users'" 
                [width]="30">
            </codx-img>
            {{item.UserName}}
        </span>
    </ng-container>
</ng-template>
<ng-template #tmpMssg2 let-data>
    <span class="mssg-item" (click)="clickViewMember(data)">
        <codx-img 
            [objectId]="data.UserID" 
            [objectName]="data.UserName" 
            [objectType]="'AD_Users'" 
            [width]="30">
        </codx-img>
        {{data.UserName}}
    </span>
</ng-template>


<!-- message type 5 -->
<ng-template #mssgType5 let-memberIDs let-memebers="value2" let-user="value3">
    <div class="d-flex align-items-center">
        <span class="d-flex align-items-center">
            <codx-imgs
                [width]="30"
                [objectId]="memberIDs" 
                [objectType]="'AD_Users'" 
                [numberImages]="1">
            </codx-imgs>
            <ng-container *ngFor="let memeber of memebers">
                <span class="mssg-item mssg-item-name" (click)="clickViewMember(memeber)">{{memeber.UserName}}</span>
            </ng-container>
        </span>
        <span>được</span>
        <span class="mssg-item" (click)="clickViewMember(user)">{{user.UserName}}</span>
        <span>thêm vào nhóm</span>
    </div>
</ng-template>
<!-- template view member -->
<ng-template #tmpViewMember let-dialog let-member="data">
    <div class="popup-view">
        <div class="popup-view-header">
            <div class="d-flex align-items-center justify-content-between">
                <span class="fw-bolder fs-5">Thông tin người dùng</span>
                <span>
                    <button type="button" class="btn-light btn btn-icon btn-sm ms-1" (click)="closePoppViewMember(dialog)">
                        <span class="icon-close icon-16"></span>
                    </button>
                </span>
            </div>
        </div>
        <div class="popup-view-body" *ngIf="member">
            <div class="popup-view-body_img">
                <codx-img 
                    [objectId]="member.userID" 
                    [objectName]="member.userName" 
                    [objectType]="'AD_Users'" [width]="90">
                </codx-img>
                <p class="fw-bolder fs-5">{{member.userName}}</p>
            </div>
            <div class="popup-view-body_infor">
                <p class="fw-bolder">Thông tin chung</p>
                <p>
                    <span class="me-4">Điện thoại:</span>
                    <span>{{member.phone}}</span>
                </p>
                <p>
                    <span class="me-4">Giới tính:</span>
                    <codx-vll 
                        [name]="'HR001'" 
                        [value]="member.gender" 
                        showText="true" 
                        [showBgColor]="true"
                        [classList]="'badge badge-sm badge-inline flex-wrap me-0'">
                    </codx-vll>
                </p>
                <p>
                    <span class="me-4">Ngày sinh:</span>
                    <span>{{member.Birthday | date:"ddmmyyyy"}}</span>
                </p>
                <p>
                    <span class="me-4">Trạng thái:</span>
                    <span>
                        <codx-vll 
                            [name]="'HR003'" 
                            [value]="member.status" 
                            [showBgColor]="true" 
                            [showText]="true"
                            [className]="'badge badge-sm badge-inline'">
                        </codx-vll>
                    </span>
                </p>
            </div>
        </div>
        
    </div>
</ng-template>