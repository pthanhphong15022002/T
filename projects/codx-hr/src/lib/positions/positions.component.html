<codx-views #view [funcID]="funcID" service="HR" entityName="HR_Positions" idField="positionID"
    [itemSelected]="itemSelected" assemblyName="ERM.Business.HR" className="PositionsBusiness"
    method="GetModelFormPositionsAsync" [views]="views" [button]="button" (buttonClick)="click($event)"
    [moreFuncs]="moreFuncs" (requestEnded)="requestEnded($event)" (selectedChange)="selectedChange($event)"
    (onDragDrop)="onDragDrop($event)" [selectedFirst]="true">
</codx-views>

<ng-template #panelLeftRef>
    <div class="content d-flex flex-column flex-column-fluid paneltree">
        <div class="searorg">
            <div class="container-fluid d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
                <div class="input-group input-group-solid background-transparent erm-search">
                    <span class="icon-search icon-20"></span>
                    <!-- <input type="text" class="form-control text-dark px-0" #eleSearchChart
              placeholder="Nhập thông tin bạn muốn tìm..." (keydown)="search($event,eleSearchChart)"> -->
                </div>
            </div>
        </div>
        <div class="contact-orgchat">
            <codx-treeview id="chartOrg" #chartOrg [pageSize]=10 [itemTemplate]="templateorg" funcId="HRS0201"
                entityName="HR_OrganizationUnits" service="HR" type="treeView" textField="orgUnitName"
                gridViewName="grvOrganizationUnits" formName="OrganizationUnits" [enableCheck]=false idField="orgUnitID"
                (onSelectionChanged)="onSelectionChanged($event)">
            </codx-treeview>
        </div>
    </div>
</ng-template>

<ng-template #templateorg let-data>
    {{data.orgUnitName}}
</ng-template>

<ng-template #itemTemplate let-data>
    <div class="px-5">
        <div class="d-flex justify-content-between align-items-center border-bottom px-2 py-3">
            <div class="justify-content-start">
                <codx-temp-full cardCss="card-template"
                    [subTitle]="(data.orgUnitID||'') + (data.departmentID ? ' | ' + data.departmentID: '') + (data.divisionID ? ' | ' + data.divisionID: '')"
                    [title]="data.positionName" [titleLine]="data.orgUnitID" [typeMF]="'hover'" [dataItem]="data"
                    [desc]="'Báo cáo trực tiếp: ' + data.reportTo" [formModel]="view.formModel"
                    [desc2]="'Báo cáo gián tiếp: ' + (data.reportTo2 || '')" (clickMF)="clickMF($event,data)">
                </codx-temp-full>
            </div>

            <div class="d-flex flex-wrap">
                <!-- <codx-temp-full cardCss="card-template" [desc]="'Nhóm chức danh: ' + data.jobID"
                    [desc2]="'Chức vụ: ' + data.jobGroup">
                </codx-temp-full> -->
                <div class="d-flex pos-group">
                    <div class="d-flex flex-column align-items-center pos-item">
                        <div class="align-items-center1 fs-7">
                            <codx-label name="lblJobName" formName="Positions" default="Nhóm chức danh: ">
                            </codx-label>
                            <span class="text-dark fw-bold">
                                <span #jobID>{{ data.jobID | formatvalue: view.formModel:"jobID":jobID | async }}</span>
                            </span>
                        </div>
                        <div class="align-items-center1 fs-7">
                            <codx-label name="lbljobGroup" formName="Positions" default="Chức vụ: ">
                            </codx-label>
                            <span class="text-dark fw-bold">
                                <span #jobGroupID>{{ data.jobGroupID | formatvalue:
                                    view.formModel:"jobGroupID":jobGroupID | async }}</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex flex-wrap">
                <div class="d-flex pos-group">
                    <div class="d-flex flex-column align-items-center pos-item w-100px" #h
                        (click)="loadEmployByCountStatus(h,data.positionID,'')">
                        <div class="pos-number text-gray-500 fs-2 fw-bold">{{data.headcounts}}</div>
                        <div class="text-gray-600 mt-1">
                            <codx-label name="lblHeadcounts" formName="Positions" default="Định biên">
                            </codx-label>
                        </div>

                    </div>
                    <div class="d-flex flex-column align-items-center pos-item w-100px" #c
                        (click)="loadEmployByCountStatus(c,data.positionID,'50;60')">
                        <div class="pos-number text-primary fs-2 fw-bold">{{data.currentcounts}}</div>
                        <div class="text-gray-600 mt-1">
                            <codx-label name="lblCurrentcounts" formName="Positions" default="Chính thức">
                            </codx-label>
                        </div>
                        <div *ngIf="data.currentEmpcounts>0" class="symbol-group symbol-hover mt-2">
                            <!-- <codx-img [width]="30" [objectId]="data.currentEmpID" [objectName]="data.currentEmpName"
                                objectType="HR_Employees">
                            </codx-img> -->
                            <codx-img [width]="30" [objectId]="data.currentEmpID" objectType="HR_Employees"
                                [numberImages]="7" (mouseenter)="popoverEmpList(popoverList)"
                                [ngbPopover]="popEmpList" popoverClass="empPopoverClass" #popoverList="ngbPopover"
                                placement="bottom" container="body" autoClose="outside" [openDelay]="500">
                            </codx-img>
                            <div *ngIf="data.currentEmpcounts>1"
                                class="symbol w-30px h-30px symbol-circle border-white bg-light justify-content-center d-flex align-items-center">
                                {{data.currentcounts-1}}+</div>
                        </div>
                    </div>
                    <div class="d-flex flex-column align-items-center pos-item w-100px" #o
                        (click)="loadEmployByCountStatus(o,data.positionID,'20;30')">
                        <div class="pos-number text-warning fs-2 fw-bold">{{data.onboard}}</div>
                        <div class="text-gray-600 mt-1">
                            <codx-label name="lblOnboard" formName="Positions" default="Onboard">
                            </codx-label>
                        </div>
                        <div *ngIf="data.onboardEmpcounts>0" class="symbol-group symbol-hover mt-2">
                            <!-- <codx-img [width]="30" [objectId]="data.onboardEmpID" [objectName]="data.onboardEmpName"
                                objectType="HR_Employees">
                            </codx-img> -->
                            <codx-img [width]="30" [objectId]="data.onboardEmpID" objectType="HR_Employees"
                                [numberImages]="7" (mouseenter)="popoverEmpList(popoverList)"
                                [ngbPopover]="popEmpList" popoverClass="empPopoverClass" #popoverList="ngbPopover"
                                placement="bottom" container="body" autoClose="outside" [openDelay]="500">
                            </codx-img>
                            <div *ngIf="data.onboardEmpcounts>1"
                                class="symbol w-30px h-30px symbol-circle border-white bg-light justify-content-center d-flex align-items-center">
                                {{data.onboardEmpcounts-1}}+</div>
                        </div>
                    </div>
                    <div class="d-flex flex-column align-items-center pos-item w-100px" #f
                        (click)="loadEmployByCountStatus(f,data.positionID,'70')">
                        <div class="pos-number text-danger fs-2 fw-bold">{{data.offboard}}</div>
                        <div class="text-gray-600 mt-1">
                            <codx-label name="lblOffboard" formName="Positions" default="Offboard">
                            </codx-label>
                        </div>
                        <div *ngIf="data.offboardEmpcounts>0" class="symbol-group symbol-hover mt-2">
                            <!-- <codx-img [width]="30" [objectId]="data.offboardEmpID" [objectName]="data.offboardEmpName"
                                objectType="HR_Employees">
                            </codx-img> -->
                            <codx-img [width]="30" [objectId]="data.offboardEmpID" objectType="HR_Employees"
                                [numberImages]="7" (mouseenter)="popoverEmpList(popoverList)"
                                [ngbPopover]="popEmpList" popoverClass="empPopoverClass" #popoverList="ngbPopover"
                                placement="bottom" container="body" autoClose="outside" [openDelay]="500">
                            </codx-img>
                            <div *ngIf="data.offboardEmpcounts>1"
                                class="symbol w-30px h-30px border-white symbol-circle">{{data.offboardEmpcounts-1}}+
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #popEmpList>
    <div class="fw-bold">
      <codx-label name="Resouces" formName="Employees" default="Danh sách nhân viên"></codx-label>
      <span>{{ "(" + countResource + ")" }}</span>
    </div>
    <div>
      <codx-searchbar *ngIf="countResource > 0" (searchEvent)="searchName($event)"></codx-searchbar>
    </div>
    <div class="d-flex align-items-start user-card p-3" *ngFor="let item of listEmployeeSearch">
      <div class="me-3">
        <div>
          <codx-img class="" [objectId]="item?.employeeID" objectType="HR_Employees">
          </codx-img>
        </div>
      </div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold">{{ item?.employeeName }}</div>
        <div class="text-gray-600 fs-7">{{ item?.positionName }}</div>
      </div>
    </div>
</ng-template>