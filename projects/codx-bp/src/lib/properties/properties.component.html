<codx-form
  #form
  [headerText]="data.processName"
  [subHeader]="header"
  [body]="body"
  [formModel]="dialog.formModel"
  [dialog]="dialog"
  class="dialog-property"
>
  <ng-template #header>
    <div class="offcanvas-header w-100">
      <div
        class="btn-extand d-flex align-items-center"
        [ngClass]="!hideExtend ? 'justify-content-end' : 'justify-content-end'"
      >
        <ng-container *ngIf="!hideExtend">
          <span [style.marginLeft]="'52%'">
            <codx-label fiedName="InfoExpand" default="Thông tin mở rộng">
            </codx-label>
          </span>
        </ng-container>
        <a
          class="text-dark-75 text-hover-primary d-flex align-items-center ms-2 cursor-pointer"
          (click)="extendShow()"
        >
          <span *ngIf="hideExtend" class="text-dark me-2">
            <codx-label
              fiedName="Expand"
              [formModel]="form.formModel"
              default="Mở rộng"
            >
            </codx-label>
          </span>
          <span class="icon-login icon-20 ext_button"></span>
        </a>
      </div>
    </div>
  </ng-template>
  <ng-template #body>
    <div class="offcanvas-content offcanvas-extend fixed-extend">
      <div class="d-flex">
        <div class="card-body">
          <div class="mb-5">
            <h4 class="fw-bold text-gray-900 mb-104">
              <codx-label
                fiedName="Info"
                [formModel]="form.formModel"
                default="Thông tin"
              >
              </codx-label>
            </h4>
            <div class="d-flex flex-wrap mb-2">
              <div class="d-flex align-items-center me-4">
                <span class="fw-bolb w-100px">
                  <codx-label name="" default="Người tạo:"> </codx-label>
                </span>
                <span class="text-dark">{{ data.userName }}</span>
              </div>
              <div class="d-flex align-items-center">
                <span class="me-1 icon-16 icon-access_alarm"></span
                ><span>{{ data.activedOn | fmDT }}</span>
              </div>
            </div>
            <div class="d-flex flex-wrap mb-2">
              <div class="d-flex align-items-center me-4">
                <span class="fw-bolb w-100px">
                  <codx-label name="" default="Phiên bản:"> </codx-label>
                </span>
                <span class="text-dark">{{ data.versionNo }}</span>
              </div>
              <div class="d-flex align-items-center">
                <span class="me-1 icon-16 icon-access_alarm"></span
                ><span>{{ data.activedOn | fmDT }}</span>
              </div>
            </div>
            <div class="d-flex flex-wrap mb-2">
              <div class="d-flex align-items-center me-4">
                <span class="fw-bolb w-100px">
                  <codx-label name="" default="Chủ qui trình:"> </codx-label>
                </span>
                <span class="text-dark">{{ data.owner }}</span>
              </div>
            </div>
          </div>
          <div class="card-rating mt-6">
            <div class="fw-bold text-gray-600 mb-4">
              <codx-label name="" default="Đánh giá"> </codx-label>
            </div>
            <div class="d-flex">
              <div class="d-flex flex-column me-20 text-center">
                <div class="fw-bolder text-warning mb-2" [style.fontSize]="'40px'">{{
                  totalRating
                }}</div>
                <div class="rating-group">
                  <div class="d-flex">
                    <span class="icon-star text-gray-500 icon-16 me-1"></span>
                    <span class="icon-star text-gray-500 icon-16 me-1"></span>
                    <span class="icon-star text-gray-500 icon-16 me-1"></span>
                    <span class="icon-star text-gray-500 icon-16 me-1"></span>
                    <span class="icon-star text-gray-500 icon-16 me-1"></span>
                  </div>
                  <div
                    [style.width]="styleRating"
                    class="d-flex rating-percent"
                  >
                    <span class="icon-star text-warning icon-16 me-1"></span>
                    <span class="icon-star text-warning icon-16 me-1"></span>
                    <span class="icon-star text-warning icon-16 me-1"></span>
                    <span class="icon-star text-warning icon-16 me-1"></span>
                    <span class="icon-star text-warning icon-16 me-1"></span>
                  </div>
                </div>
                <div class="text-gray-600 fs-7 mt-2">
                  {{ totalViews }}
                  <codx-label name="" default="Đánh giá"> </codx-label>
                </div>
              </div>
              <!--end::Section-->
              <div class="flex-grow-1">
                <div
                  class="d-flex justify-content-end align-items-start flex-wrap"
                >
                  <div class="d-flex align-items-center w-100 mw-275px mb-2">
                    <div class="d-flex align-items-center me-3">
                      <span class="me-1">5</span>
                      <div class="rating-label">
                        <i class="icon-star icon-16"></i>
                      </div>
                    </div>
                    <div class="progress h-6px w-100 me-3">
                      <div
                        class="progress-bar bg-warning"
                        role="progressbar"
                        [style.width]="rating5"
                        aria-valuenow="50"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <span class="text-primary fw-bold">{{ rating5 }}</span>
                  </div>
                  <div class="d-flex align-items-center w-100 mw-275px mb-2">
                    <div class="d-flex align-items-center me-3">
                      <span class="me-1">4</span>
                      <div class="rating-label">
                        <i class="icon-star icon-16"></i>
                      </div>
                    </div>
                    <div class="progress h-6px w-100 me-3">
                      <div
                        class="progress-bar bg-warning"
                        role="progressbar"
                        [style.width]="rating4"
                        aria-valuenow="50"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <span class="text-primary fw-bold">{{ rating4 }}</span>
                  </div>
                  <div class="d-flex align-items-center w-100 mw-275px mb-2">
                    <div class="d-flex align-items-center me-3">
                      <span class="me-1">3</span>
                      <div class="rating-label">
                        <i class="icon-star icon-16"></i>
                      </div>
                    </div>
                    <div class="progress h-6px w-100 me-3">
                      <div
                        class="progress-bar bg-warning"
                        role="progressbar"
                        [style.width]="rating3"
                        aria-valuenow="50"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <span class="text-primary fw-bold">{{ rating3 }}</span>
                  </div>
                  <div class="d-flex align-items-center w-100 mw-275px mb-2">
                    <div class="d-flex align-items-center me-3">
                      <span class="me-1">2</span>
                      <div class="rating-label">
                        <i class="icon-star icon-16"></i>
                      </div>
                    </div>
                    <div class="progress h-6px w-100 me-3">
                      <div
                        class="progress-bar bg-warning"
                        role="progressbar"
                        [style.width]="rating2"
                        aria-valuenow="50"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <span class="text-primary fw-bold">{{ rating2 }}</span>
                  </div>
                  <div class="d-flex align-items-center w-100 mw-275px mb-2">
                    <div class="d-flex align-items-center me-3">
                      <span class="me-1">1</span>
                      <div class="rating-label">
                        <i class="icon-star icon-16"></i>
                      </div>
                    </div>
                    <div class="progress h-6px w-100 me-3">
                      <div
                        class="progress-bar bg-warning"
                        role="progressbar"
                        [style.width]="rating1"
                        aria-valuenow="50"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <span class="text-primary fw-bold">{{ rating1 }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="separator my-2"></div>
          <div
            class="d-flex flex-column py-3 flex-grow-1 border-top my-rating mt-3"
          >
            <div class="d-flex align-items-center">
              <div class="font-size-lg fw-bold flex-grow-1">
                <codx-label name="" default="Đánh giá tài liệu này">
                </codx-label>
              </div>
              <div class="d-flex">
                <ngb-rating
                  [(rate)]="currentRate"
                  max="5"
                  (rateChange)="readonly = false"
                  (hover)="hovered = $event"
                  (leave)="hovered = currentRate"
                  [readonly]="readonly"
                >
                  <ng-template let-fill="fill" let-index="index">
                    <span
                      class="star"
                      [class.filled]="fill === 100"
                      [class.bad]="index < 5"
                      >&#9733;</span
                    >
                  </ng-template>
                </ngb-rating>
              </div>
            </div>
            <div div class="text-gray-500 fs-7">
              <codx-label
                name=""
                default="Cho người khác biết suy nghĩ của bạn ...."
              >
              </codx-label>
            </div>
            <div class="d-flex align-items-center mt-4">
              <div class="comment-box flex-grow-1">
                <codx-input
                  placeholder="Nhận xét của bạn..."
                  class="form-control test-datetime"
                  type="textarea"
                  format="ed2"
                  style="width: 100%"
                  [crrValue]="commenttext"
                  (valueChange)="txtValue($event, 'commenttext')"
                ></codx-input>
              </div>
              <span
                (click)="setComment()"
                class="btn btn-primary ms-3 min-w-60px"
              >
                <codx-label name="" default="Gửi"> </codx-label>
              </span>
            </div>
          </div>
          <!--begin::Wrapper-->
          <div class="mb-4">
            <!-- <ng-container *ngFor="let view of fileEditing.views; let i = index"> -->
            <!--begin::Foot-->
            <div
              *ngIf="data.rating > 0"
              class="d-flex flex-stack flex-wrap mb-5"
            >
              <codx-temp-full
                [imageId]="data.objectID"
                imageObjType="AD_Users"
                imgCss="w-30px me-3"
                [imageWidth]="30"
                [title]="data.userName"
                [subTitle]="data.positionName"
              >
              </codx-temp-full>
              <div class="d-flex align-items-center text-center">
                <div class="d-flex flex-column">
                  <div class="text-gray-600 fs-7">
                    {{ data.viewDate | timefrom }}
                  </div>
                  <div class="d-flex user-rated">
                    <span [ngClass]="setClassRating(1, data.rating)"></span>
                    <span [ngClass]="setClassRating(2, data.rating)"></span>
                    <span [ngClass]="setClassRating(3, data.rating)"></span>
                    <span [ngClass]="setClassRating(4, data.rating)"></span>
                    <span [ngClass]="setClassRating(5, data.rating)"></span>
                  </div>
                </div>
              </div>
            </div>
            <!--end::Foot-->
            <!--begin::Message-->
            <div class="fs-5 fw-normal text-gray-800">{{ data.comment }}</div>
            <!--end::Message-->
            <!-- </ng-container> -->
          </div>
          <!--end::Wrapper-->
        </div>
        <div
          [ngStyle]="{ display: hideExtend ? 'none' : 'block' }"
          [attr.disabled]="hideExtend ? true : null"
          class="extend-more pl-5 w-350px min-w-350px dm-tab-properties ms-3 border-left"
        >
          <ejs-tab>
            <e-tabitems>
              <e-tabitem>
                <ng-template #headerText>
                  <div>
                    <codx-label name="Version" default="Phiên bản">
                    </codx-label>
                  </div>
                </ng-template>
                <!-- <ng-template #content>
                                    <div class="pt-5 extend-more-content pe-3">
                                        <ng-container
                                            *ngIf="(fileEditing.history && fileEditing.history.length>0 ), else defaulEmpt">
                                            <div *ngFor="let his of fileEditing.history; let i = index">
                                                <ng-container *ngIf="his.fileName != null && his.fileName != ''">
                                                    <div class="d-flex history-item pb-4 line-hor">
                                                        <img *ngIf="his.extension != null && his.extension != ''"
                                                            alt="{{his.fileName}}" class="max-h-20px me-2"
                                                            src="../../../assets/codx/dms/{{getAvatar(his.extension)}}">
                                                        <div class="d-flex flex-column flex-grow-1">
                                                            <div class="d-flex justify-content-between">
                                                                <div class="text-dark fw-bold">{{his.fileName}}</div>
                                                                <div class="text-gray-500 ms-3">{{his.createdOn |
                                                                    timefrom}}</div>
                                                            </div>
                                                            <div class="text-primary fs-7">{{his.userName}}
                                                            </div>
                                                            <div class="text-gray-600">{{his.coment}}</div>
                                                        </div>
                                                    </div>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                    </div>
                                </ng-template> -->
              </e-tabitem>
              <e-tabitem>
                <ng-template #headerText>
                  <div>
                    <codx-label name="History" default="Lịch sử"> </codx-label>
                  </div>
                </ng-template>
                <ng-template #content>
                  <div class="pt-5 extend-more-content pe-3">
                    <ng-container
                      *ngIf="
                        fileEditing?.history && fileEditing?.history.length > 0;
                        else defaulEmpt
                      "
                    >
                      <div
                        *ngFor="
                          let history of fileEditing.history;
                          let i = index
                        "
                        class="history-item pb-6 line-hor"
                      >
                        <div class="d-flex">
                          <div class="me-3">
                            <codx-temp-full
                              [imageId]="history.createdBy"
                              imageObjType="AD_Users"
                              imgCss="w-35px"
                              [imageWidth]="35"
                            >
                            </codx-temp-full>
                          </div>
                          <div class="d-flex flex-column flex-grow-1">
                            <div class="task-date text-gray-500">
                              <span>{{ history.createdOn | timefrom }}</span>
                            </div>
                            <div class="task-name">
                              {{ history.description }}
                            </div>
                            <div class="task-name">{{ history.note }}</div>
                          </div>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </ng-template>
              </e-tabitem>
            </e-tabitems>
          </ejs-tab>
        </div>
      </div>
    </div>
  </ng-template>
</codx-form>

<ng-template #defaulEmpt>
  <div class="container h-100">
    <div class="list-empty card card-flush h-100">
      <div class="d-flex flex-column flex-center justify-content-center">
        <img
          src="../assets/themes/sys/default/img/DataEmpty.svg"
          class="w-200px"
        />
        <div class="fw-bold mt-1 text-center">
          {{ "SYS011" | mssg | async }}
        </div>
        <!-- <div class="mt-2 text-center">Chưa có dữ liệu phát sinh.</div> -->
      </div>
    </div>
  </div>
</ng-template>
