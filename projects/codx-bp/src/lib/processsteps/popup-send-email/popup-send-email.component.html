<codx-form
  [dialog]="dialog"
  [headerText]="headerText"
  [subHeaderText]="subHeaderText"
  [body]="body"
  [footer]="footer"
  [formModel]="formModel"
  #form
></codx-form>

<ng-template #body>
  <div class="request-to">
    <div class="d-flex justify-content-between border-bottom mb-2 pb-1">
        <div class="d-flex align-items-top flex-grow-1">
          <div class="w-50px fw-bold">
            <codx-label
              default="Đến:"
              name="lblTitleTo"
              formName="EmailTemplates"
              gridViewName="grvEmailTemplates"
            >
            </codx-label>
          </div>
          <div class="w-100 me-2">
            <div class="float-left align-items-center">
              <ng-container *ngFor="let item of lstTo">
                <div
                  class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                  *ngIf="item.objectType == 'U'"
                >
                  <div class="me-2">
                    <codx-img
                      [objectId]="item.objetID"
                      objectType="AD_Users"
                      width="20"
                    ></codx-img>
                  </div>
                  <div class="text-gray-600 flex-grow-1 me-2">
                    {{ item.text }}
                  </div>
                  <a
                    class="text-hover-danger d-flex align-items-center"
                    (click)="deleteUser(item, 2)"
                    ><span class="icon-close icon-16"></span
                  ></a>
                </div>
                <div
                  class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                  *ngIf="item.objectType != 'U'"
                >
                  <div class="me-3 user-mini-icon w-20px h-20px">
                    <img
                      [src]="
                        './assets/themes/sys/default/img/' + item.icon ??
                        'share_default.svg'
                      "
                    />
                  </div>
                  <div class="text-gray-600 flex-grow-1 me-2">
                    {{
                      item.text != null
                        ? item.text
                        : (item.objetID | vll: vllShare:"text" | async)
                    }}
                  </div>
                  <a
                    class="text-hover-danger d-flex align-items-center"
                    (click)="deleteUser(item, 2)"
                    ><span class="icon-close icon-16"></span
                  ></a>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        <div class="d-flex align-items-end">
          <span
            class="btn btn-sm fw-bold text-hover-primary"
            *ngIf="
              !showCC &&
              !showBCC &&
              !(showBCC || lstBcc.length > 0) &&
              !(showCC || lstCc.length > 0)
            "
            (click)="changeSendType('cc')"
            >Cc</span
          >
          <span
            class="btn btn-sm fw-bold text-hover-primary"
            *ngIf="
              !showCC &&
              !showBCC &&
              !(showCC || lstCc.length > 0) &&
              !(showBCC || lstBcc.length > 0)
            " 
            (click)="changeSendType('bcc')"
            >
            <codx-label name="lblBcc" default='Bcc'></codx-label>
            </span>
  
            <codx-input
            type="Share"
            [refValue]="vllShare"
            field="AssignTo"
            [dataShared]="[]"
            multiple="true"
            [showInput]="false"
            (valueChange)="eventApply($event)"
          >
          </codx-input>
          <!-- <span class="btn btn-icon btn-sm btn-light">
            <i
              class="icon-person_add_alt_1 icon-18"
              (click)="testdata(controlShare2)"
            ></i
          ></span> -->
        </div>
      </div>
    <div id="from">
      <div class="d-flex justify-content-between border-bottom mb-2 pb-1">
        <div class="d-flex align-items-top flex-grow-1">
          <div class="w-50px fw-bold">
            <codx-label
              name="lblTitleFrom"
              default="Từ:"
              formName="EmailTemplates"
              gridViewName="grvEmailTemplates"
            >
            </codx-label>
          </div>
          <div class="w-100 me-2">
            <div class="float-left align-items-center">
              <ng-container *ngFor="let item of lstFrom">
                <div
                  class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                  *ngIf="item.objectType == 'U'"
                >
                  <div class="me-2">
                    <codx-img
                      [objectId]="item.objetID"
                      objectType="AD_Users"
                      width="20"
                    ></codx-img>
                  </div>
                  <div class="text-gray-600 flex-grow-1 me-2">
                    {{ item.text }}
                  </div>
                  <a
                    class="text-hover-danger d-flex align-items-center"
                    (click)="deleteUser(item, 1)"
                    ><span class="icon-close icon-16"></span
                  ></a>
                </div>
                <div
                  class="d-flex justify-content-between user-mini-nav-custom align-items-center"
                  *ngIf="item.objectType != 'U'"
                >
                  <div class="me-2 user-mini-icon w-20px h-20px">
                    <img
                      class="w-20px h-20px"
                      [src]="
                        './assets/themes/sys/default/img/' + item.icon ??
                        'share_default.svg'
                      "
                    />
                  </div>
                  <div class="text-gray-600 flex-grow-1 me-2">
                    {{
                      item.text ?? (item.objetID | vll: vllShare:"text" | async)
                    }}
                  </div>
                  <a
                    class="text-hover-danger d-flex align-items-center"
                    (click)="deleteUser(item, 1)"
                    ><span class="icon-close icon-16"></span
                  ></a>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        <codx-input
          type="Share"
          [refValue]="vllShare"
          field="AssignTo"
          [dataShared]="[]"
          multiple="true"
          [showInput]="false"
          (valueChange)="eventApply($event)"
        >
        </codx-input>
        <!-- <span class="btn btn-icon btn-sm btn-light">
            <i
              class="icon-person_add_alt_1 icon-18"
              (click)="testdata(controlShare1)"
            ></i
          ></span> -->
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-between border-bottom mt-4">
    <div class="w-100">
      <codx-input
        type="text"
        class="borderless"
        placeholder="Chủ đề"
        ControlName="subject"
        [Group]="form.formGroup"
      >
      </codx-input>
    </div>

    <!-- set cứng chờ control -->
    <div ngbDropdown class="dropdown">
      <button
        ngbDropdownToggle
        class="btn btn-sm btn-light d-flex align-items-center"
        type="button"
        id="dropdownMenuButton1"
        aria-expanded="false"
      >
        <span>Chọn mẫu</span>
        <span class="icon-keyboard_arrow_down icon-16 ms-2"></span>
      </button>
      <ul ngbDropdownMenu aria-labelledby="dropdownMenuButton1">
        <li>
          <div class="mb-1 mx-3">
            <codx-input
              type="text"
              [disabled]="false"
              placeholder="Tìm kiếm"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
        </li>
        <li>
          <a ngbDropdownItem>
            <div class="d-flex flex-column">
              <span class="text-dark">Cấp quyền xem tài liệu</span>
              <i class="fs-7 mt-1">Xin cấp quyền full xem tài liệu</i>
            </div>
          </a>
        </li>
        <li>
          <a ngbDropdownItem>
            <div class="d-flex flex-column">
              <span class="text-dark">Cấp quyền full</span>
              <i class="fs-7 mt-1">Xin cấp quyền full control</i>
            </div>
          </a>
        </li>
        <div class="separator mt-3 opacity-75"></div>
        <li>
          <a ngbDropdownItem href="#">
            <span class="text-primary">Thêm mẫu mail</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
  <div class="d-flex justify-content-between align-items-end mt-4">
    <div>
      <div>
        <codx-attachment
          #attachment
          [objectType]="formModel?.entityName"
          hideBtnSave="1"
          hideFolder="1"
          hideUploadBtn="1"
          hideDes="1"
          [functionID]="dialog.formModel.funcID"
          (fileAdded)="fileAdded($event)"
          (fileCount)="getfileCount($event)"
          [objectId]="objectID"
          [allowMultiFile]="1"
          [idBrowse]="'add'"
        >
        </codx-attachment>
      </div>
    </div>

    <div #dataView id="dataView">
      <button
        class="btn btn-sm btn-light d-flex align-items-center"
        type="button"
        aria-expanded="false"
      >
        <span>
          <codx-label
            default="Chọn trường dữ liệu"
            name="lblChooseField"
            [formModel]="formModel"
          ></codx-label>
        </span>
        <span class="icon-keyboard_arrow_down icon-16 ms-2"></span>
      </button>
    </div>
  </div>

  <div
    #textarea
    class="request-box d-flex justify-content-between mt-3 h-150px"
  >
    <div class="message w-100" >
      <codx-input
        #richtexteditor
        type="textarea"
        field="message"
        format="ed"
        [crrValue]="message"
        height="150"
        (valueChange)="valueChange($event)"
      ></codx-input>
    </div>
   
  </div>
</ng-template>

<ng-template #footer>
  <div class="d-flex justify-content-between">
    <button
        type="button"
        class="btn btn-light-primary me-3"
        (click)="addFile($event)"
      >
        <i class="icon-cloud_upload fs-5"></i
        ><span>
          <codx-label
            name="UploadFile"
            formName="Tasks"
            default="Upload File"
          ></codx-label>
        </span>
      </button>
      <button
      type="button"
      class="btn btn-primary"
      (click)="sendMail()"
    >
      <codx-label name="Send" [formModel]="formModel" default="Gửi"></codx-label>
    </button>
  </div>
</ng-template>
