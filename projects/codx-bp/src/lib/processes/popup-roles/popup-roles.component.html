<codx-form headerText="{{title}}" [body]="body" [footer]="footer" [dialog]="dialog">
  <ng-template #body>
    <div class="row" style="height: 100% !important;">
      <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 border-right role-left">
        <div class="user-mini-nav">
          <div *ngIf="process != null && process?.permissions != null">
            <ng-container *ngFor="let perm of permissions; index as i;">
              <div (click)="changePermission(i)"
                [ngClass]="i == this.currentPemission.toString()?'user-nav-active':null"
                class="cursor-pointer d-flex justify-content-between has-action-menu-od user-nav-item p-2">
                <div class="d-flex justify-content-between list-title w-100">
                  <div class="d-flex align-items-top">
                    <div *ngIf="perm.objectID == null || perm.objectID == ''; then thenAvatar1 else elsethenAvatar1">
                    </div>
                    <ng-template #thenAvatar1>
                      <codx-temp-full imageSrc="../../../assets/codx/user/user-admin.svg" [imageWidth]="25"
                        imgCss="w-25px me-3 cursor-pointer symbol symbol-25 symbol-circle" [title]="perm.objectName"
                        [descLine]="1">
                      </codx-temp-full>
                    </ng-template>
                    <ng-template #elsethenAvatar1>
                      <div class="me-3 d-flex align-items-center" popoverClass="userPopoverClass"
                        [ngbPopover]="popoverSelectRoles" placement="bottom" #p="ngbPopover"
                        (mouseenter)="showPopover(p, perm.objectID)" autoClose="outside">
                        <div class="d-flex align-items-center position-relative">
                          <codx-img class="" [width]="25" [objectId]="perm.objectID" objectType="AD_Users">
                          </codx-img>
                          <div style="position: absolute; right: 0;bottom:-5px">
                            <ng-container *ngFor="let role of listRoles">
                              <ng-container *ngIf="role.value == perm.memberType">
                                <span inlineSVG="./assets/themes/bp/default/img/{{ role.icon }}"></span>
                              </ng-container>
                            </ng-container>
                          </div>
                        </div>
                        <div class="ms-3">
                          <div class="text-dark fw-bold">
                            {{ perm.objectName }}
                          </div>
                          <!-- <div  class="text-gray-700">{{ role.text }}</div> -->
                        </div>
                      </div>

                    </ng-template>
                  </div>

                </div>
                <ng-container *ngIf="checkAssignRemove(i)">
                  <div class="action-menu-od ms-0 d-flex justify-content-center align-items-center cursor-pointer"
                    (click)="removeUser(i)">
                    <i class="icon-close text-danger icon-16"></i>
                  </div>
                </ng-container>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="add-user">
          <div class="d-flex justify-content-end">
            <codx-input type="share" field="addUser" refValue="DM001" [showInput]="false"
              (valueChange)="changUsers($event)">
            </codx-input>
          </div>
          <!-- <div class="d-flex justify-content-between">
            <ng-container *ngFor="let item of listRoles">
              <div class="d-flex align-items-center ms-3">
                <span inlineSVG="./assets/themes/bp/default/img/{{ item.icon }}"></span>
                <div class="fs-8 text-gray-500 ms-1">{{ item.text }}</div>
              </div>
            </ng-container>
          </div> -->


        </div>
      </div>
      <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 ps-6 role-right">
        <div class="list-role">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">
                  <codx-label [default]="'Chức năng'" [fiedName]="'titleFunction'"></codx-label>
                </th>
                <th scope="col">
                  <codx-label [default]="'Mô tả'" [fiedName]="'titleDescription'"></codx-label>
                </th>
                <th scope="col">
                  <codx-label [default]="'Cho phép'" [fiedName]="'titleAllow'"></codx-label>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Toàn quyền'" [formModel]="dialog.formModel" [fiedName]="'Full'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Người dùng có tất cả quyền trên quy trình'" [formModel]="dialog.formModel" [fiedName]="'DescriptionFull'">
                  </codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="full" field="full"
                    [disabled]="checkAdminUpdate()"  (valueChange)="valueChange($event, 'full')" (focus)="controlFocus(true)">
                  </codx-input>
                </td>
              </tr>
              <!-- <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Tạo qui trình'" [formModel]="dialog.formModel" [fiedName]="'Create'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép tạo qui trình'" [fiedName]="'DescriptionCreate'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="checkbox" style="width:100%" [checked]="create" field="create"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'create')">
                  </codx-input>
                </td>
              </tr> -->
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Xem'" [formModel]="dialog.formModel" [fiedName]="'Read'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép xem chi tiết quy trình'" [formModel]="dialog.formModel" [fiedName]="'DescriptionRead'">
                  </codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="read" field="read"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'read')">
                  </codx-input>

                </td>
              </tr>
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Chỉnh sửa'" [formModel]="dialog.formModel" [fiedName]="'Edit'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép chỉnh sửa qui trình'" [formModel]="dialog.formModel"
                    [fiedName]="'Edit'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="edit" field="edit"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'edit')">
                  </codx-input>
                </td>
              </tr>
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Phát hành'" [formModel]="dialog.formModel" [fiedName]="'Publish'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép phát hành qui trình'" [formModel]="dialog.formModel"
                    [fiedName]="'Publish'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="publish" field="publish"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'publish')">
                  </codx-input>
                </td>
              </tr>
              <!-- <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Xóa'" [formModel]="dialog.formModel" [fiedName]="'Delete'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép xóa qui trình'" [fiedName]="'DescriptionDelete'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="checkbox" style="width:100%" [checked]="deletePerm" field="delete"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'delete')">
                  </codx-input>
                </td>
              </tr> -->
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Chia sẻ'" [formModel]="dialog.formModel" [fiedName]="'Share'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép chia sẻ qui trình'" [formModel]="dialog.formModel" [fiedName]="'DescriptionShare'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="share" field="share"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'share')">
                  </codx-input>
                </td>
              </tr>
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Phân quyền'" [formModel]="dialog.formModel" [fiedName]="'Assign'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép chia sẻ và chỉnh sửa quyền'" [formModel]="dialog.formModel" [fiedName]="'DescriptionAssign'">
                  </codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="assign" field="assign"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'assign')">
                  </codx-input>
                </td>
              </tr>
              <!-- <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Upload'" [formModel]="dialog.formModel" [fiedName]="'Upload'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép upload file'" [fiedName]="'DescriptionUpload'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="checkbox" style="width:100%" [checked]="upload" field="upload"
                    [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'upload')">
                  </codx-input>
                </td>
              </tr> -->
              <tr>
                <td class="font-size-lg text-dark">
                  <codx-label [default]="'Download'" [formModel]="dialog.formModel" [fiedName]="'Download'"></codx-label>
                </td>
                <td>
                  <codx-label [default]="'Cho phép download file'" [formModel]="dialog.formModel" [fiedName]="'DescriptionDownload'"></codx-label>
                </td>
                <td class="text-center">
                  <codx-input class="test-check" type="switch" style="width:100%" [checked]="download"
                    field="download" [disabled]="checkAdminUpdate()" (valueChange)="valueChange($event, 'download')">
                  </codx-input>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="row mt-3">
          <div class="col-xl-6 col-lg-6 col-md-6">
            <div class="form-group row">
              <div class="col-4 pt-2">
                <codx-label fiedName="StartDate" [formModel]="dialog.formModel" default="Từ ngày" class="text-dark fw-bold">
                </codx-label>
              </div>
              <div class="col-8">
                <codx-input class="form-control test-datetime"
                  type="datetime" style="width:100%" format="d" [crrValue]="startDate"
                  (valueChange)="valueChange($event, 'startDate')" [disabled]="checkAdminUpdate()">
                </codx-input>
              </div>
            </div>
          </div>
          <div class="col-xl-6 col-lg-6 col-md-6">
            <div class="form-group row">
              <div class="col-4 pt-2">
                <codx-label fiedName="EndDate" [formModel]="dialog.formModel" default="Đến ngày" class="text-dark fw-bold">
                </codx-label>
              </div>
              <div class="col-8">
                <codx-input class="form-control test-datetime"
                  type="datetime" style="width:100%;" format="d" [crrValue]="endDate"
                  (valueChange)="valueChange($event, 'endDate')" [disabled]="checkAdminUpdate()">
                </codx-input>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #footer>

    <button type="button" (click)="onSave()" class="btn btn-primary" [disabled]="checkAdminUpdate()">Lưu</button>
  </ng-template>

</codx-form>


<ng-template #popoverSelectRoles>
  <div class="d-flex flex-column">
    <ng-container *ngFor="let item of listRoles">
      <div class="d-flex align-items-center btn btn-sm btn-white mb-1"
        (click)="selectRoseType(idUserSelected, item.value)" style="cursor: pointer">
        <span inlineSVG="./assets/themes/bp/default/img/{{ item.icon }}"></span>
        <div class="fs-7 text-gray-800 ms-2">{{ item.text }}</div>
      </div>
    </ng-container>
  </div>
</ng-template>
