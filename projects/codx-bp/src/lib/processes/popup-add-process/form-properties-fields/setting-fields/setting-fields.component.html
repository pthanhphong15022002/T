<div
  *ngIf="loadedRenderHTML"
  (mouseenter)="closePopover()"
  class="p-4 h-100"
  (mouseenter)="closePopover()"
>
  <div
    (mouseenter)="closePopover()"
    class="header d-flex align-items-center justify-content-between mb-2"
  >
    <div (mouseenter)="closePopover()" class="d-flex text-dark fw-bold">
      <span
        *ngIf="dataFormat?.icon"
        [ngClass]="dataFormat?.icon"
        class="icon-18 me-2"
      ></span>
      <span>{{ dataFormat?.text }}</span>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="text-gray-800"
      *ngIf="dataCurrent?.fieldType != 'Title'"
      (click)="removeField(dataCurrent)"
    >
      <span class="icon-18 icon-delete cursor-pointer"></span>
    </div>
  </div>
  <div (mouseenter)="closePopover()" class="body">
    <div (mouseenter)="closePopover()" class="form-group">
      <codx-label
        [default]="
          dataCurrent?.fieldType == 'Title' ? 'Tên biểu mẫu' : 'Tên ô nhập liệu'
        "
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        [name]="'lblTitle'"
      ></codx-label>
      <codx-input
        type="text"
        field="title"
        [crrValue]="dataCurrent?.title ?? ''"
        (valueChange)="valueChange($event)"
      ></codx-input>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="dataCurrent?.fieldType == 'Title'"
    >
      <codx-label
        [default]="'Mô tả'"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        name="lblDescription"
      ></codx-label>
      <codx-input
        field="description"
        [formModel]="formModel"
        [crrValue]="dataCurrent?.Description ?? ''"
        (valueChange)="valueChange($event)"
      ></codx-input>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="
        dataCurrent?.fieldType != 'Title' &&
        dataCurrent?.fieldType != 'User' &&
        dataCurrent?.fieldType != 'ComboBox' &&
        dataCurrent?.fieldType != 'Rank' &&
        dataCurrent?.fieldType != 'Progress' &&
        dataCurrent?.fieldType != 'Expression' &&
        dataCurrent?.fieldType != 'Attachment' &&
        dataCurrent?.fieldType != 'Table'
      "
    >
      <codx-label
        default="Giá trị mặc định khi thêm mới biểu mẫu"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        [name]="'lblDefaultValue'"
      ></codx-label>
      <codx-input
        *ngIf="dataCurrent?.fieldType != 'DateTime'"
        field="defaultValue"
        [type]="'text'"
        [crrValue]="dataCurrent?.defaultValue ?? ''"
        (valueChange)="valueChange($event)"
      ></codx-input>
      <codx-input
        *ngIf="dataCurrent?.fieldType == 'DateTime'"
        field="defaultValue"
        type="datetime"
        [format]="dataCurrent?.dataFormat"
        [crrValue]="dataCurrent?.defaultValue ?? ''"
        (valueChange)="valueDateChange($event)"
      ></codx-input>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="
        dataCurrent?.fieldType != 'Title' &&
        dataCurrent?.fieldType != 'Rank' &&
        dataCurrent?.fieldType != 'Progress' &&
        dataCurrent?.fieldType != 'Attachment' &&
        dataCurrent?.fieldType != 'Table'
      "
    >
      <codx-label
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        [name]="'lblDescription'"
        default="Hiển thị chuỗi gợi ý khi chưa có dữ liệu"
      ></codx-label>
      <codx-input
        field="description"
        type="text"
        [crrValue]="dataCurrent?.description ?? ''"
        (valueChange)="valueChange($event)"
      ></codx-input>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="
        dataCurrent?.fieldType == 'Text' || dataCurrent?.fieldType == 'DateTime'
      "
    >
      <codx-label
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        [name]="'lblDataFormat'"
        [default]="
          dataCurrent?.fieldType == 'Text'
            ? 'Định dạng hiển thị'
            : 'Định dạng ngày'
        "
      ></codx-label>
      <codx-input
        *ngIf="dataCurrent?.fieldType == 'Text'"
        field="dataFormat"
        type="valuelist"
        [refValue]="'BP003'"
        [crrValue]="dataCurrent?.dataFormat ?? ''"
        (valueChange)="valueChange($event)"
      ></codx-input>
      <codx-input
        *ngIf="dataCurrent?.fieldType == 'DateTime'"
        field="dataFormat"
        type="valuelist"
        [refValue]="'BP004'"
        [crrValue]="dataCurrent?.dataFormat ?? ''"
        (valueChange)="valueChange($event)"
      ></codx-input>
    </div>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'Rank'"
      [ngTemplateOutlet]="tempRank"
    ></ng-container>
    <ng-container *ngIf="dataCurrent?.fieldType == 'Progress'">
      <codx-label
        default="Màu hiển thị"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        name="lblColorPG"
      ></codx-label>
      <div (mouseenter)="closePopover()" class="form-group">
        <codx-input
          field="color"
          class="ms-4"
          type="colorpicker"
          [showButtons]="false"
          placeholder="A"
          [showText]="false"
          [modeSwitcher]="false"
          [crrValue]="dataCurrent?.rank?.color"
          (valueChange)="valueRankChange($event)"
        ></codx-input>
      </div>
    </ng-container>
    <div
      (mouseenter)="closePopover()"
      *ngIf="dataCurrent?.fieldType != 'Title'"
      class="form-group mt-3 mb-3"
      style="border-bottom: 1px solid var(--gray-150)"
    ></div>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'Attachment'"
      [ngTemplateOutlet]="tempAttachment"
    >
    </ng-container>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'Number'"
      [ngTemplateOutlet]="tempNumber"
    >
    </ng-container>

    <ng-container
      *ngIf="dataCurrent?.fieldType == 'YesNo'"
      [ngTemplateOutlet]="tempYesNo"
    >
    </ng-container>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'User'"
      [ngTemplateOutlet]="tempPerson"
    >
    </ng-container>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'ValueList'"
      [ngTemplateOutlet]="tempListFormat"
    ></ng-container>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'ComboBox'"
      [ngTemplateOutlet]="tempComboBox"
    ></ng-container>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'Table'"
      [ngTemplateOutlet]="tempTable"
    ></ng-container>
    <ng-container
      *ngIf="dataCurrent?.fieldType == 'Expression'"
      [ngTemplateOutlet]="tempExpression"
    ></ng-container>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="dataCurrent?.fieldType == 'Table'"
    >
      <div (mouseenter)="closePopover()" class="d-flex">
        <codx-input
          field="hasIndexNo"
          [crrValue]="tableFormat?.hasIndexNo ?? false"
          type="switch"
          (valueChange)="valueChange($event)"
        ></codx-input>
        <codx-label
          name="lblCountStt"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Có đánh STT dòng"
          class="ms-1"
        ></codx-label>
      </div>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="
        dataCurrent?.fieldType == 'ValueList' ||
        dataCurrent?.fieldType == 'User' ||
        dataCurrent?.fieldType == 'ComboBox'
      "
    >
      <div (mouseenter)="closePopover()" class="d-flex">
        <codx-input
          field="multiselect"
          [crrValue]="dataCurrent?.multiselect"
          type="switch"
          (valueChange)="valueChange($event)"
        ></codx-input>
        <codx-label
          name="lblMultiselect"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Chọn nhiều giá trị"
          class="ms-1"
        ></codx-label>
      </div>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="dataCurrent?.fieldType != 'Title'"
    >
      <div (mouseenter)="closePopover()" class="d-flex">
        <codx-input
          field="isRequired"
          type="switch"
          [crrValue]="dataCurrent?.isRequired"
          (valueChange)="valueChange($event)"
        ></codx-input>
        <codx-label
          name="lblIsRequired"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Bắt buộc"
          class="ms-1"
        ></codx-label>
      </div>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="dataCurrent?.fieldType != 'Title'"
    >
      <div (mouseenter)="closePopover()" class="d-flex">
        <codx-input
          type="switch"
          field="isShow"
          [crrValue]="dataCurrent?.isShow"
          (valueChange)="valueChange($event)"
        ></codx-input>
        <codx-label
          default="Điều kiện hiển thị"
          name="lblIsShow"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          class="ms-1"
        ></codx-label>
      </div>
    </div>
    <div
      (mouseenter)="closePopover()"
      class="form-group"
      *ngIf="dataCurrent?.fieldType == 'Text'"
    >
      <div (mouseenter)="closePopover()" class="d-flex">
        <codx-input
          field="isUpdate"
          type="switch"
          [crrValue]="dataCurrent?.isUpdate"
          (valueChange)="valueChange($event)"
        ></codx-input>
        <codx-label
          name="lblIsRequired"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Cho phép chỉnh sửa và cập nhật các dữ liệu trùng nhau"
          class="ms-1"
        ></codx-label>
      </div>
    </div>
  </div>
</div>

<!--List-->
<ng-template #tempListFormat>
  <div (mouseenter)="closePopover()" class="d-flex justify-content-start mb-1">
    <codx-label
      name="lblListValues"
      [formName]="'DynamicForms'"
      [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
      default="Danh sách giá trị"
    ></codx-label>
  </div>
  <div (mouseenter)="closePopover()" class="form-group">
    <ng-container *ngFor="let item of lstDatasVlls; index as i">
      <div (mouseenter)="closePopover()" class="d-flex w-100 mt-3">
        <div
          (mouseenter)="closePopover()"
          class="d-flex align-items-center w-15"
        >
          <div
            (mouseenter)="closePopover()"
            class="d-flex ms-3"
            (click)="handelTextValue(i)"
          >
            <codx-input
              class="me-4"
              field="icon"
              type="vllicon"
              [disabled]="i != indexCurrentvll"
              [refValue]="'L1470'"
              [crrValue]="item?.icon"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
        </div>
        <div (mouseenter)="closePopover()" class="w-50 me-5">
          <!-- <span
            class="no-border"
            *ngIf="i != indexCurrentvll"
            [ngStyle]="{
              color: item?.color,
              'background-color': item?.backgroundColor
            }"
            (click)="handelTextValue(i)"
            [innerText]="item?.textValue ?? ''"
          ></span> -->
          <input
            class="no-border"
            [ngStyle]="{
              color: item?.color,
              'background-color': item?.backgroundColor
            }"
            #textEditValue
            type="text"
            name="textEditValue"
            matInput
            autofocus
            [value]="item.textValue"
            (blur)="onEditTextValue(textEditValue, item.value)"
            placeholder="Nhập giá trị value"
            (keydown.enter)="onEditTextValue(textEditValue, item.value)"
          />
        </div>
        <div
          (mouseenter)="closePopover()"
          class="w-15 justify-content-center me-1"
          (click)="handelTextValue(i)"
        >
          <codx-input
            field="color"
            class="ms-4"
            type="colorpicker"
            [showButtons]="false"
            placeholder="A"
            [showText]="false"
            [modeSwitcher]="false"
            [crrValue]="item.color"
            (valueChange)="valueChange($event)"
          >
          </codx-input>
        </div>
        <div
          (mouseenter)="closePopover()"
          class="w-15 align-items-center me-1"
          (click)="handelTextValue(i)"
        >
          <codx-input
            field="backgroundColor"
            class="ms-4"
            type="colorpicker"
            [showButtons]="false"
            [showText]="false"
            [modeSwitcher]="false"
            [crrValue]="item?.backgroundColor"
            (valueChange)="valueChange($event)"
          >
          </codx-input>
        </div>
        <div
          (mouseenter)="closePopover()"
          class="w-5 d-flex justify-content-center align-items-center"
          (click)="removeVll(i)"
        >
          <span class="icon-20 icon-close cursor-pointer"></span>
        </div>
      </div>
    </ng-container>
    <div (mouseenter)="closePopover()" class="d-flex w-100 mt-3">
      <div (mouseenter)="closePopover()" class="d-flex align-items-center w-15">
        <div
          (mouseenter)="closePopover()"
          class="d-flex ms-3"
          (click)="handelTextValue(-1)"
        >
          <codx-input
            class="me-4"
            field="icon"
            type="vllicon"
            [refValue]="'L1470'"
            [crrValue]="dataVll?.icon"
            (valueChange)="valueChange($event)"
          >
          </codx-input>
        </div>
      </div>
      <div
        (mouseenter)="closePopover()"
        class="w-50 me-5"
        (click)="handelTextValue(-1)"
      >
        <input
          class="no-border w-100"
          #textAddValue
          type="text"
          name="textAddValue"
          id="textAddValue"
          matInput
          autofocus
          (blur)="onAddTextValue(textAddValue)"
          placeholder="Nhập giá trị value"
        />
      </div>
      <div
        (mouseenter)="closePopover()"
        class="w-15 justify-content-center me-1"
        (click)="handelTextValue(-1)"
      >
        <codx-input
          field="color"
          class="ms-4"
          type="colorpicker"
          [showButtons]="false"
          placeholder="A"
          [showText]="false"
          [crrValue]="dataVll?.color"
          [modeSwitcher]="false"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
      <div
        (mouseenter)="closePopover()"
        class="w-15 align-items-center me-1"
        (click)="handelTextValue(-1)"
      >
        <codx-input
          field="backgroundColor"
          class="ms-4"
          type="colorpicker"
          [showButtons]="false"
          [showText]="false"
          [crrValue]="dataVll?.backgroundColor"
          [modeSwitcher]="false"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
      <div
        (mouseenter)="closePopover()"
        class="w-5 d-flex justify-content-center align-items-center"
        (click)="handelTextValue(-1)"
      >
        <span class="icon-20 icon-close cursor-pointer"></span>
      </div>
    </div>
  </div>
  <div
    (mouseenter)="closePopover()"
    class="form-group mt-3 mb-3"
    style="border-bottom: 1px solid var(--gray-150)"
  ></div>
  <div (mouseenter)="closePopover()" class="form-group">
    <div (mouseenter)="closePopover()" class="d-flex">
      <div (mouseenter)="closePopover()" class="d-flex me-2">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="dropDown"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="dropDown"
            [checked]="dataCurrent?.refType == '2' ?? false"
            [crrValue]="dataCurrent?.refType == '2'"
            (valueChange)="changeRadio($event, 'dropDown')"
          ></codx-input>
        </span>
        <codx-label
          name="lblDropDown"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="DropDown"
        ></codx-label>
      </div>
      <div (mouseenter)="closePopover()" class="d-flex">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="checkBox"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="checkBox"
            [checked]="dataCurrent.refType != '2' ?? false"
            [crrValue]="dataCurrent.refType != '2'"
            (valueChange)="changeRadio($event, 'checkBox')"
          ></codx-input>
        </span>
        <codx-label
          name="lblCheckBox"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="CheckBox"
        ></codx-label>
      </div>
    </div>
  </div>
</ng-template>
<!--ComboBox-->
<ng-template #tempComboBox>
  <div class="d-flex justify-content-between">
    <div
      (mouseenter)="closePopover()"
      class="form-group d-flex justify-content-start mb-1"
    >
      <codx-label
        name="lblListValues"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        default="Danh sách giá trị"
      ></codx-label>
    </div>
    <div
      *ngIf="listCbx?.length > 0"
      class="d-flex justify-content-end me-2 cursor-pointer"
      (click)="openSettingCbx()"
    >
      <span class="icon-18 icon-edit_square"></span>
    </div>
  </div>
  <div
    (mouseenter)="closePopover()"
    class="form-group d-flex justify-content-center align-items-center mt-3"
  >
    <ng-container [ngTemplateOutlet]="tempTableCombobox"></ng-container>
  </div>
  <div
    (mouseenter)="closePopover()"
    class="form-group mt-3 mb-3"
    style="border-bottom: 1px solid var(--gray-150)"
  ></div>
  <div (mouseenter)="closePopover()" class="form-group">
    <div (mouseenter)="closePopover()" class="d-flex">
      <div (mouseenter)="closePopover()" class="d-flex me-2">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="dropDown"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="dropDown"
            [checked]="dataCurrent?.refType == '3' ?? false"
            [crrValue]="dataCurrent?.refType == '3'"
            (valueChange)="changeRadio($event, 'dropDown')"
          ></codx-input>
        </span>
        <codx-label
          name="lblDropDown"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="DropDown"
        ></codx-label>
      </div>
      <div (mouseenter)="closePopover()" class="d-flex">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="popup"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="popup"
            [checked]="dataCurrent.refType == '3P' ?? false"
            [crrValue]="dataCurrent.refType == '3P'"
            (valueChange)="changeRadio($event, 'popup')"
          ></codx-input>
        </span>
        <codx-label
          name="lblPopup"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Popup"
        ></codx-label>
      </div>
    </div>
  </div>
</ng-template>
<!--number-->
<ng-template #tempNumber>
  <div
    (mouseenter)="closePopover()"
    class="form-group"
    *ngIf="dataCurrent?.fieldType == 'Number'"
  >
    <div (mouseenter)="closePopover()" class="d-flex">
      <div (mouseenter)="closePopover()" class="d-flex me-4">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="int"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="int"
            [checked]="dataCurrent?.dataFormat == 'I' ?? false"
            [crrValue]="dataCurrent?.dataFormat == 'I' ?? false"
            (valueChange)="changeRadio($event, 'int')"
          ></codx-input>
        </span>
        <codx-label
          name="lblInt"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Số nguyên"
        ></codx-label>
      </div>
      <div (mouseenter)="closePopover()" class="d-flex me-4">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="float"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="float"
            [checked]="dataCurrent?.dataFormat == 'D' ?? false"
            [crrValue]="dataCurrent?.dataFormat == 'D' ?? false"
            (valueChange)="changeRadio($event, 'float')"
          ></codx-input>
        </span>
        <codx-label
          name="lblFloat"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Số thập phân"
        ></codx-label>
      </div>
      <div (mouseenter)="closePopover()" class="d-flex">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="percent"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="percent"
            [checked]="dataCurrent?.dataFormat == 'P' ?? false"
            [crrValue]="dataCurrent?.dataFormat == 'P' ?? false"
            (valueChange)="changeRadio($event, 'percent')"
          ></codx-input>
        </span>
        <codx-label
          name="lblPercent"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Số thập phân"
        ></codx-label>
      </div>
    </div>
  </div>
</ng-template>
<!--YesNo-->
<ng-template #tempYesNo>
  <div
    (mouseenter)="closePopover()"
    class="form-group"
    *ngIf="dataCurrent?.fieldType == 'YesNo'"
  >
    <div (mouseenter)="closePopover()" class="d-flex">
      <div (mouseenter)="closePopover()" class="d-flex me-4">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="switch"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="switch"
            [checked]="dataCurrent?.controlType == 'Switch' ?? false"
            [crrValue]="dataCurrent?.controlType == 'Switch' ?? false"
            (valueChange)="changeRadio($event, 'switch')"
          ></codx-input>
        </span>
        <codx-label
          name="lblSwitch"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Switch"
        ></codx-label>
      </div>
      <div (mouseenter)="closePopover()" class="d-flex">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="checkBox"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="checkBox"
            [checked]="dataCurrent?.controlType == 'CheckBox' ?? false"
            [crrValue]="dataCurrent?.controlType == 'CheckBox' ?? false"
            (valueChange)="changeRadio($event, 'checkBox')"
          ></codx-input>
        </span>
        <codx-label
          name="lblCheckBox"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="CheckBox"
        ></codx-label>
      </div>
    </div>
  </div>
</ng-template>

<!--Person-->
<ng-template #tempPerson>
  <div (mouseenter)="closePopover()" class="form-group">
    <div (mouseenter)="closePopover()" class="d-flex">
      <div (mouseenter)="closePopover()" class="d-flex me-2">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="dropDown"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="dropDown"
            [checked]="dataCurrent?.refType == '3' ?? false"
            [crrValue]="dataCurrent?.refType == '3' ?? false"
            (valueChange)="changeRadio($event, 'dropDown')"
          ></codx-input>
        </span>
        <codx-label
          name="lblDropDown"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="DropDown"
        ></codx-label>
      </div>
      <div (mouseenter)="closePopover()" class="d-flex">
        <span
          class="d-flex"
          style="margin-top: -7px; margin-right: 20px !important"
        >
          <codx-input
            id="popup"
            name="{{ dataCurrent?.recID }}"
            class="test-check"
            type="radio"
            field="popup"
            [checked]="dataCurrent?.refType != '3' ?? false"
            [crrValue]="dataCurrent?.refType != '3' ?? false"
            (valueChange)="changeRadio($event, 'popup')"
          ></codx-input>
        </span>
        <codx-label
          name="lblPopup"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Popup"
        ></codx-label>
      </div>
    </div>
  </div>
</ng-template>

<!--rank-->
<ng-template #tempRank>
  <div (mouseenter)="closePopover()" class="form-group">
    <div (mouseenter)="closePopover()" class="d-flex align-items-center mb-2">
      <codx-label
        default="Tỷ lệ từ"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        name="lblRatio"
        class="me-2"
      ></codx-label>
      <div (mouseenter)="closePopover()" class="w-15 me-2">
        <codx-input
          type="number"
          field="minValue"
          [showSpinButton]="true"
          [min]="0"
          [crrValue]="dataCurrent?.rank?.minValue"
          (valueChange)="valueRankChange($event)"
        ></codx-input>
      </div>
      <codx-label
        default="đến"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        name="lblTo"
        class="me-2"
      ></codx-label>
      <div (mouseenter)="closePopover()" class="w-15">
        <codx-input
          type="number"
          field="maxValue"
          [showSpinButton]="true"
          [max]="10"
          [crrValue]="dataCurrent?.rank?.maxValue"
          (valueChange)="valueRankChange($event)"
        ></codx-input>
      </div>
    </div>
    <div (mouseenter)="closePopover()" class="d-flex mb-2">
      <span
        class="d-flex"
        style="margin-top: -7px; margin-right: 20px !important"
      >
        <codx-input
          id="rankNumber"
          name="{{ dataCurrent?.recID }}"
          class="test-check"
          type="radio"
          field="rankNumber"
          [checked]="dataCurrent?.rank.type == '1'"
          [crrValue]="dataCurrent?.rank.type == '1' ?? false"
          (valueChange)="changeRadio($event, 'rankNumber')"
        ></codx-input>
      </span>
      <codx-label
        name="lblRankNumber"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        default="Hiển thị hạng theo số"
      ></codx-label>
    </div>
    <div (mouseenter)="closePopover()" class="d-flex">
      <span
        class="d-flex"
        style="margin-top: -7px; margin-right: 20px !important"
      >
        <codx-input
          id="rankIcon"
          name="{{ dataCurrent?.recID }}"
          class="test-check"
          type="radio"
          field="rankIcon"
          [checked]="dataCurrent?.rank.type == '2' ?? false"
          [crrValue]="dataCurrent?.rank.type == '2' ?? false"
          (valueChange)="changeRadio($event, 'rankIcon')"
        ></codx-input>
      </span>
      <div (mouseenter)="closePopover()" class="d-flex flex-column">
        <codx-label
          class="mb-1"
          name="lblRankIcon"
          [formName]="'DynamicForms'"
          [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          default="Hiển thị hạng theo icon"
        ></codx-label>
        <div (mouseenter)="closePopover()" class="d-flex">
          <codx-input
            class="me-3"
            field="icon"
            type="vllicon"
            [disabled]="dataCurrent?.rank.type == '1' ? true : false"
            [refValue]="'BP006'"
            [crrValue]="dataCurrent?.rank?.icon"
            (valueChange)="valueRankChange($event)"
          >
          </codx-input>
          <codx-input
            field="color"
            class="ms-4"
            type="colorpicker"
            [showButtons]="false"
            [disabled]="dataCurrent?.rank.type == '1' ? true : false"
            placeholder="A"
            [showText]="false"
            [modeSwitcher]="false"
            [crrValue]="dataCurrent?.rank?.color"
            (valueChange)="valueRankChange($event)"
          >
          </codx-input>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!--table combobox-->
<ng-template #tempTableCombobox>
  <ng-container *ngIf="listCbx?.length > 0; else noData">
    <table class="table">
      <thead class="thead-light">
        <tr class="fw-bold">
          <th scope="col-4 d-flex justify-content-center align-items-center">
            <codx-label
              default="Tên trường dữ liệu"
              name="lblFNameTable"
              [formName]="'DynamicForms'"
              [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
            ></codx-label>
          </th>
          <th scope="col-2 d-flex justify-content-center align-items-center">
            <codx-label
              default="Hiển thị"
              name="lblShowTable"
              [formName]="'DynamicForms'"
              [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
            ></codx-label>
          </th>
          <th scope="col-2 d-flex justify-content-center align-items-center">
            <codx-label
              default="Lưu"
              name="lblSaveTable"
              [formName]="'DynamicForms'"
              [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
            ></codx-label>
          </th>
          <th scope="col-2 d-flex justify-content-center align-items-center">
            <codx-label
              default="Lọc"
              name="lblFilterTable"
              [formName]="'DynamicForms'"
              [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
            ></codx-label>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of listCbx; index as i">
          <td scope="row" style="border: none; padding: 0">
            <span>{{ item?.headerText }}</span>
          </td>
          <td>
            <codx-input
              field="allowShow"
              type="checkbox"
              [crrValue]="item?.allowShow ?? false"
              [disabled]="true"
            ></codx-input>
          </td>
          <td>
            <codx-input
              field="allowSave"
              type="checkbox"
              [crrValue]="item?.allowSave ?? false"
              [disabled]="true"
            ></codx-input>
          </td>
          <td>
            <codx-input
              field="allowFilter"
              type="checkbox"
              [crrValue]="item?.allowFilter ?? false"
              [disabled]="true"
            ></codx-input>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>
  <ng-template #noData>
    <div class="emtry-table" (click)="openSettingCbx()">
      <codx-label
        default="+ Thiết lập/ chỉnh sửa danh sách"
        name="lblEmtryCbx"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
      ></codx-label>
    </div>
  </ng-template>
</ng-template>
<!--Attach ment-->
<ng-template #tempAttachment>
  <div class="d-flex justify-content-between">
    <div
      (mouseenter)="closePopover()"
      class="form-group d-flex justify-content-start mb-1"
    >
      <codx-label
        name="lblListAttach"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        default="Danh sách mẫu"
      ></codx-label>
    </div>
  </div>
  <div
    (mouseenter)="closePopover()"
    class="form-group d-flex justify-content-center align-items-center mt-4"
  >
    <ng-container>
      <table class="table">
        <thead class="thead-light">
          <tr class="fw-bold">
            <th scope="col-8 d-flex justify-content-center align-items-center">
              <codx-label
                default="Tên file"
                name="lblNameFile"
                [formName]="'DynamicForms'"
                [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
              ></codx-label>
            </th>
            <th scope="col-2 d-flex justify-content-center align-items-center">
              <codx-label
                default="Mẫu"
                name="lblForm"
                [formName]="'DynamicForms'"
                [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
              ></codx-label>
            </th>
            <th scope="col-2 d-flex justify-content-center align-items-center">
              <codx-label
                default="Bắt buộc"
                name="lblIsRequiredAttach"
                [formName]="'DynamicForms'"
                [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
              ></codx-label>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of documentControls; index as i">
            <td scope="row" style="border: none; padding: 0">
              <input
                class="no-border"
                #textEditValue
                type="text"
                name="title"
                matInput
                autofocus
                [value]="item.title"
                (blur)="onChangeText(textEditValue, i)"
                (keydown.enter)="onChangeText(textEditValue, i)"
              />
            </td>
            <td>
              <div class="position-relative d-flex align-items-center">
                <span
                  class="me-1 icon-16 icon-i-paperclip cursor-pointer text-hover-primary"
                  (click)="uploadFile(i)"
                ></span>
                <span
                  *ngIf="item?.count > 0"
                  class="position-absolute topbar-badge translate-middle badge badge-sm rounded-pill bg-danger top-0"
                  style="left: 45% !important"
                  >{{ item?.count }}</span
                >
              </div>
            </td>
            <td>
              <codx-input
                field="isRequired"
                type="checkbox"
                (valueChange)="valueChangeFile($event, i)"
                [crrValue]="item.isRequired ?? false"
              ></codx-input>
            </td>
          </tr>
          <tr>
            <td scope="row" style="border: none; padding: 0">
              <input
                class="no-border"
                #textValue
                id="textValue"
                type="text"
                name="title"
                matInput
                autofocus
                [value]="''"
                placeholder="Thêm file"
                (blur)="onChangeText(textValue, -1)"
                (keydown.enter)="onChangeText(textValue, -1)"
              />
            </td>
            <td>
              <div class="position-relative d-flex align-items-center">
                <span
                  class="me-1 icon-16 icon-i-paperclip cursor-pointer text-hover-primary"
                  (click)="uploadFile(-1)"
                ></span>
              </div>
            </td>
            <td>
              <codx-input
                field="isRequired"
                type="checkbox"
                (valueChange)="valueChangeFile($event, -1)"
                [crrValue]="false"
              ></codx-input>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>
  </div>
  <div>
    <codx-attachment
      #attachment
      [objectId]="document?.recID"
      [objectType]="'BP_Processes_Steps_ExtendInfo'"
      [referType]="'source'"
      [parentID]="process?.recID"
      hideFolder="1"
      hideImageUpload="1"
      hideImageThumb="1"
      hideUploadBtn="1"
      hideDes="1"
      type="inline"
      allowMultiFile="1"
      (fileAdded)="fileAdded($event)"
      (fileCount)="getfileCount($event)"
      displayThumb="full"
      showMessage="1"
    >
    </codx-attachment>
  </div>
  <div
    (mouseenter)="closePopover()"
    class="form-group mt-3 mb-3"
    style="border-bottom: 1px solid var(--gray-150)"
  ></div>
</ng-template>

<!--Table-->
<ng-template #tempTable>
  <div class="d-flex justify-content-between">
    <div
      (mouseenter)="closePopover()"
      class="form-group d-flex justify-content-start mb-1"
    >
      <codx-label
        name="lblListValues"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        default="Danh sách cột"
      ></codx-label>
    </div>
  </div>
  <div
    class="d-flex flex-column align-items-center"
    cdkDropList
    (cdkDropListDropped)="dropTable($event)"
  >
    <div
      *ngFor="let item of lstTables; index as i"
      class="border-table"
      cdkDrag
    >
      <div class="d-flex justify-content-start">
        <!-- <span class="icon-email icon-18 me-2"></span> -->
        <span class="">{{ item.title }} ({{ item.fieldName }})</span>
      </div>
      <div
        class="d-flex justify-content-end cursor-pointer"
        (click)="formPropertieFields('edit', i)"
      >
        <span class="icon-18 icon-edit_square"></span>
      </div>
    </div>

    <div class="emtry-table" (click)="formPropertieFields('add', -1)">
      <codx-label
        default="+ Thêm cột"
        name="lblAddColumn"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
      ></codx-label>
    </div>
  </div>
  <div
    (mouseenter)="closePopover()"
    class="form-group mt-3 mb-3"
    style="border-bottom: 1px solid var(--gray-150)"
  ></div>
</ng-template>

<!--Expression-->
<ng-template #tempExpression>
  <div class="d-flex justify-content-between">
    <div
      (mouseenter)="closePopover()"
      class="form-group d-flex justify-content-start mb-1"
    >
      <codx-label
        name="lblExpression"
        [formName]="'DynamicForms'"
        [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
        default="Công thức"
      ></codx-label>
    </div>
    <div
      class="d-flex justify-content-end me-2 cursor-pointer"
      (click)="openSettingExpression()"
    >
      <span class="icon-18 icon-edit_square"></span>
    </div>
  </div>
  <codx-input
    type="text"
    [disabled]="true"
    format="ed2"
    field="refValue"
    placeholder="Exp [So_luong] * [Don_gia]"
    [crrValue]="dataCurrent?.refValue"
  ></codx-input>
  <div
    (mouseenter)="closePopover()"
    class="form-group mt-3 mb-3"
    style="border-bottom: 1px solid var(--gray-150)"
  ></div>
</ng-template>

<!--open form setting Expresssion-->
<ng-template #itemExpression>
  <codx-form
    [headerText]="titleAction"
    [body]="body"
    [footer]="footer"
    [dialog]="dialogExpress"
  >
    <ng-template #body>
      <div class="form-group row h-100">
        <div class="col-8">
          <codx-label
            name="lblExpress"
            default="Công thức dữ liệu"
            [formName]="'DynamicForms'"
            [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          ></codx-label>
          <div
            cdkDropList
            #tableList="cdkDropList"
            (cdkDropListDropped)="drop($event)"
          >
            <codx-input
              id="specialCodxInput"
              class="h-100 d-flex"
              type="text"
              [crrValue]="refValueEpress ?? ''"
              placeholder="Exp [So_luong] * [Don_gia]"
              (valueChange)="valueChangeExp($event)"
              field="refValueEpress"
              cdkDrag
              [cdkDragData]="refValueEpress"
              [cdkDragDisabled]="true"
              cdkDropList
            ></codx-input>
          </div>
        </div>
        <div class="col-4">
          <codx-label
            name="lblListExpress"
            default="Danh sách dữ liệu"
            [formName]="'DynamicForms'"
            [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
          ></codx-label>
          <div
            class="mt-2 d-flex flex-column"
            cdkDropList
            #menuList="cdkDropList"
            [cdkDropListData]="lstEpresssions"
            cdkDropListSortingDisabled
            [cdkDropListConnectedTo]="[tableList]"
            (cdkDropListDropped)="drop($event)"
          >
            <ng-container *ngFor="let item of lstEpresssions">
              <div
                cdkDrag
                [cdkDragData]="item"
                class="w-100 py-3 px-4 mb-3 bg-item-lightest rd-3px cursor-move mw-300px d-flex align-items-center"
              >
                <span class="fw-bold ms-4 mt-1">{{ item.title }}</span>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </ng-template>
    <ng-template #footer>
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-primary" (click)="onSave()">
          <codx-label
            name="lblSuscess"
            [formName]="'DynamicForms'"
            [gridViewName]="'grvDynamicFormsTitle' + dataCurrent?.fieldType"
            default="Đồng ý"
          ></codx-label>
        </button>
      </div>
    </ng-template>
  </codx-form>
</ng-template>
