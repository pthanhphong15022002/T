<div class="card-body p-0 codx-card-custom">
  <div class="codx-stepper stepper stepper-pills">
    <div class="stepper-header d-flex flex-wrap flex-stack ps-6">
      <div class="d-flex align-items-center">
        <h2 class="h2-title">
          {{ title }}
        </h2>
      </div>
      <div class="d-flex align-items-center">
        <div class="stepper-nav flex-center flex-wrap" #status>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item active' : 'stepper-item approve'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(0)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 0 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblInfomations"
                  [formModel]="dialog.formModel"
                  default="Thông tin chung"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(1)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 1 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblProcessSteps"
                  [formModel]="dialog.formModel"
                  default="Quy trình xử lí"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(2)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 2 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblResult"
                  [formModel]="dialog.formModel"
                  default="Kết quả đầu ra"
                ></codx-label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex align-items-center justify-content-end">
        <ng-container *ngIf="currentTab == 1">
          <div class="d-flex mx-4 bg-gray-100 p-1 step-process-tab">
            <div
              class="p-3 cursor-pointer"
              [class.active]="processTabIndex == 0"
              (click)="activeTab(0)"
            >
              <i class="icon-i-bar-chart-steps"></i>
            </div>
            <div
              class="p-3 cursor-pointer"
              [class.active]="processTabIndex == 1"
              (click)="activeTab(1)"
            >
              <i class="icon-account_tree"></i>
            </div>
          </div>
        </ng-container>
        <div class="btn btn-sm btn-bg-white text-inverse-white mb-2">
          <i
            class="icon-close icon-18 text-hover-danger"
            (click)="dialog.close()"
          ></i>
        </div>
      </div>
    </div>
    <div class="stepper-body pt-4 px-4">
      <div
        class="card shadow-none rounded-0 border-0 mx-auto h-100"
        [style]="{ width: '1100px' }"
      >
        <div
          class="scroll-y"
          class="dp-step step-content"
          data-kt-scroll="true"
          data-kt-scroll-activate="{default: true}"
          data-kt-scroll-height="auto"
          data-kt-scroll-dependencies=".tab-pane-header,.tab-pane-footer"
          data-kt-scroll-wrappers=".stepper-body"
          data-kt-scroll-offset="0px"
        >
          <div class="tab-content">
            <div
              class="tab-pane fade"
              id="pane_1"
              [ngClass]="currentTab == 0 ? 'active show' : ''"
            >
              <ng-template [ngTemplateOutlet]="tmpInfomation"></ng-template>
            </div>
            <div
              class="tab-pane fade h-100"
              id="pane_2"
              [ngClass]="currentTab == 1 ? 'active show' : ''"
            >
              <ng-container *ngIf="processTabIndex == 0">
                <lib-form-steps-field-grid
                  [data]="data"
                  [formModel]="dialog?.formModel"
                  (dataChange)="valueChange2($event)"
                ></lib-form-steps-field-grid>
              </ng-container>
              <ng-container *ngIf="processTabIndex == 1">
                <ng-template [ngTemplateOutlet]="tmpStepFields"></ng-template>
              </ng-container>
            </div>
            <div
              class="tab-pane fade"
              id="pane_2"
              [ngClass]="currentTab == 2 ? 'active show' : ''"
            >
              <ng-template [ngTemplateOutlet]="tmpResult"></ng-template>
            </div>
          </div>
          <div
            class="d-flex flex-stack justify-content-between card-footer border-top"
          >
            <div class="left" *ngIf="currentTab != 0">
              <button
                type="button"
                class="btn btn-outline-primary me-3"
                (click)="previous(currentTab)"
              >
                <codx-label
                  name="lblBack"
                  [formModel]="dialog.formModel"
                  default="Quay lại"
                >
                </codx-label>
              </button>
            </div>
            <div
              *ngIf="currentTab == 0"
              class="left d-flex cursor-pointer text-primary"
              (click)="popupAdvancedSetting()"
            >
              <span class="icon-16 icon-settings me-2"></span>
              <codx-label
                name="lblSetting"
                [formModel]="dialog.formModel"
                default="Thiết lập nâng cao"
              >
              </codx-label>
            </div>
            <div class="right d-flex align-items-center justify-content-end">
              <!-- <div
                *ngIf="currentTab == 0"
                class="d-flex justify-content-start cursor-pointer text-primary"
                (click)="formPropertieFields()"
              >
                <span class="icon-16 icon-edit_square me-2"></span>
                <codx-label
                  name="lblFormFields"
                  [formModel]="dialog.formModel"
                  default="Chỉnh sửa form"
                >
                </codx-label>
              </div> -->
              <div class="d-flex justify-content-end">
                <div class="d-flex" *ngIf="currentTab != 2">
                  <button
                    type="button"
                    class="btn btn-primary me-2"
                    (click)="continue(currentTab)"
                  >
                    <codx-label
                      [name]="'lblContinue'"
                      [default]="'Tiếp tục'"
                      [formModel]="dialog.formModel"
                    ></codx-label>
                  </button>

                  <button
                    type="button"
                    class="btn btn-primary"
                    (click)="onSave()"
                  >
                    <codx-label
                      [name]="'lblSaveNow'"
                      [default]="'Lưu ngay'"
                      [formModel]="dialog.formModel"
                    ></codx-label>
                  </button>
                </div>

                <button
                  *ngIf="currentTab == 2"
                  type="button"
                  class="btn btn-primary"
                  (click)="onSave()"
                >
                  <codx-label
                    [name]="'lblSave'"
                    [default]="'Lưu'"
                    [formModel]="dialog.formModel"
                  ></codx-label>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #tmpInfomation>
  <div class="container-infomation">
    <div class="w-100 h-100 p-8">
      <div class="form-group d-flex align-items-center">
        <codx-tag
          field="tags"
          [entityName]="dialog.formModel.entityName"
          [isEdit]="true"
          [disabled]="false"
          [value]="data?.tags"
          (valueChange)="valueChange($event)"
        ></codx-tag>
        <div class="d-flex ms-3">
          <div class="symbol symbol-circle symbol-30px symbol-vllicon">
            <codx-input
              class=""
              type="vllicon"
              refValue="L1470"
              field="icon"
              [crrValue]="data?.icon"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>

          <div class="ms-4">
            <codx-input
              class="ms-4"
              type="colorpicker"
              [showText]="false"
              [modeSwitcher]="false"
              [crrValue]="data?.color"
              field="color"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
      <div class="form-group">
        <codx-label
          [formModel]="dialog.formModel"
          [fiedName]="'GroupID'"
          default="Nhóm quy trình"
        >
        </codx-label>
        <codx-input
          [formModel]="dialog.formModel"
          field="groupID"
          [crrValue]="data?.groupID"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
      <div class="form-group">
        <codx-label
          [formModel]="dialog.formModel"
          [fiedName]="'ProcessName'"
          default="T quy trình"
        >
        </codx-label>
        <codx-input
          [formModel]="dialog.formModel"
          field="processName"
          [crrValue]="data?.processName"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <div class="d-flex justify-content-start">
            <codx-label
              name="lblPermissions"
              [formModel]="dialog.formModel"
              default="Người sử dụng"
            >
            </codx-label>
          </div>
          <div class="d-flex justify-content-end cursor-pointer">
            <button
              type="button"
              class="btn btn-icon btn-sm btn-light-primary me-2"
              (click)="sharePerm(controlShare)"
            >
              <i class="icon-person_add_alt_1 icon-16"></i>
            </button>

            <button
              type="button"
              class="btn btn-icon btn-sm btn-light-primary me-2"
              (click)="clickRoles()"
            >
              <i class="icon-settings icon-16"></i>
            </button>
          </div>
        </div>
        <div class="form-user">
          <div class="d-flex flex-wrap">
            <ng-container
              *ngIf="data?.permissions != null && data?.permissions?.length > 0"
            >
              <ng-container *ngFor="let perm of data?.permissions; index as i">
                <div
                  class="cursor-pointer has-action-menu-od me-5 d-flex align-items-center position-relative user-style line-clamp line-clamp-1"
                >
                  <div class="me-2">
                    <codx-img
                      [width]="20"
                      [objectId]="perm.objectID"
                      [objectName]="perm.objectName"
                      objectType="AD_Users"
                    >
                    </codx-img>
                  </div>
                  <div class="text-gray-600 fw-bold">{{ perm.objectName }}</div>
                  <ng-container *ngIf="checkAssignRemove(i)">
                    <div class="action-menu-od" (click)="removeUser(i)">
                      <i class="icon-close icon-14"></i>
                    </div>
                  </ng-container>
                </div>
              </ng-container>
            </ng-container>

            <div class="input-sm w-200px">
              <codx-input
                #inputUser
                field="searchUser"
                type="combobox"
                refValue="Users"
                (valueChange)="searchAddUsers($event)"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group">
        <codx-label
          name="lblAvatarProcess"
          [formModel]="dialog.formModel"
          default="Ảnh đại diện"
        >
        </codx-label>
        <ng-container [ngTemplateOutlet]="avatarProcess"></ng-container>
      </div>
    </div>
    <!-- <div class="info-right d-flex flex-column align-items-center">
      <div
        class="d-flex flex-column w-700px"
        *ngFor="let item of lstShowExtends; let i = index"
      >
        <div
          class="p-2"
          *ngIf="item.width == '100'"
          [style.width.%]="item.width"
        >
          <codx-form-format-value
            #formMatRef
            [subItem]="item.children[0]"
            [showIconDrop]="false"
            [isShowTextHeader]="true"
          ></codx-form-format-value>
        </div>
        <div *ngIf="item.width != '100'" class="row p-2">
          <ng-container *ngFor="let child of item.children">
            <div [style.width.%]="item.width">
              <codx-form-format-value
                #formMatRef
                [subItem]="child"
                [showIconDrop]="false"
                [isShowTextHeader]="true"
              ></codx-form-format-value>
            </div>
          </ng-container>
        </div>
      </div>
    </div> -->
  </div>
</ng-template>
<ng-template #avatarProcess>
  <div
    class="dropzone dropzone-default dropzone-primary d-flex flex-center flex-column h-200px"
    (click)="addAvatar()"
  >
    <div class="dropzone-msg dz-message needsclick">
      <ng-container *ngIf="linkAvatar != '' && linkAvatar">
        <img [src]="linkAvatar" class="image-maxsize" />
      </ng-container>
      <ng-container *ngIf="linkAvatar == '' || linkAvatar == null">
        <div class="dropzone-msg-title mb-2">
          <i class="icon-image icon-30"></i>
        </div>
        <div class="dropzone-msg-title mb-2">
          <codx-label
            name="lblContentAddAvatar"
            [formModel]="dialog.formModel"
            default="Chọn hình ảnh"
            class="fw-bold"
          >
          </codx-label>
        </div>
        <span class="dropzone-msg-desc">
          <codx-label
            name="lblRequiredAvatar"
            [formModel]="dialog.formModel"
            default="(Nên chọn hình ảnh có kích thước ...px đến ...px)"
            class="fw-bold"
          ></codx-label>
        </span>
      </ng-container>
    </div>
  </div>
  <codx-attachment
    #imageAvatar
    [objectId]="data?.recID"
    [objectType]="dialog.formModel.entityName"
    hideFolder="1"
    hideImageUpload="1"
    hideImageThumb="1"
    hideUploadBtn="1"
    hideDes="1"
    type="inline"
    allowMultiFile="0"
    [formModel]="dialog.formModel"
    [functionID]="dialog.formModel.funcID"
    allowExtensions=".jpg,.png"
    [isSaveSelected]="0"
    (fileAdded)="fileImgAdded($event)"
    displayThumb="full"
    showMessage="0"
    category="0"
  >
  </codx-attachment>
</ng-template>

<ng-template #controlShare let-dialogControl>
  <codx-share
    [dialog]="dialogControl"
    [multiple]="multiple"
    chkParent="O"
    [listCombobox]="listCombobox"
    (eventApply)="applyShare($event)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #tmpStepFields>
  <div class="dp-step step-content container-fluid p-0 h-100">
    <codx-diagram></codx-diagram>
  </div>
</ng-template>

<ng-template #tmpResult>
  <lib-add-file-from-process-default
    [data]="data"
    [formModel]="dialog?.formModel"
  ></lib-add-file-from-process-default>
</ng-template>
