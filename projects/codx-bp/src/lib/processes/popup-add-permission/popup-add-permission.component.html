<codx-form [headerText]="title" [body]="body" [footer]="footer" [dialog]="dialog" [formModel]="dialog.formModel" #form>
  <ng-template #body>
    <div class="offcanvas-wrapper">
      <div class="d-flex justify-content-between background-name">
        <div class="d-flex align-items-center ">
          <div [ngbPopover]="popDetail" #p="ngbPopover" [openDelay]="500"
            (mouseenter)="PopoverDetail(p, data)" (mouseleave)="PopoverDetail(p, null)" placement="bottom right top"
            autoClose="outside">
            <span class="text-name line-clamp">{{fullName}}</span>

          </div>
        </div>
      </div>
      <div class="request-to mt-4">
        <div class="d-flex justify-content-between border-bottom py-1">
          <div class="d-flex align-items-center flex-grow-1">
            <div class="w-50px">
              <codx-label name="lblFromDate" [formModel]="form.formModel" [default]="isShare ? 'Đến' : 'Cho'"
                class="fw-bold">
              </codx-label>:
            </div>
            <div class="send-group">
              <ng-container *ngFor="let perm of toPermission; index as i;">
                <div class="user-mini-item">
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <div *ngIf="perm.objectID == null || perm.objectID == ''; then thenAvatar1 else elsethenAvatar1">
                      </div>
                      <ng-template #thenAvatar1>
                        <codx-temp-full imageSrc="../../../assets/codx/user/user-admin.svg" [imageWidth]="20"
                          imgCss="w-20px me-2 cursor-pointer symbol symbol-20 symbol-circle" [title]="perm.objectName"
                          [descLine]="1">
                        </codx-temp-full>
                      </ng-template>
                      <ng-template #elsethenAvatar1>
                        <codx-temp-full [imageId]="perm.objectID" imageObjType="AD_Users"
                          imgCss="w-20px me-2 cursor-pointer symbol symbol-20 symbol-circle" [imageWidth]="20"
                          [title]="perm.objectName">
                        </codx-temp-full>
                      </ng-template>
                    </div>

                  </div>
                </div>
              </ng-container>
            </div>
          </div>
          <div class="d-flex">
            <codx-input type="share" field="addUser" refValue="BP023" [showInput]="false"
              (valueChange)="onUserEvent($event, 'to')">
            </codx-input>

          </div>
        </div>
        <div *ngIf="!isShare" class="d-flex justify-content-between border-bottom py-1">
          <div class="d-flex align-items-center flex-grow-1">
            <div class="w-50px">
              <codx-label name="lblTo" [formModel]="form.formModel" [default]="'Đến'" class="fw-bold"></codx-label>:
            </div>
            <div class="send-group">
              <ng-container *ngFor="let perm of byPermission; index as i;">
                <div class="user-mini-item">
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <div *ngIf="perm.objectID == null || perm.objectID == ''; then thenAvatar1 else elsethenAvatar1">
                      </div>
                      <ng-template #thenAvatar1>
                        <codx-temp-full imageSrc="../../../assets/codx/user/user-admin.svg" [imageWidth]="20"
                          imgCss="w-20px me-2 cursor-pointer symbol symbol-20 symbol-circle" [title]="perm.objectName"
                          [descLine]="1">
                        </codx-temp-full>
                      </ng-template>
                      <ng-template #elsethenAvatar1>
                        <codx-temp-full [imageId]="perm.objectID" imageObjType="AD_Users"
                          imgCss="w-20px me-2 cursor-pointer symbol symbol-20 symbol-circle" [imageWidth]="20"
                          [title]="perm.objectName">
                        </codx-temp-full>
                      </ng-template>
                    </div>

                  </div>
                </div>
              </ng-container>
            </div>
          </div>
          <div class="d-flex">
            <codx-input type="share" field="addUser" refValue="BP022" [showInput]="false"
              (valueChange)="onUserEvent($event, 'by')">
            </codx-input>

          </div>
        </div>
        <div *ngIf="isShare" class="d-flex justify-content-between border-bottom py-1">
          <div class="d-flex align-items-center flex-grow-1">
            <div class="w-50px">
              <codx-label name="lblCc" [formModel]="form.formModel" [default]="'Cc'" class="fw-bold"></codx-label>:
            </div>
            <div class="send-group">
              <ng-container *ngFor="let perm of ccPermission; index as i;">
                <div class="user-mini-item">
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <div *ngIf="perm.objectID == null || perm.objectID == ''; then thenAvatar1 else elsethenAvatar1">
                      </div>
                      <ng-template #thenAvatar1>
                        <codx-temp-full imageSrc="../../../assets/codx/user/user-admin.svg" [imageWidth]="20"
                          imgCss="w-20px me-2 cursor-pointer symbol symbol-20 symbol-circle" [title]="perm.objectName"
                          [descLine]="1">
                        </codx-temp-full>
                      </ng-template>
                      <ng-template #elsethenAvatar1>
                        <codx-temp-full [imageId]="perm.objectID" imageObjType="AD_Users"
                          imgCss="w-20px me-2 cursor-pointer symbol symbol-20 symbol-circle" [imageWidth]="20"
                          [title]="perm.objectName">
                        </codx-temp-full>
                      </ng-template>
                    </div>

                  </div>
                </div>
              </ng-container>
            </div>
          </div>
          <div class="d-flex">
            <codx-input type="share" field="addUser" refValue="BP023" [showInput]="false"
              (valueChange)="onUserEvent($event, 'cc')">
            </codx-input>

          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between border-bottom mt-4">
        <div class="w-100">
          <codx-input type="text" tyle="width:100%" class="borderless" [crrValue]="requestTitle"
            [placeholder]="'Nhập lý do'" [class]="validate('requestTitle')"
            (valueChange)="txtValue($event, 'requestTitle')">
          </codx-input>
        </div>
        <div class="d-flex align-items-center mb-1 w-200px min-w-200px">
          <codx-input type="combobox" field="requestTitle" refValue="EmailTemplates" placeholder="Mail mẫu"
            (valueChange)="txtValue($event, 'requestTitle')" [formModel]="form.formModel">
          </codx-input>
        </div>

      </div>

      <div class="request-box mt-4">
        <codx-input class="form-control" [placeholder]="" [class]="validate('shareContent')" type="textarea"
          headerposition="none" format="ed" height="250" [crrValue]="shareContent"
          (valueChange)="txtValue($event, 'shareContent')">
        </codx-input>
      </div>
      <div class="d-flex align-items-center justify-content-between share-item mt-2 mt-6">
        <div class="text-dark-75">
          <codx-label [fiedName]="'isShare'" [formModel]="form.formModel" default="Cho phép chia sẻ lại cho người khác?"
            class="fw-bold"></codx-label>
        </div>
        <div class="d-flex">
          <span class="switch switch-sm me-2">
            <codx-input class="test-datetime" type="switch" tyle="width:100%" [crrValue]="share"
              (valueChange)="txtValue($event, 'share')"></codx-input>
          </span>
        </div>
      </div>
      <div class="d-flex align-items-center justify-content-between share-item mt-2">
        <div class="text-dark-75">
          <codx-label fiedName="lblDownload" [formModel]="form.formModel" default="Cho phép download hoặc in tài liệu?"
            class="fw-bold"></codx-label>
        </div>
        <div class="d-flex">
          <span class="switch switch-sm me-2">
            <codx-input placeholder="download..." class="test-datetime" type="switch" style="width:100%" format="d"
              [crrValue]="download" (valueChange)="txtValue($event, 'download')"></codx-input>
          </span>
        </div>
      </div>
      <div class="text-primary font-weight-bold mt-4">
        <codx-label name="lblDownload" [formModel]="form.formModel" default="Giới hạn thời gian chia sẻ"
          class="fw-bold"></codx-label>
      </div>
      <div class="row mt-3">
        <div class="col-xl-6 col-lg-6 col-md-6">
          <div class="form-group row">
            <div class="col-4 pt-2">
              <codx-label name="fromDate" [formModel]="form.formModel" default="Từ ngày" class="text-dark fw-bold">
              </codx-label>
            </div>
            <div class="col-8">
              <codx-input [placeholder]="gridViewSetup['ToDate']?.description" class="form-control test-datetime"
                type="datetime" style="width:100%" format="d" [crrValue]="startDate"
                (valueChange)="txtValue($event, 'startDate')">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-xl-6 col-lg-6 col-md-6">
          <div class="form-group row">
            <div class="col-4 pt-2">
              <codx-label name="toDate" [formModel]="form.formModel" default="Đến ngày" class="text-dark fw-bold">
              </codx-label>
            </div>
            <div class="col-8">
              <codx-input [placeholder]="gridViewSetup['ToDate']?.description" class="form-control test-datetime"
                type="datetime" style="width:100%;" format="d" [crrValue]="endDate"
                (valueChange)="txtValue($event, 'endDate')">
              </codx-input>
            </div>
          </div>
        </div>
      </div>

      <!-- <div *ngIf="!isShare" class="row mt-5">
        <div class="col-xl-6 col-lg-6 col-md-6">
          <div class="form-group row">
            <codx-label fiedName="StartDate" [formModel]="form.formModel" default="Từ ngày"></codx-label>
            <div class="col-8">
              <codx-input placeholder="startDate..." class="form-control test-datetime" type="datetime"
                style="width:100%" format="d" [crrValue]="startDate" (valueChange)="txtValue($event, 'startDate')">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-xl-6 col-lg-6 col-md-6">
          <div class="form-group row">
            <codx-label fiedName="EndDate" [formModel]="form.formModel" default="Đến ngày"></codx-label>
            <div class="col-8">
              <codx-input placeholder="endDate..." class="form-control test-datetime" type="datetime"
                style="width:100%;" format="d" [crrValue]="endDate" (valueChange)="txtValue($event, 'endDate')">
              </codx-input>
            </div>
          </div>
        </div>
      </div> -->
    </div>
  </ng-template>
  <ng-template #footer>
    <button type="button" id="btnShare" class="btn btn-primary" (click)="onShare()">
      <codx-label name="lblSend" [formModel]="form.formModel" default="Gửi" class="ms-1 fw-bold"></codx-label>
    </button>
  </ng-template>
</codx-form>

<ng-template #popDetail>
  <div class="d-flex flex-column w-100">
    <div class="text-gray-800 ">
      {{popoverDetail.processName}}
    </div>
  </div>
</ng-template>
