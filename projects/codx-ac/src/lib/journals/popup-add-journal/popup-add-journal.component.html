<codx-layout-add
  #form
  [title]="formTitle"
  [tabInfo]="tabInfo"
  [formModel]="dialogRef.formModel"
  [footer]="footer"
  [dialog]="dialogRef"
  [tabContent]="[tabGeneralInfo, tabSettings, tabRoles]"
  [data]="journal"
>
</codx-layout-add>

<ng-template #footer>
  <button type="button" class="btn btn-primary" (click)="onClickSave()">
    <codx-label
      fiedName="lblSave"
      [formModel]="dialogRef.formModel"
      default="Lưu"
    ></codx-label>
  </button>
</ng-template>

<ng-template #tabGeneralInfo>
  <ng-container *ngIf="form.formGroup">
    <div class="form-group">
      <codx-label
        fiedName="journalType"
        [formModel]="form.formModel"
      ></codx-label>
      <codx-input
        field="journalType"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
        (valueChange)="onInputChange2($event)"
      ></codx-input>
    </div>

    <div
      class="form-group"
      *ngIf="journalTypes106.includes(journal.journalType)"
    >
      <codx-label fiedName="reasonID" [formModel]="form.formModel"></codx-label>
      <codx-input
        field="reasonID"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>
    <div
      class="form-group"
      *ngIf="journalTypes107.includes(journal.journalType)"
    >
      <codx-label fiedName="reasonID" [formModel]="form.formModel"></codx-label>
      <codx-input
        type="combobox"
        field="reasonID"
        refType="3"
        refValue="InventoryReasonsAC"
        [crrValue]="journal.reasonID"
        (valueChange)="onInputChange($event)"
      ></codx-input>
    </div>

    <div
      class="form-group"
      *ngIf="journalTypes104.includes(journal.journalType)"
    >
      <codx-label fiedName="vatType" [formModel]="form.formModel"></codx-label>
      <codx-input
        field="vatType"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <div
      class="d-flex align-items-top justify-content-between mb-3"
      *ngIf="journalTypes105.includes(journal.journalType)"
    >
      <div class="d-flex flex-column">
        <div class="mb-2">
          <codx-label
            fiedName="lblUnknown"
            [formModel]="form.formModel"
            default="Thiết lập hóa đơn GTGT theo sổ nhật ký"
            class="fw-bold"
          ></codx-label>
        </div>
        <div class="d-flex align-items-center">
          <div class="w-100 me-1">
            <codx-label
              fiedName="lblUnknown"
              [formModel]="form.formModel"
              default="Cấu hình loại hóa đơn & cách đánh số Hóa đơn GTGT cho hóa đơn bán hàng, phiếu xuất kho, phiếu xuất điều chuyển."
              class="text-gray-500"
            ></codx-label>
          </div>
        </div>
      </div>
      <div class="w-30px ms-3">
        <button
          type="button"
          class="btn btn-icon btn-light-primary"
          role="button"
          (click)="onClickOpenInvoiceForm()"
        >
          <span class="icon-edit-one icon-18"></span>
        </button>
      </div>
    </div>

    <div class="row">
      <div class="col-3 form-group">
        <codx-label
          fiedName="fiscalYear"
          [formModel]="form.formModel"
          default="Năm tài chính"
        ></codx-label>
        <ejs-combobox
          [dataSource]="fiscalYears"
          [value]="journal.fiscalYear"
          (select)="onSelect($event)"
        >
        </ejs-combobox>
      </div>
      <div class="col-9 form-group">
        <codx-label
          fiedName="periodID"
          [formModel]="form.formModel"
        ></codx-label>
        <codx-input
          #periodID
          field="periodID"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
          (valueChange)="onInputChange2($event)"
        ></codx-input>
      </div>
    </div>

    <div class="form-group">
      <codx-label
        fiedName="journalDesc"
        [formModel]="form.formModel"
      ></codx-label>
      <codx-input
        field="journalDesc"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <div class="form-group">
      <codx-label
        fiedName="inputMode"
        [formModel]="form.formModel"
      ></codx-label>
      <codx-input
        field="inputMode"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <div class="form-group">
      <codx-label
        fiedName="postingMode"
        [formModel]="form.formModel"
      ></codx-label>
      <codx-input
        field="postingMode"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <div class="row">
      <div class="col-6 form-group">
        <codx-label
          fiedName="voucherNoRule"
          [formModel]="form.formModel"
        ></codx-label>
        <codx-input
          field="voucherNoRule"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
        ></codx-input>
      </div>
      <div class="col-6 form-group">
        <codx-label
          fiedName="voucherFormat"
          [formModel]="form.formModel"
        ></codx-label>
        <div class="d-flex align-items-center">
          <div class="w-100 me-1">
            <codx-input
              disabled="true"
              field="voucherFormat"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
            ></codx-input>
          </div>
          <div class="w-auto">
            <button
              type="button"
              class="btn btn-icon btn-light-primary"
              role="button"
              (click)="onClickOpenAutoNumberPopup()"
            >
              <span class="icon-edit-one icon-18"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-6 form-group">
        <codx-label
          fiedName="duplicateVoucherNo"
          [formModel]="form.formModel"
        ></codx-label>
        <codx-input
          field="duplicateVoucherNo"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
        ></codx-input>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #tabSettings>
  <ng-container *ngIf="form.formGroup">
    <codx-label
      fiedName="lblCommonSettings"
      [formModel]="form.formModel"
      default="Thiết lập chung"
      class="fs-5 text-primary"
    ></codx-label>

    <div class="d-flex gap-2 mt-6">
      <codx-input
        field="multiCurrency"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
      <codx-label
        fiedName="multiCurrency"
        [formModel]="form.formModel"
      ></codx-label>
    </div>

    <ng-container *ngIf="journal.multiCurrency">
      <div class="row mt-6">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              class="fw-bold"
              fiedName="currencyID"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblCurrencyID"
            [formModel]="form.formModel"
            [default]="gvs.CurrencyID?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4 d-flex align-items-center justify-content-end">
          <div class="w-100 me-1">
            <codx-input
              field="currencyID"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              class="fw-bold"
              fiedName="currSourceType"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblCurrSourceType"
            [formModel]="form.formModel"
            [default]="gvs.CurrSourceType?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4 d-flex align-items-center justify-content-end">
          <div class="w-100 me-1">
            <codx-input
              field="currSourceType"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>
    </ng-container>

    <codx-combobox-popup
      *ngIf="!isHidden"
      [comboboxName]="comboboxName"
      [multiple]="isMultiple"
      [width]="600"
      [height]="500"
      [value]="comboboxValue"
      (clickSave)="onClickHideComboboxPopup($event)"
    >
    </codx-combobox-popup>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="drAcctControl"
      subFieldName="lblDRAcctControl"
      [subLabel]="gvs.DRAcctControl?.description"
      [vll067]="journal.drAcctControl"
      [data]="journal.drAcctID"
      (change)="journal.drAcctID = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DRAcctID.referedValue,
          journal.drAcctID,
          'drAcctID',
          journal.drAcctControl
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="crAcctControl"
      subFieldName="lblCRAcctControl"
      [subLabel]="gvs.CRAcctControl?.description"
      [vll067]="journal.crAcctControl"
      [data]="journal.crAcctID"
      (change)="journal.crAcctID = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.CRAcctID.referedValue,
          journal.crAcctID,
          'crAcctID',
          journal.crAcctControl
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="diM1Control"
      subFieldName="lblDIM1Control"
      [subLabel]="gvs.DIM1Control?.description"
      [vll067]="journal.diM1Control"
      [data]="journal.diM1"
      (change)="journal.diM1 = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DIM1.referedValue,
          journal.diM1,
          'diM1',
          journal.diM1Control
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="diM2Control"
      subFieldName="lblDIM2Control"
      [subLabel]="gvs.DIM2Control?.description"
      [vll067]="journal.diM2Control"
      [data]="journal.diM2"
      (change)="journal.diM2 = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DIM2.referedValue,
          journal.diM2,
          'diM2',
          journal.diM2Control
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="diM3Control"
      subFieldName="lblDIM3Control"
      [subLabel]="gvs.DIM3Control?.description"
      [vll067]="journal.diM3Control"
      [data]="journal.diM3"
      (change)="journal.diM3 = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DIM3.referedValue,
          journal.diM3,
          'diM3',
          journal.diM3Control
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="projectControl"
      subFieldName="lblProjectControl"
      [subLabel]="gvs.ProjectControl?.description"
      [vll067]="journal.projectControl"
      [data]="journal.projectID"
      (change)="journal.projectID = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.ProjectID.referedValue,
          journal.projectID,
          'projectID',
          journal.projectControl
        )
      "
    ></lib-group067>

    <div class="form-group mt-5">
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="loanControl"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblLoanControl"
            [formModel]="form.formModel"
            [default]="gvs.LoanControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="loanControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <div class="form-group mt-5">
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="assetControl"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblAssetControl"
            [formModel]="form.formModel"
            [default]="gvs.AssetControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="assetControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <div class="mt-9 fs-5 text-primary">
      <codx-label
        fiedName="lblDebtSettings"
        [formModel]="form.formModel"
        default="Thiết lập công nợ"
      ></codx-label>
    </div>

    <div
      class="form-group mt-5"
      *ngIf="journalTypes108.includes(journal.journalType)"
    >
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="settleControl"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblSettleControl"
            [formModel]="form.formModel"
            [default]="gvs.SettleControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="settleControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <div class="mt-9 fs-5 text-primary">
      <codx-label
        fiedName="lblWarehouseSettings"
        [formModel]="form.formModel"
        default="Thiết lập kho"
      ></codx-label>
    </div>

    <div
      class="form-group row align-items-center mt-5"
      *ngIf="journalTypes110.includes(journal.journalType)"
    >
      <div class="col-8">
        <div class="mb-1">
          <codx-label
            fiedName="warehouseIssue"
            [formModel]="form.formModel"
          ></codx-label>
        </div>
        <codx-label
          fiedName="lblWarehouseIssue"
          [formModel]="form.formModel"
          [default]="gvs.WarehouseIssue?.description"
          class="text-gray-500 font-italic fw-normal"
        ></codx-label>
      </div>

      <div class="col-4">
        <codx-input
          field="warehouseIssue"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
          [placeholder]="' '"
        ></codx-input>
      </div>
    </div>

    <div
      class="form-group row align-items-center mt-5"
      *ngIf="journalTypes111.includes(journal.journalType)"
    >
      <div class="col-8">
        <div class="mb-1">
          <codx-label
            fiedName="warehouseReceipt"
            [formModel]="form.formModel"
          ></codx-label>
        </div>
        <codx-label
          fiedName="lblWarehouseReceipt"
          [formModel]="form.formModel"
          [default]="gvs.WarehouseReceipt?.description"
          class="text-gray-500 font-italic fw-normal"
        ></codx-label>
      </div>

      <div class="col-4">
        <codx-input
          field="warehouseReceipt"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
          [placeholder]="' '"
        ></codx-input>
      </div>
    </div>

    <div class="form-group">
      <div class="d-flex justify-content-between align-items-center">
        <codx-label
          fiedName="idimControl"
          [formModel]="form.formModel"
        ></codx-label>

        <button
          type="button"
          class="btn btn-icon btn-light-primary"
          role="button"
          (click)="onClickOpenCustomizedMultiSelectPopup()"
        >
          <i class="icon-edit-one icon-18"></i>
        </button>
      </div>

      <div class="d-flex align-items-center">
        <div class="w-100">
          <div class="text-truncate">
            <span
              *ngFor="let a of tempIDIMControls"
              class="badge badge-pill badge-secondary me-2"
            >
              {{ a.text }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #tabRoles>
  <ng-container *ngIf="form.formGroup">
    <div class="mb-6 form-group">
      <div class="d-flex align-items-center justify-content-between">
        <div class="w-100">
          <div class="mb-1">
            <codx-label
              fiedName="creater"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblCreater"
            [formModel]="form.formModel"
            [default]="gvs.Creater?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>
        <div class="ms-5">
          <codx-input
            type="share"
            field="creater"
            refValue="AC068"
            [showInput]="false"
            (valueChange)="onInputChange($event)"
          >
          </codx-input>
        </div>
      </div>
      <div class="my-2">
        <lib-dropdown-detail
          [modelShares]="journal.creater"
          [formModel]="form.formModel"
        ></lib-dropdown-detail>
      </div>
    </div>

    <div class="form-group">
      <codx-label
        fiedName="approvalControl"
        [formModel]="form.formModel"
      ></codx-label>

      <div class="row align-items-center">
        <div class="col-8">
          <codx-label
            fiedName="lblApprovalControl"
            [formModel]="form.formModel"
            [default]="gvs.ApprovalControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4 d-flex align-items-center gap-1">
          <codx-input
            field="approvalControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
          ></codx-input>
          <button
            class="btn btn-icon btn-light-primary"
            *ngIf="journal.approvalControl === '2'"
            (click)="onCickOpenApprovalProcessPopup()"
          >
            <i class="icon-edit-one icon-18"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="form-group" *ngIf="journal.approvalControl === '1'">
      <codx-label fiedName="approver" [formModel]="form.formModel"></codx-label>

      <div class="d-flex justify-content-between align-items-center">
        <div class="w-100">
          <codx-label
            fiedName="lblApprover"
            [formModel]="form.formModel"
            [default]="gvs.Approver?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="ms-5">
          <codx-input
            type="share"
            field="approver"
            refValue="AC068"
            [showInput]="false"
            (valueChange)="onInputChange($event)"
          >
          </codx-input>
        </div>
      </div>
      <div class="my-2">
        <lib-dropdown-detail
          [modelShares]="journal.approver"
          [formModel]="form.formModel"
        ></lib-dropdown-detail>
      </div>
    </div>

    <div class="d-flex gap-2 mb-6">
      <codx-input
        field="autoPost"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
      <codx-label
        *ngIf="['1', '2'].includes(journal.approvalControl)"
        fiedName="autoPost"
        [formModel]="form.formModel"
        [default]="gvs.AutoPost.description.split(';')[1]"
      ></codx-label>
      <codx-label
        *ngIf="journal.approvalControl == '0'"
        fiedName="autoPost"
        [formModel]="form.formModel"
        [default]="gvs.AutoPost.description.split(';')[0]"
      ></codx-label>
    </div>

    <div class="form-group">
      <codx-label fiedName="poster" [formModel]="form.formModel"></codx-label>

      <div class="row align-items-center">
        <div class="col-6">
          <codx-label
            fiedName="lblPoster"
            [formModel]="form.formModel"
            [default]="gvs.Poster?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-5">
          <lib-dropdown-detail
            [modelShares]="journal.poster"
            [formModel]="form.formModel"
          ></lib-dropdown-detail>
        </div>

        <div class="col-1">
          <codx-input
            type="share"
            field="poster"
            refValue="AC068"
            [showInput]="false"
            (valueChange)="onInputChange($event)"
          >
          </codx-input>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2 mb-6">
      <codx-input
        field="unpostControl"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
      <codx-label
        fiedName="unpostControl"
        [formModel]="form.formModel"
      ></codx-label>
    </div>

    <ng-container *ngIf="journal.unpostControl">
      <div class="form-group">
        <codx-label
          fiedName="unposter"
          [formModel]="form.formModel"
        ></codx-label>

        <div class="d-flex justify-content-between align-items-center">
          <div class="w-100">
            <codx-label
              fiedName="lblUnposter"
              [formModel]="form.formModel"
              [default]="gvs.Unposter?.description"
              class="text-gray-500 font-italic fw-normal"
            ></codx-label>
          </div>

          <div class="ms-5">
            <codx-input
              type="share"
              field="unposter"
              refValue="AC068"
              [showInput]="false"
              (valueChange)="onInputChange($event)"
            >
            </codx-input>
          </div>
        </div>
        <div class="mb-5 mt-2">
          <lib-dropdown-detail
            [modelShares]="journal.unposter"
            [formModel]="form.formModel"
          ></lib-dropdown-detail>
        </div>
      </div>

      <div class="form-group">
        <codx-label
          fiedName="unPostDays"
          [formModel]="form.formModel"
        ></codx-label>

        <div class="row align-items-center">
          <div class="col-8">
            <codx-label
              fiedName="lblUnPostDays"
              [formModel]="form.formModel"
              [default]="gvs.UnPostDays?.description"
              class="text-gray-500 font-italic fw-normal"
            ></codx-label>
          </div>

          <div class="col-4">
            <codx-input
              field="unPostDays"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>
    </ng-container>

    <div class="form-group">
      <codx-label fiedName="sharer" [formModel]="form.formModel"></codx-label>

      <div class="row align-items-center">
        <div class="col-6">
          <codx-label
            fiedName="lblSharer"
            [formModel]="form.formModel"
            [default]="gvs.Sharer?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-5">
          <lib-dropdown-detail
            [modelShares]="journal.sharer"
            [formModel]="form.formModel"
          ></lib-dropdown-detail>
        </div>

        <div class="col-1">
          <codx-input
            type="share"
            field="sharer"
            refValue="AC068"
            [showInput]="false"
            (valueChange)="onInputChange($event)"
          >
          </codx-input>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
