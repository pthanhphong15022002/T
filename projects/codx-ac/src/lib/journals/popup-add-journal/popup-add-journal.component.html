<codx-layout-add
  #form
  [title]="formTitle"
  [tabInfo]="tabInfo"
  [formModel]="dialogRef.formModel"
  [footer]="footer"
  [dialog]="dialogRef"
  [tabContent]="[tabGeneralInfo, tabSettings, tabRoles]"
  [data]="journal"
>
</codx-layout-add>

<ng-template #footer>
  <button type="button" class="btn btn-primary" (click)="onClickSave()">
    <codx-label
      fiedName="lblSave"
      [formModel]="dialogRef.formModel"
      default="Lưu"
    ></codx-label>
  </button>
</ng-template>

<ng-template #tabGeneralInfo>
  <ng-container *ngIf="form.formGroup">
    <div class="row">
      <div class="col-8 row">
        <div class="form-group">
          <codx-label
            fiedName="journalType"
            [formModel]="form.formModel"
            default="Loại nghiệp vụ"
          ></codx-label>
          <codx-input
            field="journalType"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            (valueChange)="onInputChange2($event)"
          ></codx-input>
        </div>

        <div class="col-6 form-group">
          <codx-label
            fiedName="fiscalYear"
            [formModel]="form.formModel"
            default="Năm tài chính"
          ></codx-label>
          <ejs-combobox
            [dataSource]="fiscalYears"
            [value]="journal.fiscalYear"
            (select)="onSelect($event)"
          >
          </ejs-combobox>
        </div>
        <div class="col-6 form-group">
          <codx-label
            fiedName="periodID"
            [formModel]="form.formModel"
            default="Kỳ kế toán"
          ></codx-label>
          <codx-input
            #periodID
            field="periodID"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            (valueChange)="onInputChange2($event)"
          ></codx-input>
        </div>
      </div>

      <codx-img
        #thumbnail
        class="col-4"
        [funcId]="form.formModel?.funcID"
        [objectId]="journal.recID"
        [objectType]="form.formModel?.entityName"
        [width]="125"
        [imgOn]="journal.modifiedOn"
        [isAllowEdit]="true"
        [isDefaulImg]="true"
        imageType="square"
      >
      </codx-img>
    </div>

    <div class="form-group">
      <codx-label
        fiedName="journalDesc"
        [formModel]="form.formModel"
        default="Diễn giải"
      ></codx-label>
      <codx-input
        field="journalDesc"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <div ngbAccordion>
      <div ngbAccordionItem class="border-0">
        <div ngbAccordionHeader class="line-around-flex pb-3">
          <button
            ngbAccordionButton
            class="px-0 pt-0 pb-0 bg-body gap-3"
            style="width: fit-content"
            [style.--url]="arrowColorStyle"
          >
            <codx-label
              [formModel]="form.formModel"
              default="Thông tin mặc định"
              class="fw-bold text-primary"
              id="moreInfo"
            ></codx-label>
          </button>
        </div>

        <div ngbAccordionCollapse>
          <div ngbAccordionBody class="p-0">
            <ng-template>
              <div class="form-group">
                <codx-label
                  fiedName="inputMode"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="inputMode"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>

              <div class="form-group">
                <codx-label
                  fiedName="brigdeAcctControl"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="brigdeAcctControl"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>

              <div
                class="form-group"
                *ngIf="journalTypes106.includes(journal.journalType)"
              >
                <codx-label
                  fiedName="cashBookID"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="cashBookID"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>

              <div
                class="form-group"
                *ngIf="journalTypes106.includes(journal.journalType)"
              >
                <codx-label
                  fiedName="reasonID"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="reasonID"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>
              <div
                class="form-group"
                *ngIf="journalTypes107.includes(journal.journalType)"
              >
                <codx-label
                  fiedName="reasonID"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  type="combobox"
                  field="reasonID"
                  refType="3"
                  refValue="InventoryReasonsAC"
                  [crrValue]="journal.reasonID"
                  (valueChange)="onInputChange($event)"
                ></codx-input>
              </div>

              <div
                class="form-group"
                *ngIf="journalTypes104.includes(journal.journalType)"
              >
                <codx-label
                  fiedName="vatType"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="vatType"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>

              <div
                class="form-group"
                *ngIf="journalTypes105.includes(journal.journalType)"
              >
                <codx-label
                  fiedName="invoiceForm"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="invoiceForm"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #tabSettings>
  <ng-container *ngIf="form.formGroup">
    <codx-label
      fiedName="lblCommonSettings"
      [formModel]="form.formModel"
      default="Thiết lập chung"
      class="fs-5 text-primary"
    ></codx-label>

    <div class="row mt-6">
      <div class="col-6 form-group">
        <codx-label
          fiedName="assignRule"
          [formModel]="form.formModel"
        ></codx-label>
        <codx-input
          field="assignRule"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
        ></codx-input>
      </div>

      <div class="col-6 form-group">
        <codx-label
          fiedName="voucherFormat"
          [formModel]="form.formModel"
        ></codx-label>
        <div class="d-flex align-items-center">
          <div class="w-100 me-1">
            <codx-input
              disabled="true"
              field="voucherFormat"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
            ></codx-input>
          </div>
          <div class="w-auto" *ngIf="journal.assignRule !== '0'">
            <button
              type="button"
              class="btn btn-icon btn-light-primary"
              role="button"
              (click)="onClickOpenAutoNumberPopup()"
            >
              <span class="icon-edit-one icon-18"></span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between">
      <codx-label
        fiedName="multiCurrency"
        [formModel]="form.formModel"
      ></codx-label>
      <codx-input
        field="multiCurrency"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <ng-container *ngIf="journal.multiCurrency">
      <div class="row mt-6">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              class="fw-bold"
              fiedName="currencyID"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblCurrencyID"
            [formModel]="form.formModel"
            [default]="gvs.CurrencyID?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4 d-flex align-items-center justify-content-end">
          <div class="w-100 me-1">
            <codx-input
              field="currencyID"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              class="fw-bold"
              fiedName="exchangeType"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="exchangeType"
            [formModel]="form.formModel"
            [default]="gvs.CurrSourceType?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4 d-flex align-items-center justify-content-end">
          <div class="w-100 me-1">
            <codx-input
              field="exchangeType"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>
    </ng-container>

    <codx-combobox-popup
      *ngIf="!isHidden"
      [comboboxName]="comboboxName"
      [multiple]="isMultiple"
      [width]="600"
      [height]="500"
      [value]="comboboxValue"
      (clickSave)="onClickHideComboboxPopup($event)"
    >
    </codx-combobox-popup>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="drAcctControl"
      subFieldName="lblDRAcctControl"
      [subLabel]="gvs.DRAcctControl?.description"
      [vll067]="journal.drAcctControl"
      [data]="journal.drAcctID"
      (change)="journal.drAcctID = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DRAcctID.referedValue,
          journal.drAcctID,
          'drAcctID',
          journal.drAcctControl
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="crAcctControl"
      subFieldName="lblCRAcctControl"
      [subLabel]="gvs.CRAcctControl?.description"
      [vll067]="journal.crAcctControl"
      [data]="journal.crAcctID"
      (change)="journal.crAcctID = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.CRAcctID.referedValue,
          journal.crAcctID,
          'crAcctID',
          journal.crAcctControl
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="diM1Control"
      subFieldName="lblDIM1Control"
      [subLabel]="gvs.DIM1Control?.description"
      [vll067]="journal.diM1Control"
      [data]="journal.diM1"
      (change)="journal.diM1 = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DIM1.referedValue,
          journal.diM1,
          'diM1',
          journal.diM1Control
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="diM2Control"
      subFieldName="lblDIM2Control"
      [subLabel]="gvs.DIM2Control?.description"
      [vll067]="journal.diM2Control"
      [data]="journal.diM2"
      (change)="journal.diM2 = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DIM2.referedValue,
          journal.diM2,
          'diM2',
          journal.diM2Control
        )
      "
    ></lib-group067>

    <lib-group067
      [formModel]="form.formModel"
      [formGroup]="form.formGroup"
      fieldName="diM3Control"
      subFieldName="lblDIM3Control"
      [subLabel]="gvs.DIM3Control?.description"
      [vll067]="journal.diM3Control"
      [data]="journal.diM3"
      (change)="journal.diM3 = null"
      (buttonClick)="
        onClickOpenComboboxPopup(
          gvs.DIM3.referedValue,
          journal.diM3,
          'diM3',
          journal.diM3Control
        )
      "
    ></lib-group067>

    <div class="form-group mt-5">
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="projectControl"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblProjectControl"
            [formModel]="form.formModel"
            [default]="gvs.ProjectControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="projectControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <div class="form-group mt-5">
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="loanControl"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblLoanControl"
            [formModel]="form.formModel"
            [default]="gvs.LoanControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="loanControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <div class="form-group mt-5">
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="assetControl"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblAssetControl"
            [formModel]="form.formModel"
            [default]="gvs.AssetControl?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="assetControl"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <codx-label
      fiedName="lblLimitSetting"
      [formModel]="form.formModel"
      default="Thiết lập hạn mức"
      class="mt-9 fs-5 text-primary"
    ></codx-label>

    <div class="form-group mt-5">
      <div class="row align-items-center">
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="transLimit"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="transLimit"
            [formModel]="form.formModel"
            [default]="gvs.transLimit?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="transLimit"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>
    </div>

    <ng-container *ngIf="journalTypes108.includes(journal.journalType)">
      <div class="mt-9 fs-5 text-primary">
        <codx-label
          fiedName="lblDebtSettings"
          [formModel]="form.formModel"
          default="Thiết lập công nợ"
        ></codx-label>
      </div>

      <div class="form-group mt-5">
        <div class="row align-items-center">
          <div class="col-8">
            <div class="mb-1">
              <codx-label
                fiedName="subControl"
                [formModel]="form.formModel"
              ></codx-label>
            </div>
            <codx-label
              fiedName="lblSubControl"
              [formModel]="form.formModel"
              [default]="gvs.SubControl?.description"
              class="text-gray-500 font-italic fw-normal"
            ></codx-label>
          </div>

          <div class="col-4">
            <codx-input
              field="subControl"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>

      <div class="form-group mt-5">
        <div class="row align-items-center">
          <div class="col-8">
            <div class="mb-1">
              <codx-label
                fiedName="settleControl"
                [formModel]="form.formModel"
              ></codx-label>
            </div>
            <codx-label
              fiedName="lblSettleControl"
              [formModel]="form.formModel"
              [default]="gvs.SettleControl?.description"
              class="text-gray-500 font-italic fw-normal"
            ></codx-label>
          </div>

          <div class="col-4">
            <codx-input
              field="settleControl"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="journalTypes109.includes(journal.journalType)">
      <div class="mt-9 fs-5 text-primary">
        <codx-label
          fiedName="lblWarehouseSettings"
          [formModel]="form.formModel"
          default="Thiết lập kho"
        ></codx-label>
      </div>

      <div
        class="form-group row align-items-center mt-5"
        *ngIf="journalTypes110.includes(journal.journalType)"
      >
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="warehouseIssue"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblWarehouseIssue"
            [formModel]="form.formModel"
            [default]="gvs.WarehouseIssue?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="warehouseIssue"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>

      <div
        class="form-group row align-items-center mt-5"
        *ngIf="journalTypes111.includes(journal.journalType)"
      >
        <div class="col-8">
          <div class="mb-1">
            <codx-label
              fiedName="warehouseReceipt"
              [formModel]="form.formModel"
            ></codx-label>
          </div>
          <codx-label
            fiedName="lblWarehouseReceipt"
            [formModel]="form.formModel"
            [default]="gvs.WarehouseReceipt?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <codx-input
            field="warehouseReceipt"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            [placeholder]="' '"
          ></codx-input>
        </div>
      </div>

      <div class="form-group mt-5">
        <div class="d-flex justify-content-between align-items-center">
          <codx-label
            fiedName="idimControl"
            [formModel]="form.formModel"
          ></codx-label>

          <button
            type="button"
            class="btn btn-icon btn-light-primary"
            role="button"
            (click)="onClickOpenMultiSelectPopup()"
          >
            <i class="icon-edit-one icon-18"></i>
          </button>
        </div>

        <div class="d-flex align-items-center">
          <div class="w-100">
            <div class="text-truncate">
              <span
                *ngFor="let a of tempIDIMControls"
                class="badge badge-pill badge-secondary me-2"
              >
                {{ a.text }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #tabRoles>
  <ng-container *ngIf="form.formGroup">
    <lib-group-share
      [formModel]="form.formModel"
      field="creater"
      labelName="lblCreater"
      [label]="gvs.Creater?.description"
      [objectType]="createrObjectType"
      [objectId]="creater"
      (change)="onShareInputChange($event)"
    ></lib-group-share>

    <!-- <div class="form-group">
      <div class="row align-items-center">
        <div class="col-7 d-flex flex-column gap-1">
          <codx-label
            fiedName="creater"
            [formModel]="form.formModel"
          ></codx-label>
          <codx-label
            fiedName="lblCreater"
            [formModel]="form.formModel"
            [default]="gvs.Creater?.description"
            class="text-gray-500 font-italic fw-normal"
          ></codx-label>
        </div>

        <div class="col-4">
          <lib-dropdown-detail
            *ngIf="createrObjectType === 'U' || !createrObjectType"
            [formModel]="form.formModel"
            [objectId]="creater"
            [objectType]="createrObjectType"
          ></lib-dropdown-detail>
        </div>

        <div class="col-1">
          <button
            class="btn btn-icon btn-light-primary"
            (click)="onClickOpenPermissionPopup()"
          >
            <i class="icon-connection-point icon-16"></i>
          </button>
        </div>
      </div>

      <div class="pb-2" *ngIf="createrObjectType && createrObjectType !== 'U'">
        <lib-dropdown-detail
          [formModel]="form.formModel"
          [objectId]="creater"
          [objectType]="createrObjectType"
        ></lib-dropdown-detail>
      </div>
    </div> -->

    <div class="form-group row align-items-center">
      <div class="col-8 d-flex flex-column gap-1">
        <codx-label
          fiedName="approvalControl"
          [formModel]="form.formModel"
        ></codx-label>
        <codx-label
          fiedName="lblApprovalControl"
          [formModel]="form.formModel"
          [default]="gvs.ApprovalControl?.description"
          class="text-gray-500 font-italic fw-normal"
        ></codx-label>
      </div>

      <div class="col-4 d-flex align-items-center gap-1">
        <codx-input
          field="approvalControl"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
        ></codx-input>
        <button
          class="btn btn-icon btn-light-primary"
          *ngIf="journal.approvalControl === '2'"
          (click)="onCickOpenApprovalProcessPopup()"
        >
          <i class="icon-edit-one icon-18"></i>
        </button>
      </div>
    </div>

    <lib-group-share
      *ngIf="journal.approvalControl === '1'"
      [formModel]="form.formModel"
      field="approver"
      labelName="lblApprover"
      [label]="gvs.Approver?.description"
      [objectType]="approverObjectType"
      [objectId]="approver"
      (change)="onShareInputChange($event)"
    ></lib-group-share>

    <div
      *ngIf="journal.approvalControl"
      class="d-flex justify-content-between mb-6"
    >
      <codx-label
        *ngIf="['1', '2'].includes(journal.approvalControl)"
        fiedName="lblAutoPost"
        [formModel]="form.formModel"
        [default]="gvs.AutoPost.description.split(';')[1]"
      ></codx-label>
      <codx-label
        *ngIf="journal.approvalControl == '0'"
        fiedName="lblAutoPost"
        [formModel]="form.formModel"
        [default]="gvs.AutoPost.description.split(';')[0]"
      ></codx-label>
      <codx-input
        field="autoPost"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <lib-group-share
      [formModel]="form.formModel"
      field="poster"
      labelName="lblPoster"
      [label]="gvs.Poster?.description"
      [objectType]="posterObjectType"
      [objectId]="poster"
      (change)="onShareInputChange($event)"
    ></lib-group-share>

    <div class="d-flex justify-content-between mb-6">
      <codx-label
        fiedName="unpostControl"
        [formModel]="form.formModel"
      ></codx-label>
      <codx-input
        field="unpostControl"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input>
    </div>

    <ng-container *ngIf="journal.unpostControl">
      <lib-group-share
        [formModel]="form.formModel"
        field="unposter"
        labelName="lblUnposter"
        [label]="gvs.Unposter?.description"
        [objectType]="unposterObjectType"
        [objectId]="unposter"
        (change)="onShareInputChange($event)"
      ></lib-group-share>

      <div class="form-group">
        <codx-label
          fiedName="unPostDays"
          [formModel]="form.formModel"
        ></codx-label>

        <div class="row align-items-center">
          <div class="col-8">
            <codx-label
              fiedName="lblUnPostDays"
              [formModel]="form.formModel"
              [default]="gvs.UnPostDays?.description"
              class="text-gray-500 font-italic fw-normal"
            ></codx-label>
          </div>

          <div class="col-4">
            <codx-input
              field="unPostDays"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              [placeholder]="' '"
            ></codx-input>
          </div>
        </div>
      </div>
    </ng-container>

    <lib-group-share
      [formModel]="form.formModel"
      field="sharer"
      labelName="lblSharer"
      [label]="gvs.Sharer?.description"
      [objectType]="sharerObjectType"
      [objectId]="sharer"
      (change)="onShareInputChange($event)"
    ></lib-group-share>
  </ng-container>
</ng-template>
