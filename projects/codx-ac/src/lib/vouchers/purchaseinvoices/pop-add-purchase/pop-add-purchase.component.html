<codx-form #form [subHeader]="subHeader" [body]="body" [footer]="footer" [formModel]="dialog.formModel"
  [dialog]="dialog" [data]="purchaseinvoices" [customToolbar]="subToolbar" [openMore]="false">
</codx-form>
<ng-template #subHeader>
  <ng-container *ngIf="form?.formGroup"> </ng-container>
</ng-template>
<ng-template #body>
  <div class="card-add mt-5" #cardbodyRef>
    <ejs-tab #cashRef>
      <e-tabitems>
        <!-- Tab thông tin chứng từ -->
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top me-2">
              <i class="icon-info icon-18 me-2"></i>
              <div class="fw-bold fs-6 text-uppercase">Thông tin chứng từ</div>
            </div>
          </ng-template>
          <ng-template #content>
            <ng-container *ngTemplateOutlet="tabBasic"></ng-container>
          </ng-template>
        </e-tabitem>
        <!-- Tab Thông tin hóa đơn -->
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top" *ngIf="VATType == '1'">
              <i class="icon-description icon-18 me-2"></i>
              <div class="fw-bold fs-6 text-uppercase">Thông tin hóa đơn</div>
            </div>
          </ng-template>
          <ng-template #content>
            <ng-container *ngTemplateOutlet="tabBill"></ng-container>
          </ng-template>
        </e-tabitem>
      </e-tabitems>
    </ejs-tab>
    <ejs-tab>
      <e-tabitems>
        <!-- Tab chi tiết bút toán -->
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top me-2" (click)="detaiClick(1)">
              <i class="icon-format_list_numbered icon-18 me-2"></i>
              <span class="fw-bold fs-6 text-uppercase">Chi tiết</span>
            </div>
          </ng-template>
          <ng-template #content>
            <ng-container *ngTemplateOutlet="tabLine"></ng-container>
          </ng-template>
        </e-tabitem>
        <!-- Tab Thông tin hóa đơn -->
        <e-tabitem>
          <ng-template #headerText>
            <div *ngIf="VATType == '2'" class="d-flex align-items-top" (click)="detaiClick(2)">
              <i class="icon-description icon-18 me-2"></i>
              <div class="fw-bold fs-6 text-uppercase">Thông tin hóa đơn</div>
            </div>
          </ng-template>
          <ng-template #content>
            <ng-container *ngTemplateOutlet="tabLineBill"></ng-container>
          </ng-template>
        </e-tabitem>
      </e-tabitems>
    </ejs-tab>
    <div class="row mb-2">
      <ng-container *ngTemplateOutlet="addLine"></ng-container>
    </div>
  </div>
</ng-template>
<ng-template #subToolbar>
  <div class="w-100">
    <div class="d-flex align-items-center justify-content-between pt-2">
      <div class="d-flex justify-content-start me-2">
        <div class="mt-1 btn btn-icon btn-sm btn-primary btn-circle me-4 bg">
          <i *ngIf="formType == 'add'" class="icon-add_box icon-16"></i>
          <i *ngIf="formType == 'edit'" class="icon-edit_square icon-16"></i>
        </div>
        <div class="card-title">
          <div class="d-flex flex-column">
            <div class="dialog-title line-clamp line-clamp-1 me-3 text-uppercase">
              {{ headerText }}
            </div>
          </div>
        </div>
        <div class="ms-3 input-circle input-sm" *ngIf="form?.formGroup">
          <codx-input class="badge badge-danger" [Group]="form.formGroup" field="status" [formModel]="form.formModel">
          </codx-input>
        </div>
      </div>
      <div class="d-flex justify-content-end me-3">
        <div *ngIf="formType != 'edit'" class="ms-2">
          <button type="button" class="btn btn-light-primary">
            <codx-label class="fs-6 fw-normal" fiedName="lblSave" [formName]="formModel?.formName"
              [gridViewName]="formModel?.gridViewName" default="Lưu & thêm"></codx-label>
          </button>
        </div>
        <div class="ms-2 me-2">
          <button type="button" class="btn btn-primary" style="min-width: 60px" (click)="onSave()">
            <codx-label class="fs-6 fw-normal" fiedName="lblSave" [formName]="formModel?.formName"
              [gridViewName]="formModel?.gridViewName" default="Lưu"></codx-label>
          </button>
        </div>
        <div class="ms-2">
          <div class="mt-1 btn btn-icon btn-sm btn-light-primary btn-circle bg" (click)="close()">
            <i class="icon-close icon-16"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #tabBasic>
  <ng-container *ngIf="form?.formGroup">
    <div class="row mt-5">
      <div class="col-9">
        <div class="row">
          <div class="col-3">
            <div class="form-group">
              <!-- Mã nhà cung cấp -->
              <div class="form-group">
                <codx-label fiedName="ObjectID" [formModel]="form.formModel">
                </codx-label>
                <codx-input [Group]="form.formGroup" field="objectID" [formModel]="form.formModel"
                  (valueChange)="valueChange($event)">
                </codx-input>
              </div>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <!-- tên nhà cung cấp -->
              <div class="form-group">
                <codx-label fiedName="ObjectID" [formModel]="form.formModel" default="Tên nhà cung cấp">
                </codx-label>
                <codx-input [disabled]="true" type="text" field="objectID" [crrValue]="objectName"></codx-input>
              </div>
            </div>
          </div>
          <div class="col-3">
            <div class="form-group">
              <!-- hình thức thanh toán -->
              <div class="form-group">
                <codx-label fiedName="PmtMethodID" [formModel]="form.formModel">
                </codx-label>
                <codx-input [Group]="form.formGroup" field="pmtMethodID" [formModel]="form.formModel"
                  (valueChange)="valueChange($event)">
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-3">
            <div class="form-group">
              <!-- điều khoản thanh toán -->
              <div class="form-group">
                <codx-label fiedName="PmtTermID" [formModel]="form.formModel">
                </codx-label>
                <codx-input [Group]="form.formGroup" field="pmtTermID" [formModel]="form.formModel"
                  (valueChange)="valueChange($event)">
                </codx-input>
              </div>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <!-- hạn thanh toán -->
              <div class="form-group">
                <codx-label fiedName="Buyer" [formModel]="form.formModel">
                </codx-label>
                <codx-input [Group]="form.formGroup" field="buyer" [formModel]="form.formModel"
                  (valueChange)="valueChange($event)">
                </codx-input>
              </div>
            </div>
          </div>
          <div class="col-3">
            <div class="form-group">
              <!-- hạn thanh toán -->
              <div class="form-group">
                <codx-label fiedName="InvoiceDueDate" [formModel]="form.formModel">
                </codx-label>
                <codx-input [Group]="form.formGroup" field="invoiceDueDate" [formModel]="form.formModel"
                  (valueChange)="valueChange($event)">
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div #noteRef class="col-10">
            <div class="form-group">
              <codx-label fiedName="Memo" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="memo" [formModel]="form.formModel"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="col-3">
        <div class="row">
          <!-- Tiền tệ -->
          <div class="col-6">
            <div class="form-group">
              <codx-label fiedName="CurrencyID" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="currencyID" [formModel]="form.formModel"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
          <!-- Tỷ giá -->
          <div class="col-6">
            <div class="form-group">
              <codx-label fiedName="ExchangeRate" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="exchangeRate" [formModel]="form.formModel"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="row">
          <!-- Ngày chứng từ -->
          <div class="col-6">
            <div class="form-group">
              <codx-label fiedName="VoucherDate" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" [formModel]="form.formModel" field="voucherDate"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
          <!-- Số chứng từ -->
          <div class="col-6">
            <div class="form-group">
              <codx-label fiedName="VoucherNo" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="voucherNo" [formModel]="form.formModel"
                [disabled]="journal?.voucherNoRule != '0'" [placeholder]="
                  journal?.voucherNoRule == '2'
                    ? 'Số chứng từ được tạo tự động'
                    : ''
                " (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
<ng-template #tabBill>
  <ng-container *ngIf="fgVATInvoices">
    <div class="row mt-5" *ngIf="VATType == '1'">
      <div class="row">
        <div class="col-2">
          <div class="form-group">
            <!-- mẫu số -->
            <div class="form-group">
              <codx-label fiedName="InvoiceForm" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="invoiceForm" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- ký hiệu -->
            <div class="form-group">
              <codx-label fiedName="InvoiceSeri" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="invoiceSeri" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)"></codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- số hóa đơn -->
            <div class="form-group">
              <codx-label fiedName="InvoiceNo" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="invoiceNo" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- ngày hóa đơn -->
            <div class="form-group">
              <codx-label fiedName="InvoiceDate" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="invoiceDate" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="form-group">
            <!-- đối tượng -->
            <div class="form-group">
              <codx-label fiedName="ObjectID" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="objectID" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-2">
          <div class="form-group">
            <!--hàng hóa dịch vụ -->
            <div class="form-group">
              <codx-label fiedName="Goods" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="goods" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- dvt -->
            <div class="form-group">
              <codx-label fiedName="UMID" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="umid" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- số lượng -->
            <div class="form-group">
              <codx-label fiedName="Quantity" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="quantity" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- đơn giá -->
            <div class="form-group">
              <codx-label fiedName="UnitPrice" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="unitPrice" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- số tiền -->
            <div class="form-group">
              <codx-label fiedName="TaxBase" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="taxBase" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-2">
          <div class="form-group">
            <!-- thuế suất -->
            <div class="form-group">
              <codx-label fiedName="VATID" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="vatid" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- tiền thuế -->
            <div class="form-group">
              <codx-label fiedName="TaxAmt" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input [Group]="fgVATInvoices" field="taxAmt" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-9">
          <div class="form-group">
            <!-- ghi chú -->
            <div class="form-group">
              <codx-label fiedName="TaxNote" [formModel]="fmVATInvoices">
              </codx-label>
              <codx-input id="taxNote" [Group]="fgVATInvoices" field="taxNote" [formModel]="fmVATInvoices"
                (valueChange)="valueChangeVAT($event)">
              </codx-input>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
<ng-template #tabLine>
  <div *ngIf="modegrid == 1" class="h-100 w-100 border">
    <codx-gridview-v2 #grid class="tabLine" #gridPurchase autoLoad="true" [formName]="fmPurchaseInvoicesLines.formName"
      [gridViewName]="fmPurchaseInvoicesLines.gridViewName" [entityName]="fmPurchaseInvoicesLines.entityName"
      [templateMore]="morefunction" [editSettings]="editSettings" [allowFiltering]="true" [allowSorting]="true"
      [dataSource]="purchaseInvoicesLines" service="PS" [height]="gridHeight" [autoLoad]="false" rowHeight="40"
      (cellChanged)="cellChangedPurchase($event)" (created)="gridCreated($event, gridPurchase)"
      [allowTextWrap]="false"></codx-gridview-v2>
  </div>
  <ng-container *ngIf="form?.formGroup && modegrid == 2 && gridViewLines">
    <div class="table-responsive mt-2"
      style="height: 400px; border-radius: 5px;background-color: rgba(229, 229, 229, 0.67)">
      <table id="myTable" class="table table-hover">
        <thead style="
            position: sticky;
            top: 0;
            background-color: var(--primary-active);
            color: white;
          ">
          <tr>
            <th style="
                width: 50px;
                white-space: nowrap;
                padding: 10px 10px;
              ">
              <codx-label class="fw-bold" fiedName="RowNo" [formModel]="fmPurchaseInvoicesLines">
              </codx-label>
            </th>
            <th style="
                width: 200px;
                white-space: nowrap;
                padding: 10px 10px;
              ">
              <div class="d-flex">
                <i style="color: white" class="icon-i-box-seam icon-18 me-2"></i>
                <codx-label class="fw-bold" fiedName="ItemID" [formModel]="fmPurchaseInvoicesLines">
                </codx-label>
              </div>
            </th>
            <th style="
                width: 200px;
                white-space: nowrap;
                position: sticky;
                top: 0;
                padding: 10px 10px;
              ">
              <div class="d-flex">
                <i style="color: white" class="icon-i-cash icon-18 me-2"></i>
                <span class="fs-6 fw-bold">Thông tin mua hàng</span>
              </div>
            </th>
            <th style="
                width: 200px;
                white-space: nowrap;
                position: sticky;
                top: 0;
                padding: 10px 10px;
              ">
              <div class="d-flex">
                <i style="color: white" class="icon-i-journal-text icon-18 me-2"></i>
                <span class="fs-6 fw-bold">Thông tin thuế</span>
              </div>
            </th>
            <th style="
                width: 200px;
                white-space: nowrap;
                position: sticky;
                top: 0;
                padding: 10px 10px;
              ">
              <div class="d-flex">
                <i style="color: white" class="icon-i-graph-up icon-18 me-2"></i>
                <span class="fs-6 fw-bold">Thông tin phân tích</span>
              </div>
            </th>
            <th style="width: 50px;" *ngIf="purchaseInvoicesLines.length > 0"></th>
          </tr>
        </thead>
        <tbody style="border-bottom: 1px solid #dee2e6" *ngFor="
            let item of purchaseInvoicesLines
              | slice : (page - 1) * pageSize : page * pageSize
          ">
          <tr>
            <td class="fs-5" style="padding: 10px 10px">
              <span>
                <div style="
                  background: var(--primary-active);
                  width: 28px;
                  height: 28px;
                  align-items: center;
                  border-radius: 50px;
                " class="d-flex justify-content-start">
                <span style="display: block; margin: auto; color: white" class="fs-5 fw-bold">
                  {{ item.rowNo }}
                </span>
              </div>
              </span>
            </td>
            <td style="padding: 10px 10px">
              <ng-container *ngFor="let name of itemName">
                <span *ngIf="name.itemID == item.itemID" class="fw-bold line-clamp line-clamp-1 fs-5">
                  {{name.itemName}}</span>
              </ng-container>
              <div style="white-space: nowrap" class="d-flex align-items-center justify-content-start">
                <ng-container *ngIf="item.idiM0 != null && item.idiM0 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM0" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM0}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM1 != null && item.idiM1 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM1" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM1}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM2 != null && item.idiM2 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM2" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM2}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM3 != null && item.idiM3 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM3" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM3}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM4 != null && item.idiM4 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM4" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  &nbsp;
                  <span #idiM4 class="fs-6 fw-bold" [innerHTML]="
                      item.idiM4
                        | formatvalue
                          : fmPurchaseInvoicesLines
                          : 'idiM4'
                          : idiM4
                        | async
                    "></span>
                </ng-container>
              </div>
              <div style="white-space: nowrap" class="d-flex align-items-center justify-content-start mt-1">
                <ng-container *ngIf="item.idiM5 != null && item.idiM5 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM5" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM5}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM6 != null && item.idiM6 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM6" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM6}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM7 != null && item.idiM7 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM7" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM7}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM8 != null && item.idiM8 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM8" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM8}}&nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;</span>
                </ng-container>

                <ng-container *ngIf="item.idiM9 != null && item.idiM9 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="IDIM9" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  <span class="fs-6 fw-bold">&nbsp;{{item.idiM9}}</span>
                </ng-container>
              </div>
            </td>
            <td style="padding: 10px 10px">
              <div *ngIf="item.netAmt != null && item.netAmt != ''" style="white-space: nowrap" class="d-flex align-items-center justify-content-start mt-1">
                <span class="text-gray-700 fs-6">Tiền hàng:</span>
                <span class="fs-6 fw-bold">&nbsp;{{ item.quantity }} {{ item.umid }} x
                  {{ item.unitPrice.toLocaleString("it-IT") }} =
                  {{ item.netAmt.toLocaleString("it-IT") }}</span>
              </div>
            </td>
            <td style="padding: 10px 10px">
              <div *ngIf="item.vatAmt != null && item.vatAmt != ''" style="white-space: nowrap" class="d-flex align-items-center justify-content-start mt-1">
                <codx-label class="text-gray-700 label-colon"
                    fiedName="VATID" [formModel]="fmPurchaseInvoicesLines">
                </codx-label>
                <ng-container *ngFor="let vat of lsVatCode">
                  <span *ngIf="vat.vatid == item.vatid" class="fs-5 fw-bold">
                    &nbsp;{{ vat.taxRate }}% x
                    {{ item.netAmt.toLocaleString("it-IT") }} =
                    {{ item.vatAmt.toLocaleString("it-IT") }}
                  </span>
                </ng-container>
              </div>
            </td>
            <td style="padding: 10px 10px">
              <div style="white-space: nowrap" class="d-flex align-items-center justify-content-start mt-1">
                <ng-container *ngIf="item.diM2 != null && item.diM2 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="DIM2" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  &nbsp;
                  <span #diM2 class="fs-6 fw-bold" [innerHTML]="
                      item.diM2
                        | formatvalue
                          : fmPurchaseInvoicesLines
                          : 'diM2'
                          : diM2
                        | async
                    "></span>
                  &nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;
                </ng-container>
                <ng-container *ngIf="item.diM3 != null && item.diM3 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="DIM3" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  &nbsp;
                  <span #diM3 class="fs-6 fw-bold" [innerHTML]="
                      item.diM3
                        | formatvalue
                          : fmPurchaseInvoicesLines
                          : 'diM3'
                          : diM3
                        | async
                    "></span>
                </ng-container>
              </div>
              <div style="white-space: nowrap" class="d-flex align-items-center justify-content-start mt-1">
                <ng-container *ngIf="item.diM1 != null && item.diM1 != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="DIM1" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  &nbsp;
                  <span #diM1 class="fs-6 fw-bold" [innerHTML]="
                      item.diM1
                        | formatvalue
                          : fmPurchaseInvoicesLines
                          : 'diM1'
                          : diM1
                        | async
                    "></span>
                  &nbsp;&nbsp;&nbsp;&#9679;&nbsp;&nbsp;&nbsp;
                </ng-container>
                <ng-container *ngIf="item.projectID != null && item.projectID != ''">
                  <codx-label class="text-gray-700 label-colon"
                    fiedName="ProjectID" [formModel]="fmPurchaseInvoicesLines">
                  </codx-label>
                  &nbsp;
                  <span #projectID class="fs-6 fw-bold" [innerHTML]="
                      item.projectID
                        | formatvalue
                          : fmPurchaseInvoicesLines
                          : 'projectID'
                          : projectID
                        | async
                    "></span>
                </ng-container>
              </div>
            </td>
            <td>
              <div class="has-action-menu">
                <codx-mfunc [dataItem]="item" [formModel]="form.formModel"
                  (clickMF)="clickMF($event, item)" isBookMark="false" type="hover"></codx-mfunc>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <ng-container *ngIf="modegrid == 2">
        <div class="container w-90 h-90">
          <div style="background: none;" class="list-empty card card-flush h-100">
            <div class="d-flex flex-column flex-center justify-content-center">
              <button style="border-radius: 49px" type="button" class="btn btn-light-primary mt-2" (click)="addRow()">
                <div class="d-flex align-items-center">
                  <i class="icon-add_box icon-18"></i>
                  <span class="fs-6 fw-bold">Thêm dòng</span>
                </div>
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </ng-container>
  <div class="row mt-2">
    <div *ngIf="purchaseInvoicesLines.length > 0" class="d-flex justify-content-end">
      <ngb-pagination [(page)]="page" [pageSize]="pageSize"
        [collectionSize]="purchaseInvoicesLines.length"></ngb-pagination>
    </div>
  </div>
  <div class="d-flex align-items-center justify-content-start me-10 mt-3">
    <span class="fs-6 fw-bold me-10">Tổng tiền: {{ totalnet }}</span>
    <span class="fs-6 fw-bold me-10">Tổng thuế: {{ totalvat }}</span>
    <span class="fs-6 fw-bold me-10">Tổng cộng: {{ total }}</span>
  </div>
</ng-template>
<ng-template #tabLineBill>
  <codx-gridview-v2 *ngIf="VATType == '2'" #gridInvoices [formName]="fmVATInvoices.formName"
    [gridViewName]="fmVATInvoices.gridViewName" [entityName]="fmVATInvoices.entityName" [templateMore]="morefunction"
    [editSettings]="editSettings" [allowFiltering]="true" [allowSorting]="true" [dataSource]="objectvatinvoices"
    service="AC" [height]="gridHeight" rowHeight="40" (cellChanged)="cellChangedInvoice($event)"
    (created)="gridCreated($event, gridInvoices)"></codx-gridview-v2>
</ng-template>
<ng-template #addLine let-data>
  <ng-container *ngIf="form?.formGroup">
    <div *ngIf="countDetail > 0">
      <div class="mt-4 mb-3 text-primary fw-bold fs-5">
        <codx-label [formModel]="form.formModel" default="Thông tin hóa đơn tham chiếu"></codx-label>
      </div>
      <div class="row">
        <div class="col-2">
          <div class="form-group">
            <!-- mẫu số -->
            <div class="form-group">
              <codx-label fiedName="InvoiceForm" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="invoiceForm" [formModel]="form.formModel"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- ký hiệu -->
            <div class="form-group">
              <codx-label fiedName="InvoiceSeri" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="invoiceSeri" [formModel]="form.formModel"
                (valueChange)="valueChange($event)"></codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- số hóa đơn -->
            <div class="form-group">
              <codx-label fiedName="InvoiceNo" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="invoiceNo" [formModel]="form.formModel"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-1">
          <div class="form-group">
            <!-- ngày hóa đơn -->
            <div class="form-group">
              <codx-label fiedName="InvoiceDate" [formModel]="form.formModel">
              </codx-label>
              <codx-input [Group]="form.formGroup" field="invoiceDate" [formModel]="form.formModel"
                (valueChange)="valueChange($event)">
              </codx-input>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
<ng-template #morefunction let-data>
  <div class="col-6 d-flex align-items-center justify-content-end" (click)="deleteRow(data)">
    <span type="button" class="btn btn-icon btn-sm btn-light-danger ms-1">
      <i class="icon-delete icon-16"></i>
    </span>
  </div>
</ng-template>
<ng-template #footer>
  <div class="codx-detail-footer dialog-footer" *ngIf="purchaseinvoices">
    <div class="btn btn-white btn-icon tab-action" (click)="expandTab()">
      <span class="icon-unfold_more icon-20"></span>
    </div>
    <ng-container *ngTemplateOutlet="tabRef"></ng-container>
  </div>
</ng-template>
<ng-template #tabRef>
  <div #tab id="codx-tab">
    <codx-tabs [entityName]="form.formModel.entityName" [formModel]="form.formModel" [objectID]="purchaseinvoices.recID"
      [funcID]="form.formModel.funcID" [TabControl]="tabInfo"></codx-tabs>
  </div>
</ng-template>