<codx-views
  #view
  [views]="views"
  [button]="btnAdd"
  entityName="SM_SalesInvoices"
  predicates="JournalNo=@0"
  [dataValues]="journalNo"
  (buttonClick)="handleClickAdd($event)"
  (selectedChange)="handleChange($event)"
>
</codx-views>

<ng-template #moreTemplate let-data>
  <codx-mfunc
    [dataItem]="data"
    [formModel]="view.formModel"
    (clickMF)="handleClickMF($event, data)"
    [isBookMark]="true"
    type="view"
  ></codx-mfunc>
</ng-template>

<ng-template #sider let-data>
  <codx-temp-full
    [descTmp]="descTmp"
    [desc2Tmp]="desc2Tmp"
    [titleTmp]="titleTmp"
    cardCss="card-template border-bottom p-3 list-task"
    [formModel]="view.formModel"
    [modeImgs]="true"
    [titleLine]="2"
    [dataItem]="data"
    [footer]="siderFooter"
    [hideMF]="false"
    typeMF="hover"
    moreFuncCss="me-15"
    (clickMF)="handleClickMF($event, data)"
  >
  </codx-temp-full>
</ng-template>

<ng-template #descTmp let-data>
  <span
    class="text-gray-600"
    [innerHTML]="
      data?.objectID | formatvalue : view.formModel : 'objectID' | async
    "
  >
  </span>
</ng-template>

<ng-template #desc2Tmp let-data>
  <span class="text-gray-600">{{ data?.memo }}</span>
</ng-template>

<ng-template #titleTmp let-data>
  <span class="fs-5 fw-bold text-uppercase">{{ data.voucherNo }}</span>
  <span class="fs-5 fw-bold text-uppercase">{{
    data.totalAmt | currency : "VND" : "code"
  }}</span>
</ng-template>

<ng-template #siderFooter let-data>
  <div class="d-flex align-items-center justify-content-between pt-2">
    <div class="d-flex align-items-center">
      <codx-vll
        [formModel]="view.formModel"
        field="Status"
        [value]="data?.status"
        [showText]="true"
        [showBgColor]="true"
        class="badge badge-light badge-md fs-4 me-3"
      >
      </codx-vll>

      <span
        class="fs-6 text-gray-600"
        [innerHTML]="
          data?.voucherDate
            | formatvalue : view.formModel : 'voucherDate'
            | async
        "
      ></span>
    </div>

    <codx-img
      [objectId]="data?.recID"
      [objectName]="data?.createdBy"
      [objectType]="view?.entityName"
      [width]="30"
    >
    </codx-img>
  </div>
</ng-template>

<ng-template #content>
  <codx-detail-tmp
    [header]="header"
    [body]="body"
    [hideMF]="false"
    [formModel]="view.formModel"
    [dataItem]="selectedData"
    [footer]="contentFooter"
    (clickMF)="handleClickMF($event, selectedData)"
  >
  </codx-detail-tmp>
</ng-template>

<ng-template #header>
  <div class="fw-bold line-clamp line-clamp-1 fs-4 text-uppercase pt-2">
    {{ selectedData?.voucherNo }}
  </div>

  <div class="d-flex align-items-center justify-content-between pt-2">
    <span
      class="fw-bold line-clamp line-clamp-1 fs-4 text-uppercase"
      [innerHTML]="
        selectedData?.objectID
          | formatvalue : view.formModel : 'objectID'
          | async
      "
    >
    </span>

    <codx-vll
      [formModel]="view.formModel"
      field="Status"
      [value]="selectedData?.status"
      [showText]="true"
      [showBgColor]="true"
      class="badge badge-light badge-md fs-4 me-2 mb-2"
    >
    </codx-vll>
  </div>
</ng-template>

<ng-template #body>
  <div class="d-flex align-items-center justify-content-between pt-2 mb-2">
    <div class="d-flex gap-10">
      <div>
        <i class="bi bi-calendar2-event icon-16 me-2 text-primary"></i>
        <codx-label
          fiedName="voucherDate"
          [formModel]="view.formModel"
          class="fw-bold fs-5"
        ></codx-label
        >:&nbsp;
        <span
          class="text-gray-600 fs-5"
          [innerHTML]="
            selectedData?.voucherDate
              | formatvalue : view.formModel : 'voucherDate'
              | async
          "
        ></span>
      </div>
      <div>
        <i class="bi bi-credit-card-2-front-fill icon-16 me-2 text-primary"></i>
        <codx-label
          fiedName="pmtMethodID"
          [formModel]="view.formModel"
          class="fw-bold fs-5"
        ></codx-label
        >:&nbsp;
        <span
          [innerHTML]="
            selectedData.pmtMethodID
              | formatvalue : view.formModel : 'pmtMethodID'
              | async
          "
          class="text-gray-600 fs-5"
        ></span>
      </div>
    </div>

    <span class="badge badge-pill badge-primary me-2">
      <span class="fs-5">{{
        selectedData.totalAmt | currency : "VND" : "code"
      }}</span>
    </span>
  </div>

  <div class="d-flex gap-10 mb-2">
    <div>
      <i class="bi bi-credit-card-2-front-fill icon-16 me-2 text-primary"></i>
      <codx-label
        fiedName="pmtTermID"
        [formModel]="view.formModel"
        class="fw-bold fs-5"
      ></codx-label
      >:&nbsp;
      <span
        class="text-gray-600 fs-5"
        [innerHTML]="
          selectedData?.pmtTermID
            | formatvalue : view.formModel : 'pmtTermID'
            | async
        "
      ></span>
    </div>
    <div>
      <i class="bi bi-person-circle icon-16 me-2 text-primary"></i>
      <codx-label
        fiedName="invoiceDueDate"
        [formModel]="view.formModel"
        class="fw-bold fs-5"
      ></codx-label
      >:&nbsp;
      <span
        [innerHTML]="
          selectedData.invoiceDueDate
            | formatvalue : view.formModel : 'invoiceDueDate'
            | async
        "
        class="text-gray-600 fs-5"
      ></span>
    </div>
  </div>

  <div class="d-flex gap-10 mb-2">
    <div>
      <i class="bi bi-credit-card-2-front-fill icon-16 me-2 text-primary"></i>
      <codx-label
        fiedName="contractNo"
        [formModel]="view.formModel"
        class="fw-bold fs-5"
      ></codx-label
      >:&nbsp;
      <span
        class="text-gray-600 fs-5"
        [innerHTML]="
          selectedData?.contractNo
            | formatvalue : view.formModel : 'contractNo'
            | async
        "
      ></span>
    </div>

    <div>
      <i class="bi bi-person-circle icon-16 me-2 text-primary"></i>
      <codx-label
        fiedName="salespersonID"
        [formModel]="view.formModel"
        class="fw-bold fs-5"
      ></codx-label
      >:&nbsp;
      <span
        [innerHTML]="
          selectedData?.salespersonID
            | formatvalue : view.formModel : 'salespersonID'
            | async
        "
        class="text-gray-600 fs-5"
      ></span>
    </div>

    <div>
      <i class="bi bi-person-circle icon-16 me-2 text-primary"></i>
      <codx-label
        fiedName="warehouse"
        [formModel]="view.formModel"
        class="fw-bold fs-5"
      ></codx-label
      >:&nbsp;
      <span
        [innerHTML]="
          selectedData.warehouse
            | formatvalue : view.formModel : 'warehouse'
            | async
        "
        class="text-gray-600 fs-5"
      ></span>
    </div>
  </div>

  <div class="d-flex gap-10 mb-2">
    <div>
      <i class="bi bi-brush icon-16 me-2 text-primary"></i>
      <codx-label
        fiedName="memo"
        [formModel]="view.formModel"
        class="fw-bold fs-5"
      ></codx-label
      >:&nbsp;
      <span
        [innerHTML]="
          selectedData?.memo | formatvalue : view.formModel : 'memo' | async
        "
        class="text-gray-600 fs-5"
      ></span>
    </div>
  </div>

  <ejs-tab class="mt-5">
    <e-tabitems>
      <e-tabitem>
        <ng-template #headerText>
          <div class="d-flex me-2">
            <i class="icon-format_list_numbered icon-18 me-2"></i>
            <codx-label
              class="fw-bold fs-6"
              fiedName="lblDetail"
              [formModel]="view.formModel"
              default="Thông tin chi tiết"
            ></codx-label>
          </div>
        </ng-template>
        <ng-template #content>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col" *ngFor="let th of ths">
                    <codx-label
                      [fiedName]="th.field"
                      [default]="th.label"
                      [formModel]="fmSalesInvoicesLines"
                    ></codx-label>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="
                    let line of salesInvoicesLines
                      | slice : (page - 1) * pageSize : page * pageSize
                  "
                >
                  <th scope="row">{{ line.rowNo }}</th>
                  <td>
                    <div
                      class="fw-bold"
                      [innerHTML]="
                        line.itemID
                          | formatvalue : fmSalesInvoicesLines : 'ItemID'
                          | async
                      "
                    ></div>
                    <div>
                      <ng-container
                        *ngFor="let i of [0, 1, 2, 3]; last as isLast"
                      >
                        <codx-label
                          [fiedName]="'idiM' + i"
                          [formModel]="fmSalesInvoicesLines"
                        ></codx-label
                        >:&nbsp;
                        <span
                          [innerHTML]="
                            line['idiM' + i]
                              | formatvalue : fmSalesInvoicesLines : 'idiM' + i
                              | async
                          "
                        ></span>
                        <ng-container *ngIf="!isLast">
                          &nbsp;|&nbsp;
                        </ng-container>
                      </ng-container>
                    </div>
                    <div>
                      <codx-vll
                        [formModel]="fmSalesInvoicesLines"
                        field="LineType"
                        [value]="line.lineType"
                        [showText]="true"
                        [showBgColor]="true"
                        class="badge badge-primary mt-2"
                      >
                      </codx-vll>
                      <ng-container
                        *ngFor="
                          let i of [5, 6, 7, 8, 9];
                          last as isLast;
                          first as isFirst
                        "
                      >
                        <ng-container *ngIf="!isFirst">
                          &nbsp;|&nbsp;
                        </ng-container>
                        <codx-label
                          [fiedName]="'idiM' + i"
                          [formModel]="fmSalesInvoicesLines"
                        ></codx-label
                        >:&nbsp;
                        <span
                          [innerHTML]="
                            line['idiM' + i]
                              | formatvalue : fmSalesInvoicesLines : 'idiM' + i
                              | async
                          "
                        ></span>
                        <ng-container *ngIf="!isLast">
                          &nbsp;|&nbsp;
                        </ng-container>
                      </ng-container>
                    </div>
                  </td>
                  <td>{{ line.quantity }} {{ line.umid }}</td>
                  <td>{{ line.costPrice }}</td>
                  <td>{{ line.costAmt }}</td>
                  <td>
                    <span
                      [innerHTML]="
                        line.vatid
                          | formatvalue : fmSalesInvoicesLines : 'VATID'
                          | async
                      "
                    ></span>
                  </td>
                  <td>{{ line.vatAmt }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <th></th>
                  <th>
                    <codx-label
                      fiedName="lblTotal"
                      [formModel]="fmSalesInvoicesLines"
                      default="Tổng cộng"
                    ></codx-label>
                  </th>
                  <th>{{ totalRow.totalQuantity }}</th>
                  <th></th>
                  <th>{{ totalRow.totalPrice }}</th>
                  <th></th>
                  <th>{{ totalRow.totalVat }}</th>
                </tr>
              </tfoot>
            </table>
            <ngb-pagination
              [(page)]="page"
              [pageSize]="pageSize"
              [collectionSize]="salesInvoicesLines.length"
            ></ngb-pagination>
          </div>
        </ng-template>
      </e-tabitem>
    </e-tabitems>
  </ejs-tab>
</ng-template>

<ng-template #contentFooter>
  <codx-tabs
    [entityName]="view.formModel.entityName"
    [formModel]="view.formModel"
    [objectID]="selectedData.recID"
    [funcID]="view.formModel.funcID"
    [TabControl]="tabControl"
  ></codx-tabs>
</ng-template>
