<codx-form
  #form
  [body]="body"
  [footer]="footer"
  [formModel]="dialogRef.formModel"
  [dialog]="dialogRef"
  [customToolbar]="customToolbar"
  [data]="salesInvoice"
>
</codx-form>

<ng-template #body>
  <ejs-tab>
    <e-tabitems>
      <e-tabitem>
        <ng-template #headerText>
          <div class="d-flex align-items-center">
            <i class="icon-info icon-18 me-2"></i>
            <codx-label
              fiedName="lblGeneralInfoTab"
              default="Thông tin chứng từ"
              class="fw-bold fs-6"
            ></codx-label>
          </div>
        </ng-template>
        <ng-template #content>
          <div class="row mt-6">
            <div class="col-7">
              <div class="row">
                <div class="col-5 form-group">
                  <codx-label
                    fiedName="objectID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="objectID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                    (valueChange)="handleInputChange($event)"
                  ></codx-input>
                </div>
                <div class="col-7 form-group">
                  <codx-label
                    fiedName="customerName"
                    [formModel]="form.formModel"
                    default="Tên khách"
                  ></codx-label>
                  <codx-input
                    type="text"
                    field="customerName"
                    [disabled]="true"
                    [crrValue]="customerName"
                  ></codx-input>
                </div>

                <div class="col-3 form-group">
                  <codx-label
                    fiedName="pmtMethodID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="pmtMethodID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="pmtTermID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="pmtTermID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="delModeID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="delModeID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="warehouse"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="warehouse"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>

                <div class="col-3 form-group">
                  <codx-label
                    fiedName="channelID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="channelID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="salespersonID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="salespersonID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="supervisorID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="supervisorID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="projectID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="projectID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
              </div>
            </div>
            <div class="col-2"></div>
            <div class="col-3">
              <div class="row">
                <div class="col-6 form-group">
                  <codx-label
                    fiedName="currencyID"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="currencyID"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                    (valueChange)="handleInputChange($event)"
                  ></codx-input>
                </div>
                <div class="col-6 form-group">
                  <codx-label
                    fiedName="exchangeRate"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="exchangeRate"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
              </div>

              <div class="form-group">
                <codx-label
                  fiedName="voucherDate"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="voucherDate"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                ></codx-input>
              </div>

              <div class="form-group">
                <codx-label
                  fiedName="voucherNo"
                  [formModel]="form.formModel"
                ></codx-label>
                <codx-input
                  field="voucherNo"
                  [formModel]="form.formModel"
                  [Group]="form.formGroup"
                  [disabled]="journal?.voucherNoRule != '0'"
                  [placeholder]="
                    journal?.voucherNoRule == '2'
                      ? (voucherNoPlaceholderText$ | async)
                      : ''
                  "
                ></codx-input>
              </div>
            </div>
          </div>
        </ng-template>
      </e-tabitem>
      <e-tabitem>
        <ng-template #headerText>
          <div class="d-flex align-items-center">
            <i class="bi bi-receipt icon-18 me-2"></i>
            <codx-label
              fiedName="lblReceiptInfo"
              default="Thông tin hóa đơn"
              class="fw-bold fs-6"
            ></codx-label>
          </div>
        </ng-template>
        <ng-template #content>
          <div class="row mt-6">
            <div class="col-8">
              <div class="row">
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="invoiceForm"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceForm"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                    [disabled]="true"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="invoiceSeriNo"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceSeriNo"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                    [disabled]="true"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="invoiceNo"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceNo"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                    [disabled]="true"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="invoiceDate"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceDate"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                    [disabled]="true"
                  ></codx-input>
                </div>

                <div class="col-4 form-group">
                  <codx-label
                    fiedName="invoiceName"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceName"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-4 form-group">
                  <codx-label
                    fiedName="invoiceTaxCode"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceTaxCode"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-4 form-group">
                  <codx-label
                    fiedName="invoiceAddress"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceAddress"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>

                <div class="col-6 form-group">
                  <codx-label
                    fiedName="invoiceEmail"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoiceEmail"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-6 form-group">
                  <codx-label
                    fiedName="invoicePhone"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="invoicePhone"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </e-tabitem>
      <e-tabitem>
        <ng-template #headerText>
          <div class="d-flex align-items-center">
            <i class="bi bi-link icon-18 me-2"></i>
            <codx-label
              fiedName="lblRef"
              default="Tham chiếu"
              class="fw-bold fs-6"
            ></codx-label>
          </div>
        </ng-template>
        <ng-template #content>
          <div class="row mt-6">
            <div class="col-5">
              <codx-label
                fiedName="lblCancelInfo"
                [formModel]="form.formModel"
                default="Thông tin hủy hóa đơn"
                class="fw-bold fs-5 text-primary"
              ></codx-label>

              <div class="row mt-3">
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="cancelReason"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="cancelReason"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-2 form-group"></div>
                <div class="col-2 form-group"></div>
                <div class="col-2 form-group">
                  <codx-label
                    fiedName="cancelRefNo"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="cancelRefNo"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group">
                  <codx-label
                    fiedName="cancelRefDate"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="cancelRefDate"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>

                <div class="form-group">
                  <codx-label
                    fiedName="cancelNote"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="cancelNote"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
              </div>
            </div>
            <div class="col-2"></div>
            <div class="col-5">
              <codx-label
                fiedName="lblReturnInfo"
                [formModel]="form.formModel"
                default="Thông tin trả hàng"
                class="fw-bold fs-5 text-primary"
              ></codx-label>

              <div class="row mt-3">
                <div class="col-2 form-group"></div>
                <div class="col-2 form-group"></div>
                <div class="col-2 form-group">
                  <codx-label
                    fiedName="returnReference"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="returnReference"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
                <div class="col-3 form-group"></div>
                <div class="col-3 form-group"></div>

                <div class="form-group">
                  <codx-label
                    fiedName="returnNote"
                    [formModel]="form.formModel"
                  ></codx-label>
                  <codx-input
                    field="returnNote"
                    [formModel]="form.formModel"
                    [Group]="form.formGroup"
                  ></codx-input>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </e-tabitem>
      <e-tabitem>
        <ng-template #headerText>
          <div class="d-flex align-items-center">
            <i class="bi bi-receipt icon-18 me-2"></i>
            <codx-label
              fiedName="lblOtherInfo"
              default="Thông tin khác"
              class="fw-bold fs-6"
            ></codx-label>
          </div>
        </ng-template>
        <ng-template #content>
          <div class="row mt-6">
            <div class="col-3 form-group">
              <codx-label
                fiedName="autoSettlement"
                [formModel]="form.formModel"
              ></codx-label>
              <codx-input
                field="autoSettlement"
                [formModel]="form.formModel"
                [Group]="form.formGroup"
              ></codx-input>
            </div>
          </div>
        </ng-template>
      </e-tabitem>
    </e-tabitems>
  </ejs-tab>

  <ejs-tab>
    <e-tabitems>
      <e-tabitem>
        <ng-template #headerText>
          <i class="icon-format_list_numbered icon-18 me-2"></i>
          <codx-label
            class="fw-bold fs-6"
            fiedName="lblDetail"
            [formModel]="form.formModel"
            default="Chi tiết"
          ></codx-label>
        </ng-template>
        <ng-template #content>
          <codx-gridview-v2
            #grid
            [formName]="fmSalesInvoicesLines.formName"
            [gridViewName]="fmSalesInvoicesLines.gridViewName"
            [entityName]="fmSalesInvoicesLines.entityName"
            service="SM"
            [templateMore]="more"
            [editSettings]="editSettings"
            [allowFiltering]="true"
            [allowSorting]="true"
            [autoLoad]="false"
            [height]="200"
            [dataSource]="salesInvoicesLines"
            (cellChanged)="handleCellChange($event)"
            (created)="handleCreate($event)"
          ></codx-gridview-v2>
        </ng-template>
      </e-tabitem>
    </e-tabitems>
  </ejs-tab>

  <button
    class="btn btn-light-primary btn-sm mt-3 d-flex align-items-center"
    (click)="addRow()"
  >
    <i class="icon-add icon-16 me-1"></i>
    <codx-label
      fiedName="lblAddLine"
      [formModel]="fmSalesInvoicesLines"
      default="Thêm dòng"
    ></codx-label>
  </button>

  <div class="row mt-3">
    <div class="col-5 form-group">
      <codx-label fiedName="memo" [formModel]="form.formModel"></codx-label>
      <codx-input
        field="memo"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
        (valueChange)="handleInputChange($event)"
      ></codx-input>
    </div>

    <div class="col-7">
      <codx-label
        fiedName="orderNo"
        [formModel]="form.formModel"
        class="fw-bold"
      ></codx-label
      >:&nbsp;{{ salesInvoice.orderNo }}
    </div>
  </div>
</ng-template>

<ng-template #footer>
  <codx-tabs
    [entityName]="form.formModel.entityName"
    [formModel]="form.formModel"
    [objectID]="salesInvoice?.recID"
    [funcID]="form.formModel.funcID"
    [TabControl]="tabs"
  ></codx-tabs>
</ng-template>

<ng-template #customToolbar>
  <div class="d-flex justify-content-between pt-2 w-100">
    <div class="d-flex align-items-center">
      <div class="btn btn-icon btn-lg btn-primary btn-circle me-4 bg">
        <i
          class="icon-16"
          [ngClass]="isEdit ? 'icon-edit_square' : 'icon-add_box'"
        ></i>
      </div>
      <div
        class="dialog-title line-clamp line-clamp-1 me-3 fw-bold text-uppercase"
      >
        {{ formTitle }}
      </div>
      <div class="ms-3 input-circle input-sm" *ngIf="form?.formGroup">
        <codx-input
          field="status"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
        >
        </codx-input>
      </div>
    </div>

    <div class="d-flex align-items-center">
      <ng-container *ngIf="!isEdit">
        <button
          type="button"
          class="btn btn-light-primary"
          (click)="handleClickSave(false)"
        >
          <codx-label
            class="fs-6 fw-normal"
            fiedName="lblSaveAndClear"
            [formModel]="form.formModel"
            default="Lưu & thêm"
          ></codx-label>
        </button>
      </ng-container>

      <button
        type="button"
        class="btn btn-primary ms-3"
        (click)="handleClickSave(true)"
      >
        <codx-label
          class="fs-6 fw-normal"
          fiedName="lblSave"
          [formModel]="form.formModel"
          default="Lưu"
        ></codx-label>
      </button>

      <div
        class="ms-4 btn btn-icon btn-sm btn-light-primary btn-circle bg"
        (click)="close()"
      >
        <i class="icon-close icon-16"></i>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #more let-data>
  <span
    ngbTooltip="Xóa"
    placement="bottom"
    type="button"
    class="btn btn-icon btn-light-danger ms-1"
    (click)="deleteRow(data)"
  >
    <i class="icon-delete icon-16"></i>
  </span>
</ng-template>
