<div class="page-anwsers pt-3">
  <div class="px-5 pt-5 div-header-1 bg-white" [ngClass]="{'rounded-bottom border-bottom': lstRespondents.length <= 0}">
    <div class="d-flex justify-content-between align-items-center pb-10">
      <div>
        <span class="fs-2 text-bold">{{lstRespondents.length}} câu trả lời</span>
      </div>
      <div>
        <!-- <span>more function</span> -->
      </div>
    </div>
  </div>
  <div #tab class="div-header-2" *ngIf="lstRespondents.length>0 ; else nullT">
    <ejs-tab #tabContent id="ejstab-survey-id" class="ejstab-survey" headerPlacement="Top" (selected)="onSelectTab($event)">
      <e-tabitems>
        <e-tabitem>
          <ng-template #headerText class="">
            <div class="nav-item">
              <a class="nav-link d-flex px-0">
                <span class="fw-bold">
                  <codx-label
                    default="Bản tóm tắt"
                  >
                  </codx-label>
                </span>
              </a>
            </div>
          </ng-template>
          <ng-template #content class="pd-t-20">
            <ng-container *ngIf="lstCountQuestion && lstCountQuestion.length > 0">
              <div class="bg-white mt-5 border rounded p-7" *ngFor="let item of lstCountQuestion">
                <div class="fs-5">{{extractContent(item.question)}}</div>
                <div class="mt-2">{{countAnswer(item.answers)}} câu trả lời</div>

                <ng-container *ngIf="!item.isChart ; else isChart">
                  <ng-container [ngSwitch]="item?.answerType">
                    <ng-container  *ngFor="let an of item.answers">
                      <ng-container *ngIf="an.answer">
                         <!-- Trả lời ngắn -->
                        <ng-container *ngSwitchCase="'T'">
                          <div class="p-3 bg-gray-100 rounded-1 mt-5">{{an.answer}}</div>
                        </ng-container>
                         <!-- Trả lời trắc nghiệm -->
                        <ng-container *ngSwitchCase="'O'">
                          <div class="d-flex align-items-center">
                            <codx-input [type]="'radio'" [disabled]="true" [checked]="true"></codx-input>
                            <span class="ms-7 mt-4">{{an.answer}}</span>
                          </div>
                        </ng-container>
                        <ng-container *ngSwitchCase="'L'">
                          <div class="d-flex align-items-center">
                            <codx-input [type]="'radio'" [disabled]="true" [checked]="true"></codx-input>
                            <span class="ms-7 mt-4">{{an.answer}}</span>
                          </div>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-template #isChart>
                  <ng-container *ngIf="item.answers && item.answers.length>0">
                    <div class="p-3 mt-5">
                      <codx-chart 
                        [height]="settingChart(item?.answerType,'height')" 
                        [primaryXAxis]="settingChart(item?.answerType,'primaryXAxis')" 
                        [primaryYAxis]="settingChart(item?.answerType,'primaryYAxis')" 
                        [seriesSetting]="settingChart(item?.answerType,'seriesSetting')"
                        [chartArea]="settingChart(item?.answerType,'chartArea')"
                        [legendSettings]="settingChart(item?.answerType,'legendSettings')"
                        [dataSource]="item.dataChart"
                        [palettes]="palettes" 
                      > 
                      </codx-chart>
                    </div>
                  </ng-container>
                </ng-template>
              </div>
            </ng-container>
           
            <!-- <div>
              
              <codx-chart [accumulation]="true"></codx-chart>
            </div> -->
          </ng-template>
        </e-tabitem>
        <e-tabitem>
          <ng-template #headerText class="">
            <div class="nav-item">
              <a class="nav-link d-flex px-0">
                <span class="fw-bold">
                  <codx-label
                    default="Câu hỏi"
                  >
                  </codx-label>
                </span>
              </a>
            </div>
          </ng-template>
          <ng-template #content class="pd-t-20">
            <div class="bg-white border border-top-0 rounded-bottom p-7">
              <div class="d-flex align-items-center ">
                <div class="div-drop-question" ngbDropdown container="body">
                  <button
                    type="button"
                    class="btn btn-light btn-sm dropdown1 border bg-white"
                    ngbDropdownToggle
                  >
                    <ng-container>
                      <div class="d-flex align-items-center p-3">
                        <div class="content-dropdown line-clamp line-clamp-1">
                          <span>{{seletedDropDown}}</span>
                        </div>
                        <i class="icon-i-caret-down-fill icon-12"></i>
                      </div>
                    </ng-container>
                  </button>
                  <div ngbDropdownMenu>
                    <ng-container *ngIf="respondents && respondents.responds.length > 0">
                      <button class="btn-dpd-1 line-clamp line-clamp-1" ngbDropdownItem *ngFor="let item of respondents.responds ; let i = index" (click)="selectedDropDown(i,item.question)">
                        <span class="span-overflow" [title]="extractContent(item.question)">{{extractContent(item.question)}}</span>
                      </button>
                    </ng-container>
                  </div>
                </div>
                <div class="d-flex align-items-center ms-7">
                  <div id="div-pervious" class="disabled p-5 mx-3 cur-point" title="Câu hỏi trước" (click)="changeQuestion('pervious')"><i class="icon-14 icon-arrow_back_ios"></i></div>
                  <codx-input [ngClass]="['ip-number']" type="number" [min]="1" [max]="respondents ? respondents.responds.length : 1" [showSpinButton]="true" [crrValue]="indexQ" (valueChange)="valueChangeIndex($event)"></codx-input>
                  <span class="ms-2"> / {{respondents?.responds.length}}</span>
                  <div id="div-next" [class.div-back-cricle]="respondents.responds && respondents.responds.length > 1" [class.disabled]="respondents.responds && respondents.responds.length <= 1" class="p-5 mx-3 cur-point" title="Câu hỏi tiếp theo" (click)="changeQuestion('next')"><i class="icon-14 icon-arrow_forward_ios"></i></div>
                </div>
              </div>
            </div>
            <div class="bg-white mt-5 border rounded p-7">
              <div class="d-flex align-items-center justify-content-between mb-5">
                <span class="fs-4">{{seletedDropDown}}</span>
                <button *ngIf="question?.answerType == 'O'" class="btn btn-dp-icon border-0 btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample" (click)="showCollapse()">
                  <codx-label [default]="'Xem tùy chọn'"></codx-label>
                  <i class="icon-i-chevron-down icon-14 ms-2"></i>
                </button>
              </div>
              <div *ngIf="question?.answerType == 'O'" class="collapse" id="collapseExample">
                <ng-container *ngIf="question && (question.answers.length > 0)">
                  <div class="d-flex align-items-center py-3" *ngFor="let item of question.answers">
                    <ng-container *ngIf="question?.answerType" [ngSwitch]="question?.answerType">
                      <ng-container *ngSwitchCase="'O'">
                        <codx-input
                          *ngIf="!item.other"
                          type="radio"
                          [disabled]="true"
                          class="test-check"
                          field="O"
                          ngClass="ip-ans me-7"
                        ></codx-input>
                        <span>{{item.answer}}</span>
                      </ng-container>
                      <ng-container *ngSwitchCase="'C'">
                        <codx-input
                          *ngIf="!item.other"
                          type="checkbox"
                          [disabled]="true"
                          class="test-check"
                          field="O"
                          ngClass="ip-ans me-7"
                        ></codx-input>
                        <span>{{item.answer}}</span>
                      </ng-container>
                    </ng-container>
                   
                  </div>
                </ng-container>
              </div>
            </div>
            <ng-container *ngIf="lstCountQuestion[indexRepons] && lstCountQuestion[indexRepons].answers &&  lstCountQuestion[indexRepons].answers.length > 0">
              <div *ngFor="let item of lstCountQuestion[indexRepons].answers">
                <div class="bg-white mt-5 border rounded p-7">
                  <div class="d-flex align-items-center border-bottom pb-3" *ngIf="item.answer ; else elseAnswer">
                    <ng-container *ngIf="question?.answerType" [ngSwitch]="question?.answerType">
                      <ng-container *ngSwitchCase="'O'">
                        <codx-input
                          *ngIf="!item.other"
                          type="radio"
                          [disabled]="true"
                          class="test-check"
                          field="O"
                          ngClass="ip-ans me-7"
                          [checked]="true"
                        ></codx-input>
                        <span>{{item.answer}}</span>
                      </ng-container>
                      <ng-container *ngSwitchCase="'L'">
                        <codx-input
                          *ngIf="!item.other"
                          type="radio"
                          [disabled]="true"
                          class="test-check"
                          field="O"
                          ngClass="ip-ans me-7"
                          [checked]="true"
                        ></codx-input>
                        <span>{{item.answer}}</span>
                      </ng-container>
                      <ng-container *ngSwitchCase="'T'">
                        {{item.answer}}
                      </ng-container>
                      <ng-container *ngSwitchCase="'C'">
                        <codx-input
                        *ngIf="!item.other"
                        type="checkbox"
                        [disabled]="true"
                        class="test-check"
                        field="O"
                        ngClass="ip-ans me-7"
                        [checked]="true"
                      ></codx-input>
                        {{item.answer}}
                      </ng-container>
                    </ng-container> 
                 
                  </div>
                  <ng-template #elseAnswer>
                    <div class="border-bottom pb-3"><span class="text-italic">Câu hỏi được để trống</span></div>
                  </ng-template>
                  <div class="pt-3" ngbDropdown container="body">
                    <button
                      type="button"
                      class="btn btn-outline-primary btn-sm border-0 dropdown1 mg-btn"
                      ngbDropdownToggle
                    >
                      <ng-container>
                        <div class="d-flex align-items-center p-1">
                          <div>
                            <span>{{item.count}} câu trả lời</span>
                          </div>
                        </div>
                      </ng-container>
                    </button>
                    <div ngbDropdownMenu>
                      <ng-container *ngIf="item.respondents && item.respondents.length > 0">
                        <div ngbDropdownItem *ngFor="let item2 of item.respondents">
                          Câu trả lời {{item2.index}}
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-template>
        </e-tabitem>
        <e-tabitem>
          <ng-template #headerText class="">
            <div class="nav-item">
              <a class="nav-link d-flex px-0">
                <span class="fw-bold">
                  <codx-label
                    default="Cá nhân"
                  >
                  </codx-label>
                </span>
              </a>
            </div>
          </ng-template>
          <ng-template #content >
            <div class="scroll-y ques-scroll bg-white rounded-top p-5">
              <ng-container *ngFor="let i of lstRespondents">
                <div>{{i.respondent}}</div>
                <ng-container *ngFor="let x of i.responds">
                  <div class="d-flex ms-5 mt-3">
                    <div class="div-sv-mt">{{extractContent(x.question)}}</div>
                    <span class="me-2">:</span>
                    <div>
                      <ng-container *ngFor="let z of x.results">
                        <div class=""><span>{{z.answer ? z.answer : 'Để trống' }}</span></div>
                      </ng-container>
                    </div>
                  </div>
                </ng-container>
                <!-- <div class="table-responsive">
                  <table class="table table-rounded table-striped border gy-7 gs-7">
                    <thead>
                      <tr class="fw-semibold fs-6 text-gray-800 border-bottom border-gray-200">
                        <th>Câu hỏi</th>
                        <th>Câu trả lời</th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngFor="let x of i.responds">
                        <tr>
                          <td [innerHTML]="x.question">{{x.question}}</td>
                          <td>
                            <ng-container *ngFor="let z of x.results">
                              <div class="d-flex"><span>{{z.answer}}</span></div>
                            </ng-container>
                          </td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div> -->
              </ng-container>
            </div>
          </ng-template>
        </e-tabitem>
      </e-tabitems>
    </ejs-tab>
  </div>
</div>
<ng-template #nullT>
  <div class="d-flex justify-content-center align-items-center bg-white p-7 rounded border mt-5">
    <span>Chưa có câu trả lời</span>
  </div>
</ng-template>

