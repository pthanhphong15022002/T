<codx-views
  #view
  [views]="views"
  [funcID]="funcID"
  [service]="service"
  [assemblyName]="assemblyName"
  [entityName]="entityName"
  [className]="className"
  [method]="method"
  [button]="button"
  (buttonClick)="click($event)"
  [idField]="idField"
  [selectedFirst]="true"
  (selectedChange)="selectedChange($event)"
  (viewChanging)="viewChanging($event)"
  (viewChanged)="viewChanged($event)"
  (clickMF)="clickMF($event, itemSelected)"
  (doubleClick)="onDbClick($event)"
>
</codx-views>

<!-- header -->
<ng-template #headerTemplate let-data>
  <div class="d-flex w-100 ps-2 pe-4 border-bottom">
    <div class="w-40 text-dark fw-bold p-3 fw-500">
      <codx-label
        fiedName="lblProjectName"
        [setRequire]="false"
        [formModel]="view.formModel"
        [default]="'Tên dự án'"
      ></codx-label>
    </div>
    <div class="w-25 text-dark fw-bold p-3 fw-500">
      <codx-label
        fiedName="lblProjectType"
        [setRequire]="false"
        [formModel]="view.formModel"
        [default]="'Phân loại'"
      ></codx-label>
    </div>
    <div class="w-25 text-dark fw-bold p-3 fw-500">
      <codx-label
        fiedName="lblScheduleFinishDate"
        [setRequire]="false"
        [formModel]="view.formModel"
        [default]="'Ngày hết hạn'"
      ></codx-label>
    </div>
    <div class="w-25 text-dark fw-bold p-3 fw-500">
      <codx-label
        fiedName="lblStatus"
        [setRequire]="false"
        [formModel]="view.formModel"
        [default]="'Tình Trạng'"
      ></codx-label>
    </div>
    <div class="w-25 text-dark fw-bold p-3 fw-500">
      <codx-label
        fiedName="lblMembers"
        [setRequire]="false"
        [formModel]="view.formModel"
        [default]="'Thành viên'"
      ></codx-label>
    </div>
    <div class="w-25 text-dark fw-bold p-3 fw-500">
      <codx-label
        fiedName="lblProjectManeger"
        [setRequire]="false"
        [formModel]="view.formModel"
        [default]="'Quản lý'"
      ></codx-label>
    </div>
  </div>
</ng-template>
<!-- end header -->
<!-- template list -->
<ng-template #templateList let-data>
  <div class="d-flex align-items-center border-bottom">
    <!-- ProjectName -->
    <div class="w-40 p-5">
      <div class="d-flex align-items-center cursor-pointer hover-active">
        <div class="d-flex flex-column me-4">
          <codx-img [funcId]="funcID" [objectId]="data.recID" [objectName]="data.projectName"
            objectType="PM_Projects" [width]="40">
          </codx-img>

        </div>
        <div class="d-flex flex-column">
          <div #nameField
            class="align-items-center line-clamp line-clamp-1 mb-1">
            <span class="fw-bold fs-6 me-3 text-nowrap item-active" >
              {{data.projectName}}</span>


          </div>
          <div #positionField *ngIf="data.projectID" class="text-gray-600 mb-1 fs-7 line-clamp line-clamp-1">
            <span [ngbTooltip]="positionTooltip">{{data.projectID? data.projectID : data.projectName}}</span>
            <ng-template #positionTooltip>
              <div class="d-flex flex-column">
                <span class="label-text-color">{{grvSetup['ProjectID']?.headerText}}</span>
                <span *ngIf="positionField.scrollHeight > positionField.clientHeight"
                  class="text-gray-600">{{data.projectID? data.projectID : data.projectName}}</span>
              </div>
            </ng-template>
          </div>
          <div #orgUnitField *ngIf="data.orgUnitID" class="text-gray-700 mb-1 line-clamp line-clamp-1">
            <span [ngbTooltip]="orgUnitTooltip">{{data.orgUnitName? data.orgUnitName : data.orgUnitID}}</span>
            <ng-template #orgUnitTooltip>
              <div class="d-flex flex-column">
                <span class="label-text-color">{{grvSetup['OrgUnitID']?.headerText}}</span>
                <span *ngIf="orgUnitField.scrollHeight > orgUnitField.clientHeight"
                  class="text-gray-600">{{data.orgUnitName? data.orgUnitName : data.orgUnitID}}</span>
              </div>
            </ng-template>
          </div>
          <div #departmentField [ngbTooltip]="departmentTooltip"
            class="text-gray-600 align-items-center line-clamp line-clamp-1">
            <span *ngIf="data.departmentID != data.orgUnitID">
              {{data.departmentName? data.departmentName :data.departmentID}}</span>
            <span *ngIf="data?.departmentID && data.divisionID" class="text-gray-400 mx-1">,</span>
            <span *ngIf="data.divisionID">{{data.divisionName? data.divisionName: data.divisionID }}</span>
            <ng-template #departmentTooltip>
              <div class="d-flex flex-column">
                <span class="label-text-color">{{grvSetup['DepartmentID']?.headerText}}</span>
                <span *ngIf="data.departmentID != data.orgUnitID
                  && departmentField.scrollHeight > departmentField.clientHeight">
                  {{data.departmentName? data.departmentName :
                  data.departmentID}}</span>
                <span *ngIf="data.divisionID && departmentField.scrollHeight > departmentField.clientHeight">
                  {{data.divisionName? data.divisionName: data.divisionID }}</span>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
    <!-- Phân loại-->
    <div class="w-25 p-5">
      <div class="d-flex flex-column">
        <div class="d-flex mb-1">
          {{ data.projectType }}
          <codx-vll
            [name]="grvSetup['ProjectType']?.referedValue"
            [value]="data.projectType"
            [showBgColor]="true"
            [showText]="true"
            [className]="'badge badge-sm badge-inline'"
          >
          </codx-vll>
        </div>
      </div>
    </div>
    <!-- ngày hết hạn -->
    <div class="w-25 p-5">
      <div class="d-flex flex-column">
        <div class="d-flex w-100 align-items-center">
          <div class="fw-bold"> <codx-label fiedName="Schedule" [formModel]="formModel" default="Kế hoạch">
          </codx-label>: </div> &nbsp;{{data.finishDate | fmDT}}
        </div>
        <div class="d-flex w-100 align-items-center mt-2">
          <div class="fw-bold"> <codx-label fiedName="Actual" [formModel]="formModel" default="Thực tế">
          </codx-label>: </div>&nbsp; {{
            data.actualFinishDate | fmDT
          }}
        </div>

      </div>
    </div>
    <!-- Tình trạng -->
    <div class="w-25 h-100">
      <div class="w-100 h-100">
        <div class="w-100 d-flex align-items-center" *ngIf="!data.taskStatus">
          Chưa có công việc...
        </div>
        <div class="d-flex flex-column w-100  h-100  align-items-center" *ngIf="data.taskStatus">
          <div class="w-100 h-30px">
            <ejs-progressbar
            [id]="data[idField]"
            [type]="'Linear'"
            [maximum]="100"
            [minimum]="0"
            [value]="data.taskStatus.done > 0 ? (data.taskStatus.done/data.taskStatus.count) * 100 : 0"
            [width]="'100%'"
            [trackThickness]="30"
            [progressThickness]="30"
            [height]="'40'"
            [animation]="{enable: true, duration: 500, delay: 0}"
            [showProgressValue]="true"
            trackColor="#f2f2f2"
            progressColor="#1E90FF"
            cornerRadius="Round4px"
            (textRender)="textRender($event,data.taskStatus)"
          >
          </ejs-progressbar>
          </div>
          <div class="w-100 d-flex align-items-center pt-5 px-2">
            <div class="w-50 d-flex float-start text-truncate">
              <b>{{data.taskStatus.done}}/{{data.taskStatus.count}}</b> &nbsp; hoàn thành
            </div>
            <div class="w-50 d-flex justify-content-end text-truncate">
              <b>{{data.taskStatus.isOverdue}}</b> &nbsp; quá hạn
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Thành viên-->
    <div class="w-25 p-5">
      <div class="d-flex has-action-menu justify-content-between w-100">
        <codx-imgs  [objectId]="getMembers(data,'objectID')"
            objectType="AD_Users" [width]="40"  [numberImages]="4" *ngIf="data.permissions">
          </codx-imgs>
      </div>
    </div>
    <!-- Quản lý-->
    <div class="w-25 p-5">
      <div class="d-flex has-action-menu justify-content-between w-100">
        <codx-img  [objectId]="data.projectManager" [objectName]="data.projectManager"
            objectType="AD_Users" [width]="40">
          </codx-img>
      </div>
    </div>
  </div>
</ng-template>
<!-- end template list -->
