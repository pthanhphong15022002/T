<codx-views #view [views]="views" [selectedFirst]="true" idField="recID" [button]="buttonAdd"
  (selectedChange)="onSelectionChanged($event)" (buttonClick)="btnClick($event)" (onActions)="onAction($event)"
  (clickMF)="clickMF($event)" [titleToolBarTmp]="breadCumbs" [autoSearch]="false" (searchChanged)="handleSearch($event)"
  [service]="'HR'" (changeDataMF)="handleShowHideMF($event)">
</codx-views>
<ng-template #footerLeftPanel>
  <div class="d-flex flex-column justify-content-start">
    <div class="cursor-pointer" *ngIf="viewDetailData == true && calendarGrid">
      <codx-input type="switch" [checked]="isOnlyReadSavedData"
        (valueChange)="onChangeIsReadSavedData($event)"></codx-input>
      <codx-label [formModel]="view.formModel" [name]="'lblOnlyReadSavedData'" [default]="'Chỉ đọc số liệu đã lưu'"
        class="ms-2 text-primary">
      </codx-label>
    </div>
    
    <div class="cursor-pointer d-flex flex-row align-items-center" *ngIf="calendarGrid || gridTotal" (click)="explanPopup()">
      <span class="icon-sticky_note_2 pe-1 text-primary"></span>
      <codx-label class="text-primary fw-bold" name="lblExplanation" default="Chú thích bảng công"
        [formName]="funcList?.formName" [gridViewName]="funcList?.gridViewName"></codx-label>
    </div>
    <!--<div *ngIf="calendarGrid || gridTotal" class="btn-group" ngbDropdown role="group" container="body">
      
      <a role="button" (click)=" explanPopup()" class=" text-primary">
        <div class="pt-2 d-flex flex-row align-items-center">
          <span class="icon-sticky_note_2 pe-1"></span>
          <codx-label default="Chú thích loại công" name="lblNote" [formModel]="view.formModel">
          </codx-label>
        </div>
      </a>
       <a id="show_menu" role="button" (click)=" explanPopup()" class="dropdown-toggle-split dropdown-toggle-click" ngbDropdownToggle>
        <div class="py-1 d-flex flex-row align-items-center">
          <span class="icon-sticky_note_2"></span>
          <codx-label default="Chú thích loại công" name="lblNote" [formModel]="view.formModel">
          </codx-label>
        </div>
      </a>
      <div class="dropdown-menu" ngbDropdownMenu>
        <div>
          <view-kowcode></view-kowcode>
        </div>
      </div> 
    </div>-->
  </div>

</ng-template>
<ng-template #leftPanel let-data>
  <codx-listview id="chartOrg" #chartOrg [itemTemplate]="tempTree" funcId="" entityName="HR_OrganizationUnits"
    service="HR" type="treeView" assemblyName="ERM.Business.HR" className="OrganizationUnitsBusiness"
    textField="orgUnitName" gridViewName="grvOrganizationUnits" formName="OrganizationUnits" [enableCheck]="false"
    [method]="'GetDataOrgAsync'" idField="orgUnitID" [dataService]="dtService"
    (onSelectionChanged)="onSelectionChangedTreeOrg($event)" [footerTemplate]="footerLeftPanel">
  </codx-listview>
</ng-template>

<ng-template #tempTree let-data>
  <div class="d-flex align-items-top py-1">
    <i class="icon-home me-2"></i>
    <span>{{ data?.orgUnitName }}</span>
  </div>
</ng-template>

<ng-template #tmpPanelRight>
  <div class="h-100">
    <div [ngClass]="!(modeView == 1 )? 'd-none' :'d-block'">
      <codx-gridview-v2 *ngIf=" calendarGridColumns.length > 0" #calendarGrid [formName]="view.formModel?.formName"
        [entityName]="view.formModel?.entityName" [gridViewName]="'grvKowDsUIByDay'" [columnsGrid]="calendarGridColumns"
        [service]="'HR'" [assemblyName]="'PR'" [checkboxSelect]="true" [className]="'KowDsBusiness'" [predicates]=""
        [dataValues]="dataValues" [autoFitColumns]="false" [hideMoreFunc]="true"
        (onDoubleClick)="doubleClickGrid($event)" [height]="'100%'" [method]="'LoadDataForGridAsync'"
        [idField]="'employeeID'" (onDatabound)="onLoadedData($event)"></codx-gridview-v2>
    </div>
    <div [ngClass]="!(modeView == 2 ) ? 'd-none' :'d-block'">
      <codx-gridview-v2 #gridTotal *ngIf="columnTotalKow?.length > 0 && loadedTotalGrid && dataValues"
        [columnsGrid]="columnTotalKow" [autoFitColumns]="false" [gridViewName]="'grvKowDsUIByKow'"
        [formModel]="gridTotalFM" [formName]="'KowDs'" [hideMoreFunc]="true" [height]="'100%'" [service]="'HR'"
        [assemblyName]="'PR'" [className]="'KowDsBusiness'" [predicates]="" [method]="'LoadDataForGridStatisticAsync'"
        [dataValues]="dataValues" [idField]="'employeeID'" (onDoubleClick)="doubleClickGrid($event)"></codx-gridview-v2>
    </div>
    <!-- process loading -->
    <ng-container *ngIf="processing">
      <div class="processing position-absolute bottom-0 end-0">
        <ng-container *ngFor="let item of processObj; index as idx">
          <div class="animate__bounceInRight animate__delay-2s">
            <div class="processing-item px-4">
              <div class="d-flex justity-content-end">
                <button type="button" class="btn btn-icon btn-light" (click)="clickRemoveProcess(idx)">
                  <span class="icon-close icon-18 text-danger"></span>
                </button>
              </div>
              <ngb-progressbar class="w-100 mb-3" type="primary" [value]="item.value" [striped]="true" [animated]="true">
                <i class="text-white">{{item.value}}%</i>
              </ngb-progressbar>
              <ng-container *ngIf="item.iteration > 0 && item.totalIteration > 0">
                <span class="text-gray fw-italic">{{item.iteration}}/{{item.totalIteration}}</span>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #breadCumbs>
  <codx-label [formModel]="view.formModel" [name]="'lblbreadCumbs'" [default]="formHeaderText" class="fw-bold fs-4">
  </codx-label>
  <span *ngIf="timeKeepingMode == '2'">
    <span class="icon-navigate_next px-1"></span>
    <codx-label [formModel]="view.formModel" [name]="'lblbreadCumbs2'" [default]="'Chi tiết theo ngày '"
      (click)="switchModeView(1)" class="ms-2 fw-bold fs-4 text-primary">
    </codx-label>
    <span class="ms-2 fw-bold fs-4 text-primary"> | </span>
    <codx-label [formModel]="view.formModel" [name]="'lblbreadCumbs3'" [default]="'Bảng công tổng hợp'"
      (click)="switchModeView(2)" class="ms-2 fw-bold fs-4 text-primary">
    </codx-label>
  </span>
</ng-template>

<ng-template #tempKow let-data>
  <div>
    <div class="d-flex flex-wrap" *ngIf="data[data?.column?.field]?.length>0">
      <div *ngFor="let item of data[data?.column?.field]">
        <div class="w-40px py-1 text-center mx-1 my-1"
          [ngClass]="[item?.kowCode?.length == 1 ? 'bg-warning' : item?.kowCode?.length == 2 ? 'bg-success':'bg-info']">
          {{item?.value}}</div>
      </div>
    </div>
    <div *ngIf="data[data?.column?.field]?.length==0">
      <div>{{"0"}}</div>
    </div>
  </div>
</ng-template>

<ng-template #tempKowTotal let-data>
  <div *ngIf="data && data[data?.column?.field]">
    {{data[data?.column?.field]}}
  </div>
</ng-template>

<ng-template #tempEmployee let-data>
  <div class="d-flex align-items-center w-100">
    <div class="p-3 ps-5">
      <div class="d-flex align-items-center">
        <div class="d-flex flex-column me-4">
          <codx-img [funcId]="'HRT03a1'" [objectId]="data?.EmployeeID" [objectName]="data?.EmployeeName"
            objectType="HR_Employees" [width]="40" [imageType]="'circle'" class="pic-emloyee">
          </codx-img>
        </div>
        <div class="d-flex flex-column">
          <div class="align-items-center line-clamp line-clamp-1 mb-1">
            <span class="fw-bold fs-6 me-3 text-nowrap">
              {{data?.EmployeeName}}</span>
            <i class="icon-qr_code_scanner text-danger icon-14 me-1"></i>
            <span class="text-danger">{{ data?.EmployeeID }}</span>
          </div>
          <div>
            {{data?.PositionName}}
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- template popup gen kowd -->
<ng-template #tmpPopupKowD let-dialog>
  <div class="container p-4">
    <div class="row">
      <div class="form-group">
        <div class="d-flex align-items-center justify-content-between">
          <h3 class="text-primary">CHÚ THÍCH</h3>
          <button type="button" class="btn btn-icon btn-light" (click)="dialog.close()">
              <span class="icon-close icon-18"></span>
          </button>
        </div> 
      </div>
    </div>
    <div class="row">
      <div class="form-group">
        <div class="d-flex align-items-center justify-content-between">
          <codx-input 
            type="radio" 
            name="genKowD" 
            field="kowDOption" 
            [checked]="true" 
            [crrValue]="1" 
            label="Gán công mặt định" 
            labelPosition="after" 
            [formModel]="dialog.formModel" 
            (valueChange)="valueChange($event)">
          </codx-input>
          <codx-input type="combobox" [refValue]="'HRKows'" field="kowCode" (valueChange)="valueChange($event)"></codx-input>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="form-group">
        <codx-input 
          type="radio" 
          name="genKowD" 
          field="kowDOption" 
          [checked]="false" 
          [crrValue]="2" 
          label="Cập nhật dữ liệu Nghỉ phép vào Bảng công" 
          labelPosition="after" 
          [formModel]="dialog.formModel" 
          (valueChange)="valueChange($event)">
        </codx-input>
      </div>
    </div>
    <div class="row mt-4">
      <div class="form-group">
        <div class="d-flex justify-content-end">
          <button type="button" class="btn btn-primary" (click)="clickBtn(dialog)">Thực hiện</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>