<codx-views
  #view
  [views]="views"
  [funcID]="funcID"
  [service]="'DP'"
  [entityName]="'DP_Activities'"
  [autoLoad]="true"
  (onActions)="onAction($event)"
  (viewChanged)="viewChanged($event)"
  [button]="button"
  (buttonClick)="click($event)"
  [viewActiveType]="viewActiveType"
>
</codx-views>

<ng-template #cellTemplate let-data>
  <div [innerHtml]="getCellContent(data?.date)"></div>
</ng-template>

<ng-template #contentTmp let-data>
  <div>
    <h5>{{ data?.taskName }}</h5>
  </div>

  <div class="d-flex mt-1 flex-grow-1 mb-2 me-6">
    <i class="icon-person me-1"></i>
    <span class="ms-1 fw-bold">
      {{ data?.createdByName }}
    </span>
  </div>

  <div class="d-flex mt-1 flex-grow-1 mb-2">
    <div class="d-flex me-6">
      <i class="icon-calendar_today icon-16 me-2"></i>
      <span class="ms-1 fw-bold">
        <span
          class="text-gray-700"
          #startDate
          [innerHTML]="
            data?.startDate
              | formatvalue : formModelActivities : 'startDate'
              | async
          "
        >
        </span>
        <span>-</span>
        <span
          class="text-gray-700"
          #startDate
          [innerHTML]="
            data?.endDate
              | formatvalue : formModelActivities : 'endDate'
              | async
          "
        ></span>
      </span>
    </div>
  </div>

  <hr />

  <div class="mb-2 text-dark me-6">
    <span>
      <codx-label
        fiedName="Memo"
        [formModel]="formModelActivities"
        class="text-gray-600 label-colon"
      >
      </codx-label>
    </span>
    <span class="ms-2 fw-bold">
      <span class="text-gray-700 size-content-schedule cursor-pointer">
        <span
          *ngIf="data?.memo"
          [innerHTML]="data?.memo"
          [ngbTooltip]="tooltipMemo"
          placement="left bottom top right"
          container="body"
        ></span>
        <span
          *ngIf="!data?.memo"
          [innerHTML]="
            data?.memo | formatvalue : formModelActivities : 'memo' | async
          "
        ></span>
      </span>
    </span>
  </div>
  <div class="d-flex mb-2">
    <div class="d-flex text-dark me-6">
      <codx-label
        class="text-gray-600 me-4 label-colon"
        fiedName="Owner"
        [setRequire]="false"
        [formModel]="formModelActivities"
      >
      </codx-label>
      <div class="d-flex justify-content-end">
        <codx-imgs
          [objectId]="data?.owner"
          objectType="AD_Users"
          [width]="30"
          [numberImages]="3"
        >
        </codx-imgs>
      </div>
    </div>
  </div>

  <ng-template #tooltipMemo>
    <div [innerHTML]="data?.memo"></div>
  </ng-template>
</ng-template>

<ng-template #resourceHeader let-data>
  <div class="container">
    <codx-temp-full
      [imageId]="data?.resourceData?.owner"
      [imageObjType]="'AD_Users'"
      [imageReferType]="'avt'"
      [title]="data?.resourceData?.userName"
      [subTitle]="data?.resourceData?.postionName"
    >
      <!-- [content]="'(' + data.resourceData.events + ')'" -->
    </codx-temp-full>
  </div>
</ng-template>

<ng-template #eventTemplate let-data>
  <h5 class="fw-bold">
    <i
      style="color: black"
      [ngClass]="data?.isActual ? 'icon-hourglass_bottom' : 'icon-golf_course'"
    ></i>
    {{ data?.taskName }}
  </h5>
</ng-template>

<ng-template #headerTempContent let-data>
  <div class="mt-2 me-2">
    <codx-mfunc
    [dataItem]="data"
    [formModel]="view.formModel"
    (clickMF)="clickMF($event, data)"
    (changeDataMF)="changeDataMF($event, data)"
    type="hover"
    >
  </codx-mfunc>
</div>
</ng-template>

<ng-template #popupChoiseTypeCM let-data>
  <codx-form
    #form
    [customToolbar]="subHeader"
    [body]="addGroupJobBody"
    [footer]="addGroupJobFooter"
    [dialog]="popupTypeCM"
  ></codx-form>
</ng-template>

<ng-template #subHeader>
  <div class="pt-2 px-2 w-100">
    <div class="d-flex justify-content-between align-items-center w-100">
      <codx-label
        name="titleTypeTasks"
        class="fw-bold fs-4"
        [default]="'Thêm công việc'"
      ></codx-label>
      <button
        class="button-close d-flex p-3"
        style="border: none; outline: none; background: none"
        (click)="closeBeforeAddTask()"
      >
        <i class="icon-close icon-18 text-hover-danger p-1"></i>
      </button>
    </div>
  </div>
</ng-template>
<ng-template #addGroupJobBody let-data>
  <div class="form-group w-100">
    <div>
      <codx-label
        fiedName="type"
        [formModel]="view.formModel"
        default="Loại "
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="typeCMs"
        [fields]="fieldsGroup"
        (change)="filterText($event, 'type')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>
  <!-- khách hàng -->
  <div class="form-group w-100" *ngIf="fieldTypeCm == 'CM_Customers' && listCustomer">
    <div>
      <codx-label
        fiedName="StepName"
        [formModel]="view.formModel"
        default="Khách hàng"
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="listCustomer"
        [fields]="fieldsCustomer"
        (change)="filterText($event,'CM_Customers')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>
  <!-- Tiềm năng -->
  <div class="form-group w-100" *ngIf="fieldTypeCm == 'CM_Leads' && listLead ">
    <div>
      <codx-label
        fiedName="StepName"
        [formModel]="view.formModel"
        default="Tiềm năng"
        [setRequire]="true"
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="listLead"
        [fields]="fieldsLead"
        (change)="filterText($event, 'CM_Leads')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>
  <!-- Cơ hội -->
  <div class="form-group w-100" *ngIf="fieldTypeCm == 'CM_Deals' && listDeal ">
    <div>
      <codx-label
        fiedName="StepName"
        [formModel]="view.formModel"
        default="Cơ hội"
        [setRequire]="true"
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="listDeal"
        [fields]="fieldsDeal"
        (change)="filterText($event, 'CM_Deals')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>
  <!-- Hợp đồng -->
  <div class="form-group w-100" *ngIf="fieldTypeCm == 'CM_Contracts' && listContract ">
    <div>
      <codx-label
        fiedName="StepName"
        [formModel]="view.formModel"
        default="Hợp đồng"
        [setRequire]="true"
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="listContract"
        [fields]="fieldsContract"
        (change)="filterText($event,'CM_Contracts')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>
  <!-- Sự cố -->
  <div class="form-group w-100" *ngIf="fieldTypeCm == 'CM_Cases' && listCase ">
    <div>
      <codx-label
        fiedName="StepName"
        [formModel]="view.formModel"
        default="Sự cố"
        [setRequire]="true"
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="listCase"
        [fields]="fieldsCase"
        (change)="filterText($event,'CM_Cases')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>
  <!-- Giai đoạn -->
  <div class="form-group w-100" *ngIf="listStep && isStepTask">
    <div>
      <codx-label
        fiedName="StepName"
        [formModel]="view.formModel"
        default="Giai đoạn"
        [setRequire]="true"
      >
      </codx-label>
    </div>
    <div>
      <ejs-combobox
        [dataSource]="listStep"
        [fields]="fieldsStep"
        (change)="filterText($event, 'step')"
        [allowCustom]="false"
      ></ejs-combobox>
    </div>
  </div>

</ng-template>
<ng-template #addGroupJobFooter let-data>
  <div class="d-flex justify-content-end">
    <button
      type="button"
      class="btn btn-primary"
      (click)="continue()"
      [disabled]="disableButton"
    >
      <codx-label
        name="lblSave"
        formName="Tasks"
        default="Tiếp tục"
      ></codx-label>
    </button>
  </div>
</ng-template>