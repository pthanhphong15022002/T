<codx-views
  #view
  [funcID]="funcID"
  [service]="service"
  [assemblyName]="assemblyName"
  [entityName]="entityName"
  [className]="className"
  [method]="method"
  [views]="views"
  [button]="showButtonAdd ? button : null"
  (buttonClick)="click($event)"
  [dataObj]="dataObj"
  [moreFuncs]="moreFuncs"
  [autoLoad]="true"
  [idField]="idField"
  [autoSearch]="false"
  (selectedChange)="selectedChange($event)"
  (viewChanged)="viewChanged($event)"
  (onLoading)="onLoading($event)"
  (searchChanged)="searchChanged($event)"
  [viewActiveType]="viewMode"
></codx-views>

<!--grid view-->
<ng-template #templateMore let-data>
  <div>
    <codx-mfunc
      [dataItem]="data"
      [formModel]="view.formModel"
      (clickMF)="clickMF($event, data)"
      (changeDataMF)="changeMoreMF($event)"
      [isBookMark]="true"
      type="view"
    ></codx-mfunc>
  </div>
</ng-template>
<!--grid view-->

<!--List view-->

<ng-template #itemViewList let-dataList>
  <codx-view-list-cm
    [dataSelected]="dataList"
    [formModel]="view.formModel"
    [entityName]="entityName"
    [vllPriority]="vllPriority"
    [funcID]="funcID"
    (clickMoreFunc)="clickMoreFunc($event)"
    (changeMoreMF)="changeMoreMF($event)"
  ></codx-view-list-cm>
</ng-template>
<!--List view-->
<!--list details tempfull-->
<ng-template #itemTemplate let-data>
  <codx-temp-full
    cardCss="card-template border-bottom p-3 list-task"
    [typeMF]="'hover'"
    [imageId]="data.recID"
    [imageObjName]="getNameCrm(data)"
    [imgOn]="data?.modifiedOn"
    (changeDataMF)="changeDataMF($event, data)"
    [imageReferType]="'avt'"
    [imageWidth]="35"
    imgCss="me-3"
    [imageObjType]="entityName"
    [title]="getNameCrm(data)"
    [titleCss]="'fs-6 mb-1'"
    [descTmp]="descTmp"
    (clickMF)="clickMF($event, data)"
    [moreFuncCss]="'me-9'"
    [typeMF]="'hover'"
    [formModel]="view.formModel"
    [footer]="footer"
    [dataItem]="data"
    [baseHeaderRightTmp]="baseHeaderRightTmp"
  >
  </codx-temp-full>
</ng-template>
<ng-template #baseHeaderRightTmp let-data>
  <div class="d-flex justify-content-end" *ngIf="data.isBlackList">
    <span
      class="icon-do_disturb_alt icon-16 text-gray-700"
      [ngbTooltip]="popupIsBlackList"
      ><ng-template #popupIsBlackList>
        <codx-label
          fiedName="IsBlackList"
          [formModel]="view.formModel"
        ></codx-label> </ng-template
    ></span>
  </div>
</ng-template>

<ng-template #descTmp let-data>
  <div class="d-flex flex-column w-100">
    <div
      class="mb-1 d-flex align-items-center"
      *ngIf="funcID == 'CM0102' && data?.mobile"
    >
      <span
        [ngbTooltip]="popupAllowCall"
        [ngClass]="
          data.allowCall
            ? 'icon-phone_android text-primary'
            : 'icon-phonelink_erase'
        "
        class="icon-16 me-2"
        ><ng-template #popupAllowCall>
          <codx-label
            name="lblAllowCall"
            [formModel]="view.formModel"
            [default]="
              data?.allowCall
                ? 'Cho phép điện thoại'
                : 'Không cho phép điện thoại'
            "
          ></codx-label> </ng-template
      ></span>
      <span
        [ngClass]="data.allowCall ? 'text-primary' : ''"
        class="text-gray-700"
        >{{ data.mobile }}</span
      >
    </div>
    <div
      class="mb-1 d-flex align-items-center"
      *ngIf="funcID == 'CM0102' && data?.personalEmail"
    >
      <span
        [ngbTooltip]="popupAllowEmail"
        [ngClass]="
          data.allowEmail ? 'icon-email text-primary' : 'icon-print_disabled'
        "
        class="icon-16 me-2 text-gray-900"
        ><ng-template #popupAllowEmail>
          <codx-label
            name="lblAllowEmail"
            [formModel]="view.formModel"
            [default]="
              data?.allowEmail ? 'Cho phép gửi mail' : 'Không cho phép gửi mail'
            "
          ></codx-label> </ng-template
      ></span>
      <span [ngClass]="data.allowEmail ? 'text-primary' : ''">{{
        data.personalEmail
      }}</span>
    </div>
    <div class="mb-1 d-flex align-items-top" *ngIf="data.address">
      <span
        class="icon-location_on icon-16 me-2 text-gray-700"
        [ngbTooltip]="popupAddress"
      >
        <ng-template #popupAddress>
          <codx-label
            fiedName="Address"
            [formModel]="view.formModel"
          ></codx-label>
        </ng-template>
      </span>
      <span class="fs-7 text-gray-600">{{ data.address }}</span>
    </div>
    <div *ngIf="funcID == 'CM0101'" class="mb-1 d-flex align-items-center">
      <div
        *ngIf="
          data?.custGroupID != null && data?.custGroupID?.trim() != '';
          then thenData;
          else noData
        "
      ></div>
      <ng-template #thenData>
        <ng-container *ngIf="lstCustGroups != null && lstCustGroups.length > 0">
          <ng-container *ngFor="let item of lstCustGroups">
            <div
              class="d-flex align-items-center"
              *ngIf="item?.recID == data?.custGroupID"
            >
              <span
                [ngClass]="item?.icon ?? 'icon-corporate_fare icon-16'"
                [ngStyle]="{ color: item?.iconColor }"
                class="me-2"
                [ngbTooltip]="popupCustGroupID"
                ><ng-template #popupCustGroupID>
                  <codx-label
                    [setRequire]="false"
                    fiedName="CustGroupID"
                    [formModel]="view.formModel"
                  ></codx-label> </ng-template
              ></span>
              <span class="fs-7">
                {{ item?.custGroupName }}
              </span>
            </div>
          </ng-container>
        </ng-container>
      </ng-template>
      <ng-template #noData>
        <div class="d-flex align-items-center">
          <span
            class="icon-corporate_fare icon-16 me-2"
            [ngbTooltip]="popupCustGroupID"
            ><ng-template #popupCustGroupID>
              <codx-label
                [setRequire]="false"
                fiedName="CustGroupID"
                [formModel]="view.formModel"
              ></codx-label> </ng-template
          ></span>
          <span
            class="fs-7"
            [innerHTML]="
              data?.custGroupID
                | formatvalue : view.formModel : 'CustGroupID'
                | async
            "
          ></span>
        </div>
      </ng-template>
    </div>
    <div
      class="mb-1 d-flex align-items-top"
      *ngIf="funcID != 'CM0102' && data.industries"
    >
      <span
        class="icon-work_outline icon-16 me-2 text-gray-700"
        [ngbTooltip]="popupIndustries"
      >
        <ng-template #popupIndustries>
          <codx-label
            fiedName="Industries"
            [formModel]="view.formModel"
          ></codx-label>
        </ng-template>
      </span>
      <span class="">
        <span *ngFor="let item of data?.industries.split(';'); index as i">
          <span
            [innerHTML]="
              item | formatvalue : view.formModel : 'Industries' | async
            "
          ></span
          ><span class="me-1" *ngIf="i < data?.industries.split(';').length - 1"
            >,
          </span>
          <!-- {{ dataSelected?.segmentID }} -->
        </span>
      </span>
    </div>
    <div
      [ngClass]="
        funcID == 'CM0101'
          ? 'd-flex justify-content-between align-items-center'
          : 'd-flex justify-content-end'
      "
    >
      <div
        class="justify-content-start align-items-end codx-badge"
        *ngIf="funcID == 'CM0101'"
      >
        <codx-vll
          [name]="gridViewSetup?.Status?.referedValue"
          [field]="'Status'"
          [value]="
            data?.status == '5' || data?.status == '7' || data?.status == '9'
              ? '4'
              : data?.status
          "
          [showText]="true"
          [showBgColor]="true"
          class="badge badge-light badge-sm"
        >
        </codx-vll>
      </div>
      <div class="d-flex align-items-center justify-content-end">
        <span
          class="me-3 text-gray-700"
          [innerHTML]="
            data?.createdOn | formatvalue : view.formModel : 'createdOn' | async
          "
        ></span>
        <codx-imgs
          class="h-25px"
          [isToolTip]="true"
          [width]="25"
          [objectId]="funcID == 'CM0101' ? data?.owner : data?.createdBy"
          [objectType]="'AD_Users'"
          [numberImages]="1"
        >
        </codx-imgs>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #footer let-data> </ng-template>

<!--list details tempfull-->
<!--Detail-->
<ng-template #templateDetail>
  <codx-cmcustomer-detail
    #customerDetail
    [gridViewSetup]="gridViewSetup"
    [dataService]="view.dataService"
    [formModel]="view.formModel"
    [recID]="dataSelected.recID"
    [dataSelected]="dataSelected"
    [lstCustGroups]="lstCustGroups"
    [funcID]="funcID"
    (clickMoreFunc)="clickMoreFunc($event)"
    [entityName]="entityName"
    (changeMoreMF)="changeMoreMF($event)"
    (addressNameCMEmit)="addressNameCMEmit($event)"
  >
  </codx-cmcustomer-detail>
</ng-template>
