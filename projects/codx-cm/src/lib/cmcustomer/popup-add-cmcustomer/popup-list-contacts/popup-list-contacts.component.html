<codx-form
  #form
  [customToolbar]="header"
  [body]="body"
  [openMore]="false"
  [dialog]="dialog"
  [formModel]="dialog.formModel"
  [footer]="footer"
></codx-form>
<ng-template #header>
  <div class="d-flex justify-content-between w-100 mt-2">
    <div class="d-flex align-items-center justify-content-start">
      <div class="h3">
        <codx-label
          name="lblContacts"
          [formModel]="dialog.formModel"
          default="Chọn liên hệ"
        ></codx-label>
      </div>
      <div class="ms-3 input-sm w-350px min-w-350px">
        <codx-input
          [disabled]="type == 'formAdd' ? true : false"
          [field]="'contactType'"
          [formModel]="form.formModel"
          (valueChange)="valueChange($event)"
          [crrValue]="contactType"
        ></codx-input>
      </div>
    </div>
    
    <div class="d-flex justify-content-end">
      <button
        style="border: none; outline: none; background: none"
        (click)="dialog.close()"
      >
        <i class="icon-close icon-18 text-hover-danger"></i>
      </button>
    </div>
  </div>
</ng-template>
<ng-template #body>
  <div class="d-flex justify-content-between mb-3">
    <div class="w-100 input-sm">
      <codx-searchbar (searchEvent)="searchName($event)"></codx-searchbar>
    </div>
    <div class="ms-3">
      <button
        type="button"
        (click)="clickAddContact()"
        class="btn btn-sm btn-primary min-w-75px"
      >
        <codx-label
          name="lblAdd"
          [formModel]="dialog.formModel"
          default="Thêm"
        ></codx-label>
      </button>
    </div>
  </div>

  <ng-container *ngIf="loaded">
    <div
      class="list-contacts"
      *ngIf="lstSearch != null && lstSearch.length > 0; else noData"
    >
      <ng-container
        [ngTemplateOutlet]="listContacts"
        [ngTemplateOutletContext]="{ item: lstSearch }"
      >
      </ng-container>
    </div>
  </ng-container>
  <ng-template #noData>
    <div class="mb-3">
      <div class="d-flex flex-column flex-center justify-content-center">
        <img
          src="../assets/themes/sys/default/img/DataEmpty.svg"
          class="w-250px"
        />
        <div class="fs-5 text-dark fw-bold mt-2 text-center">
          {{ "SYS011" | mssg | async }}
        </div>
      </div>
    </div>
  </ng-template>
</ng-template>
<ng-template #footer>
  <div class="d-flex justify-content-end">
    <div class="me-2">
      <button
        type="button"
        (click)="dialog.close()"
        class="btn btn-light-primary"
      >
        <codx-label
          name="lblCancel"
          [formModel]="dialog.formModel"
          default="Hủy"
        ></codx-label>
      </button>
    </div>
    <div class="">
      <button type="button" (click)="onSave()" class="btn btn-primary">
        <codx-label
          name="lblSave"
          [formModel]="dialog.formModel"
          default="Đồng ý"
        ></codx-label>
      </button>
    </div>
  </div>
</ng-template>
<ng-template #listContacts let-data="item">
  <ng-container *ngFor="let item of data; index as i">
    <div
      (click)="changeContacts(i, item)"
      [ngClass]="i == this.currentContact.toString() ? 'user-nav-active' : null"
      class="d-flex justify-content-between has-action-menu-od user-nav-item p-2"
    >
      <div class="col-6">
        <div class="me-3 d-flex align-items-center">
          <div class="d-flex align-items-center me-3">
            <codx-img
              class=""
              [width]="30"
              [objectId]="item.recID"
              [objectName]="item.contactName"
              objectType="CM_Contacts"
            >
            </codx-img>
          </div>
          <div class="d-flex flex-column">
            <div class="text-dark fw-bold">
              {{ item?.contactName }}
            </div>
            <div
              class="text-gray-500 fs-7"
              [innerHTML]="
                item?.jobTitle
                  | formatvalue : dialog.formModel : 'JobTitle'
                  | async
              "
            ></div>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="d-flex align-items-center" *ngIf="item.mobile">
          <span
            [ngClass]="
              item.allowCall == true
                ? 'icon-phone_android text-primary icon-16 me-1'
                : 'icon-phonelink_erase icon-16 me-1'
            "
          ></span>
          <span
            [ngClass]="
              item.allowCall == true
                ? 'text-primary text-gray-900'
                : 'text-gray-900'
            "
            >{{ item.mobile }}</span
          >
        </div>
        <div class="d-flex align-items-center" *ngIf="item?.personalEmail">
          <span
            [ngClass]="
              item.allowEmail == true
                ? 'icon-email text-primary icon-16 me-1'
                : 'icon-print_disabled icon-16 me-1'
            "
          ></span>
          <span
            [ngClass]="
              item.allowEmail == true
                ? 'text-primary text-gray-900'
                : 'text-gray-900'
            "
            >{{ item?.personalEmail }}</span
          >
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
