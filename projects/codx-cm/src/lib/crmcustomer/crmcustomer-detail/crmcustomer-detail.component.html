<ng-container *ngIf="dataSelected?.recID">
  <codx-detail-tmp [header]="header" [formModel]="formModel" [body]="body" [dataItem]="dataSelected" [hideMF]="false"
    [footer]="tabs" (clickMF)="clickMF($event, dataSelected)">
    <ng-template #header let-data>
      <div class="container_detail mt-3">
        <div class="d-flex flex-grow-1 mb-4">
          <div class="me-3">
            <codx-img [objectId]="dataSelected.recID" [objectName]="getNameCrm(dataSelected)" [referType]="'avt'"
            [imgOn]="dataSelected?.modifiedOn" [objectType]="entityName" [width]="35">
            </codx-img>
          </div>
          <div class="d-flex flex-column flex-grow-1">
            <div class="d-flex justify-content-between">
              <div class="d-flex flex-column">
                <div class="fw-bold fs-6 text-dark codx-text-overflow-1line">
                  {{ funcID == 'CM0101' ? dataSelected.customerName : funcID == 'CM0102' ? dataSelected.contactName : funcID == 'CM0103' ? dataSelected.partnerName : dataSelected.opponentName}}
                </div>
                <div class="d-flex align-items-start me-4 mb-1" *ngIf="funcID == 'CM0102'">
                  <div class="me-3" *ngIf="dataSelected?.phoneNumber">
                    <span
                      [ngClass]="dataSelected?.allowCall ? 'icon-phone_android text-primary' : 'icon-phonelink_erase'"
                      class=" icon-16 me-1"></span>
                    <span [ngClass]="dataSelected?.allowCall ? 'text-primary' : ''"
                      class="text-gray-900">{{dataSelected?.phoneNumber}}</span>
                  </div>
                  <div *ngIf="dataSelected?.email">
                    <span [ngClass]="dataSelected?.allowEmail ? 'icon-email text-primary' : 'icon-print_disabled'"
                      class="icon-16 me-1 text-gray-900"></span>
                    <span [ngClass]="dataSelected?.allowEmail ? 'text-primary' : ''"
                      class="text-gray-900">{{dataSelected?.email}}</span>
                  </div>
                </div>
                <div class="me-4 mb-1">
                  <span class="icon-location_on icon-16 me-1 text-gray-700"></span>
                  <span class="text-gray-900">Xã phú mậu, thành phố Huế, Thừa thiên Huế</span>
                </div>
              </div>
              <div class="d-flex flex-column align-items-start" *ngIf="dataSelected?.field">
                <codx-tag [entityName]="entityName" [disabled]="true" [isEdit]="false"
                  [value]="dataSelected?.field">
                </codx-tag>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="funcID != 'CM0104'&& dataSelected?.contacts != null && dataSelected?.contacts.length > 0"
          [ngClass]="funcID == 'CM0101' || funcID == 'CM0103' ? 'd-flex align-items-start' : ''">
          <ng-container *ngFor="let item of dataSelected?.contacts">
            <div *ngIf="item.contactType == '1'" class="d-flex">
              <div class="me-3" style="white-space: nowrap" *ngIf="funcID == 'CM0101' || funcID == 'CM0103'">
                <codx-label class="text-dark" fiedName="Memo" [formModel]="formModel" default="Liên hệ: "></codx-label>
              </div>
              <div class="d-flex flex-grow-1 mb-4">
                <div class="me-3">
                  <codx-img [objectId]="item.recID" [objectName]="item.contactName" [objectType]="'CM_Contacts'" [width]="35">
                  </codx-img>
                </div>
                <div class="d-flex flex-column flex-grow-1">

                  <div [ngClass]="
                    funcID == 'CM0102'
                      ? 'd-flex
                  justify-content-between'
                      : ''
                  ">
                    <div class="d-flex flex-column">
                      <div class="fw-bold fs-6 text-dark codx-text-overflow-1line">
                        {{item?.contactName}}
                      </div>
                      <div class="d-flex align-items-start me-4 mb-1">
                        <div class="me-3" *ngIf="item?.phoneNumber">
                          <span [ngClass]="item.allowCall ? 'icon-phone_android text-primary' : 'icon-phonelink_erase'"
                            class=" icon-16 me-1"></span>
                          <span [ngClass]="item.allowCall ? 'text-primary' : ''"
                            class="text-gray-900">{{item?.phoneNumber}}</span>
                        </div>
                        <div *ngIf="item?.email">
                          <span [ngClass]="item.allowEmail ? 'icon-email text-primary' : 'icon-print_disabled'"
                            class="icon-16 me-1 text-gray-900"></span>
                          <span [ngClass]="item.allowEmail ? 'text-primary' : ''"
                            class="text-gray-900">{{item.email}}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        <div class="d-flex align-items-start" *ngIf="funcID=='CM0102'">
          <div class="me-2">
            <codx-label class="text-gray-500 text-nowrap" fiedName="IsCustomer" [formModel]="formModel"
              default="Là khách hàng cá nhân: "></codx-label>
          </div>
          <div class="text-dark">
            <codx-input class="test-check me-2" type="switch" style="width:100%" [checked]="dataSelected?.isCustomer"
              field="isCustomer" [disabled]="true">
            </codx-input>
            <span>{{dataSelected.customerFrom}}</span>
          </div>
        </div>

      </div>
    </ng-template>
    <ng-template #body let-data>
      <div class="instance-select">
        <ul ngbNav #nav="ngbNav" [(activeId)]="name" class="nav nav-tabs">
          <ng-container *ngFor="let item of tabDetail; let i = index">
            <li [ngbNavItem]="item.name" class="nav-item">
              <a ngbNavLink class="nav-link">
                <div class="d-flex align-item-center">
                  <i [ngClass]="item.icon + ' ' + (item.name == name ? 'text-primary': '')" class="me-2"></i><span>
                    <codx-label [name]="'tab' + item.name" [formModel]="'SYS'" [default]="item.textDefault">
                    </codx-label>
                  </span>
                </div>
              </a>
              <ng-template ngbNavContent>
                <ng-container *ngTemplateOutlet="tabIns; context: { $implicit: item.name }">
                </ng-container>
              </ng-template>
            </li>
          </ng-container>
        </ul>
        <div [ngbNavOutlet]="nav" class="py-5"></div>
      </div>
      <ng-template #tabIns let-name>
        <div id="viewModeDetail" class="view-step-box">
          <ng-container *ngIf="name == 'Information'">
            <div class="d-flex flex-column">
              <div class="mb-3">
                <div class="mb-3">
                  <codx-label class="text-dark fw-bold" name="lblInformation" default="Thông tin chung">
                  </codx-label>
                </div>
                <codx-information [funcID]="funcID" [dataSelected]="dataSelected" [formModel]="formModel">
                </codx-information>
              </div>
              <div class="mb-3">
                <div class="mb-3">
                  <codx-label class="text-dark fw-bold" fiedName="Memo" [formModel]="formModel" default="Mô
                  tả">
                  </codx-label>
                </div>
                <div>
                  {{dataSelected?.memo}}
                </div>
              </div>
              <div class="mb-3" *ngIf="funcID == 'CM0104'">
                <div class="mb-3">
                  <codx-label class="text-dark fw-bold" name="lblProsCons" [formModel]="formModel"
                    default="Ưu / Nhược điểm">
                  </codx-label>
                </div>
                <div class="row">
                  <div class="col-6 row">
                    <div class="col-6">
                      <codx-label class="text-gray-300" [formModel]="formModel" fiedName="Advantage" default="Ưu điểm:">
                      </codx-label>
                    </div>
                    <div class="col-6">
                      {{dataSelected?.advantage}}
                    </div>
                  </div>
                  <div class="col-6 row">
                    <div class="col-6">
                      <codx-label class="text-gray-300" [formModel]="formModel" fiedName="Disadvantage"
                        default="Nhược điểm:"></codx-label>
                    </div>
                    <div class="col-6">
                      {{dataSelected?.disadvantage}}

                    </div>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <div class="mb-3">
                  <codx-label class="text-dark fw-bold" name="lblAddress" default="Thông tin địa chỉ">
                  </codx-label>
                </div>
                <div>Dữ liệu thêm sau</div>
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="name == 'Contact'">
            <div class="d-flex justify-content-end bg-gray-200 p-3 rounded-2 mb-2">
              <button type="button" class="btn btn-clean btn-sm btn-icon btn-icon-md" (click)="clickAddContact()">
                <i class="icon-person_add_alt_1 icon-18 text-primary"></i>
              </button>
            </div>
            <div *ngIf="dataSelected?.contacts != null && dataSelected.contacts.length > 0">
              <div *ngFor="let item of dataSelected?.contacts">
                <ng-container [ngTemplateOutlet]="contacts" [ngTemplateOutletContext]="{ $implicit: item }">
                </ng-container>
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="name == 'Task'">
            <ng-container [ngTemplateOutlet]="task" [ngTemplateOutletContext]="{ value: dataSelected.steps }">
            </ng-container>
          </ng-container>
          <ng-container *ngIf="name == 'Opportunity'">
            <ng-container [ngTemplateOutlet]="opportunity"> </ng-container>
          </ng-container>
          <ng-container *ngIf="name == 'Product'">
            <ng-container [ngTemplateOutlet]="product"> </ng-container>
          </ng-container>
          <ng-container *ngIf="name == 'Offered'">
            <ng-container>Sản phẩm cung cấp </ng-container>
          </ng-container>
        </div>
      </ng-template>
    </ng-template>
    <ng-template #tabs let-data>
      <codx-tabs [entityName]="entityName" [formModel]="formModel" [TabControl]="tabControl"
        [objectID]="dataSelected.recID" [funcID]="formModel.funcID" [dataTree]="treeTask"></codx-tabs>
    </ng-template>
  </codx-detail-tmp>
</ng-container>

<ng-template #contacts let-data>
  <div class="row mb-2">
    <div class="col-4 d-flex">
      <div class="me-3">
        <codx-img [objectId]="data.recID" [objectName]="data?.contactName" [objectType]="'CM_Contacts'" [width]="35">
        </codx-img>
      </div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="d-flex justify-content-between">
          <div class="d-flex flex-column">
            <div class="fw-bold fs-6 text-dark codx-text-overflow-1line mb-1">
              {{ data?.contactName }}
            </div>
            <div class="me-4">
              <span class="icon-location_on icon-16 me-1 text-gray-700"></span>
              <span class="text-gray-900">Xã phú mậu, thành phố Huế, Thừa thiên Huế</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-4 d-flex flex-column">
      <div class="mb-1" *ngIf="data?.phoneNumber">
        <span [ngClass]="data.allowCall ? 'icon-phone_android text-primary' : 'icon-phonelink_erase'"
          class=" icon-16 me-1"></span>
        <span [ngClass]="data.allowCall ? 'text-primary' : ''" class="text-gray-900">{{data.phoneNumber}}</span>
      </div>
      <div  *ngIf="data?.email">
        <span [ngClass]="data.allowEmail ? 'icon-email text-primary' : 'icon-print_disabled'"
          class="icon-16 me-1 text-gray-900"></span>
        <span [ngClass]="data.allowEmail ? 'text-primary' : ''" class="text-gray-900">{{data.email}}</span>
      </div>
    </div>
    <div class="col-4 d-flex flex-column">
      <div class="mb-1">{{data.contactType}}</div>
    </div>
  </div>
</ng-template>

<ng-template #opportunity>
  <div class="d-flex justify-content-between">
    <div class="d-flex flex-column">
      <div class="fw-bold fs-6 text-dark codx-text-overflow-1line">
        Trương Đặng Ngọc Phúc
      </div>
      <div class="d-flex align-items-start me-4 mb-1">
        <div class="me-3">
          <span class="icon-money icon-16 me-1"></span>
          <codx-label class="text-gray-600" name="lblNumber" default="Doanh số
            kỳ vọng: "></codx-label>
          <span class="ms-1">50.000.000 VND</span>
        </div>
        <div>
          <span class="">%</span>
          <codx-label class="text-gray-600" name="lblNumber" default="Tỷ lệ
            thành công: "></codx-label>
          <span class="ms-1">70%</span>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-top">
      <div class="d-flex flex-column">
        <div class="badge badge-primary">Giới thiệu sản phẩm</div>
        <div class="ms-5">
          <span class="icon-money icon-16 me-1"></span>
          <span class="text-gray-500 my-2">23/04/2023</span>
        </div>
      </div>
      <div class="ms-3">
        <codx-imgs [isToolTip]="true" [width]="35" [objectId]="'ADMIN'" ojectType="AD_Users" [numberImages]="1">
        </codx-imgs>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #task let-data="value">
  <div *ngFor="let step of data; let i = index">
    <div>
      <span class="h4 me-3 justify-content-center align-items-center" style="
          width: 35px;
          height: 35px;
          border-radius: 50%;
          background-color: rgb(45, 171, 255);
          display: inline-flex;
        ">{{ i + 1 }}</span>
      <span class="h4">{{ step.stepName }}</span>
    </div>
    <codx-show-task [dataSource]="step"></codx-show-task>
  </div>
</ng-template>
<ng-template #product let-data="value">
  <codx-table></codx-table>
</ng-template>
