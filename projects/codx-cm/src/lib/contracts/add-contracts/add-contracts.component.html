<ng-container>
  <codx-layout-add
    #formlayoutadd
    [title]="headerTest"
    [tabInfo]="tabInfo"
    [tabContent]="tabContent"
    [openMore]="true"
    [dialog]="dialog"
    [formModel]="dialog.formModel"
    [footer]="footer"
    (setTitle)="getTitle()"
    ></codx-layout-add>
    <!-- [data]="contracts" -->
    <!-- [subHeader]="subHeader" -->
  <ng-template #information>
    <ng-container
      [ngTemplateOutlet]="informationTemp"
      [ngTemplateOutletContext]="{ $implicit: formlayoutadd }"
    ></ng-container>
  </ng-template>
  <ng-template #reference>
    <ng-container
      [ngTemplateOutlet]="referenceTemp"
      [ngTemplateOutletContext]="{ $implicit: formlayoutadd }"
    ></ng-container>
  </ng-template>

  <ng-template #extend>
    <ng-container
      [ngTemplateOutlet]="extendTemp"
      [ngTemplateOutletContext]="{ $implicit: formlayoutadd }"
    ></ng-container>
  </ng-template>
  <ng-template #task>
    <ng-container
      [ngTemplateOutlet]="taskTemp"
      [ngTemplateOutletContext]="{ $implicit: formlayoutadd }"
    ></ng-container>
  </ng-template>
</ng-container>

<ng-template #subHeader let-form>
  <!-- <codx-tag
    field="tags"
    [entityName]="dialog.formModel.entityName"
    [isEdit]="true"
    [disabled]="false"
    [value]="contracts?.tags"
    (valueChange)="valueTagChange($event)"
  ></codx-tag> -->
</ng-template>

<ng-template #taskTemp let-form>
  <div class="form-group step-name w-100">
    <div>
      <codx-label
        fiedName="taskName"
        [formModel]="frmModelInstancesTask"
        default="Tên công việc"
      >
      </codx-label>
    </div>
    <codx-input
      field="taskName"
      [formModel]="frmModelInstancesTask"
      type="text"
      [crrValue]="stepsTasks?.taskName"
      [disabled]="stepsTasks?.isTaskDefault"
      (valueChange)="changeValueTextTask($event)"
      >
    </codx-input>
  </div>

  <div class="form-group d-flex justify-content-between" *ngIf="isStartIns">
    <div class="me-2">
      <codx-label
        fiedName="startDate"
        [formModel]="frmModelInstancesTask"
        default="Ngày bắt đầu"
      >
      </codx-label>
      <codx-input
        field="startDate"
        [crrValue]="stepsTasks?.startDate"
        type="datetime"
        format="F"
        [disabled]="stepsTasks?.isTaskDefault"
        (valueChange)="changeValueDateTask($event)"
        >
      </codx-input>
    </div>
    <div class="ms-2">
      <codx-label
        fiedName="endDate"
        [formModel]="frmModelInstancesTask"
        default="Ngày kết thúc"
      >
      </codx-label>
      <codx-input
        field="endDate"
        [crrValue]="stepsTasks?.endDate"
        type="datetime"
        format="F"
        (valueChange)="changeValueDateTask($event)"
        [disabled]="stepsTasks?.isTaskDefault"
        >
      </codx-input>
    </div>
  </div>
  <div class="form-group">
    <div class="d-flex justify-content-between row">
      <div class="col-6">
        <codx-label
          fiedName="durationDay"
          [formModel]="frmModelInstancesTask"
          default="Thời lượng công việc"
        >
        </codx-label>
        <div class="d-flex justify-content-between row">
          <div class="col-6 position-relative">
            <codx-input
              field="durationDay"
              [crrValue]="stepsTasks?.durationDay"
              (valueChange)="changeValueTextTask($event)"
              [disabled]="stepsTasks?.isTaskDefault || isStartIns"
              type="number"
              min="0"
            >
            </codx-input>
            <div
              class="position-absolute text-gray-400"
              style="top: 8px; right: 14px"
            >
              <codx-label
                name="titleDate"
                [formModel]="form?.formModel"
                default="Ngày"
              >
              </codx-label>
            </div>
          </div>

          <div class="col-6 position-relative">
            <codx-input
              field="durationHour"
              [crrValue]="stepsTasks?.durationHour"
              (valueChange)="changeValueTextTask($event)"
              type="number"
              min="0"
              [disabled]="stepsTasks?.isTaskDefault || isStartIns"
            >
            </codx-input>
            <div
              class="position-absolute text-gray-400"
              style="top: 8px; right: 14px"
            >
              <codx-label
                name="titleHour"
                [formModel]="frmModelInstancesTask"
                default="Giờ"
              >
              </codx-label>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6 ps-1">
        <codx-label
          fiedName="reminders"
          [formModel]="frmModelInstancesTask"
          default="Nhắc nhở trước khi bắt đầu"
        >
        </codx-label>
        <div>
          <codx-input
            field="reminders"
            [formModel]="frmModelInstancesTask"
            [crrValue]="stepsTasks?.reminders"
            refValue="DP030"
            type="valuelist"
            (valueChange)="changeValueTextTask($event)"
            [disabled]="stepsTasks?.isTaskDefault"
          >
          </codx-input>
        </div>
      </div>
    </div>
  </div>
  <div class="form-group">
    <div class="d-flex align-items-center">
      <codx-label
        fiedName="ApproveRule"
        [formName]="'DPProcesses'"
        [gridViewName]="'grvDPProcesses'"
      >
      </codx-label>
      <div class="me-3 pt-1 ms-2">
        <codx-input
          type="switch"
          class="test-check"
          [checked]="stepsTasks?.approveRule"
          field="approveRule"
          (valueChange)="valueChangeAlertTask($event)"
          >
        </codx-input>
      </div>
      <button
        type="button"
        class="btn btn-icon btn-sm btn-light-primary ms-"
        [disabled]="!stepsTasks?.approveRule "
        (click)="clickSettingApprove()"
        >
        <i class="icon-settings icon-16"></i>
      </button>
      <!-- || stepsTasks?.isTaskDefault -->
    </div>
    <!-- <div class="ms-2 mt-1">
      <codx-view-approve *ngIf="stepsTasks?.approveRule" [listApprover]="listApproverView" type="1"></codx-view-approve>
    </div> -->
  </div>
</ng-template>

<ng-template #footer let-form>
  <div class="d-flex justify-content-between">
    <div></div>
    <button
      type="button"
      button
      class="btn btn-primary ms-1"
      (click)="save()"
    >
      <codx-label default="Lưu"></codx-label>
    </button>
  </div>
</ng-template>

<ng-template #dataIsEmpty>
  <codx-no-data> </codx-no-data>
</ng-template>

<ng-template #informationTemp let-form>
  <div class="row">
    <div class="col-6">
      <div class="form-group">
        <codx-label
          [formModel]="dialog?.formModel"
          fiedName="contractID"
          default="Mã hợp đồng"
        >
        </codx-label>
        <codx-input
          [formModel]="dialog?.formModel"
          field="contractID"
          [crrValue]="contracts?.contractID"
          [placeholder]="planceHolderAutoNumber ?? grvSetup['ContractID'].headerText"
          [disabled]="disabledShowInput || action === 'edit'"
          (valueChange)="changeAutoNum($event)"
        ></codx-input>
      </div>
    </div>

    <div class="col-6">
      <div class="form-group">
        <codx-label
          [formModel]="dialog?.formModel"
          fiedName="contractDate"
          default="Ngày tạo hợp đồng"
        ></codx-label>
        <codx-input
          field="contractDate"
          type="datetime"
          [crrValue]="contracts?.contractDate"
          (valueChange)="changeValueDate($event)"
        ></codx-input>
      </div>
    </div>
  </div>

  <div class="row form-group">
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="contractType"
        default="Loại hợp đồng"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="contractType"
        [crrValue]="contracts?.contractType"
        (valueChange)="valueChangeCombobox($event)"
      >
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="businessLineID"
        default="Dòng sản phẩm"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="businessLineID"
        [crrValue]="contracts?.businessLineID"
        (valueChange)="valueChangeCombobox($event)"
        [disabled]="action == 'edit' || type == 'DP'"
      >
      </codx-input>
    </div>
  </div>

  <div class="row form-group">
    <codx-label
      [formModel]="dialog?.formModel"
      fiedName="contractName"
      default="Tên hợp đồng"
    ></codx-label>
    <codx-input
      [formModel]="dialog?.formModel"
      field="contractName"
      type="text"
      [crrValue]="contracts?.contractName"
      (valueChange)="valueChangeText($event)"
    >
    </codx-input>
  </div>

  <div class="row form-group">
    <div>
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="customerID"
        default="Khách hàng"
      ></codx-label>
    </div>
    <div class>
      <codx-input
        [formModel]="dialog?.formModel"
        field="customerID"
        type="combobox"
        (valueChange)="valueChangeCombobox($event)"
        [crrValue]="contracts?.customerID"
        [disabled]="type == 'deal' || type == 'quotation' || type == 'customer'"
      >
      </codx-input>
    </div>
  </div>

  <div class="row form-group">
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="ContactID"
        default="Người đại diện"
      ></codx-label>
      <!-- <codx-input
        field="contactID"
        [formModel]="form.formModel"
        [Group]="form.formGroup"
      ></codx-input> -->
      <codx-input
        #inputContact
        [formModel]="dialog?.formModel"
        field="contactID"
        [model]="{ObjectID: contracts?.customerID }"
        (valueChange)="valueChangeCombobox($event)"
        [crrValue]="contracts?.contactID"
      >
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="owner"
        default="Người phụ trách"
      ></codx-label>
      <codx-input
        [ngClass]="!contracts?.applyProcess ? 'd-none' :''"
        type="combobox"
        [model]="{ ProcessID: contracts?.processID }"
        refValue="DPUserProcess"
        [crrValue]="contracts?.owner"
        (valueChange)="valueChangeOwner($event)"
      >
      </codx-input>
      <div [ngClass]="contracts?.applyProcess ? 'd-none' :''">
        <codx-input
          field="owner"
          [formModel]="dialog?.formModel"
          (valueChange)="valueChangeOwner($event)"
          [crrValue]="contracts?.owner"
        >
        </codx-input>
      </div>
    </div>
  </div>

  <div class="row form-group">
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="area"
        default="Diện tích thuê"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="area"
        [crrValue]="contracts?.area"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="assetID"
        default="Ví trí thuê"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="assetID"
        [crrValue]="contracts?.assetID"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>
  </div>

  <div class="row form-group">
    <codx-label
      [formModel]="dialog?.formModel"
      fiedName="purpose"
      default="Mục đích thuê"
    ></codx-label>
    <codx-input
      [formModel]="dialog?.formModel"
      field="purpose"
      [crrValue]="contracts?.purpose"
      (valueChange)="valueChangeText($event)"
    >
    </codx-input>
  </div>

  <div class="row form-group">
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="contractAmt"
        default="Giá trị hợp đồng"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="contractAmt"
        [crrValue]="contracts?.contractAmt"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="pmtMethodID"
        default="Phương thức thanh toán"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="pmtMethodID"
        [crrValue]="contracts?.pmtMethodID"
        (valueChange)="valueChangeCombobox($event)"
      >
      </codx-input>
    </div>
  </div>

  <div class="row form-group">
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="interval"
        default="Thời hạn hợp đồng"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="interval"
        [crrValue]="contracts?.interval"
        (valueChange)="valueChangeCombobox($event)"
      >
      </codx-input>
    </div>
    <div class="col-6">
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="disposalBefore"
        default="Gởi đề nghị thanh toàn hợp đồng"
      ></codx-label>
      <codx-input
        [formModel]="dialog?.formModel"
        field="disposalBefore"
        [crrValue]="contracts?.disposalBefore"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>
  </div>

  <div class="row form-group">
    <div class="col-6">
      <div>
        <codx-label
          [formModel]="dialog?.formModel"
          fiedName="effectiveFrom"
          default="Ngày hiệu lực"
        ></codx-label>
      </div>
      <div class="">
        <codx-input
          field="effectiveFrom"
          type="datetime"
          [crrValue]="contracts?.effectiveFrom"
          (valueChange)="changeValueDate($event)"
        >
        </codx-input>
      </div>
    </div>
    <div class="col-6">
      <div>
        <codx-label
          [formModel]="dialog?.formModel"
          fiedName="effectiveTo"
          default="Ngày hết hiệu lực"
        >
        </codx-label>
      </div>
      <div class="">
        <codx-input
          field="effectiveTo"
          type="datetime"
          [crrValue]="contracts?.effectiveTo"
          (valueChange)="changeValueDate($event)"
        >
        </codx-input>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #referenceTemp>
  <div class="row form-group">
    <codx-label
      [formModel]="dialog?.formModel"
      fiedName="dealID"
      default="Cơ hội"
    ></codx-label>
    <codx-input
      #inputDeal
      field="dealID"
      [formModel]="dialog?.formModel"
      [crrValue]="contracts?.dealID"
      (valueChange)="valueChangeCombobox($event)"
      [model]="customerID"
      [disabled]="type == 'deal'"
    >
    </codx-input>
  </div>

  <div class="row form-group">
    <codx-label
      [formModel]="dialog?.formModel"
      fiedName="quotationID"
      default="Báo giá"
    ></codx-label>
    <codx-input
      #inputQuotation
      [formModel]="dialog?.formModel"
      field="quotationID"
      [crrValue]="contracts?.quotationID"
      (valueChange)="valueChangeCombobox($event)"
      [model]="customerID"
      [disabled]="type == 'quotation'"
    ></codx-input>
  </div>
</ng-template>

<ng-template #extendTemp>
  <div class="row form-group">
    <div class="col-6">
      <div>
        <codx-label
          [formModel]="dialog?.formModel"
          fiedName="adjustYear"
          default="Số năm điều chỉnh tiền thuế"
        ></codx-label>
      </div>
      <div class>
        <codx-input
          [formModel]="dialog?.formModel"
          field="adjustYear"
          [crrValue]="contracts?.adjustYear"
          (valueChange)="valueChangeText($event)"
        >
        </codx-input>
      </div>
    </div>
    <div class="col-6">
      <div>
        <codx-label
          [formModel]="dialog?.formModel"
          fiedName="adjustPercent"
          default="% điều chỉnh"
        ></codx-label>
      </div>
      <div class>
        <codx-input
          [formModel]="dialog?.formModel"
          field="adjustPercent"
          [crrValue]="contracts?.adjustPercent"
          (valueChange)="valueChangeText($event)"
        >
        </codx-input>
      </div>
    </div>
  </div>
  <div class="row form-group">
    <div>
      <codx-label
        [formModel]="dialog?.formModel"
        fiedName="note"
        default="Ghi chú"
      ></codx-label>
    </div>
    <div class>
      <codx-input
        #inputQuotation
        [formModel]="dialog?.formModel"
        field="note"
        [crrValue]="contracts?.note || ''"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>
  </div>
</ng-template>













<!-- <div class="py-5" *ngIf="false">
  <header
    class="px-6 mb-6 w-100 d-flex align-items-center justify-content-between"
  >
    <div class="d-flex align-items-center">
      <button type="text" class="btn btn-icon btn-primary rounded-circle me-3">
        <span *ngIf="action == 'add'" class="icon-add_box icon-18"></span>
        <span *ngIf="action == 'copy'" class="icon-file_copy icon-16"></span>
        <span *ngIf="action == 'edit'" class="icon-edit_square icon-16"></span>
      </button>
      <codx-label
        class="fs-3 fw-bold"
        [formModel]="formModel"
        fiedName
        [default]="headerTest"
      ></codx-label>
    </div>
    <div class="d-flex align-items-center">
      <button
        type="button"
        class="btn btn-md btn-primary min-w-70px"
        (click)="handleSaveContract()"
      >
        <codx-label
          [formModel]="formModel"
          fiedName
          default="Lưu"
        ></codx-label>
      </button>
      <button
        class="button-close d-flex p-3"
        style="border: none; outline: none; background: none"
        (click)="dialog.close()"
      >
        <i class="icon-close icon-18 text-hover-danger p-1"></i>
      </button>
    </div>
  </header>
  <main class="px-6 h-100">
    <codx-taskbar
      [listTab]="listTypeContract"
      (tab)="changeTab($event)"
      size="22"
    ></codx-taskbar>
    <div class="mt-6">
      <container-element [ngSwitch]="tabClicked">
        <some-element
          *ngSwitchCase="'general'"
          [ngTemplateOutlet]="generalTemplate"
        ></some-element>
        <some-element
          *ngSwitchCase="'quotations'"
          [ngTemplateOutlet]="quotationsTemplate"
        ></some-element>
        <some-element
          *ngSwitchCase="'pay'"
          [ngTemplateOutlet]="payTemplate"
        ></some-element>
        <some-element
          *ngSwitchCase="'ship'"
          [ngTemplateOutlet]="shipTemplate"
        ></some-element>
        <some-element
          *ngSwitchCase="'extend'"
          [ngTemplateOutlet]="extendTemplate"
        ></some-element>
        <some-element *ngSwitchDefault></some-element>
      </container-element>
    </div>
  </main>
</div>

<ng-template #generalTemplate let-data="value">
  <div class="d-flex justify-content-between">
    <div class="w-40">
      <div class="row form-group">
        <div>
          <codx-label
            [formModel]="formModel"
            fiedName="customerID"
            default="Bên B"
          ></codx-label>
        </div>
        <div class>
          <codx-input
            [formModel]="formModel"
            field="customerID"
            type="combobox"
            (valueChange)="valueChangeCombobox($event)"
            [crrValue]="contracts?.customerID"
            [disabled]="
              type == 'deal' || type == 'quotation' || type == 'customer'
            "
          >
          </codx-input>
        </div>
      </div>
      <div class="row form-group">
        <div>
          <codx-label
            [formModel]="formModel"
            fiedName="contractName"
            default="Tên hợp đồng"
          ></codx-label>
        </div>
        <div class>
          <codx-input
            [formModel]="formModel"
            field="contractName"
            type="text"
            [crrValue]="contracts?.contractName"
            (valueChange)="valueChangeText($event)"
          >
          </codx-input>
        </div>
      </div>
      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="formModel"
              fiedName="dealID"
              default="Cơ hội"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              #inputDeal
              [formModel]="dialog.formModel"
              field="dealID"
              [crrValue]="contracts?.dealID"
              (valueChange)="valueChangeCombobox($event)"
              [model]="customerID"
              [disabled]="type == 'deal'"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="quotationID"
              default="Báo giá"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              #inputQuotation
              [formModel]="dialog.formModel"
              field="quotationID"
              [crrValue]="contracts?.quotationID"
              (valueChange)="valueChangeCombobox($event)"
              [model]="customerID"
              [disabled]="type == 'quotation'"
            >
            </codx-input>
          </div>
        </div>
      </div>
      <div class="row form-group" *ngIf="contracts?.applyProcess">
        <div class="col-12">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="processID"
              default="Quy trình áp dụng"
            >
            </codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="processID"
              [crrValue]="contracts?.processID"
              (valueChange)="cbxProcessChange($event)"
              [disabled]="contracts?.processID"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>

    <div class="w-50">
      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="representative"
              default="Người đại diện"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="representative"
              type="text"
              [mode]="{}"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.representative"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>

        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName=""
              default="Người phụ trách"
            >
            </codx-label>
          </div>

          <div *ngIf="!contracts?.applyProcess; else ownerProcess">
            <codx-input
              field="owner"
              [formModel]="dialog.formModel"
              (valueChange)="valueChangeOwner($event)"
              [crrValue]="contracts?.owner"
            >
            </codx-input>
          </div>

          <ng-template #ownerProcess>
            <div>
              <ejs-combobox
                [dataSource]="listParticipants"
                (valueChange)="valueChangeOwner($event)"
                [fields]="fieldCbxParticipants"
                [allowFiltering]="true"
                [value]="contracts?.owner"
              ></ejs-combobox>
            </div>
          </ng-template>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="contractID"
              default="Mã hợp đồng"
            >
            </codx-label>
          </div>
          <div class="">
            <codx-input
              [formModel]="dialog.formModel"
              field="contractID"
              type="text"
              [crrValue]="contracts?.contractID"
              [placeholder]="
                planceHolderAutoNumber ?? grvSetup['ContractID'].headerText
              "
              (controlBlur)="changeAutoNum($event)"
              [disabled]="disabledShowInput || action === 'edit'"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="contractType"
              default="Loại hợp đồng"
            ></codx-label>
          </div>
          <div class="">
            <codx-input
              [formModel]="dialog.formModel"
              field="contractType"
              [crrValue]="contracts?.contractType"
              (valueChange)="valueChangeCombobox($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="effectiveFrom"
              default="Ngày hiệu lực"
            ></codx-label>
          </div>
          <div class="">
            <codx-input
              field="effectiveFrom"
              type="datetime"
              [crrValue]="contracts?.effectiveFrom"
              (valueChange)="changeValueDate($event)"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="effectiveTo"
              default="Ngày hết hiệu lực"
            >
            </codx-label>
          </div>
          <div class="">
            <codx-input
              [formModel]=""
              field="effectiveTo"
              type="datetime"
              [crrValue]="contracts?.effectiveTo"
              (valueChange)="changeValueDate($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-container
    *ngIf="contracts?.applyProcess"
    [ngTemplateOutlet]="tabCustomFieldDetail"
  ></ng-container>
</ng-template>

<ng-template #quotationsTemplate let-data="value">
  <codx-quotations-lines
    #viewQuotationsLine
    [transID]="quotations?.recID"
    [exchangeRate]="1"
    [currencyID]="quotations?.currencyID"
    [listQuotationLines]="listQuotationsLine"
    [quotationLinesAddNew]="quotationLinesAddNew"
    [quotationLinesEdit]="quotationLinesEdit"
    [quotationLinesDeleted]="quotationLinesDeleted"
    [actionParent]="action"
    [isSetMoreFunc]="true"
    (eventQuotationLines)="eventQuotationLines($event)"
  ></codx-quotations-lines>
</ng-template>

<ng-template #payTemplate let-data="value">
  <ng-container [ngTemplateOutlet]="methodPayTemplate"></ng-container>
  <ng-container [ngTemplateOutlet]="calendarPayTemplate"></ng-container>
</ng-template>


<ng-template #shipTemplate let-data="value">
  <div>
    <codx-taskbar
      [listTab]="[
        {
          icon: 'icon-error_outline',
          name: 'contract',
          textDefault: 'Thông tin giao hàng'
        }
      ]"
      class="mb-2"
      size="22"
    ></codx-taskbar>
    <div class="d-flex justify-content-between mt-5">
      <div class="w-50">
        <div class="row form-group">
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delTermID"
                default="Điều khoản giao hàng"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="delTermID"
                [crrValue]="contracts?.delTermID"
                (valueChange)="valueChangeCombobox($event)"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delModeID"
                default="Hình thức giao hàng"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="delModeID"
                (valueChange)="valueChangeCombobox($event)"
                [crrValue]="contracts?.delModeID"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delPrice"
                default="Phí vận chuyển"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                field="delPrice"
                type="number"
                [min]="0"
                (valueChange)="valueChangeText($event)"
                [crrValue]="contracts?.delPrice"
              >
              </codx-input>
            </div>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-6">
            <div
              class="d-flex justify-content-between align-items-center h-30px"
            >
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delContactID"
                default="Liên hệ giao hàng"
              ></codx-label>
              <button
                type="button"
                class="btn btn-icon btn-sm btn-light-primary"
              >
                <i class="icon-person_add_alt_1 icon-16"></i>
              </button>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="delContactID"
                [crrValue]="contracts?.delContactID"
                (valueChange)="valueChangeCombobox($event)"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-6">
            <div class="h-30px d-flex align-items-center">
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delPhone"
                default="Số điện thoại"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="delPhone"
                (valueChange)="valueChangeText($event)"
                [crrValue]="contracts?.delPhone"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>

      <div class="w-40">
        <div class="row form-group">
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delDeadline"
                default="Hạn giao hàng"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                field="delDeadline"
                type="datetime"
                (valueChange)="changeValueDate($event)"
                [crrValue]="contracts?.delDeadline"
              >
              </codx-input>
            </div>
          </div>

          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delStatus"
                default="Tình trạng giao hàng"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="delStatus"
                type="valuelist"
                refValue="CRM019"
                (valueChange)="valueChangeCombobox($event)"
                [crrValue]="contracts?.delStatus"
              >
              </codx-input>
            </div>
          </div>

          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delActualDate"
                default="Ngày giao hàng thành công"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                field="delActualDate"
                type="datetime"
                (valueChange)="changeValueDate($event)"
                [crrValue]="contracts?.delActualDate"
                [disabled]="disabledDelActualDate"
              >
              </codx-input>
            </div>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-12">
            <div
              class="d-flex justify-content-between align-items-center h-30px"
            >
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="delAddress"
                default="Địa chỉ giao hàng"
              ></codx-label>
              <button
                type="button"
                class="btn btn-icon btn-sm btn-light-primary"
              >
                <i class="icon-add_location_alt icon-16"></i>
              </button>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="delAddress"
                type="valuelist"
                [crrValue]="contracts?.delAddress"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #extendTemplate let-data="value"> </ng-template>

<ng-template #termsAndRelatedTemplate let-data="value">
  <div class="d-flex justify-content-between mt-5">
    <div class="d-flex align-items-center nav-item w-100 mb-1">
      <div class="d-flex align-items-center mb-2">
        <span class="icon-attach_file icon-18 me-2 text-primary"></span>
        <div class="fw-bold text-primary">
          <codx-label
            name="lblAttachments"
            [formModel]="dialog.formModel"
            default="Tài liệu đính kèm"
          >
          </codx-label>
        </div>
      </div>
    </div>

    <button
      style="float: left"
      type="button"
      class="btn btn-light-primary d-flex align-items-center"
      (click)="addFile($event)"
    >
      <i class="icon-cloud_upload fs-5"></i
      ><span>
        <codx-label
          class="text-nowrap"
          [formModel]="dialog.formModel"
          name="UploadFile"
          formName="Tasks"
          default="Đính kèm"
        ></codx-label>
      </span>
    </button>
  </div>

  <div>
    <codx-attachment
      #attachment
      [objectType]="dialog.formModel.entityName"
      [objectId]="contracts?.recID"
      hideFolder="1"
      hideImageUpload="0"
      hideImageThumb="0"
      hideUploadBtn="1"
      [showMessage]="0"
      hideDes="1"
      type="inline"
      allowMultiFile="1"
      referType="source"
      [formModel]="dialog.formModel"
      displayThumb="full"
    >
    </codx-attachment>
  </div>
</ng-template>

<ng-template #representativeTemplate let-data="value">
  <div class="d-flex justify-content-between">
    <div class="w-50">
      <div class="row form-group">
        <div class="col-8">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="companyName"
              default="Bên A"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="companyName"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.legalName"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-4">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="taxCode"
              default="Mã số thuế"
            >
            </codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="taxCode"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.taxCode"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-12">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="address"
              default="Địa chỉ"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="address"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.street"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="phone"
              default="Điện thoại"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="phone"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.phone"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="faxNo"
              default="Fax"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="faxNo"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.faxNo"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="contactName"
              default="Người đại diện"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="contactName"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.contactName"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="jobTitle"
              default="Chức vụ"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="jobTitle"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.jobTitle"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="bankAccount"
              default="Tài khoản ngân hàng"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="bankAccount"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.bankAccount"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="bankID"
              default="Ngân hàng"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="bankID"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="account?.bankID"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>

    <div class="w-40">
      <div class="row form-group">
        <div class="col-8">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="customerID"
              default="Bên B"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="customerID"
              type="combobox"
              (valueChange)="valueChangeCombobox($event)"
              [crrValue]="contracts?.customerID"
              [disabled]="
                type == 'deal' || type == 'quotation' || type == 'customer'
              "
            >
            </codx-input>
          </div>
        </div>
        <div class="col-4">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="taxCode"
              default="Mã số thuế"
            >
            </codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="taxCode"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.taxCode"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-12">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="address"
              default="Địa chỉ"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="address"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.address"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="phone"
              default="Điện thoại"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="phone"
              type="number"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.phone"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="faxNo"
              default="Fax"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="faxNo"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.faxNo"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="representative"
              default="Người đại diện"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="representative"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.representative"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="jobTitle"
              default="Chức vụ"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="jobTitle"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.jobTitle"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>

      <div class="row form-group">
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="bankAccount"
              default="Tài khoản ngân hàng"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="bankAccount"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.bankAccount"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div>
            <codx-label
              [formModel]="dialog.formModel"
              fiedName="bankID"
              default="Ngân hàng"
            ></codx-label>
          </div>
          <div class>
            <codx-input
              [formModel]="dialog.formModel"
              field="bankID"
              type="text"
              (valueChange)="valueChangeText($event)"
              [crrValue]="contracts?.bankID"
              [disabled]="true"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #methodPayTemplate let-data="value">
  <div>
    <codx-taskbar
      [listTab]="[
        {
          icon: 'icon-error_outline',
          name: 'contract',
          textDefault: 'Thông tin thanh toán'
        }
      ]"
      size="22"
      class="mb-3"
    ></codx-taskbar>
    <div class="d-flex justify-content-between mt-5">
      <div class="w-50">
        <div class="row form-group">
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="contractAmt"
                default="Giá trị hợp đồng"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="contractAmt"
                type="number"
                [min]="0"
                [crrValue]="contracts?.contractAmt"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="paidAmt"
                default="Số tiền thanh toán"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="paidAmt"
                type="number"
                [min]="0"
                (valueChange)="valueChangeText($event)"
                [crrValue]="contracts?.paidAmt"
                [disabled]="true"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="remainAmt"
                default="Số tiền còn lại"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="remainAmt"
                type="number"
                [min]="0"
                (valueChange)="valueChangeText($event)"
                [crrValue]="contracts?.remainAmt"
                [disabled]="true"
              >
              </codx-input>
            </div>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-4">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="pmtTermID"
                default="Điều khoản thanh toán"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="pmtTermID"
                (valueChange)="valueChangeCombobox($event)"
                [crrValue]="contracts?.pmtTermID"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-8">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="pmtMethodID"
                default="Phương thức thanh toán"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="pmtMethodID"
                type="valuelist"
                (valueChange)="valueChangeCombobox($event)"
                [crrValue]="contracts?.pmtMethodID"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>

      <div class="w-40">
        <div class="row form-group">
          <div class="col-6">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="currencyID"
                default="Tiền tệ"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="currencyID"
                type="valuelist"
                [crrValue]="contracts?.currencyID"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-6">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="exchangeRate"
                default="Tỷ giá"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="exchangeRate"
                type="number"
                [crrValue]="contracts?.exchangeRate"
                [disabled]="true"
              >
              </codx-input>
            </div>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-6">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="pmtStatus"
                default="Tình trạng thanh toán"
              >
              </codx-label>
            </div>
            <div class>
              <codx-input
                [formModel]="dialog.formModel"
                field="pmtStatus"
                (valueChange)="valueChangeCombobox($event)"
                [crrValue]="contracts?.pmtStatus"
              >
              </codx-input>
            </div>
          </div>
          <div class="col-6">
            <div>
              <codx-label
                [formModel]="dialog.formModel"
                fiedName="pmtDeadline"
                default="Hạn thanh toán"
              ></codx-label>
            </div>
            <div class>
              <codx-input
                field="pmtDeadline"
                type="datetime"
                (valueChange)="changeValueDate($event)"
                [crrValue]="contracts?.pmtDeadline"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #calendarPayTemplate let-data="value">
  <div>
    <codx-taskbar
      [listTab]="[
        {
          icon: 'icon-error_outline',
          name: 'contract',
          textDefault: 'Lịch thanh toán'
        }
      ]"
      size="22"
      class="mb-3"
    ></codx-taskbar>
  </div>
  <view-payment
    [isSave]="false"
    [contracts]="contracts"
    [listPayment]="listPayment"
    [listPaymentAdd]="listPaymentAdd"
    [listPaymentEdit]="listPaymentEdit"
    [listPaymentDelete]="listPaymentDelete"
    [listPaymentHistory]="listPaymentHistory"
  ></view-payment>
</ng-template>

<ng-template #tabCustomFieldDetail let-form>
  <div *ngIf="listField?.length > 0">
    <div class="mb-5">
      <codx-label
        class="border-bottom border-bottom-2 border-primary text-primary p-1 fw-bold"
        [formModel]="dialog.formModel"
        fiedName="titleField"
        default="Thông tin mở rộng"
      ></codx-label>
    </div>
    <div class="row">
      <div
        *ngFor="let item of listField"
        class="col-xl-3 col-lg-4 col-md-6 col-sm-12"
      >
        <codx-input-custom-field
          [customField]="item"
          [checkValid]="false"
          [objectId]="item.recID"
          [objectType]="'DP_Instances_Steps_Fields'"
          [formModel]="dialog.formModel"
          (valueChangeCustom)="valueChangeCustom($event)"
        >
        </codx-input-custom-field>
      </div>
    </div>
  </div>
</ng-template> -->
