<codx-detail-tmp
  [header]="headerTemp"
  [body]="bodyTemp"
  [footer]="footerTemp"
  [formModel]="formModel"
  (clickMF)="clickMF($event, contract)"
  (changeDataMF)="changeDataMF($event, contract)"
  [hideMF]="true"
  [dataItem]="contract"
  class="overflow-hidden"
></codx-detail-tmp>
<!-- -------------------------------------------------- Template chính ------------------------------------------------ -->
<ng-template #headerTemp>
  <div *ngIf="isView" class="d-flex justify-content-end">
    <button
      class="button-close d-flex p-3"
      style="border: none; outline: none; background: none"
      (click)="dialog.close()"
    >
      <i class="icon-close icon-18 text-hover-danger p-1"></i>
    </button>
  </div>
  <div>
    <div class="d-flex align-items-center text-primary mb-2">
      <i class="icon-add_shopping_cart icon-18 me-2 text-primary"></i>
      <span
        [ngbTooltip]="businessLine"
        container="body"
        class="fw-bold fs-6"
        #BusinessLineID
        [innerHTML]="
          contract?.businessLineID
            | formatvalue
              : formModel
              : 'BusinessLineID'
              : BusinessLineID
              : 'CMContracts'
              : 'grvCMContracts'
            | async
        "
      ></span>
      <ng-template #businessLine>
        <codx-label
          class="fs-6 fw-bold"
          fiedName="businessLineID"
          [formModel]="formModel"
          [setRequire]="false"
          default="Dòng sản phẩm"
        ></codx-label>
      </ng-template>
    </div>

    <div class="row">
      <div class="col-8">
        <div class="d-flex">
          <div class="me-4">
            <codx-img
              [objectId]="contract?.customerName"
              [imgOn]="contract?.modifiedOn"
              [objectType]="'CM_Customers'"
              [referType]="'avt'"
              [width]="40"
            >
            </codx-img>
            <!-- [objectName]="contract?.customerName" -->
          </div>
          <div class="d-flex flex-column">
            <div>
              <span
                class="text-dark codx-textcontent fw-bold"
                #customerID
                [innerHTML]="
                  contract?.customerID
                    | formatvalue
                      : formModel
                      : 'CustomerID'
                      : customerID
                      : 'CMContracts'
                      : 'grvCMContracts'
                    | async
                "
                [ngbTooltip]="customer"
                container="body"
              ></span>
              <ng-template #customer>
                <codx-label
                  class="fs-6 fw-bold"
                  fiedName="customerID"
                  [formModel]="formModel"
                  [setRequire]="false"
                  default="Khách hàng"
                ></codx-label>
              </ng-template>
            </div>
            <div class="text-gray-700 fs-5-sm">
              {{ contract?.contractName }}
            </div>
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="d-flex justify-content-end align-items-center mb-2">
          <span class="icon-monetization_on icon-18 me-1 text-warning"></span>
          <span
            class="fs-5 fw-bold"
            #ContractAmt
            [innerHTML]="
              contract?.contractAmt
                | formatvalue
                  : formModel
                  : 'ContractAmt'
                  : ContractAmt
                  : 'CMContracts'
                  : 'grvCMContracts'
                | async
            "
            [ngbTooltip]="contractAmt"
            container="body"
          ></span>
          <span
            class="fs-5 fw-bold ms-1"
            #CurrencyID
            [innerHTML]="
              contract?.currencyID
                | formatvalue
                  : formModel
                  : 'CurrencyID'
                  : CurrencyID
                  : 'CMContracts'
                  : 'grvCMContracts'
                | async
            "
          ></span>
          <ng-template #contractAmt>
            <codx-label
              class="fs-6 fw-bold"
              fiedName="contractAmt"
              [formModel]="formModel"
              [setRequire]="false"
              default="Giá trị hợp đồng"
            ></codx-label>
          </ng-template>
        </div>
        <div class="d-flex justify-content-end align-items-center mb-2">
          <span class="icon-av_timer icon-16 text-gray-600 me-1"></span>
          <span
            class="text-gray-600"
            #CreatedOn
            [innerHTML]="
              contract?.createdOn
                | formatvalue
                  : formModel
                  : 'CreatedOn'
                  : CreatedOn
                  : 'CMContracts'
                  : 'grvCMContracts'
                | async
            "
            [ngbTooltip]="createdOn"
            container="body"
          ></span>
          <ng-template #createdOn>
            <codx-label
              class="fs-6 fw-bold"
              fiedName="createdOn"
              [formModel]="formModel"
              [setRequire]="false"
              default="Ngày lập hợp đồng"
            ></codx-label>
          </ng-template>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-6"></div>
      <div class="col-6">
        <div class="d-flex justify-content-end align-items-center mb-2">
          <div
            *ngIf="contract?.status == '2' && stepCurrent; else statusDefault"
            [ngStyle]="{
              'background-color': stepCurrent?.backgroundColor
            }"
            class="badge badge-sm d-flex align-items-center me-0"
          >
            <span
              [ngClass]="stepCurrent?.icon"
              [ngStyle]="{
                color: stepCurrent?.iconColor
              }"
              class="me-1"
            ></span>
            <span
              class="text-ellipsis line-clamp line-clamp-2"
              [ngbTooltip]="stepCurrent?.stepName"
              [ngStyle]="{
                color: stepCurrent.textColor
              }"
              >{{ stepCurrent?.stepName }}</span
            >
          </div>
          <ng-template #statusDefault>
            <codx-vll
              [name]="vllStatus"
              [field]="'Status'"
              [value]="contract?.status"
              [showText]="true"
              [showBgColor]="true"
              class="me-0 badge badge-primary badge-sm"
            >
            </codx-vll>
          </ng-template>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-6"></div>
      <div class="col-6">
        <div
          *ngIf="contract?.approveStatus && contract?.approveStatus != '1'"
          class="d-flex justify-content-end"
        >
          <span
            [innerHTML]="
              contract?.approvedDate
                | formatvalue : formModel : 'approvedDate'
                | async
            "
            [ngbTooltip]="approvedDate"
            placement="top"
          >
            <ng-template #approvedDate>
              <codx-label
                fiedName="approvedDate"
                [formModel]="formModel"
                [setRequire]="false"
                default="Ngày duyệt"
              ></codx-label>
            </ng-template>
          </span>
          <codx-vll
            [name]="'DP043'"
            [field]="'ApproveStatus'"
            [value]="contract?.approveStatus"
            [showText]="true"
            [showBgColor]="true"
            class="badge badge-primary badge-sm ms-3 me-0"
          >
          </codx-vll>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <div class="mb-1">
          <codx-label
            class="label-colon fs-6 fw-bold"
            fiedName="contactID"
            [formModel]="formModel"
            [setRequire]="false"
            default="Người đại diện"
          >
          </codx-label>
        </div>
        <div class="d-flex align-items-center">
          <div class="me-3">
            <codx-img
              [objectId]="contactPerson?.recID"
              [objectName]="contactPerson?.contactName"
              [imgOn]="contactPerson?.modifiedOn"
              [objectType]="'CM_Contacts'"
              [width]="50"
            >
            </codx-img>
          </div>
          <div class="d-flex flex-column">
            <div
              *ngIf="contactPerson?.contactName"
              class="fw-bold text-dark fs-6"
              #contactName
              [innerHTML]="
                contactPerson?.contactName
                  | formatvalue : formModelContact : 'contactName' : contactName
                  | async
              "
            ></div>
            <div class="fs-7 text-gray-600">
              <div
                #role
                *ngIf="contactPerson?.jobTitle"
                [innerHTML]="
                  contactPerson?.jobTitle
                    | formatvalue : formModelContact : 'JobTitle' : role
                    | async
                "
              ></div>
            </div>

            <div class="d-flex align-items-start">
              <div
                class="d-flex align-items-center me-3"
                *ngIf="contactPerson?.mobile"
              >
                <div
                  class="text-gray-600 fs-7"
                  #mobile
                  [innerHTML]="
                    contactPerson?.mobile
                      | formatvalue : formModelContact : 'mobile' : mobile
                      | async
                  "
                ></div>
              </div>
              <div
                class="d-flex align-items-center"
                *ngIf="contactPerson?.personalEmail"
              >
                <div
                  class="text-gray-600 fs-7"
                  #personalEmail
                  [innerHTML]="
                    contactPerson?.personalEmail
                      | formatvalue
                        : formModelContact
                        : 'personalEmail'
                        : personalEmail
                      | async
                  "
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-6 d-flex flex-column align-items-end">
        <div>
          <codx-label
            class="label-colon fs-6 fw-bold"
            fiedName="owner"
            [formModel]="formModel"
            [setRequire]="false"
            default="Người phụ trách"
          >
          </codx-label>
        </div>
        <div class="d-flex align-items-center">
          <codx-imgs
            [width]="25"
            [objectId]="contract?.owner"
            ojectType="AD_Users"
            [numberImages]="1"
          ></codx-imgs>
          <span
            class="text-dark fw-bold codx-textcontent ms-2 mb-2"
            #owner
            [innerHTML]="
              contract?.owner
                | formatvalue
                  : formModel
                  : 'Owner'
                  : owner
                  : 'CMContracts'
                  : 'grvCMContracts'
                | async
            "
          ></span>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #bodyTemp>
  <div
    class="cm-scroll"
    [ngClass]="isShowFull ? 'cm-full' : ''"
    *ngIf="this.idTabShow"
  >
    <div
      class="btn btn-white btn-icon tab-action"
      (click)="clickShowTab(!isShowFull)"
    >
      <span class="icon-unfold_more icon-20"></span>
    </div>
    <div class="instance-select">
      <ejs-tab>
        <e-tabitems>

          <e-tabitem *ngIf="idTabShow.includes('1')">
            <ng-template #headerText>
              <ng-container
                [ngTemplateOutlet]="tabTemp"
                [ngTemplateOutletContext]="{value: {icon: 'icon-info', default: 'Thông tin chung', name: 'lblInformation'}}"
              ></ng-container>
            </ng-template>
            <ng-template #content>
              <ng-container [ngTemplateOutlet]="generalTemplate">
              </ng-container>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="idTabShow.includes('5')">
            <ng-template #headerText>
              <ng-container
                [ngTemplateOutlet]="tabTemp"
                [ngTemplateOutletContext]="{value: {icon: 'icon-add_task',default: 'Công việc',name: 'lblTask'}}"
              ></ng-container>
            </ng-template>
            <ng-template #content>
              <ng-container [ngTemplateOutlet]="task"> </ng-container>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="idTabShow.includes('7')">
            <ng-template #headerText>
              <ng-container
                [ngTemplateOutlet]="tabTemp"
                [ngTemplateOutletContext]="{value: {icon: 'icon-sticky_note_2',default: 'Ghi chú',name: 'lblMemo'}}"
              ></ng-container>
            </ng-template>
            <ng-template #content>
              <ng-container [ngTemplateOutlet]="memo"> </ng-container>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="idTabShow.includes('8')">
            <ng-template #headerText>
              <ng-container
                [ngTemplateOutlet]="tabTemp"
                [ngTemplateOutletContext]="{value: {icon: 'icon-appstore',default: 'Phụ lục',name: 'lblAppendix'}}"
              ></ng-container>
            </ng-template>
            <ng-template #content>
              <ng-container [ngTemplateOutlet]="appendix"> </ng-container>
            </ng-template>
          </e-tabitem>

          <e-tabitem *ngIf="idTabShow.includes('9')">
            <ng-template #headerText>
              <ng-container
              [ngTemplateOutlet]="tabTemp"
              [ngTemplateOutletContext]="{value: {icon: 'icon-payments',default: 'Thanh lý',name: 'lblDisposal'}}"
            ></ng-container>
            </ng-template>
            <ng-template #content>
              <ng-container [ngTemplateOutlet]="disposal"> </ng-container>
            </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </div>
</ng-template>

<ng-template #footerTemp>
  <codx-tabs
    [entityName]="formModel?.entityName"
    [formModel]="formModel"
    [TabControl]="tabControl"
    [objectID]="contract?.recID"
    [funcID]="formModel?.funcID"
    [transID]="contract?.recID"
    [dataTree]="treeTask"
    [approveStatus]="contract?.approveStatus"
    [data]="contract"
    [keyField]="'recID'"
  ></codx-tabs>
</ng-template>

<!-- -------------------------------------------------- Template phụ ------------------------------------------------ -->

<ng-template #tabTemp let-data="value">
  <div class="d-flex align-items-center me-2">
    <span class="text-hover-primary icon-16 me-1 fw-bold" [ngClass]="data?.icon"></span>
    <codx-label
      class="fw-bold text-hover-primary text-dark"
      [default]="data?.default"
      [formModel]="formModel"
      [name]="data?.name"
    ></codx-label>
  </div>
</ng-template>

<!-- Thông tin chung -->
<ng-template #generalTemplate>
  <div class="mt-3">
    <codx-label
      class="fs-5-sm fw-bold"
      name="lblGeneral"
      [formModel]="formModel"
      [setRequire]="false"
      default="Thông tin chung"
    >
    </codx-label>
    <div class="row my-1">
      <div class="col-6">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="contractID"
          [formModel]="formModel"
          [setRequire]="false"
          default="Số hợp đồng"
        >
        </codx-label>
        <span
          #contractID
          class="text-dark fw-bold codx-textcontent"
          [innerHTML]="
            contract?.contractID
              | formatvalue
                : formModel
                : 'ContractID'
                : contractID
                : 'CMContracts'
                : 'grvCMContracts'
              | async
          "
        ></span>
      </div>

      <div class="col-6">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="contractType"
          [formModel]="formModel"
          [setRequire]="false"
          default="Loại hợp đồng"
        >
        </codx-label>
        <span
          #contractType
          class="text-dark fw-bold codx-textcontent"
          [innerHTML]="
            contract?.contractType
              | formatvalue
                : formModel
                : 'ContractType'
                : contractType
                : 'CMContracts'
                : 'grvCMContracts'
              | async
          "
        ></span>
      </div>
    </div>

    <div class="row my-1">
      <div class="col-6 d-flex flex-wrap align-items-cente aquar">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="interval"
          [formModel]="formModel"
          [setRequire]="false"
          default="Thời hạn hợp đồng (tháng)"
        >
        </codx-label>
        <span
          #interval
          class="text-dark fw-bold codx-textcontent"
          [innerHTML]="
            contract?.interval || 0
              | formatvalue
                : formModel
                : 'Interval'
                : interval
                : 'CMContracts'
                : 'grvCMContracts'
              | async
          "
        ></span>
        <codx-label
          class="mx-1"
          name="lblMonth"
          [formModel]="formModel"
          default="tháng"
        >
        </codx-label>
        <span
          #effectiveFrom
          class="text-dark fw-bold codx-textcontent"
          [innerHTML]="
            contract?.effectiveFrom
              | formatvalue
                : formModel
                : 'EffectiveFrom'
                : effectiveFrom
                : 'CMContracts'
                : 'grvCMContracts'
              | async
          "
        ></span>
        <span class="px-1">-</span>
        <span
          #effectiveTo
          class="text-dark fw-bold codx-textcontent"
          [innerHTML]="
            contract?.effectiveTo
              | formatvalue
                : formModel
                : 'EffectiveTo'
                : effectiveTo
                : 'CMContracts'
                : 'grvCMContracts'
              | async
          "
        ></span>
        <div class="d-flex align-items-end">
          <span
            class="icon-18 icon-notifications cursor-pointer"
            [ngbTooltip]="'Thiết lập thông báo'"
            (click)="notificationContract()"
          ></span>
        </div>
      </div>

      <div class="col-6">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="pmtMethodID"
          [formModel]="formModel"
          [setRequire]="false"
          default="Phương thức thanh toán"
        >
        </codx-label>
        <span
          #pmtMethodID
          class="text-dark fw-bold codx-textcontent"
          [innerHTML]="
            contract?.pmtMethodID
              | formatvalue
                : formModel
                : 'PmtMethodID'
                : pmtMethodID
                : 'CMContracts'
                : 'grvCMContracts'
              | async
          "
        ></span>
      </div>
    </div>

    <!-- Thông báo -->
    <!-- <div class="d-flex align-items-center">
      <codx-label
        class="label-colon text-gray-600 codx-textlabel"
        fiedName="notification"
        [formModel]="formModel"
        [setRequire]="false"
        default="Thông báo sắp hết hạn hợp đồng"
      >
      </codx-label>
      <span>Trước {{ contract?.expirationAlertTime }} ngày.</span>
      <div class="ms-1">
        <codx-input
          class="check-circle me-1 mt-1"
          field="isAlert"
          type="checkbox"
          [checked]="contract?.isAlert"
          (valueChange)="valueChangeChecked($event, contract)"
        ></codx-input>
        <codx-label
          fiedName="isAlertTitle"
          [formName]="'DPProcesses'"
          [gridViewName]="'grvDPProcesses'"
          [setRequire]="false"
          [default]="'Thông báo'"
        ></codx-label>
        <span>,</span>
      </div>
      <div class="ms-1">
        <codx-input
          class="check-circle me-1 mt-1"
          field="isMail"
          type="checkbox"
          [checked]="contract?.isMail"
          (valueChange)="valueChangeChecked($event, contract)"
        ></codx-input>
        <codx-label
          fiedName="isMailTitle"
          [formName]="'DPProcesses'"
          [gridViewName]="'grvDPProcesses'"
          [setRequire]="false"
          [default]="'Mail'"
        ></codx-label>
      </div>
      <div class="ms-1 d-flex align-items-end">
        <span
          class="icon-18 icon-email cursor-pointer"
          [ngbTooltip]="'Thiết lập Mail'"
          (click)="handelMailContract()"
        ></span>
      </div>
    </div> -->
    <!-- <div class="row">
      <div class="col-6">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="isMail"
          [formModel]="formModel"
          [setRequire]="false"
          default="Gởi mail"
        >
        </codx-label>
        <span *ngIf="contract?.isMail">Có</span>
        <span *ngIf="!contract?.isMail">Không</span>
      </div>
      <div class="col-6">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="isAlert"
          [formModel]="formModel"
          [setRequire]="false"
          default="Thông báo"
        >
        </codx-label>
        <span *ngIf="contract?.isAlert">Có</span>
        <span *ngIf="!contract?.isAlert">Không</span>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="expirationAlertTime"
          [formModel]="formModel"
          [setRequire]="false"
          default="Thời gian thông báo (ngày)"
        >
        </codx-label>
        <span>{{ contract?.expirationAlertTime }}</span>
      </div>
      <div class="col-6">
        <div class="d-flex align-items-center">
          <codx-label
            class="label-colon text-gray-600 codx-textlabel"
            fiedName="emailTemplate"
            [formModel]="formModel"
            [setRequire]="false"
            default="Thiết lập mail"
          ></codx-label>
          <span
            class="icon-18 icon-email cursor-pointer"
            [ngbTooltip]="'Thiết lập Mail'"
            (click)="handelMailContract()"
          ></span>
        </div>
      </div>
    </div> -->
    <!-- End thông báo -->
  </div>

  <div class="mt-2">
    <codx-label
      class="fs-5-sm fw-bold"
      name="lblNote"
      [formModel]="formModel"
      [setRequire]="false"
      default="Ghi chú"
    >
    </codx-label>
    <div class="row my-1">
      <span
        class="text-gray-600"
        [innerHTML]="contract?.note | formatvalue : formModel : 'Note' | async"
      ></span>
    </div>
  </div>

  <div class="mt-2" *ngIf="isHaveField">
    <codx-label
      class="fs-5-sm fw-bold"
      name="lblExpanded"
      [formModel]="formModel"
      [setRequire]="false"
      default="Thông tin mở rộng"
    ></codx-label>
    <div class="d-flex flex-column">
      <ng-container *ngFor="let item of listInsStep">
        <codx-fields-detail-temp
          *ngIf="item?.fields?.length > 0"
          [dataStep]="item"
          [showColumnControl]="showColumnControl(item.stepID)"
          [isUpdate]="['1', '2', '15',].includes(contract.status) && !contract.closed && contract?.approveStatus != '3'"
          [objectIdParent]="contract.recID"
          [customerID]="contract.customerID"
          (saveDataStep)="saveDataStep($event)"
        >
        </codx-fields-detail-temp>
      </ng-container>
    </div>
  </div>
</ng-template>
<!-- công việc -->
<ng-template #task let-data="value">
  <step-task
    [entityName]="'CM_Contracts'"
    [listInstanceStep]="listInsStep"
    [dataCM]="contract"
    [applyFor]="'4'"
    (saveAssignTask)="saveAssign($event)"
    (changeProgress)="autoStart($event)"
    (isSusscess)="checkSusscess($event)"
    [taskAdd]="taskAdd"
    (moveStage)="handelMoveStage($event)"
    [isAdmin]="contract?.isAdminAll"
    [isViewStep]="!(['1', '2', '15',].includes(contract?.status) && !contract?.closed && contract?.approveStatus != '3')"
  ></step-task>
  <!-- [taskAdd]="dataTaskAdd" -->
</ng-template>
<!-- Ghi chú -->
<ng-template #memo let-data="value">
  <div class="mt-2">
    <codx-tree-comment
      [objectID]="contract.recID"
      [objectType]="formModel?.entityName"
      [actionType]="'C'"
      [addNew]="true"
      [funcID]="formModel?.funcID"
      (totalCommentChange)="changeCountFooter($event, 'comment')"
    >
    </codx-tree-comment>
  </div>
</ng-template>
<!-- thanh lý -->
<ng-template #disposal let-data="value">
  <div class="appendix">
    <div *ngIf="contract?.disposalID" class="mt-3">
      <div class="row mb-2">
        <div class="col-6 d-flex align-items-center">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalID"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.disposalID
                | formatvalue : formModel : 'DisposalID'
                | async
            "
          ></span>
        </div>
        <div class="col-6 d-flex align-items-center">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalOn"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.disposalOn
                | formatvalue : formModel : 'DisposalOn'
                | async
            "
          ></span>
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-6 d-flex align-items-center">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="effectiveTo"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.effectiveTo
                | formatvalue : formModel : 'EffectiveTo'
                | async
            "
          ></span>
        </div>
        <div class="col-6 d-flex align-items-center">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="debtClosingOn"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.debtClosingOn
                | formatvalue : formModel : 'DebtClosingOn'
                | async
            "
          ></span>
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-6 d-flex align-items-center">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalType"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.disposalType
                | formatvalue : formModel : 'DisposalType'
                | async
            "
          ></span>
        </div>
        <div class="col-6 d-flex align-items-center">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalReason"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.disposalReason
                | formatvalue : formModel : 'DisposalReason'
                | async
            "
          ></span>
        </div>
      </div>

      <div class="row mb-2">
        <div class="d-flex col-6">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="pmtMethodID"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.pmtMethodID
                | formatvalue : formModel : 'PmtMethodID'
                | async
            "
          ></span>
        </div>
        <div class="d-flex col-6">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalExpired"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.disposalExpired
                | formatvalue : formModel : 'DisposalExpired'
                | async
            "
          ></span>
        </div>
      </div>

      <div class="row mb-2">
        <div class="d-flex">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalCmt"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
          </div>
          <span
            class="text-dark fw-bold codx-textcontent"
            [innerHTML]="
              contract?.disposalCmt
                | formatvalue : formModel : 'DisposalCmt'
                | async
            "
          ></span>
        </div>
      </div>

      <div class="row mb-2">
        <div class="d-flex col-6">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalNewAddress"
              [formModel]="formModel"
              [setRequire]="false"
              default="Liên hệ/ địa chỉ mới"
            >
            </codx-label>
          </div>
          <span> {{ contract?.disposalNewAddress }}</span>
        </div>
        <div class="d-flex col-6">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalNewContac"
              [formModel]="formModel"
              [setRequire]="false"
              default="Tên người liên hệ"
            >
            </codx-label>
          </div>
          <span> {{ contract?.disposalNewContact }}</span>
        </div>
      </div>

      <div class="row mb-2">
        <div class="d-flex col-6">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalEmail"
              [formModel]="formModel"
              [setRequire]="false"
              default="Email"
            >
            </codx-label>
          </div>
          <span> {{ contract?.disposalEmail }}</span>
        </div>
        <div class="d-flex col-6">
          <div class="w-150px min-w-150px">
            <codx-label
              class="label-colon text-gray-600 codx-textlabel"
              fiedName="disposalPhone"
              [formModel]="formModel"
              [setRequire]="false"
              default="Điện thoại"
            >
            </codx-label>
          </div>
          <span> {{ contract?.disposalPhone }}</span>
        </div>
      </div>
    </div>
    <div *ngIf="!contract?.disposalID" class="center">
      <codx-no-data></codx-no-data>
    </div>
  </div>
</ng-template>
<!-- phụ lục -->
<ng-template #appendix>
  <div class="appendix">
    <div *ngIf="listContractInParentID?.length > 0" class="mt-3">
      <div
        *ngFor="let contract of listContractInParentID"
        class="p-2 link-container"
        (dblclick)="linkData('contract', contract?.recID)"
      >
        <div class="d-flex align-items-center">
          <span class="me-2 icon-18 icon-sticky_note_2"></span>
          <span
            class="fw-bold fs-5-sm"
            [innerHTML]="
              contract?.useType | formatvalue : formModel : 'UseType' | async
            "
          ></span>
        </div>
        <div class="ms-5">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <span [ngbTooltip]="contractNameTmp" class="fs-5-sm">{{
                contract?.contractName
              }}</span>
              <span class="mx-2">-</span>
              <span [ngbTooltip]="contractIDTmp">{{
                contract?.contractID
              }}</span>
              <ng-template #contractIDTmp>
                <codx-label
                  class="text-gray-600"
                  fiedName="contractID"
                  [formModel]="formModel"
                  [setRequire]="false"
                ></codx-label>
              </ng-template>
              <ng-template #contractNameTmp>
                <codx-label
                  class="text-gray-600"
                  fiedName="contractName"
                  [formModel]="formModel"
                  [setRequire]="false"
                ></codx-label>
              </ng-template>
            </div>

            <div class="d-flex justify-content-end align-items-center mb-2">
              <span
                class="icon-monetization_on icon-18 me-1 text-warning"
              ></span>
              <span
                class="fs-5-sm"
                [innerHTML]="
                  contract?.contractAmt
                    | formatvalue : formModel : 'ContractAmt'
                    | async
                "
              ></span>
              <span
                class="fs-5-sm ms-1"
                [innerHTML]="
                  contract?.currencyID
                    | formatvalue : formModel : 'CurrencyID'
                    | async
                "
              ></span>
            </div>
          </div>
          <div class="d-flex align-items-center">
            <codx-vll
              [name]="vllStatus"
              [field]="'Status'"
              [value]="contract?.status"
              [showText]="true"
              [showBgColor]="true"
              class="me-0 badge badge-primary badge-sm"
            >
            </codx-vll>
            <div class="d-flex align-items-center ms-2">
              <span class="icon-16 icon-av_timer me-1 text-gray-700"></span>
              <span
                class="fs-6-sm"
                [innerHTML]="
                  contract?.effectiveFrom
                    | formatvalue : formModel : 'EffectiveFrom'
                    | async
                "
              ></span>
              <span class="mx-1">-</span>
              <span
                class="fs-6-sm"
                [innerHTML]="
                  contract?.effectiveTo
                    | formatvalue : formModel : 'EffectiveTo'
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="!listContractInParentID || listContractInParentID?.length <= 0"
      class="center"
    >
      <codx-no-data [mould]="2" [isLoading]="isLoadingContract"></codx-no-data>
    </div>
  </div>
</ng-template>

<!-- Liên kết -->
<ng-template #contractLinkTem>
  <div>
    <div
      *ngIf="contractLink"
      class="p-2 link-container"
      (dblclick)="linkData('contract', contractLink?.recID)"
    >
      <div class="d-flex align-items-center">
        <img width="17px" src="/assets/themes/cm/default/img/CM0204.svg" />
        <codx-label
          class="label-colon fs-5-sm fw-bold ms-2"
          name="lblContractLink"
          [formModel]="formModel"
          [default]="'Hợp đồng liên kết'"
        >
        </codx-label>
      </div>
      <div class="ms-7">
        <div class="d-flex justify-content-between">
          <div>
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="contractName"
              [formModel]="formModel"
              [setRequire]="false"
            ></codx-label>
            <span class="fs-5-sm ms-1">{{ contractLink?.contractName }}</span>
          </div>
          <codx-vll
            [name]="vllStatus"
            [field]="'Status'"
            [value]="contractLink?.status"
            [showText]="true"
            [showBgColor]="true"
            class="me-0 badge badge-primary badge-sm"
          >
          </codx-vll>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
          <div class="d-flex align-items-center">
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="contractID"
              [formModel]="formModel"
              [setRequire]="false"
            ></codx-label>
            <span class="fs-5-sm ms-1">{{ contractLink?.contractID }}</span>
          </div>
          <div [ngbTooltip]="tooltipDate" class="d-flex align-items-center">
            <span class="icon-date_range icon-16 me-1"></span>
            <span
              class="text-gray-600"
              [innerHTML]="
                contractLink?.contractDate
                  | formatvalue : formModel : 'ContractDate'
                  | async
              "
            >
              <ng-template #tooltipDate>
                <codx-label
                  fiedName="contractDate"
                  [formModel]="formModel"
                  [setRequire]="false"
                ></codx-label>
              </ng-template>
            </span>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-2">
          <div class="d-flex align-items-center">
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="contractAmt"
              [formModel]="formModel"
              [setRequire]="false"
            >
            </codx-label>
            <div class="d-flex align-items-center fs-5-sm">
              <span
                [innerHTML]="
                  contractLink?.contractAmt
                    | formatvalue : formModel : 'ContractAmt'
                    | async
                "
              ></span>
              <span
                class="ms-1"
                [innerHTML]="
                  contractLink?.currencyID
                    | formatvalue : formModel : 'CurrencyID'
                    | async
                "
              ></span>
            </div>
          </div>

          <div
            class="d-flex align-items-center fs-5-sm"
            [ngbTooltip]="tooltipOwner"
          >
            <codx-imgs
              class="me-3 d-flex align-items-center"
              [width]="25"
              ojectType="AD_Users"
              [numberImages]="1"
              [isToolTip]="true"
              [objectId]="contractLink?.owner"
            ></codx-imgs>
            <span
              class="text-dark fw-bold codx-textcontent"
              [innerHTML]="
                contractLink?.owner | formatvalue : formModel : 'Owner' | async
              "
            ></span>
            <ng-template #tooltipOwner>
              <codx-label
                fiedName="owner"
                [formModel]="formModel"
                [setRequire]="false"
              ></codx-label>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="deal"
      class="p-2 link-container"
      (dblclick)="linkData('deal', deal?.recID)"
    >
      <div class="d-flex align-items-center">
        <img width="17px" src="/assets/themes/cm/default/img/CM0201.svg" />
        <codx-label
          class="label-colon fs-5-sm fw-bold ms-2"
          fiedName="dealID"
          [formModel]="formModel"
        >
        </codx-label>
      </div>
      <div class="ms-7">
        <div class="d-flex justify-content-between">
          <div>
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="dealName"
              [formModel]="fmDeals"
              [setRequire]="false"
            ></codx-label>
            <span class="fs-5-sm ms-1">{{ deal?.dealName }}</span>
          </div>
          <codx-vll
            [name]="vllStatus"
            [field]="'Status'"
            [value]="deal?.status"
            [showText]="true"
            [showBgColor]="true"
            class="me-0 badge badge-primary badge-sm"
          >
          </codx-vll>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
          <div class="d-flex align-items-center">
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="dealID"
              [formModel]="fmDeals"
              [setRequire]="false"
            ></codx-label>
            <span class="fs-5-sm ms-1">{{ deal?.dealID }}</span>
          </div>
          <div [ngbTooltip]="tooltipDate" class="d-flex align-items-center">
            <span class="icon-date_range icon-16 me-1"></span>
            <span
              class="text-gray-600"
              [innerHTML]="
                deal?.createdOn | formatvalue : fmDeals : 'CreatedOn' | async
              "
            >
              <ng-template #tooltipDate>
                <codx-label
                  fiedName="createdOn"
                  [formModel]="fmDeals"
                  [setRequire]="false"
                ></codx-label>
              </ng-template>
            </span>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-2">
          <div class="d-flex align-items-center">
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="dealValue"
              [formModel]="fmDeals"
              [setRequire]="false"
            >
            </codx-label>
            <div class="d-flex align-items-center fs-5-sm">
              <span
                [innerHTML]="
                  deal?.dealValue | formatvalue : fmDeals : 'DealValue' | async
                "
              ></span>
              <span
                class="ms-1"
                [innerHTML]="
                  deal?.currencyID
                    | formatvalue : fmDeals : 'CurrencyID'
                    | async
                "
              ></span>
            </div>
          </div>

          <div
            class="d-flex align-items-center fs-5-sm"
            [ngbTooltip]="tooltipOwner"
          >
            <codx-imgs
              class="me-3 d-flex align-items-center"
              [width]="25"
              ojectType="AD_Users"
              [numberImages]="1"
              [isToolTip]="true"
              [objectId]="deal?.owner"
            ></codx-imgs>
            <span
              class="text-dark fw-bold codx-textcontent"
              [innerHTML]="
                deal?.owner | formatvalue : fmDeals : 'Owner' | async
              "
            ></span>
            <ng-template #tooltipOwner>
              <codx-label
                fiedName="owner"
                [formModel]="fmDeals"
                [setRequire]="false"
              ></codx-label>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="quotation"
      class="p-2 link-container"
      (dblclick)="linkData('quotation', quotation?.recID)"
    >
      <div class="d-flex align-items-center">
        <img width="17px" src="/assets/themes/cm/default/img/CM0202.svg" />
        <codx-label
          class="label-colon fs-5-sm fw-bold ms-2"
          fiedName="quotationID"
          [formModel]="formModel"
        >
        </codx-label>
      </div>
      <div class="ms-7">
        <div class="d-flex justify-content-between">
          <div>
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="quotationName"
              [formModel]="fmQuotations"
              [setRequire]="false"
            ></codx-label>
            <span class="fs-5-sm ms-1">{{ quotation?.quotationName }}</span>
          </div>
          <codx-vll
            [name]="'CRM012'"
            [field]="'Status'"
            [value]="quotation?.status"
            [showText]="true"
            [showBgColor]="true"
            class="me-0 badge badge-primary badge-sm"
          >
          </codx-vll>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
          <div class="d-flex align-items-center">
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="quotationID"
              [formModel]="fmQuotations"
              [setRequire]="false"
            ></codx-label>
            <span class="fs-5-sm ms-1">{{ quotation?.quotationID }}</span>
          </div>
          <div [ngbTooltip]="tooltipDate" class="d-flex align-items-center">
            <span class="icon-date_range icon-16 me-1"></span>
            <span
              class="text-gray-600"
              [innerHTML]="
                quotation?.createdOn
                  | formatvalue : fmQuotations : 'CreatedOn'
                  | async
              "
            >
              <ng-template #tooltipDate>
                <codx-label
                  fiedName="createdOn"
                  [formModel]="fmQuotations"
                  [setRequire]="false"
                ></codx-label>
              </ng-template>
            </span>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-2">
          <div class="d-flex align-items-center">
            <codx-label
              class="label-colon fs-5-sm"
              fiedName="totalAmt"
              [formModel]="fmQuotations"
              [setRequire]="false"
            >
            </codx-label>
            <div class="d-flex align-items-center fs-5-sm">
              <span
                [innerHTML]="
                  quotation?.totalAmt
                    | formatvalue : fmQuotations : 'TotalAmt'
                    | async
                "
              ></span>
              <span
                class="ms-1"
                [innerHTML]="
                  quotation?.currencyID
                    | formatvalue : fmQuotations : 'CurrencyID'
                    | async
                "
              ></span>
            </div>
          </div>

          <div
            class="d-flex align-items-center fs-5-sm"
            [ngbTooltip]="tooltipOwner"
          >
            <codx-imgs
              class="me-3 d-flex align-items-center"
              [width]="25"
              ojectType="AD_Users"
              [numberImages]="1"
              [isToolTip]="true"
              [objectId]="quotation?.createdBy"
            ></codx-imgs>
            <span
              class="text-dark fw-bold codx-textcontent"
              [innerHTML]="
                quotation?.createdBy
                  | formatvalue : fmQuotations : 'CreatedBy'
                  | async
              "
            ></span>
            <ng-template #tooltipOwner>
              <codx-label
                fiedName="createdBy"
                [formModel]="fmQuotations"
                [setRequire]="false"
              ></codx-label>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!quotation && !deal && !contractLink">
      <codx-no-data></codx-no-data>
    </div>
  </div>
</ng-template>
<ng-template #notificationTemp let-data>
  <div class="liquidation p-5">
    <div class="header-liquidation w-100">
      <div class="d-flex justify-content-between w-100">
        <span class="fs-5 fw-bold">Thiết lâp thông báo</span>
        <button
          class="button-close d-flex"
          style="border: none; outline: none; background: none"
          (click)="notificationPopup.close()"
        >
          <i class="icon-close icon-18 text-hover-danger p-1"></i>
        </button>
      </div>
    </div>

    <div class="main-liquidation pt-3">
      <div class="form-group">
        <div class="d-flex align-items-center">
          <codx-label
            class="label-colon text-gray-600 codx-textlabel"
            fiedName="emailTemplate"
            [formModel]="formModel"
            [setRequire]="false"
            default="Thiết lập mail"
          ></codx-label>
          <span
            class="icon-18 icon-email cursor-pointer"
            [ngbTooltip]="'Thiết lập Mail'"
            (click)="handelMailContract()"
          ></span>
        </div>
      </div>
      <div class="form-group">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="isMail"
          [formModel]="formModel"
          [setRequire]="false"
          default="Gởi mail"
        >
        </codx-label>
        <span *ngIf="contract?.isMail">Có</span>
        <span *ngIf="!contract?.isMail">Không</span>
      </div>

      <div class="form-group">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="isAlert"
          [formModel]="formModel"
          [setRequire]="false"
          default="Thông báo"
        >
        </codx-label>
        <span *ngIf="contract?.isAlert">Có</span>
        <span *ngIf="!contract?.isAlert">Không</span>
      </div>

      <div class="form-group">
        <codx-label
          class="label-colon text-gray-600 codx-textlabel"
          fiedName="expirationAlertTime"
          [formModel]="formModel"
          [setRequire]="false"
          default="Thời gian thông báo (ngày)"
        >
        </codx-label>
        <span>{{ contract?.expirationAlertTime }}</span>
      </div>
      <!-- End thông báo -->
    </div>
    <div class="footer-liquidation w-100 d-flex justify-content-end"></div>
  </div>
</ng-template>
