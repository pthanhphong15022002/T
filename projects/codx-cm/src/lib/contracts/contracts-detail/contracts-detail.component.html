<codx-views
  #view
  [service]="service"
  [assemblyName]="assemblyName"
  [entityName]="entityName"
  [className]="className"
  [method]="methodLoadData"
  idField="recID"
  [funcID]="'CM0204'"
  [views]="views"
  [button]="button"
  (buttonClick)="click($event)"
  [toolbarDisplay]="true"
  [selectedFirst]="true"
  [autoLoad]="true"
  [autoSearch]="true"
  (selectedChange)="selectedChange($event)"
></codx-views>
<!-- temp left -->
<ng-template #itemTemplate let-data>
  <codx-temp-full
    cardCss="card-template border-bottom p-3 list-task"
    (clickMF)="clickMF($event, data)"
    [moreFuncCss]="'me-15'"
    (changeDataMF)="changeDataMF($event, data)"
    [typeMF]="'hover'"
    [title]="data.contractName"
    [descTmp]="descTmp"
    [formModel]="view.formModel"
    [titleCss]="'fw-bold fs-6 mb-1'"
    [dataItem]="data"
    [footer]="footerTmp"
  >
  </codx-temp-full>
</ng-template>

<ng-template #descTmp let-data>
  <div class="d-flex align-items-top mb-1">
    <span class="icon-business icon-16 me-2"></span>
    <span class="text-gray-700">{{
      data?.companyName || "Cty cổ phần tin học lạc việt"
    }}</span>
  </div>
</ng-template>

<ng-template #footerTmp let-data>
  <div class="d-flex justify-content-between align-items-center mb-1">
    <div>
      <codx-label
        class="label-colon"
        fiedName="contractType"
        [formModel]="view.formModel"
        [setRequire]="false"
      >
      </codx-label>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.contractType
            | formatvalue : view.formModel : 'ContractType'
            | async
        "
      ></span>
    </div>
    <div class="d-flex justify-content-end align-items-center">
      <span class="icon-monetization_on icon-16 me-2 text-warning"></span>
      <span class="fs-6 fw-bold">25.000.000</span>
    </div>
  </div>
  <div class="d-flex justify-content-between align-items-center">
    <div>

      <codx-vll
        [name]="vllStatus"
        [field]="'Status'"
        [value]="data?.status"
        [showText]="true"
        [showBgColor]="true"
        class="badge badge-light badge-md fs-7"
      >
      </codx-vll>
    </div>
    <div class="d-flex justify-content-end align-items-center">
      <span class="icon-16 icon-av_timer me-1"></span>
      <span>{{ data.createdOn | date : "dd/MM/yyyy" }}</span>
    </div>
    <div>
      <codx-imgs
        [width]="25"
        [objectId]="data.createdBy"
        ojectType="AD_Users"
        [numberImages]="1"
      >
      </codx-imgs>
    </div>
  </div>
</ng-template>

<!-- temp right -->
<ng-template #templateDetail>
  <codx-detail-tmp
    [header]="headerRightTemp"
    [formModel]="view.formModel"
    [body]="mainRightTemp"
    [footer]="footerRightTemp"
    (clickMF)="clickMF($event, itemSelected)"
    (changeDataMF)="changeDataMF($event, itemSelected)"
    [dataItem]="itemSelected"
  ></codx-detail-tmp>
</ng-template>

<ng-template #headerRightTemp>
  <div class="d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center fs-5 fw-bold">
      <span>{{ itemSelected?.contractName }}</span>
      <span> - </span>
      <span>{{ itemSelected?.contractID }}</span>
    </div>
    <div>
      <codx-vll
        [name]="vllStatus"
        [field]="'Status'"
        [value]="itemSelected?.status"
        [showText]="true"
        [showBgColor]="true"
        class="badge badge-light badge-md fs-7"
      >
      </codx-vll>
    </div>
  </div>
  <div class="d-flex align-items-center justify-content-between fs-6 mb-5">
    <div>
      <codx-label
        class="label-colon"
        fiedName="contractDate"
        [formModel]="view.formModel"
      ></codx-label>
      <span
        class="me-3"
        [innerHTML]="
          itemSelected?.contractDate
            | formatvalue : view.formModel : 'ContractDate'
            | async
        "
      ></span>
    </div>
    <div>
      <codx-label
        class="label-colon"
        fiedName="effectiveFrom"
        [formModel]="view.formModel"
      ></codx-label>
      <span
        class="me-3"
        [innerHTML]="
          itemSelected?.effectiveFrom
            | formatvalue : view.formModel : 'EffectiveFrom'
            | async
        "
      ></span>
    </div>
    <div>
      <codx-label
        class="label-colon"
        fiedName="effectiveTo"
        [formModel]="view.formModel"
      ></codx-label>
      <span
        class="me-3"
        [innerHTML]="
          itemSelected?.effectiveTo
            | formatvalue : view.formModel : 'EffectiveTo'
            | async
        "
      ></span>
    </div>
    <div>
      <codx-label
        class="label-colon"
        fiedName="extendOn"
        [formModel]="view.formModel"
      ></codx-label>
      <span
        class="me-3"
        [innerHTML]="
          itemSelected?.extendOn
            | formatvalue : view.formModel : 'ExtendOn'
            | async
        "
      ></span>
    </div>
    <div>
      <codx-imgs
        [width]="25"
        [objectId]="itemSelected.createdBy"
        ojectType="AD_Users"
        [numberImages]="1"
      >
      </codx-imgs>
    </div>
  </div>
  <div class="row fs-6">
    <div class="col-6">
      <codx-label
        class="label-colon"
        fiedName="dealID"
        [formModel]="view.formModel"
      ></codx-label>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.dealID | formatvalue : view.formModel : 'DealID' | async
        "
      ></span>
    </div>
    <div class="col-6 d-flex align-items-center">
      <div class="me-5">
        <codx-label
          class="label-colon"
          fiedName="currencyID"
          [formModel]="view.formModel"
        >
        </codx-label>
        <span
          class="fs-7"
          [innerHTML]="
            itemSelected?.currencyID
              | formatvalue : view.formModel : 'CurrencyID'
              | async
          "
        >
        </span>
      </div>
      <div>
        <codx-label
          class="label-colon"
          fiedName="exchangeRate"
          [formModel]="view.formModel"
        >
        </codx-label>
        <span
          class="fs-7"
          [innerHTML]="
            itemSelected?.exchangeRate
              | formatvalue : view.formModel : 'ExchangeRate'
              | async
          "
        >
        </span>
      </div>
    </div>
  </div>
  <div class="row fs-6">
    <div class="col-6">
      <codx-label
        class="label-colon"
        fiedName="quotationID"
        [formModel]="view.formModel"
      >
      </codx-label>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.quotationID
            | formatvalue : view.formModel : 'QuotationID'
            | async
        "
      >
      </span>
    </div>
    <!-- Hợp đồng sử dụng -->
    <div class="col-6">
      <codx-label
        class="label-colon"
        fiedName="useType"
        [formModel]="view.formModel"
        [setRequire]="false"
      >
      </codx-label>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.useType
            | formatvalue : view.formModel : 'UseType'
            | async
        "
      >
      </span>
    </div>
  </div>
  <div class="row fs-6">
    <div class="col-6">
      <codx-label
        class="label-colon"
        fiedName="orderID"
        [formModel]="view.formModel"
        [setRequire]="false"
      >
      </codx-label>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.orderID
            | formatvalue : view.formModel : 'OrderID'
            | async
        "
      ></span>
    </div>
    <!-- Loại hợp đồng -->
    <div class="col-6">
      <codx-label
        class="label-colon"
        fiedName="contractType"
        [formModel]="view.formModel"
        [setRequire]="false"
      >
      </codx-label>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.contractType
            | formatvalue : view.formModel : 'ContractType'
            | async
        "
      ></span>
    </div>
  </div>
</ng-template>

<ng-template #mainRightTemp>
  <codx-taskbar
    [listTab]="listClicked"
    (tab)="changeTab($event)"
    size="20"
    class="mt-5"
  ></codx-taskbar>
  <hr class="mt-0" />
  <div>
    <container-element [ngSwitch]="tabClicked">
      <some-element
        *ngSwitchCase="'general'"
        [ngTemplateOutlet]="generalTemplate"
      ></some-element>
      <some-element
        *ngSwitchCase="'detailItem'"
        [ngTemplateOutlet]="itemsTemplate"
      ></some-element>
      <some-element
        *ngSwitchCase="'pay'"
        [ngTemplateOutlet]="payTemplate"
      ></some-element>
      <some-element
        *ngSwitchCase="'termsAndRelated'"
        [ngTemplateOutlet]="termsAndRelatedTemplate"
      ></some-element>
      <some-element *ngSwitchDefault></some-element>
    </container-element>
  </div>
</ng-template>

<ng-template #footerRightTemp>
  <codx-tabs
    [entityName]="view.formModel.entityName"
    [formModel]="view.formModel"
    [TabControl]="tabControl"
    [objectID]="itemSelected.recID"
    [funcID]="view.formModel.funcID"
  ></codx-tabs>
</ng-template>

<ng-template #contract let-data>
  <list-contracts [projectID]="itemSelected?.recID"></list-contracts>
</ng-template>

<ng-template #generalTemplate>
  <div class="A mb-5">
    <div>
      <span class="fs-5 fw-bold">Bên A</span>
    </div>
    <ng-container
      [ngTemplateOutlet]="general"
      [ngTemplateOutletContext]="{ data: { value: account, type: 'A' } }"
    ></ng-container>
  </div>

  <div class="B mb-5">
    <div><span class="fs-5 fw-bold">Bên B</span></div>
    <ng-container
      [ngTemplateOutlet]="general"
      [ngTemplateOutletContext]="{ data: { value: itemSelected, type: 'B' } }"
    ></ng-container>
  </div>
</ng-template>
<ng-template #itemsTemplate>
  <view-quotations></view-quotations>
</ng-template>

<ng-template #payTemplate>
  <div>
    <div class="fs-6 fw-bold"><span>Tiến độ thanh toán</span></div>
    <div class="row">
      <div class="col-4">
        <span>Giá trị hợp đồng: </span>
        <span>{{ itemSelected?.contractAmt }}</span>
      </div>
      <div class="col-4">
        <span>Số tiền thanh toán: </span>
        <span>{{ itemSelected?.paidAmt }}</span>
      </div>
      <div class="col-4">
        <span>Số tiền còn lại: </span>
        <span>{{ itemSelected?.remainAmt }}</span>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <span>Giá trị hợp đồng: </span>
        <span>{{ itemSelected?.contractAmt }}</span>
      </div>
      <div class="col-8">
        <span>Tình trạng thanh toán: </span>
        <span>{{ itemSelected?.paymentStatus }}</span>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <span>Điều khoản thanh toán: </span>
        <span>{{ itemSelected?.pmtTermID }}</span>
      </div>
      <div class="col-8">
        <span>Phương thức thanh toán: </span>
        <span>{{ itemSelected?.pmtMethodID }}</span>
      </div>
    </div>
  </div>

  <div>
    <div class="fs-6 fw-bold"><span>Lịch thanh toán</span></div>
    <!-- <product></product> -->
    <table class="table table-striped">
      <thead>
        <tr class="fw-bold">
          <th>STT</th>
          <th>Ngày thanh toán</th>
          <th>Số tiền thanh toán</th>
          <th>Trạng thái</th>
          <th>Đã thanh toán</th>
          <th>Dư nợ còn lại</th>
          <th>Ghi chú</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let paymemnt of listPayment">
          <td>{{ paymemnt?.rowNo }}</td>
          <td>{{ paymemnt?.scheduleDate | date : "dd/MM/yyyy" }}</td>
          <td>{{ paymemnt?.scheduleAmt }}</td>
          <td>{{ paymemnt?.status }}</td>
          <td>{{ paymemnt?.remainAmt }}</td>
          <td>{{ paymemnt?.remainAmt }}</td>
          <td>{{ paymemnt?.memo }}</td>
        </tr>
      </tbody>
    </table>
    <div class="d-flex align-items-center">
      <div class="content-icon">
        <span class="icon-add text-primary"></span>
      </div>
      <button
        style="height: 28px"
        type="button"
        class="btn btn-outline-primary btn-sm"
        (click)="addPay()"
      >
        <codx-label
          [formModel]
          fiedName
          default="Thêm lịch thanh toán"
        ></codx-label>
      </button>
    </div>
  </div>

  <div>
    <div class="fs-6 fw-bold"><span>Tiến giao hàng</span></div>
    <div class="row">
      <div class="col-4">
        <span>Điều khoản giao hàng: </span>
      </div>
      <div class="col-4">
        <span>Hình thức giao hàng: </span>
      </div>
      <div class="col-4">
        <span>Phí vận chuyển: </span>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <span>Hạn giao hàng: </span>
      </div>
      <div class="col-4">
        <span>Tình trạng giao hàng: </span>
      </div>
      <div class="col-4">
        <span>Ngày giao hàng thành công: </span>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <span>Liên hệ giao hàng: </span>
      </div>
      <div class="col-8">
        <span>Số diện thoại: </span>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <span>Địa chỉ giao hàng: </span>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #termsAndRelatedTemplate let-data="data">
  <div [innerHTML]="itemSelected?.note"></div>
</ng-template>

<ng-template #general let-data="data">
  <div class="row fs-6 my-2">
    <div class="col-6">
      <codx-label
      class="label-colon"
      fiedName="exchangeRate"
      [formModel]="view.formModel"
    >
    </codx-label>
      <span>Tên công ty: </span>
      <span>{{
        data?.type == "A" ? data?.value?.legalName : data?.value?.companyName
      }}</span>
    </div>
    <div class="col-5">
      <span>Mã số thuế: </span>
      <span>{{
        data?.type == "A" ? data?.value?.taxCode : data?.value?.taxCode
      }}</span>
    </div>
  </div>
  <div class="row fs-6 my-2">
    <div class="col-12">
      <span>Địa chỉ: </span>
      <span>{{
        data?.type == "A" ? data?.value?.street : data?.value?.address
      }}</span>
    </div>
  </div>
  <div class="row fs-6 my-2">
    <div class="col-12">
      <span>Điện thoại: </span>
      <span>{{
        data?.type == "A" ? data?.value?.phone : data?.value?.phone
      }}</span>
    </div>
  </div>
  <div class="row fs-6 my-2">
    <div class="col-6">
      <span>Người đại diện: </span>
      <span>{{
        data?.type == "A"
          ? data?.value?.contactName
          : data?.value?.representative
      }}</span>
    </div>
    <div class="col-6">
      <span>Chức vụ: </span>
      <span>{{
        data?.type == "A" ? data?.value?.jobTitle : data?.value?.jobTitle
      }}</span>
    </div>
  </div>
  <div class="row fs-6 my-2">
    <div class="col-6">
      <span>Tài khoản ngân hàng: </span>
      <span>{{
        data?.type == "A" ? data?.value?.bankAccount : data?.value?.bankAccount
      }}</span>
    </div>
    <div class="col-6">
      <span>Ngân hàng: </span>
      <span>{{
        data?.type == "A" ? data?.value?.bankID : data?.value?.bankID
      }}</span>
    </div>
  </div>
</ng-template>
