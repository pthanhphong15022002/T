<codx-form
  #form
  [headerText]="title"
  [body]="body"
  [footer]="footer"
  [data]="data"
  [formModel]="dialog.formModel"
  [dialog]="dialog"
>
  <ng-template #body>
    <div class="form-group">
      <div class="d-flex justify-content-between">
        <div class="d-flex align-items-center flex-row">
          <codx-img
            [objectId]="data?.salespersonID"
            imageType="circle"
            width="30"
            [objectType]="'AD_Users'"
            [objectName]="data?.title"
          ></codx-img>
          <div [ngClass]="'ms-4 d-flex flex-column'">
            <span class="text-dark fw-bold">
              {{ data?.title }}
            </span>
            <div class="">
              {{ data?.positionName }}
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end" style="padding-right: 16px;">
          <span
            class="fw-bold"
            [innerHTML]="
              data?.target
                | formatvalue : form.formModel : 'Target'
                | async
            "
          ></span>
        </div>
      </div>
    </div>
    <ng-container>
      <div class="form-group">
        <div class="text-primary">
          <codx-label
            class="fw-bold fs-6"
            name="lblSalesperson"
            [formModel]="form.formModel"
            default="Phân công nhân viên bán hàng"
          >
          </codx-label>
        </div>
      </div>
      <ng-container>
        <div class="table-container px-3">
          <table>
            <thead>
              <tr>
                <th class="fixed-width-column-user" style="z-index: 100"></th>
                <th class="" style="width: 70px">
                  <codx-label
                    class="fw-bold d-flex justify-content-end"
                    name="lblWeight"
                    [formModel]="dialog.formModel"
                    default="Trọng số"
                  ></codx-label>
                </th>
                <th style="width: 50px"></th>
                <th class="fixed-width-column">
                  <codx-label
                    class="fw-bold d-flex justify-content-end"
                    fiedName="Target"
                    formName="CMTargetsLines"
                    gridViewName="grvCMTargetsLines"
                  ></codx-label>
                </th>
              </tr>
            </thead>
            <tbody *ngIf="lstMonths != null && lstMonths.length > 0">
              <tr *ngFor="let item of lstMonths">
                <td class="fixed-width-column-user">
                  <span class="fw-bold">
                    {{ item?.text }}
                  </span>
                </td>
                <td class="" style="width: 70px">
                  <div
                    [ngClass]="
                      item?.lineID == this.editingItem &&
                      typeChange === 'weight'
                        ? 'user-nav-active'
                        : null
                    "
                    *ngIf="
                      editingItem !== item?.lineID || typeChange !== 'weight'
                    "
                    (click)="dbClick(item?.lineID, 'weight')"
                    class="d-flex justify-content-end user-nav-item"
                  >
                    <span class="me-1" [innerHTML]="formatNumberWithoutTrailingZeros(item?.weight)"></span>
                    %
                  </div>
                  <div
                    [ngClass]="
                      item?.lineID == this.editingItem &&
                      typeChange === 'weight'
                        ? 'user-nav-active'
                        : null
                    "
                    class="user-nav-item d-flex"
                    *ngIf="
                      item?.lineID == this.editingItem &&
                      typeChange === 'weight'
                    "
                  >
                    <input
                      type="number"
                      #lblWeight
                      name="lblWeight"
                      [min]="0"
                      [max]="100"
                      matInput
                      autofocus
                      [value]="item?.weight.toFixed(2)"
                      (blur)="
                        updateTarget(lblWeight.value, item?.lineID, 'weight')
                      "
                      (keydown.enter)="
                        updateTarget(lblWeight.value, item?.lineID, 'weight')
                      "
                      class="no-border text-gray-600 no-spinner"
                      style="margin-left: 0px; width: 70px"
                    />
                  </div>
                </td>
                <td style="width: 50px">
                  <span
                    *ngIf="item?.isExit"
                    class="w-10 icon-warning text-danger icon-16"
                    [ngbTooltip]="TooltipEdit"
                  >
                    <ng-template #TooltipEdit>
                      <codx-label
                        default="Đã chỉnh sửa"
                        name="lblIsEdit"
                        [formModel]="dialog.formModel"
                      ></codx-label>
                    </ng-template>
                  </span>
                </td>
                <td class="fixed-width-column">
                  <div
                    [ngClass]="
                      item?.lineID == this.editingItem &&
                      typeChange === 'target'
                        ? 'user-nav-active'
                        : null
                    "
                    *ngIf="
                      editingItem !== item?.lineID || typeChange !== 'target'
                    "
                    (click)="dbClick(item?.lineID, 'target')"
                    class="d-flex justify-content-end user-nav-item"
                  >
                    <span class="" [innerHTML]="targetToFixed(item?.target)">
                    </span>
                  </div>
                  <div
                    [ngClass]="
                      item?.lineID == this.editingItem &&
                      typeChange === 'target'
                        ? 'user-nav-active'
                        : null
                    "
                    class="user-nav-item d-flex"
                    *ngIf="
                      item?.lineID == this.editingItem &&
                      typeChange === 'target'
                    "
                  >
                    <input
                      type="number"
                      #lblTarget
                      name="lblTarget"
                      [min]="0"
                      matInput
                      autofocus
                      [value]="item?.target"
                      (blur)="
                        updateTarget(lblTarget.value, item?.lineID, 'target')
                      "
                      (keydown.enter)="
                        updateTarget(lblTarget.value, item?.lineID, 'target')
                      "
                      class="no-border text-gray-600 no-spinner"
                      style="margin-left: 0px"
                    />
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="px-3">
          <table>
            <thead>
              <tr class="background" style="background-color: #a3a2a2">
                <th class="fixed-width-column-user" style="z-index: 100">
                  <codx-label
                    class="d-flex justify-content-center fw-bold"
                    name="lblSum"
                    [formModel]="dialog.formModel"
                    default="Tổng cộng"
                  ></codx-label>
                </th>
                <th class="" style="width: 70px">
                  <div class="d-flex justify-content-end">
                    <span class="fw-bold me-1" [innerHTML]="sumWeight()"></span>
                    %
                  </div>
                </th>
                <th style="width: 50px"></th>
                <th class="fixed-width-column">
                  <span
                    class="fw-bold d-flex justify-content-end"
                    [innerHTML]="sumTarget()"
                  ></span>
                </th>
              </tr>
            </thead>
          </table>
        </div>
        <div class="px-3 mt-5">
          <button
            type="button"
            class="btn btn-sm btn-outline-primary"
            (click)="clickRefered()"
          >
            <i class="icon-refresh text-primary icon-20 me-1"></i>
            <codx-label
              name="lblRefered"
              [formModel]="form.formModel"
              default="Khôi phục lại"
            ></codx-label>
          </button>
        </div>
      </ng-container>
    </ng-container>
  </ng-template>
  <ng-template #footer>
    <div class="d-flex justify-content-end">
      <button type="button" class="btn btn-primary" (click)="onSave()">
        <codx-label
          name="lblSave"
          [formModel]="dialog.formModel"
          default="Lưu"
        ></codx-label>
      </button>
    </div>
  </ng-template>
</codx-form>
