<ng-container *ngIf="dataSelected?.recID">
  <codx-detail-tmp
    class="leads-detail"
    style="height: 100%"
    [header]="header"
    [formModel]="formModel"
    [body]="body"
    [dataItem]="dataSelected"
    [hideMF]="true"
    [footer]="tabs"
    (changeDataMF)="changeDataMF($event, dataSelected)"
    (clickMF)="clickMF($event, dataSelected)"
  >
    <ng-template #header let-data>
      <div class="d-flex align-items-center justify-content-between">
        <div
          class="mb-2"
          [ngbTooltip]="gridViewSetup?.BusinessLineID?.headerText"
        >
          <span
            class="icon-add_shopping_cart icon-18 me-2 text-gray-700"
          ></span>
          <span
            class="text-dark fs-6 fw-bold"
            #businessLineID
            [innerHTML]="
              dataSelected?.businessLineID
                | formatvalue : formModel : 'businessLineID' : businessLineID
                | async
            "
          ></span>
        </div>
        <div class="toolbar-detail">
          <codx-mfunc
            [hideMF]="dataSelected?.status == '11'"
            [dataItem]="dataSelected"
            [formModel]="formModel"
            (changeDataMF)="changeDataMF($event, dataSelected)"
            (clickMF)="clickMF($event, dataSelected)"
            [isBookMark]="true"
            type="view"
          ></codx-mfunc>
        </div>
      </div>
      <ng-template #toolTipDealValue>
        <div class="text-end text-sm-start">
          <strong class="label-colon">{{
            gridViewSetup?.DealValue?.headerText
          }}</strong>
          {{ dataSelected?.dealValue }}
        </div>
      </ng-template>
      <div class="container_detail mt-1">
        <div class="d-flex justify-content-between mb-2">
          <div class="d-flex flex-column w-100">
            <div class="d-flex align-items-start">
              <div class="me-4">
                <codx-img
                  [objectId]="dataSelected?.recID"
                  [objectName]="dataSelected?.leadName"
                  [imgOn]="dataSelected?.modifiedOn"
                  [objectType]="'CM_Leads'"
                  [referType]="'avt'"
                  [width]="40"
                >
                </codx-img>
              </div>
              <div class="d-flex flex-column">
                <div
                  class="d-flex align-items-top"
                  *ngIf="
                    dataSelected.leadName != null &&
                    dataSelected.leadName.trim() != ''
                  "
                >
                  <span
                    class="fw-bold text-dark fs-5-sm mb-1"
                    #leadName
                    [innerHTML]="
                      dataSelected?.leadName
                        | formatvalue : formModel : 'leadName' : leadName
                        | async
                    "
                  ></span>
                </div>

                <div
                  class="d-flex align-items-top"
                  *ngIf="
                    dataSelected.address != null &&
                    dataSelected.address.trim() != ''
                  "
                >
                  <span
                    [ngbTooltip]="popupAddress"
                    class="icon-location_on icon-16 me-2 text-gray-600 fs-7"
                    ><ng-template #popupAddress>
                      <codx-label
                        fiedName="Address"
                        [formModel]="formModel"
                      ></codx-label>
                    </ng-template>
                  </span>
                  <span class="text-gray-600">{{ dataSelected.address }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="ms-5 d-flex justify-content-between">
            <div class="d-flex flex-column">
              <div class="d-flex justify-content-end">
                <div
                  class="d-flex align-items-center"
                  [ngbTooltip]="toolTipDealValue"
                >
                  <span
                    class="icon-monetization_on pe-1 text-warning icon-16 mt-1"
                  ></span>
                  <span
                    class="fw-bold fs-5-sm pe-1"
                    *ngIf="dataSelected?.dealValue; else defaultNull"
                    #dealValue
                    [innerHTML]="
                      dataSelected?.dealValue
                        | formatvalue : formModel : 'dealValue' : dealValue
                        | async
                    "
                  ></span>
                  <span
                    *ngIf="dataSelected?.currencyID"
                    [ngClass]="
                      dataSelected?.currencyID ? '' : 'line-clamp-menu'
                    "
                    class="fw-bold fs-5-sm"
                    [ngbTooltip]="gridViewSetup?.CurrencyID?.headerText"
                    #currencyID
                    [innerHTML]="
                      dataSelected?.currencyID
                        | formatvalue : formModel : 'currencyID'
                        | async
                    "
                  ></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex align-items-top justify-content-between">
          <div class="w-100 d-flex flex-column">
            <div class="d-flex align-items-top justify-content-between">
              <div class="w-100 d-flex flex-column">
                <div
                  class="d-flex align-items-top"
                  *ngIf="dataSelected.category == '1'"
                >
                  <codx-label
                    fiedName="Industries"
                    class="text-dark fw-bold label-colon"
                    [setRequire]="false"
                    [formModel]="formModel"
                  ></codx-label>
                  <!-- <span
                    class="text-gray-700 line-clamp line-clamp-1"
                    #industries
                    [innerHTML]="
                      dataSelected?.industries
                        | formatvalue
                          : formModel
                          : 'industries'
                          : industries
                          : 'CMLeads'
                          : 'grvCMLeads'
                        | async
                    "
                  ></span> -->
                  <div
                    *ngFor="
                      let item of dataSelected?.industries?.split(';');
                      index as i
                    "
                  >
                    <span
                      #industries
                      class="text-gray-700"
                      [innerHTML]="
                        item
                          | formatvalue
                            : formModel
                            : 'industries'
                            : industries
                            : 'CMLeads'
                            : 'grvCMLeads'
                          | async
                      "
                    ></span>
                    <span
                      class="me-1"
                      *ngIf="
                        i < dataSelected?.industries?.split(';').length - 1
                      "
                      >,</span
                    >
                  </div>
                </div>
                <div class="d-flex align-items-top">
                  <codx-label
                    default="Nhu cầu:"
                    class="text-dark fw-bold me-2 text-nowrap"
                  ></codx-label>
                  <span
                    class="text-gray-700 line-clamp line-clamp-2"
                    #note
                    [ngbTooltip]="dataSelected?.note"
                    [innerHTML]="
                      dataSelected?.note
                        | formatvalue : formModel : 'note' : note
                        | async
                    "
                  ></span>
                </div>
                <div class="mt-2" *ngIf="viewTag && viewTag != ''">
                  <codx-tag
                    [entityName]="formModel.entityName"
                    [disabled]="true"
                    [isEdit]="false"
                    [value]="viewTag"
                  >
                  </codx-tag>
                </div>
              </div>
              <div class="ms-6 d-flex flex-column">
                <div class="d-flex flex-column">
                  <div
                    class="mb-1 d-flex align-items-center justify-content-end"
                  >
                    <div
                      *ngIf="
                        dataSelected.status == '2' && dataSelected.applyProcess;
                        else statusDefault
                      "
                      [ngStyle]="{
                        'background-color':
                          dataSelected?.steps['backgroundColor']
                      }"
                      class="badge badge-sm d-flex align-items-center mw-125px me-0"
                    >
                      <span
                        [ngClass]="dataSelected?.steps['icon']"
                        [ngStyle]="{ color: dataSelected?.steps['iconColor'] }"
                        class="me-1"
                      ></span>
                      <span
                        class="text-ellipsis line-clamp line-clamp-1"
                        [ngbTooltip]="dataSelected?.currentStepName"
                        [ngStyle]="{ color: dataSelected?.steps['textColor'] }"
                        >{{ dataSelected?.currentStepName }}</span
                      >
                    </div>
                    <ng-template #statusDefault>
                      <div
                        [ngbTooltip]="
                          dataSelected?.status == '13' ? popupCustGroupID : ''
                        "
                      >
                        <ng-template #popupCustGroupID>
                          <div class="text-end text-sm-start">
                            <codx-label
                              [setRequire]="false"
                              class="d-flex align-items-start label-colon fw-bold codx-textlabel inline"
                              fiedName="ReturnedCmt"
                              [formModel]="formModel"
                            ></codx-label>
                            <span
                              class="d-flex align-items-start inline"
                              [innerHTML]="
                                dataSelected?.returnedCmt
                                  | formatvalue : formModel : 'ReturnedCmt'
                                  | async
                              "
                            ></span>
                          </div>
                        </ng-template>
                        <codx-vll
                          [name]="gridViewSetup?.Status?.referedValue"
                          [field]="'Status'"
                          [value]="dataSelected?.status"
                          [showText]="true"
                          [showBgColor]="true"
                          class="badge badge-light badge-sm me-0"
                        >
                        </codx-vll>
                      </div>
                    </ng-template>
                    <ng-container
                      *ngIf="
                        dataSelected?.approveStatus &&
                        dataSelected?.approveStatus != '1'
                      "
                    >
                      <codx-vll
                        [name]="gridViewSetup?.ApproveStatus?.referedValue"
                        [field]="'ApproveStatus'"
                        [value]="dataSelected?.approveStatus"
                        [showText]="true"
                        [showBgColor]="true"
                        class="badge badge-primary badge-sm"
                      >
                      </codx-vll>
                    </ng-container>
                  </div>

                  <ng-template #tooltipSalesperson>
                    <div class="d-flex justify-content-center fw-bold fs-6">
                      <span
                        #salespersonID
                        [innerHTML]="
                          dataSelected?.salespersonID
                            | formatvalue
                              : formModel
                              : 'salespersonID'
                              : salespersonID
                            | async
                        "
                      ></span>
                    </div>
                    <div class="d-flex justify-content-center">
                      {{ gridViewSetup?.SalespersonID?.headerText }}
                    </div>
                  </ng-template>
                  <ng-template #tooltipConsultant>
                    <div class="d-flex justify-content-center fw-bold fs-6">
                      <span
                        #consultantID
                        [innerHTML]="
                          dataSelected?.consultantID
                            | formatvalue
                              : formModel
                              : 'consultantID'
                              : consultantID
                            | async
                        "
                      ></span>
                    </div>
                    <div class="d-flex justify-content-center">
                      {{ gridViewSetup?.ConsultantID?.headerText }}
                    </div>
                  </ng-template>

                  <ng-template #tooltipOwner>
                    <div class="d-flex justify-content-center fw-bold fs-6">
                      <span
                        #owner
                        [innerHTML]="
                          dataSelected?.owner
                            | formatvalue : formModel : 'owner' : owner
                            | async
                        "
                      ></span>
                    </div>
                    <div class="d-flex justify-content-center">
                      {{ gridViewSetup?.Owner?.headerText }}
                    </div>
                  </ng-template>
                </div>
              </div>
            </div>
            <div
              class="d-flex align-items-top justify-content-between mt-2 mb-2"
            >
              <div class="d-flex flex-wrap align-items-top w-100">
                <div class="d-flex flex-column">
                  <div class="mb-1">
                    <codx-label
                      class="text-dark fw-bold"
                      default="Liên hệ chính:"
                      [formModel]="formModel"
                    ></codx-label>
                  </div>
                  <div class="d-flex align-items-start">
                    <div class="me-3">
                      <codx-img
                        [objectId]="dataSelected?.contactID"
                        [objectName]="dataSelected?.contactName"
                        [imgOn]="dataSelected?.modifiedOn"
                        [objectType]="formModel?.entityName"
                        [width]="40"
                      >
                      </codx-img>
                    </div>
                    <div class="d-flex flex-column">
                      <div class="fw-bold text-dark fs-6 mb-1">
                        <span
                          *ngIf="dataSelected?.contactName"
                          #contactName
                          [innerHTML]="
                            dataSelected?.contactName
                              | formatvalue
                                : formModel
                                : 'contactName'
                                : contactName
                              | async
                          "
                        ></span>
                      </div>
                      <div class="d-flex flex-wrap align-items-center">
                        <div class="fs-7 text-gray-600 me-2">
                          <span
                            *ngIf="dataSelected?.jobTitle"
                            #jobTitle
                            [innerHTML]="
                              dataSelected?.jobTitle
                                | formatvalue
                                  : formModel
                                  : 'jobTitle'
                                  : jobTitle
                                | async
                            "
                          ></span>
                        </div>
                        <div class="d-flex align-items-start fs-7">
                          <div
                            class="d-flex align-items-center me-3"
                            *ngIf="dataSelected?.phone"
                          >
                            <span
                              #phone
                              [innerHTML]="
                                dataSelected?.phone
                                  | formatvalue : formModel : 'phone' : phone
                                  | async
                              "
                            ></span>
                          </div>
                          <div
                            class="d-flex align-items-center"
                            *ngIf="dataSelected?.email"
                          >
                            <span
                              #email
                              [innerHTML]="
                                dataSelected?.email
                                  | formatvalue : formModel : 'email' : email
                                  | async
                              "
                            ></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="w-125px min-w-125px d-flex flex-column">
                <div class="d-flex flex-column">
                  <div class="d-flex justify-content-end">
                    <codx-label
                      default="Thông tin bán hàng"
                      class="text-dark fw-bold mb-1"
                    ></codx-label>
                  </div>
                  <div class="d-flex justify-content-end">
                    <div
                      style="position: relative"
                      [ngbTooltip]="tooltipOwner"
                      *ngIf="dataSelected?.owner"
                    >
                      <codx-imgs
                        [width]="30"
                        [objectId]="dataSelected?.owner"
                        ojectType="AD_Users"
                        [numberImages]="1"
                        [isToolTip]="false"
                      >
                      </codx-imgs>
                      <div style="position: absolute; right: 0px; bottom: 0px">
                        <span
                          ><img
                            src="/assets/themes/cm/default/img/{{
                              getIcon('1')
                            }}"
                            alt=""
                        /></span>
                      </div>
                    </div>

                    <div
                      style="position: relative"
                      [ngbTooltip]="tooltipSalesperson"
                      *ngIf="dataSelected?.salespersonID"
                    >
                      <codx-img
                        [width]="30"
                        [objectId]="dataSelected.salespersonID"
                        objectType="AD_Users"
                        [referType]="'avt'"
                        [numberImages]="1"
                      >
                      </codx-img>
                      <div style="position: absolute; right: 0px; bottom: 0px">
                        <span
                          ><img
                            src="/assets/themes/cm/default/img/{{
                              getIcon('3')
                            }}"
                            alt=""
                        /></span>
                      </div>
                    </div>

                    <div
                      style="position: relative"
                      [ngbTooltip]="tooltipConsultant"
                      *ngIf="dataSelected?.consultantID"
                    >
                      <codx-imgs
                        [width]="30"
                        [objectId]="dataSelected?.consultantID"
                        ojectType="AD_Users"
                        [numberImages]="1"
                        [isToolTip]="false"
                      >
                      </codx-imgs>
                      <div style="position: absolute; right: 0px; bottom: 0px">
                        <span
                          ><img
                            src="/assets/themes/cm/default/img/{{
                              getIcon('5')
                            }}"
                            alt=""
                        /></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
    <ng-template #tabs let-data>
      <codx-tabs
        [entityName]="formModel.entityName"
        [formModel]="formModel"
        [TabControl]="tabControl"
        [objectID]="dataSelected.recID"
        [funcID]="formModel.funcID"
        [refType]="formModel.entityName"
        [refID]="dataSelected.recID"
        [transID]="dataSelected.recID"
        [dataTree]="treeTask"
        [approveStatus]="dataSelected.approveStatus"
        (tabChange)="changeFooter($event)"
      ></codx-tabs>
    </ng-template>
  </codx-detail-tmp>
</ng-container>
<ng-template #body let-data>
  <div class="cm-scroll" [ngClass]="isShow ? 'cm-full' : ''">
    <div
      class="btn btn-white btn-icon tab-action"
      (click)="clickShowTab(!isShow)"
    >
      <span class="icon-unfold_more icon-20"></span>
    </div>
    <div class="instance-select">
      <ejs-tab #tabObj>
        <e-tabitems>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-top">
                <span class="icon-info icon-16 me-2"></span>
                <span>
                  <codx-label
                    class="fw-bold"
                    default="Thông tin chung"
                    [formModel]="formModel"
                    name="lblInformation"
                  ></codx-label>
                </span>
              </div>
            </ng-template>
            <ng-template #content>
              <div class="d-flex flex-column mt-4">
                <div class="text-dark text-primary fw-bold fs-6 mb-3">
                  <codx-label
                    default="Thông tin chung"
                    [formModel]="formModel"
                    name="lblInformation"
                  ></codx-label>
                </div>
                <div class="mb-3">
                  <div class="d-flex">
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          *ngIf="companyNo || customerNo"
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <div
                            *ngIf="dataSelected.category == '1'; else default"
                          >
                            <codx-label
                              name="lblLeadID"
                              [default]="companyNo"
                              class="nowrap label-colon"
                              [setRequire]="false"
                              [formModel]="formModel"
                            ></codx-label>
                          </div>
                          <ng-template #default>
                            <codx-label
                              name="lblLeadID"
                              [default]="customerNo"
                              class="nowrap label-colon"
                              [setRequire]="false"
                              [formModel]="formModel"
                            ></codx-label>
                          </ng-template>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #leadID
                            [innerHTML]="
                              dataSelected?.leadID
                                | formatvalue : formModel : 'leadID' : leadID
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <codx-label
                            fiedName="AnnualRevenue"
                            class="nowrap label-colon"
                            [setRequire]="false"
                            [formModel]="formModel"
                          ></codx-label>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #annualRevenue
                            [innerHTML]="
                              dataSelected?.annualRevenue
                                | formatvalue
                                  : formModel
                                  : 'annualRevenue'
                                  : annualRevenue
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex">
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          *ngIf="companyName || customerName"
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <div
                            *ngIf="dataSelected.category == '1'; else default"
                          >
                            <codx-label
                              name="lblCompanyPhone"
                              [default]="companyName"
                              class="nowrap label-colon"
                              [setRequire]="false"
                              [formModel]="formModel"
                            ></codx-label>
                          </div>
                          <ng-template #default>
                            <codx-label
                              name="lblCustomerName"
                              [default]="customerName"
                              class="nowrap label-colon"
                              [setRequire]="false"
                              [formModel]="formModel"
                            ></codx-label>
                          </ng-template>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #companyPhone
                            [innerHTML]="
                              dataSelected?.companyPhone
                                | formatvalue
                                  : formModel
                                  : 'companyPhone'
                                  : companyPhone
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <codx-label
                            fiedName="Headcounts"
                            class="nowrap label-colon"
                            [setRequire]="false"
                            [formModel]="formModel"
                          ></codx-label>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #headcounts
                            [innerHTML]="
                              dataSelected?.headcounts
                                | formatvalue
                                  : formModel
                                  : 'headcounts'
                                  : headcounts
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="d-flex">
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <codx-label
                            fiedName="FaxNo"
                            class="nowrap label-colon"
                            [setRequire]="false"
                            [formModel]="formModel"
                          ></codx-label>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #faxNo
                            [innerHTML]="
                              dataSelected?.faxNo
                                | formatvalue : formModel : 'faxNo' : faxNo
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <codx-label
                            fiedName="CampaignID"
                            class="nowrap label-colon"
                            [setRequire]="false"
                            [formModel]="formModel"
                          ></codx-label>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #campaignID
                            [innerHTML]="
                              dataSelected?.campaignID
                                | formatvalue
                                  : formModel
                                  : 'campaignID'
                                  : campaignID
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="d-flex">
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <codx-label
                            fiedName="WebPage"
                            class="nowrap label-colon"
                            [setRequire]="false"
                            [formModel]="formModel"
                          ></codx-label>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #webPage
                            [innerHTML]="
                              dataSelected?.webPage
                                | formatvalue : formModel : 'webPage' : webPage
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="mb-5px d-flex align-items-top">
                        <div
                          class="w-150px min-w-150px text-gray-600 codx-textlabel"
                        >
                          <codx-label
                            fiedName="ChannelID"
                            class="nowrap label-colon"
                            [setRequire]="false"
                            [formModel]="formModel"
                          ></codx-label>
                        </div>
                        <div class="text-dark fw-bold codx-textcontent">
                          <span
                            #channelID
                            [innerHTML]="
                              dataSelected?.channelID
                                | formatvalue
                                  : formModel
                                  : 'channelID'
                                  : channelID
                                | async
                            "
                          ></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <div class="text-dark text-primary fw-bold fs-6 mb-2">
                    <codx-label
                      [setRequire]="false"
                      class="nowrap"
                      fiedName="Memo"
                      [formModel]="formModel"
                    ></codx-label>
                  </div>
                  <span class="text-gray-600">
                    <span
                      #memo
                      [innerHTML]="
                        dataSelected?.memo
                          | formatvalue : formModel : 'memo' : memo
                          | async
                      "
                    ></span>
                  </span>
                </div>
                <div *ngIf="applyProcess">
                  <div class="d-flex flex-column mt-5">
                    <ng-container *ngFor="let item of listSteps">
                      <codx-fields-detail-temp
                        *ngIf="item?.fields?.length > 0 && item?.fields"
                        [dataStep]="item"
                        [showColumnControl]="showColumnControl(item.stepID)"
                        [isUpdate]="
                          ['0', '1', '2', '13'].includes(dataSelected.status) &&
                          dataSelected?.full &&
                          !dataSelected.closed
                        "
                      >
                      </codx-fields-detail-temp>
                    </ng-container>
                  </div>
                </div>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-top">
                <span class="icon-more icon-16 me-2"></span>
                <codx-label
                  class="fw-bold"
                  default="Công việc"
                  [formModel]="formModel"
                  name="lblTask"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content let-data="value">
              <div class="mt-4">
                <step-task
                  [entityName]="'CM_Leads'"
                  [typeTask]="2"
                  [customerID]="dataSelected?.recID"
                  [entityName]="'CM_Leads'"
                  [isPause]="!dataSelected?.full"
                  (saveAssignTask)="saveAssign($event)"
                ></step-task>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-top">
                <span class="icon-more icon-16 me-2"></span>
                <codx-label
                  class="fw-bold"
                  default="Công việc"
                  [formModel]="formModel"
                  name="lblProcess"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content let-data="value">
              <div>
                <step-task
                  [isDataLoading]="isDataLoading"
                  [dataSelected]="dataSelected"
                  [formModel]="formModel"
                  [listInstanceStep]="listSteps"
                  [applyFor]="'5'"
                  (continueStep)="continueStep($event)"
                  (saveAssignTask)="saveAssign($event)"
                ></step-task>
              </div>
            </ng-template>
          </e-tabitem>
          <e-tabitem>
            <ng-template #headerText>
              <div class="d-flex align-items-top">
                <span class="icon-i-chat-right icon-16 me-2"></span>
                <codx-label
                  class="fw-bold"
                  default="Thảo luận"
                  [formModel]="formModel"
                  name="lblComment"
                ></codx-label>
              </div>
            </ng-template>
            <ng-template #content let-data>
              <div class="tab-comt mt-4">
                <div class="tab_container">
                  <codx-tree-comment
                    [objectID]="dataSelected.recID"
                    [objectType]="formModel.entityName"
                    [actionType]="'C'"
                    [addNew]="true"
                    [funcID]="formModel.funcID"
                    (totalCommentChange)="changeCountFooter($event, 'comment')"
                  >
                  </codx-tree-comment>
                </div>
              </div>
            </ng-template>
          </e-tabitem>
        </e-tabitems>
      </ejs-tab>
    </div>
  </div>
</ng-template>

<ng-template #referencesDeal>
  <div
    *ngIf="tmpDeal; else noData"
    class="d-flex justify-content-between align-items-top p-3 border-bottom border-gray-150 user-nav-item"
  >
    <div class="d-flex flex-column">
      <div
        class="fw-bold fs-6 line-clamp line-clamp-1 mb-3"
        [innerHTML]="
          tmpDeal.dealName | formatvalue : formModelDeal : 'DealName' | async
        "
      ></div>
      <div class="d-flex flex-wrap align-items-top me-4 mb-1">
        <div class="me-3 d-flex justify-content-start me-6">
          <span class="icon-money icon-16 me-1" [ngbTooltip]="popupDealValue">
            <ng-template #popupDealValue>
              <codx-label
                fiedName="DealValue"
                [formModel]="formModelDeal"
              ></codx-label> </ng-template
          ></span>
          <codx-label
            class="label-colon text-gray-600"
            [formModel]="formModelDeal"
            fiedName="DealValue"
          ></codx-label>
          <span
            class="ms-1 text-dark fw-bold pe-1"
            [innerHTML]="
              tmpDeal.dealValue
                | formatvalue : formModelDeal : 'DealValue'
                | async
            "
          ></span>
          <span
            class="fw-bold line-clamp-menu"
            #currencyID
            [innerHTML]="
              tmpDeal?.currencyID
                | formatvalue : formModelDeal : 'currencyID' : currencyID
                | async
            "
          ></span>
        </div>
        <div class="d-flex align-items-center">
          <span
            class="icon-offline_pin icon-16 me-2"
            [ngbTooltip]="popupProbability"
          >
            <ng-template #popupProbability>
              <codx-label
                fiedName="Probability"
                [formModel]="formModelDeal"
              ></codx-label> </ng-template
          ></span>
          <codx-label
            class="label-colon text-gray-600 me-1"
            [formModel]="formModelDeal"
            fiedName="Probability"
          ></codx-label>
          <span
            class="me-1 text-dark fw-bold"
            [innerHTML]="
              tmpDeal.probability
                | formatvalue : formModelDeal : 'Probability'
                | async
            "
          ></span
          ><span class="text-dark fw-bold">%</span>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-top ms-4">
      <div class="d-flex flex-column w-130px min-w-130px">
        <div class="d-flex align-items-center justify-content-end mb-1">
          <div
            *ngIf="tmpDeal.status == '5'; else statusDefault"
            [ngStyle]="{
              'background-color': tmpDeal?.steps['backgroundColor']
            }"
            class="me-0 badge badge-sm d-flex align-items-center mw-125px"
          >
            <span
              [ngClass]="tmpDeal?.steps['icon']"
              [ngStyle]="{ color: tmpDeal?.steps['iconColor'] }"
              class="me-1"
            ></span>
            <span
              class="text-ellipsis line-clamp line-clamp-1"
              [ngbTooltip]="tmpDeal?.currentStepName"
              [ngStyle]="{ color: tmpDeal?.steps['textColor'] }"
              >{{ tmpDeal?.currentStepName }}</span
            >
          </div>
          <ng-template #statusDefault>
            <codx-vll
              [name]="gridViewSetupDeal?.Status?.referedValue"
              [field]="'Status'"
              [value]="tmpDeal?.status"
              [showText]="true"
              [showBgColor]="true"
              class="badge badge-light badge-sm me-0"
            >
            </codx-vll>
          </ng-template>
        </div>
        <div class="ms-1 d-flex justify-content-end align-items-center mt-1">
          <span
            class="icon-date_range icon-16 text-gray-800 me-1"
            [ngbTooltip]="popupEndDate"
            ><ng-template #popupEndDate>
              <codx-label
                fiedName="EndDate"
                [formModel]="formModelDeal"
              ></codx-label> </ng-template
          ></span>
          <span
            class="text-gray-700"
            [innerHTML]="
              tmpDeal.endDate | formatvalue : formModelDeal : 'EndDate' | async
            "
          ></span>
        </div>
      </div>

      <div class="ms-5" *ngIf="tmpDeal.owner">
        <codx-imgs
          [isToolTip]="true"
          [width]="30"
          [objectId]="tmpDeal.owner"
          ojectType="AD_Users"
          [numberImages]="1"
        >
        </codx-imgs>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #noData>
  <codx-no-data> </codx-no-data>
</ng-template>
<ng-template #defaultNull> <span class="pe-1">0</span></ng-template>
