<div class="list-contracts h-100">
  <div *ngIf="!isNoData">
    <ng-container *ngFor="let task of listActivitie; let i=index">
      <div
        cdkDrag
        [cdkDragStartDelay]="100"
        [cdkDragData]="task"
        [cdkDragDisabled]="true"
        class="drap-drop my-2"
      >
        <div class="d-flex align-items-center justify-content-between">
          <div style="flex-grow: 1" class="has-action-menu ps-2">
            <ng-container
              [ngTemplateOutlet]="taskTemplate"
              [ngTemplateOutletContext]="{
                value: { task: task, group: null , index:i}
              }"
            ></ng-container>
          </div>
          <div>
            <ng-container
              [ngTemplateOutlet]="timeAndProgress"
              [ngTemplateOutletContext]="{
                value: { value: task, group: null, type: 'T' }
              }"
            ></ng-container>
          </div>
        </div>

        <div style="margin-left: 45px">
          <ng-container
            [ngTemplateOutlet]="fileTemplate"
            [ngTemplateOutletContext]="{ value: task }"
          ></ng-container>
        </div>
      </div>
    </ng-container>
  </div>
  <div *ngIf="isNoData">
    <div class="mb-5">
      <codx-no-data></codx-no-data>
    </div>
  </div>
  <div class="d-flex justify-content-center add-contract">
    <button
      *ngIf="!isPause"
      type="button"
      class="btn btn-sm btn btn-primary add-contract d-flex align-items-center"
      (click)="chooseTypeTask()"
    >
      <i class="icon-18 icon-more text-light"></i>
      <codx-label
        class=""
        [formModel]=""
        fiedName="btnAddContract"
        [default]="'Thêm công việc'"
      ></codx-label>
    </button>
  </div>
</div>

<ng-template #taskTemplate let-data="value">
  <div
    class="d-flex justify-content-start align-items-center has-action-menu task-hover cursor-pointer"
    #popoverDetails="ngbPopover"
    [ngbPopover]="setNameTypeTask(data?.task?.taskType)"
    [placement]="data?.index == 0 ? 'bottom-left' :'top-left'"
    (mouseenter)="popoverDetails.open()"
    (mouseleave)="popoverDetails.close()"
  >
    <codx-icon-step
      [typeTask]="data?.task?.taskType"
      [listTypeTask]="listTaskType"
      [isStep]="false"
      [size]="30"
    ></codx-icon-step>
    <div class="steplist-hearder">
      <div class="text-dark fw-bold fs-6 line-clamp line-clamp-1 task-name">
        {{ data?.task?.taskName }}
      </div>
    </div>
    <codx-mfunc
      *ngIf="!isPause && data?.task?.status == '1'"
      [formModel]="grvMoreFunction"
      [isBookMark]="true"
      [dataItem]="moreDefaut"
      [type]="'hover'"
      (clickMF)="clickMFTask($event, data?.task)"
      (changeDataMF)="changeDataMFTask($event, data?.task)"
    >
    </codx-mfunc>
    <codx-mfunc
      *ngIf="!isPause && data?.task?.status != '1'"
      [formModel]="grvMoreFunction"
      [isBookMark]="true"
      [dataItem]="moreDefaut"
      [type]="'hover'"
      (clickMF)="clickMFTask($event, data?.task)"
      (changeDataMF)="changeDataMFTask($event, data?.task)"
    >
    </codx-mfunc>
  </div>
</ng-template>

<ng-template #timeAndProgress let-data="value">
  <div class="d-flex align-items-center justify-content-end me-3 time-progress">
    <div
      class="date text-nowrap mx-2"
      *ngIf="data?.value?.startDate && data?.value?.endDate"
    >
      <span
        [innerHTML]="
          data?.value?.startDate
            | formatvalue : grvMoreFunction : 'StartDate'
            | async
        "
      ></span>
      <span class="mx-1">-</span>
      <span
        [innerHTML]="
          data?.value?.endDate
            | formatvalue : grvMoreFunction : 'EndDate'
            | async
        "
      ></span>
    </div>

    <span class="d-flex align-items-center">
      <codx-imgs
        class="me-2 d-flex align-items-center"
        [width]="25"
        ojectType="AD_Users"
        [numberImages]="1"
        [isToolTip]="true"
        [objectId]="getRole(data?.value, 'ID')"
        [objectName]="getRole(data?.value, 'name')"
      >
      </codx-imgs>
    </span>
    <div
      class="disabled-inline cursor-pointer ms-2"
      (click)="openPopupUpdateProgress(data?.value, 'T')"
    >
      <codx-progressbar
        [progress]="data?.value?.progress"
        [stype]="3"
        [vllData]="vllData"
        [status]="data?.value?.status"
        [isStep]="false"
        #p="ngbPopover"
        [ngbPopover]="'Cập nhật tiến độ'"
        (mouseenter)="p.open()"
        (mouseleave)="p.close()"
      ></codx-progressbar>
    </div>
  </div>
</ng-template>

<ng-template #fileTemplate let-data="value">
  <codx-attachment
    #attachment
    [objectType]="'DP_Instances_Steps_Tasks'"
    [objectId]="data?.recID"
    hideFolder="1"
    hideImageUpload="0"
    hideImageThumb="0"
    hideUploadBtn="1"
    [showMessage]="0"
    hideDes="1"
    type="inline"
    allowMultiFile="1"
    referType="source"
    displayThumb="full"
  >
  </codx-attachment>
</ng-template>

<!-- <div class="text-gray-600">
        <codx-label class="title" fiedName="updateTime" default="Cập nhật:">
        </codx-label>
        <span
          [innerHTML]="
            data?.task?.modifiedOn || data?.task?.createdOn
              | formatvalue : grvMoreFunction : 'ModifiedOn'
              | async
          "
        ></span>
      </div> -->
