<div class="list-contracts po">
   <button
     type="button"
     class="btn btn-sm btn btn-primary add-contract d-flex align-items-center"
     (click)="chooseTypeTask()"
   >
     <i class="icon-18 icon-more text-light"></i>
     <codx-label class="fw-bold" [formModel]="" fiedName="btnAddContract" [default]="'Thêm công việc'"></codx-label>
   </button>
   <div>
    <ng-container *ngFor="let task of listActivitie">
      <div
        cdkDrag
        [cdkDragStartDelay]="100"
        [cdkDragData]="task"
        [cdkDragDisabled]="true"
        class="drap-drop"
      >
        <div
          class="d-flex align-items-center justify-content-between"
        >
          <div style="flex-grow: 1" class="has-action-menu">
            <ng-container
              [ngTemplateOutlet]="taskTemplate"
              [ngTemplateOutletContext]="{
                value: { task: task, group: null }
              }"
            ></ng-container>
          </div>
          <div>
            <ng-container
              [ngTemplateOutlet]="timeAndProgress"
              [ngTemplateOutletContext]="{
                value: { value: task, group: null, type: 'T' }
              }"
            ></ng-container>
          </div>
        </div>

        <div class="ms-5">
          <ng-container
            [ngTemplateOutlet]="fileTemplate"
            [ngTemplateOutletContext]="{ value: task }"
          ></ng-container>
        </div>
      </div>
    </ng-container>
   </div>
 </div>

 <ng-template #taskTemplate let-data="value">
  <div class="d-flex justify-content-start align-items-center has-action-menu">
    <!-- icon task -->
    <div class="icon-container me-3" [ngStyle]="getColor(data?.task)">
      <span
        class="icon-18 text-primary-600"
        [ngClass]="getIconTask(data?.task)"
      ></span>
    </div>
    <div class="steplist-hearder">
      <div class="text-dark fw-bold fs-6 line-clamp line-clamp-1">
        <span>{{ data?.task?.taskName }}</span>
      </div>
      <div class="text-gray-600" >
        <codx-label
          class="title"
          fiedName="updateTime"
          default="Cập nhật:"
         
        >
        </codx-label>
        <span
          >{{
            data?.task?.modifiedOn || data?.task?.createdOn
              | date : dateTimeFomat
          }}
        </span>
      </div>
    </div>
    <codx-mfunc
      [formModel]="grvMoreFunction"
      [isBookMark]="true"
      [dataItem]="moreDefaut"
      [type]="'hover'"
    >
    </codx-mfunc>
  </div>
</ng-template>

<ng-template #timeAndProgress let-data="value">
  <div class="d-flex align-items-center justify-content-end me-3 time-progress">
    <!-- <div *ngIf="data?.value?.startDate && data?.value?.endDate">
      <span
        class="fs-7"
        [innerHTML]="
          data?.value?.startDate
            | formatvalue : view.formModel : 'ContractType'
            | async
        "
      ></span>
      <span
        class="fs-7"
        [innerHTML]="
          itemSelected?.contractType
            | formatvalue : view.formModel : 'ContractType'
            | async
        "
      ></span>
    </div> -->
    <span
      class="date text-nowrap"
      *ngIf="data?.value?.startDate && data?.value?.endDate"
    >
      {{ data?.value?.startDate | date : dateFomat }} -
      {{ data?.value?.endDate | date : dateFomat }}</span
    >
    <span class="d-flex align-items-center">
      <codx-imgs
        class="me-2 d-flex align-items-center"
        [width]="25"
        ojectType="AD_Users"
        [numberImages]="1"
        [isToolTip]="true"
        [objectId]="getRole(data?.value, 'ID')"
        [objectName]="getRole(data?.value, 'name')"
      >
      </codx-imgs>
    </span>
    <div
      class="disabled-inline"
    >
      <codx-progressbar
        [progress]="data?.value?.progress"
        #p="ngbPopover"
        [ngbPopover]="'Cập nhật tiến độ'"
        (mouseenter)="p.open()"
        (mouseleave)="p.close()"
      ></codx-progressbar>
    </div>
    <div class="notify" style="min-width: 40px">
      <codx-attachment-temp
        [objectID]="data?.value.refID"
        [hideMoreF]="0"
        [viewType]="'4'"
        [hideDelete]="1"
      ></codx-attachment-temp>
    </div>
    <div class="notify" style="min-width: 40px">
      <codx-comment-temp [objectID]="data?.value.recID"></codx-comment-temp>
    </div>
  </div>
</ng-template>

<ng-template #fileTemplate let-data="value">
  <codx-attachment
    #attachment
    [objectType]="'DP_Instances_Steps_Tasks'"
    [objectId]="data?.recID"
    hideFolder="1"
    hideImageUpload="0"
    hideImageThumb="0"
    hideUploadBtn="1"
    [showMessage]="0"
    hideDes="1"
    type="inline"
    allowMultiFile="1"
    referType="source"
    displayThumb="full"
  >
  </codx-attachment>
</ng-template>