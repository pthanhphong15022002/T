<ng-container *ngIf="dataSelected?.recID">
  <codx-detail-tmp
    [header]="header"
    [formModel]="formModel"
    [body]="body"
    [dataItem]="dataSelected"
    [hideMF]="true"
    [footer]="tabs"
    (changeDataMF)="changeDataMF($event, dataSelected)"
    (clickMF)="clickMF($event, dataSelected)"
  >
    <ng-template #header let-data>
      <div class="d-flex justify-content-between">
        <div class="text-info">

          <div>
            <i class="icon-add_shopping_cart icon-16 me-2 "></i>
            <span
            class="text-gray-700 fs-4"
            #businessLineID
            [innerHTML]="
            dataSelected?.businessLineID
                | formatvalue
                  : formModel
                  : 'businessLineID'
                  : businessLineID
                  : 'CMDeals'
                  : 'grvCMDeals'
                | async
            "
          ></span>
          </div>
        </div>
        <div></div>
        <div>
          <codx-mfunc
          [hideMF]="false"
          [dataItem]="dataSelected"
          [formModel]="formModel"
          (changeDataMF)="changeDataMF($event, dataSelected)"
          (clickMF)="clickMF($event, dataSelected)"
          [isBookMark]="true"
          type="view"
        ></codx-mfunc>
        </div>
      </div>

      <div class="container_detail mt-1">
        <div class="d-flex align-items-top justify-content-between">
          <div class="w-100 d-flex flex-column">
        <div class="d-flex align-items-top justify-content-between">
          <div class="w-100 d-flex flex-column">
            <div class="fs-2 fw-bold mb-2">
              <div
              class="text-gray-600"
              #customerName
              [innerHTML]="
                dataSelected?.customerName
                  | formatvalue
                    : formModel
                    : 'customerName'
                    : customerName
                    : 'CMDeals'
                    : 'grvCMDeals'
                  | async
              "
            ></div>
            </div>

            <div class="d-flex align-items-top justify-content-start mb-2">
            </div>

            <div class="d-flex align-items-top justify-content-start mb-2">
              <codx-label
                default="Cơ hội:"
                class="text-dark fw-bold me-2"
              ></codx-label>
              <i class="icon-business icon-16 me-2"></i>
              <span
              class="text-gray-700"
              #dealName
              [innerHTML]="
              dataSelected?.dealName
                  | formatvalue
                    : formModel
                    : 'dealName'
                    : dealName
                    : 'CMDeals'
                    : 'grvCMDeals'
                  | async
              "
            ></span>
            </div>
            <div class="d-flex align-items-top mb-2">
              <codx-label
                default="Lĩnh vực hoạt động:"
                class="text-dark fw-bold me-2"
              ></codx-label>
            <span
            class="text-gray-600"
            #industries
            [innerHTML]="
              dataSelected?.industries
                | formatvalue
                  : formModelCustomer
                  : 'industries'
                  : industries
                  : 'CMCustomers'
                  : 'grvCMCustomers'
                | async
            "
          ></span>

            </div>
            <div class="d-flex align-items-top justify-content-start mb-2">
              <codx-label
                default="Nhu cầu:"
                class="text-dark fw-bold me-2"
              ></codx-label>
              <span
              class="text-gray-700"
              #note
              [innerHTML]="
              dataSelected?.note
                  | formatvalue
                    : formModel
                    : 'note'
                    : note
                    : 'CMDeals'
                    : 'grvCMDeals'
                  | async
              "
            ></span>
            </div>
            <div class="mb-2">
              <codx-tag
                [entityName]="formModel.entityName"
                [disabled]="true"
                [isEdit]="false"
                [value]="dataSelected?.tags"
              >
              </codx-tag>
            </div>
            <div class="d-flex flex-wrap align-items-top mb-2">
              <div class="d-flex align-items-center me-6 mb-1">
                <codx-label
                [formModel]="formModel"
                fiedName="ExpectedClosed"
                  default="Ngày dự kiến đóng:"
                  class="text-dark fw-bold me-1"
                ></codx-label>
                <span
                  class="text-gray-600"
                  #expectedClosed
                  [innerHTML]="
                    dataSelected?.expectedClosed
                      | formatvalue
                        : formModel
                        : 'expectedClosed'
                        : expectedClosed
                        : 'CMDeals'
                        : 'grvCMDeals'
                      | async
                  "
                ></span>
              </div>
            </div>
          </div>
          <div class="w-150px min-w-150px d-flex flex-column">
            <div class="d-flex flex-column">
              <div class="d-flex align-items-top justify-content-end mb-2">
                <span class="icon-monetization_on pe-1 text-warning"></span>
                <span class="fs-5 fw-bold">{{ dataSelected?.dealValue }}</span>
              </div>
              <div class="mb-2 d-flex align-items-center justify-content-end">
                <span class="icon-check_circle text-green icon-16 me-1"></span>
                <span class="fs-6">{{ dataSelected?.probability }}%</span>
              </div>
              <div class="d-flex justify-content-end mb-2">
                    <div
                *ngIf="dataSelected.status != '1'"   [ngStyle]="{
                  'background-color':
                  dataSelected.status == '3' || dataSelected.status == '4'
                      ? colorReasonSuccess?.color
                      : dataSelected.status == '5' || dataSelected.status == '6'
                      ? colorReasonFail?.color
                      : dataSelected?.steps['backgroundColor']
                }"
                class="me-2 badge badge-sm d-flex align-items-center"
              >
                <span
                  [ngClass]="dataSelected?.steps['icon']"
                  [ngStyle]="{ color: dataSelected?.steps['iconColor'] }"
                  class="me-1"
                ></span>
                <span  class="menu-title fw-bold line-clamp-menu"  [ngbTooltip]="dataSelected?.currentStepName" [ngStyle]="{ color: data?.steps['textColor'] }">{{  dataSelected?.currentStepName }}</span>
              </div>
                <div   *ngIf="dataSelected.status == '1'" >

                  <codx-vll
                  [name]="'DP028'"
                  [field]="'Status'"
                  [value]="dataSelected?.status"
                  [showText]="true"
                  [showBgColor]="true"
                  class="badge badge-light badge-sm"
                >
                </codx-vll>

                </div>
              </div>
              <div class="d-flex flex-column align-items-top">
                <div class="d-flex justify-content-end">
                  <codx-label default="Bán hàng" class="text-dark fw-bold mb-1"></codx-label>/
                  <codx-label default="Tư vấn:" class="text-dark fw-bold mb-1"></codx-label>
                </div>
                <div class="d-flex justify-content-end">
                  <codx-imgs
                    [isToolTip]="true"
                    [width]="30"
                    [objectId]="dataSelected.owner"
                    ojectType="AD_Users"
                    [numberImages]="1"
                  >
                  </codx-imgs>

                  <codx-imgs
                  [isToolTip]="true"
                  [width]="30"
                  [objectId]="dataSelected.consultantID"
                  ojectType="AD_Users"
                  [numberImages]="1"
                >
                </codx-imgs>
                </div>
              </div>

            </div>
          </div>
        </div>


        <div class="view-details-header bg-body scroll-y me-3 h-100">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex tab-header">
              <codx-taskbar
                [listTab]="tabDetail"
                [change]="dataSelected"
                (tab)="changeTab($event)"
                size="18"
                class="mb-3"
              ></codx-taskbar>
            </div>
          </div>
        </div>
      </div>
    </div>

        </div>
    </ng-template>
  </codx-detail-tmp>
</ng-container>
<ng-template #body let-data>
  <codx-tab-deal-detail
    [tabClicked]="tabClicked"
    [dataSelected]="dataSelected"
    (saveAssign)="saveAssign($event)"
  ></codx-tab-deal-detail>
</ng-template>
<ng-template #tabs let-data>
  <codx-tabs
    [entityName]="formModel.entityName"
    [formModel]="formModel"
    [TabControl]="tabControl"
    [objectID]="dataSelected.recID"
    [funcID]="formModel.funcID"
    [dataTree]="treeTask"
    [funcIDQuotations]="'CM0202'"
    [predicates]="'RefType==@0 && RefID==@1'"
    [dataValues]="formModel.entityName + ';' + dataSelected.recID"
    [refType]="formModel.entityName"
    [refID]="dataSelected.recID"
    [customerID]="dataSelected.customerID"
    [salespersonID]="dataSelected.salespersonID"
    [consultantID]="dataSelected.consultantID"
    (tabChange)="changeFooter($event)"
    [disableRefID]="true"
  ></codx-tabs>
</ng-template>

<ng-template #contract let-data>
  <list-contracts
    [dealID]="dataSelected?.recID"
    [listContract]="listContract"
    [type]="'deal'"
  ></list-contracts>
</ng-template>
<!-- <ng-template #quotations let-data>
 <lib-quotations [funcID]="'CM0202'" [customerID]="dataSelected.customerID" ></lib-quotations>
</ng-template> -->
