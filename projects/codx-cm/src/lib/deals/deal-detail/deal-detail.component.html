<ng-container *ngIf="dataSelected?.recID">
  <codx-detail-tmp
    [header]="header"
    [formModel]="formModel"
    [body]="body"
    [dataItem]="dataSelected"
    [hideMF]="true"
    [footer]="tabs"
    (changeDataMF)="changeDataMF($event, dataSelected)"
    (clickMF)="clickMF($event, dataSelected)"
  >
    <ng-template #tooltipDealName>
      <div class="text-end text-sm-start">
        <strong>{{ gridViewSetup["DealName"]?.headerText }}</strong
        >: {{ dataSelected?.dealName }}
      </div>
    </ng-template>
    <ng-template #toolTipDealValue>
      <div class="text-end text-sm-start">
        <strong>{{ gridViewSetup["DealValue"]?.headerText }}</strong
        >: {{ dataSelected?.dealValue }}
      </div>
    </ng-template>
    <ng-template #toolTipProbability>
      <div class="text-end text-sm-start">
        <strong>{{ gridViewSetup["Probability"]?.headerText }}</strong
        >: {{ dataSelected?.probability }}
      </div>
    </ng-template>
    <ng-template #header let-data>
      <div class="d-flex justify-content-between">
        <div class="text-info d-flex align-items-center">
          <i class="icon-add_shopping_cart icon-18 me-2 text-gray-700"></i>
          <span
            class="text-dark fs-6 fw-bold line-clamp-menu"
            [ngbTooltip]="gridViewSetup['BusinessLineID']?.headerText"
            #businessLineID
            [innerHTML]="
              dataSelected?.businessLineID
                | formatvalue
                  : formModel
                  : 'businessLineID'
                  : businessLineID
                  : 'CMDeals'
                  : 'grvCMDeals'
                | async
            "
          ></span>
        </div>
        <div></div>
        <div>
          <codx-mfunc
            [hideMF]="false"
            [dataItem]="dataSelected"
            [formModel]="formModel"
            (changeDataMF)="changeDataMF($event, dataSelected)"
            (clickMF)="clickMF($event, dataSelected)"
            [isBookMark]="true"
            type="view"
          ></codx-mfunc>
        </div>
      </div>

      <div class="container_detail mt-1">
        <div class="d-flex justify-content-between mb-2">
          <div class="d-flex flex-column w-100">
            <div class="d-flex align-items-start">
              <div class="me-4">
                <codx-img
                  [objectId]="dataSelected?.customerID"
                  [objectName]="dataSelected?.customerName"
                  [imgOn]="dataSelected?.modifiedOn"
                  [objectType]="'CM_Customers'"
                  [referType]="'avt'"
                  [width]="35"
                >
                </codx-img>
              </div>
              <div class="d-flex flex-column">
                <div class="text-gray-600">
                  {{ dataSelected.customerName }}
                </div>
                <div
                  class="fw-bold text-dark fs-5"
                  [ngbTooltip]="tooltipDealName"
                  #dealName
                  [innerHTML]="
                    dataSelected?.dealName
                      | formatvalue : formModel : 'dealName' : dealName
                      | async
                  "
                ></div>
              </div>
            </div>
          </div>
          <div class="ms-5 d-flex justify-content-between">
            <div class="d-flex flex-column">
              <div class="d-flex flex-row">
                <div
                  class="d-flex align-items-top justify-content-end fs-4"
                  [ngbTooltip]="toolTipDealValue"
                >
                  <span
                    class="icon-monetization_on pe-1 text-warning icon-16 mt-1"
                  ></span>
                  <span
                    class="fw-bold line-clamp-menu pe-1"
                    *ngIf="dataSelected?.dealValue; else defaultNull"
                    #dealValue
                    [innerHTML]="
                      dataSelected?.dealValue
                        | formatvalue : formModel : 'dealValue' : dealValue
                        | async
                    "
                  ></span>
                  <span
                    [ngClass]="
                      dataSelected?.currencyID ? '' : 'line-clamp-menu'
                    "
                    class="text-gray-700"
                    [ngbTooltip]="gridViewSetup['CurrencyID']?.headerText"
                    #currencyID
                    [innerHTML]="
                      dataSelected?.currencyID
                        | formatvalue : formModel : 'currencyID'
                        | async
                    "
                  ></span>
                </div>
              </div>
              <div class="d-flex justify-content-end">
                <div
                  class="d-flex align-items-top justify-content-end ps-10 fs-6"
                  [ngbTooltip]="gridViewSetup['Probability']?.headerText"
                >
                  <span
                    class="icon-check_circle text-green icon-16 mt-1 pe-1"
                  ></span>
                  <span
                    *ngIf="dataSelected?.probability; else defaultNull"
                    class="line-clamp-menu"
                    [ngbTooltip]="gridViewSetup['Probability']?.headerText"
                    #probability
                    [innerHTML]="
                      dataSelected?.probability
                        | formatvalue : formModel : 'probability' : probability
                        | async
                    "
                  ></span
                  >%
                </div>

                <span
                  class="text-gray-600 line-clamp-menu ps-3"
                  #expectedClosed
                  [ngbTooltip]="gridViewSetup['ExpectedClosed']?.headerText"
                  [innerHTML]="
                    dataSelected?.expectedClosed
                      | formatvalue
                        : formModel
                        : 'expectedClosed'
                        : expectedClosed
                      | async
                  "
                ></span>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex align-items-top justify-content-between">
          <div class="w-100 d-flex flex-column">
            <div class="d-flex align-items-top justify-content-between">
              <div class="w-100 d-flex flex-column">
                <div class="d-flex align-items-top mb-1">
                  <codx-label
                    fiedName="Industries"
                    class="text-dark fw-bold me-2 label-colon"
                    [setRequire]="false"
                    [formModel]="formModelCustomer"
                    default="Lĩnh vực hoạt động"
                  ></codx-label>
                  <span
                    class="text-gray-600"
                    #industries
                    [innerHTML]="
                      dataSelected?.industries
                        | formatvalue
                          : formModelCustomer
                          : 'industries'
                          : industries
                        | async
                    "
                  ></span>
                </div>
                <div class="d-flex align-items-top justify-content-start mb-1">
                  <codx-label
                    default="Nhu cầu:"
                    class="text-dark fw-bold me-2 text-nowrap"
                  ></codx-label>
                  <span
                    class="text-gray-700"
                    #note
                    [innerHTML]="
                      dataSelected?.note
                        | formatvalue
                          : formModel
                          : 'note'
                          : note
                          : 'CMDeals'
                          : 'grvCMDeals'
                        | async
                    "
                  ></span>
                </div>
                <div class="mb-1" *ngIf="viewTag && viewTag != ''">
                  <codx-tag
                    [entityName]="formModel.entityName"
                    [disabled]="true"
                    [isEdit]="false"
                    [value]="viewTag"
                  >
                  </codx-tag>
                </div>
                <div class="d-flex flex-wrap align-items-top mb-1">
                  <div class="d-flex flex-column">
                    <div class="mb-2">
                      <codx-label
                        class="text-dark fw-bold"
                        default="Liên hệ chính:"
                      ></codx-label>
                    </div>
                    <div class="d-flex align-items-start">
                      <div class="me-3" *ngIf="contactPerson">
                        <codx-img
                          [objectId]="contactPerson?.recID"
                          [objectName]="contactPerson?.contactName"
                          [imgOn]="contactPerson?.modifiedOn"
                          [objectType]="'CM_Contacts'"
                          [width]="60"
                        >
                        </codx-img>
                      </div>
                      <div class="me-3" *ngIf="!contactPerson">
                        <codx-img
                          [objectId]="null"
                          [objectName]="null"
                          [imgOn]="null"
                          [width]="60"
                        >
                        </codx-img>
                      </div>
                      <div class="d-flex flex-column">
                        <span
                          class="fw-bold text-dark fs-6 mb-1"
                          #contactName
                          [innerHTML]="
                            dataSelected?.contactName
                              | formatvalue
                                : formModel
                                : 'contactName'
                                : contactName
                              | async
                          "
                        ></span>

                        <div>
                          {{ contactPerson?.contactName }}
                        </div>
                        <div class="fs-7 text-gray-600 mb-1">
                          {{ contactPerson?.role }}
                        </div>
                        <div class="d-flex align-items-start">
                          <div
                            class="d-flex align-items-center me-5"
                            *ngIf="contactPerson?.mobile"
                          >
                            <span
                              class="icon-phone_android text-primary icon-16 me-2"
                            ></span>
                            <span class="text-gray-800 fs-7">{{
                              contactPerson?.mobile
                            }}</span>
                          </div>
                          <div
                            class="d-flex align-items-center"
                            *ngIf="contactPerson?.personalEmail"
                          >
                            <span
                              class="icon-print_disabled icon-16 me-2 text-gray-600"
                            ></span>
                            <span class="text-gray-800 fs-7">{{
                              contactPerson?.personalEmail
                            }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="w-175px min-w-175px d-flex flex-column">
                <div class="d-flex flex-column">
                  <div
                    class="mb-2 d-flex align-items-center justify-content-end"
                  >
                    <div
                      *ngIf="dataSelected.status == '2'; else statusDefault"
                      [ngStyle]="{
                        'background-color':
                          dataSelected?.steps['backgroundColor']
                      }"
                      class="badge badge-sm d-flex align-items-center"
                    >
                      <span
                        [ngClass]="dataSelected?.steps['icon']"
                        [ngStyle]="{ color: dataSelected?.steps['iconColor'] }"
                        class="me-1"
                      ></span>
                      <span
                        class="text-ellipsis line-clamp line-clamp-1"
                        [ngbTooltip]="dataSelected?.currentStepName"
                        [ngStyle]="{ color: dataSelected?.steps['textColor'] }"
                        >{{ dataSelected?.currentStepName }}</span
                      >
                    </div>
                    <ng-template #statusDefault>
                      <codx-vll
                        [name]="gridViewSetup?.Status?.referedValue"
                        [field]="'Status'"
                        [value]="dataSelected?.status"
                        [showText]="true"
                        [showBgColor]="true"
                        class="badge badge-light badge-sm"
                      >
                      </codx-vll>
                    </ng-template>
                  </div>

                  <div
                    class="d-flex flex-column align-items-top"
                    style="margin-top: 2.25rem !important"
                  >
                    <div class="d-flex justify-content-end">
                      <codx-label
                        default="Bán hàng/Tư vấn"
                        class="text-dark fw-bold mb-2"
                      ></codx-label>
                    </div>
                    <div class="d-flex justify-content-end">
                      <codx-imgs
                        [width]="30"
                        [objectId]="dataSelected.owner"
                        ojectType="AD_Users"
                        [numberImages]="1"
                      >
                      </codx-imgs>

                      <codx-imgs
                        [width]="30"
                        [objectId]="dataSelected.consultantID"
                        ojectType="AD_Users"
                        [numberImages]="1"
                      >
                      </codx-imgs>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- <div class="view-details-header bg-body scroll-y me-3 h-100">
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex tab-header">
                  <codx-taskbar
                    [listTab]="tabDetail"
                    [change]="dataSelected"
                    (tab)="changeTab($event)"
                    size="18"
                    class="mb-3"
                  ></codx-taskbar>
                </div>
              </div>
            </div> -->
          </div>
        </div>
      </div>
    </ng-template>
  </codx-detail-tmp>
</ng-container>
<ng-template #body let-data>
  <div class="d-flex flex-column">
    <!-- <codx-taskbar
      [listTab]="tabDetail"
      [change]="dataSelected"
      (tab)="changeTab($event)"
      size="18"
      class="mb-3"
    ></codx-taskbar> -->

    <codx-tab-deal-detail
      [tabClicked]="tabClicked"
      [dataSelected]="dataSelected"
      [formModel]="formModel"
      [listSteps]="listSteps"
      [isUpdateTab]="isUpdateTab"
      [checkMoreReason]="checkMoreReason"
      (saveAssign)="saveAssign($event)"
      [tabDetail]="tabDetail"
      [mergedList]="mergedList"
    ></codx-tab-deal-detail>
  </div>
</ng-template>
<ng-template #tabs let-data>
  <codx-tabs
    [entityName]="formModel.entityName"
    [formModel]="formModel"
    [TabControl]="tabControl"
    [objectID]="dataSelected.recID"
    [funcID]="formModel.funcID"
    [dataTree]="treeTask"
    [funcIDQuotations]="'CM0202'"
    [predicates]="'RefType==@0 && RefID==@1'"
    [dataValues]="formModel.entityName + ';' + dataSelected.recID"
    [refType]="formModel.entityName"
    [refID]="dataSelected.recID"
    [customerID]="dataSelected.customerID"
    [salespersonID]="dataSelected.salespersonID"
    [consultantID]="dataSelected.consultantID"
    (tabChange)="changeFooter($event)"
    [disableRefID]="true"
  ></codx-tabs>
</ng-template>

<ng-template #referencesDeal>
  <div *ngIf="mergedList?.length > 0 && mergedList != null; else noData">
    <div *ngFor="let item of mergedList" class="p-3">
      <div class="d-flex justify-content-start">
        <div>
          <i [class]="getSettingValue(item?.type, 'icon')"></i>
        </div>
        <div class="d-flex align-items-stretch">
          <codx-label
            [default]="getSettingValue(item?.type, 'headerText')"
            class="pe-2"
          ></codx-label>
          <span
            *ngIf="item?.type == '1'"
            class="text-gray-700 line-clamp-menu"
            [ngbTooltip]="grvSetupQuotation['VersionName']?.headerText"
            #versionName
            [innerHTML]="
              item?.versionName
                | formatvalue : formModelQuotations : 'versionName'
                | async
            "
          ></span>
        </div>
        <div
          class="ms-auto"
          [ngbTooltip]="getSettingValue(item?.type, 'deadValue')"
        >
          <span
            class="icon-monetization_on pe-1 text-warning icon-16 mt-1"
          ></span>
          <span
            class="text-gray-700 line-clamp-menu pe-2"
            #totalAmt
            [innerHTML]="
              item?.totalAmt
                | formatvalue : formModelQuotations : 'totalAmt'
                | async
            "
          ></span>
          <span
            class="text-gray-700 line-clamp-menu"
            #currencyID
            [innerHTML]="
              item?.currencyID
                | formatvalue
                  : getSettingValue(item?.type, 'formModel')
                  : 'currencyID'
                | async
            "
          ></span>
        </div>
      </div>
      <div class="d-flex justify-content-start">
        <span [ngbTooltip]="getSettingValue(item?.type, 'name')">
          {{ item?.name }}
        </span>
      </div>
      <div class="d-flex justify-content-between">
        <div class="first-div d-flex align-items-start">
          <codx-vll
            [name]="getSettingValue(item?.type, 'status')"
            [field]="'Status'"
            [value]="item?.status"
            [showText]="true"
            [showBgColor]="true"
            class="badge badge-light badge-sm"
          >
          </codx-vll>
          <div [ngbTooltip]="getSettingValue(item?.type, 'createOn')">
            <span class="icon-16 icon-av_timer me-1"></span>
            <span
              class="text-gray-700 line-clamp-menu"
              #createdOn
              [innerHTML]="
                item?.createdOn
                  | formatvalue
                    : getSettingValue(item?.type, 'formModel')
                    : 'createdOn'
                  | async
              "
            ></span>
          </div>
        </div>
        <div class="last-div">
          <codx-imgs
            [isToolTip]="true"
            [width]="25"
            [objectId]="item?.createdBy"
            objectType="AD_Users"
            [numberImages]="1"
          >
          </codx-imgs>
        </div>
      </div>
    </div>
  </div>
  <ng-template #noData>
    <codx-no-data> </codx-no-data>
  </ng-template>
</ng-template>
<ng-template #defaultNull> <p>0</p></ng-template>
