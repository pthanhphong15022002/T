<ng-container *ngIf="dataSelected?.recID">
  <codx-detail-tmp
    [header]="header"
    [formModel]="formModel"
    [body]="body"
    [dataItem]="dataSelected"
    [hideMF]="true"
    [footer]="tabs"
    (changeDataMF)="changeDataMF($event, dataSelected)"
    (clickMF)="clickMF($event, dataSelected)"
  >
    <ng-template #tooltipDealName>
      <div class="text-end text-sm-start">
        <strong>{{ gridViewSetup["DealName"]?.headerText }}</strong
        >: {{ dataSelected?.dealName }}
      </div>
    </ng-template>
    <ng-template #toolTipDealValue>
      <div class="text-end text-sm-start">
        <strong>{{ gridViewSetup["DealValue"]?.headerText }}</strong
        >: {{ dataSelected?.dealValue }}
      </div>
    </ng-template>
    <ng-template #toolTipProbability>
      <div class="text-end text-sm-start">
        <strong>{{ gridViewSetup["Probability"]?.headerText }}</strong
        >: {{ dataSelected?.probability }}
      </div>
    </ng-template>
    <ng-template #header let-data>
      <div class="d-flex justify-content-between mb-2">
        <div
          class="text-info d-flex align-items-center"
          [ngbTooltip]="gridViewSetup['BusinessLineID']?.headerText"
        >
          <i class="icon-add_shopping_cart icon-18 me-2 text-gray-700"></i>
          <span
            class="text-dark fs-6 fw-bold line-clamp-menu"
            #businessLineID
            [innerHTML]="
              dataSelected?.businessLineID
                | formatvalue
                  : formModel
                  : 'businessLineID'
                  : businessLineID
                  : 'CMDeals'
                  : 'grvCMDeals'
                | async
            "
          ></span>
        </div>
        <div class="toolbar-detail">
          <codx-mfunc
            [hideMF]="false"
            [dataItem]="dataSelected"
            [formModel]="formModel"
            (changeDataMF)="changeDataMF($event, dataSelected)"
            (clickMF)="clickMF($event, dataSelected)"
            [isBookMark]="true"
            type="view"
          ></codx-mfunc>
        </div>
      </div>

      <div class="container_detail mt-1">
        <div class="d-flex justify-content-between mb-3">
          <div class="d-flex flex-column w-100">
            <div class="d-flex align-items-start">
              <div class="me-4">
                <codx-img
                  [objectId]="dataSelected?.customerID"
                  [objectName]="dataSelected?.customerName"
                  [imgOn]="dataSelected?.modifiedOn"
                  [objectType]="'CM_Customers'"
                  [referType]="'avt'"
                  [width]="35"
                >
                </codx-img>
              </div>
              <div class="d-flex flex-column">
                <div class="text-gray-600">
                  {{ dataSelected.customerName }}
                </div>
                <div
                  class="fw-bold text-dark fs-5-sm"
                  [ngbTooltip]="tooltipDealName"
                  #dealName
                  [innerHTML]="
                    dataSelected?.dealName
                      | formatvalue : formModel : 'dealName' : dealName
                      | async
                  "
                ></div>
              </div>
            </div>
          </div>
          <div class="ms-5 d-flex justify-content-between">
            <div class="d-flex flex-column">
              <div class="d-flex justify-content-end">
                <div
                  class="d-flex align-items-top fs-5-sm"
                  [ngbTooltip]="toolTipDealValue"
                >
                  <span
                    class="icon-monetization_on pe-1 text-warning icon-16 mt-1"
                  ></span>
                  <span
                    class="fw-bold line-clamp-menu pe-1"
                    *ngIf="dataSelected?.dealValue; else defaultNull"
                    #dealValue
                    [innerHTML]="
                      dataSelected?.dealValue
                        | formatvalue : formModel : 'dealValue' : dealValue
                        | async
                    "
                  ></span>
                  <span
                    *ngIf="dataSelected?.currencyID"
                    [ngClass]="
                      dataSelected?.currencyID ? '' : 'line-clamp-menu'
                    "
                    class="text-gray-700"
                    [ngbTooltip]="gridViewSetup['CurrencyID']?.headerText"
                    #currencyID
                    [innerHTML]="
                      dataSelected?.currencyID
                        | formatvalue : formModel : 'currencyID'
                        | async
                    "
                  ></span>
                </div>
              </div>
              <div class="d-flex align-items-center justify-content-end mt-1">
                <div
                  class="d-flex align-items-center"
                  [ngbTooltip]="gridViewSetup['Probability']?.headerText"
                >
                  <span
                    class="icon-check_circle text-green icon-14 me-1"
                  ></span>
                  <span
                    *ngIf="dataSelected?.probability; else defaultNull"
                    class="line-clamp-menu"
                    [ngbTooltip]="gridViewSetup['Probability']?.headerText"
                    #probability
                    [innerHTML]="
                      dataSelected?.probability
                        | formatvalue : formModel : 'probability' : probability
                        | async
                    "
                  ></span
                  >%
                </div>
                <span
                  [ngClass]="
                    dataSelected?.expectedClosed
                      ? 'text-gray-600 ms-3'
                      : 'text-gray-600 ms-3 line-clamp line-clamp-1'
                  "
                  #expectedClosed
                  [ngbTooltip]="gridViewSetup['ExpectedClosed']?.headerText"
                  [innerHTML]="
                    dataSelected?.expectedClosed
                      | formatvalue
                        : formModel
                        : 'expectedClosed'
                        : expectedClosed
                      | async
                  "
                ></span>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex align-items-top justify-content-between">
          <div class="w-100 d-flex flex-column">
            <div class="d-flex align-items-top justify-content-between">
              <div class="w-100 d-flex flex-column">
                <div class="d-flex align-items-top">
                  <codx-label
                    fiedName="Industries"
                    class="text-dark fw-bold me-2 label-colon"
                    [setRequire]="false"
                    [formModel]="formModelCustomer"
                    default="Lĩnh vực hoạt động"
                  ></codx-label>
                  <span
                    class="text-gray-600"
                    #industries
                    [innerHTML]="
                      dataSelected?.industries
                        | formatvalue
                          : formModelCustomer
                          : 'industries'
                          : industries
                        | async
                    "
                  ></span>
                </div>
                <div class="d-flex align-items-top justify-content-start">
                  <codx-label
                    default="Nhu cầu:"
                    class="text-dark fw-bold me-2 text-nowrap"
                  ></codx-label>
                  <span
                    class="text-gray-700"
                    #note
                    [innerHTML]="
                      dataSelected?.note
                        | formatvalue
                          : formModel
                          : 'note'
                          : note
                          : 'CMDeals'
                          : 'grvCMDeals'
                        | async
                    "
                  ></span>
                </div>
                <div class="" *ngIf="viewTag && viewTag != ''">
                  <codx-tag
                    [entityName]="formModel.entityName"
                    [disabled]="true"
                    [isEdit]="false"
                    [value]="viewTag"
                  >
                  </codx-tag>
                </div>
                <div class="d-flex flex-wrap align-items-top mb-1 mt-2">
                  <div class="d-flex flex-column">
                    <div class="mb-1">
                      <codx-label
                        class="text-dark fw-bold"
                        default="Liên hệ chính:"
                      ></codx-label>
                    </div>
                    <div class="d-flex align-items-start">
                      <div class="me-3" *ngIf="contactPerson">
                        <codx-img
                          [objectId]="contactPerson?.recID"
                          [objectName]="contactPerson?.contactName"
                          [imgOn]="contactPerson?.modifiedOn"
                          [objectType]="'CM_Contacts'"
                          [width]="50"
                        >
                        </codx-img>
                      </div>
                      <div class="me-3" *ngIf="!contactPerson">
                        <codx-img
                          [objectId]="null"
                          [objectName]="null"
                          [imgOn]="null"
                          [width]="50"
                        >
                        </codx-img>
                      </div>
                      <div class="d-flex flex-column">
                        <div
                          class="fw-bold text-dark fs-6"
                          #contactName
                          [innerHTML]="
                            dataSelected?.contactName
                              | formatvalue
                                : formModel
                                : 'contactName'
                                : contactName
                              | async
                          "
                        ></div>

                        <div class="fs-6 fw-bold text-dark">
                          {{ contactPerson?.contactName }}
                        </div>
                        <div class="fs-7 text-gray-600">
                          {{ contactPerson?.role }}
                        </div>
                        <div class="d-flex align-items-start">
                          <div
                            class="d-flex align-items-center me-3"
                            *ngIf="contactPerson?.mobile"
                          >
                            <span
                              class="icon-phone_android text-primary icon-14 me-1"
                            ></span>
                            <span class="text-gray-800 fs-7">{{
                              contactPerson?.mobile
                            }}</span>
                          </div>
                          <div
                            class="d-flex align-items-center"
                            *ngIf="contactPerson?.personalEmail"
                          >
                            <span
                              class="icon-print_disabled icon-14 me-1 text-gray-600"
                            ></span>
                            <span class="text-gray-800 fs-7">{{
                              contactPerson?.personalEmail
                            }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="w-175px min-w-175px d-flex flex-column">
                <div class="d-flex flex-column">
                  <div
                    class="mb-1 d-flex align-items-center justify-content-end"
                  >
                    <div
                      *ngIf="dataSelected.status == '2'; else statusDefault"
                      [ngStyle]="{
                        'background-color':
                          dataSelected?.steps['backgroundColor']
                      }"
                      class="badge badge-sm d-flex align-items-center me-0"
                    >
                      <span
                        [ngClass]="dataSelected?.steps['icon']"
                        [ngStyle]="{ color: dataSelected?.steps['iconColor'] }"
                        class="me-1"
                      ></span>
                      <span
                        class="text-ellipsis line-clamp line-clamp-1"
                        [ngbTooltip]="dataSelected?.currentStepName"
                        [ngStyle]="{ color: dataSelected?.steps['textColor'] }"
                        >{{ dataSelected?.currentStepName }}</span
                      >
                    </div>
                    <ng-template #statusDefault>
                      <codx-vll
                        [name]="gridViewSetup?.Status?.referedValue"
                        [field]="'Status'"
                        [value]="dataSelected?.status"
                        [showText]="true"
                        [showBgColor]="true"
                        class="badge badge-light badge-sm me-0"
                      >
                      </codx-vll>
                    </ng-template>
                    <ng-container
                      *ngIf="
                        dataSelected?.approveStatus &&
                        dataSelected?.approveStatus != '1'
                      "
                    >
                      <codx-vll
                        [name]="gridViewSetup?.ApproveStatus.referedValue"
                        [field]="'ApproveStatus'"
                        [value]="dataSelected?.approveStatus"
                        [showText]="true"
                        [showBgColor]="true"
                        class="badge badge-primary badge-sm"
                      >
                      </codx-vll>
                    </ng-container>
                  </div>
                  <ng-template #tooltipSalesperson>
                    <div class="d-flex justify-content-center fw-bold fs-6">
                      <span
                        #salespersonID
                        [innerHTML]="
                          dataSelected?.salespersonID
                            | formatvalue
                              : formModel
                              : 'salespersonID'
                              : salespersonID
                            | async
                        "
                      ></span>
                    </div>
                    <div class="d-flex justify-content-center">
                      {{ gridViewSetup["SalespersonID"]?.headerText }}
                    </div>
                  </ng-template>
                  <ng-template #tooltipConsultant>
                    <div class="d-flex justify-content-center fw-bold fs-6">
                      <span
                        #consultantID
                        [innerHTML]="
                          dataSelected?.consultantID
                            | formatvalue
                              : formModel
                              : 'consultantID'
                              : consultantID
                            | async
                        "
                      ></span>
                    </div>
                    <div class="d-flex justify-content-center">
                      {{ gridViewSetup["ConsultantID"]?.headerText }}
                    </div>
                  </ng-template>
                  <div
                    class="d-flex flex-column align-items-top"
                    style="margin-top: 2.25rem !important"
                  >
                    <div class="d-flex justify-content-end">
                      <codx-label
                        default="Bán hàng/Tư vấn"
                        class="text-dark fw-bold mb-2"
                      ></codx-label>
                    </div>
                    <div class="d-flex justify-content-end">
                      <div
                        style="position: relative"
                        [ngbTooltip]="tooltipSalesperson"
                        *ngIf="dataSelected?.salespersonID"
                      >
                        <codx-img
                          [width]="30"
                          [objectId]="dataSelected.salespersonID"
                          objectType="AD_Users"
                          [referType]="'avt'"
                          [numberImages]="1"
                        >
                        </codx-img>
                        <div
                          style="position: absolute; right: 0px; bottom: 0px"
                        >
                          <span
                            ><img
                              src="/assets/themes/cm/default/img/{{
                                getIcon('3')
                              }}"
                              alt=""
                          /></span>
                        </div>
                      </div>
                      <div
                        style="position: relative"
                        [ngbTooltip]="tooltipConsultant"
                        *ngIf="dataSelected?.consultantID"
                      >
                        <codx-imgs
                          [width]="30"
                          [objectId]="dataSelected?.consultantID"
                          ojectType="AD_Users"
                          [numberImages]="1"
                          [isToolTip]="false"
                        >
                        </codx-imgs>
                        <div
                          style="position: absolute; right: 0px; bottom: 0px"
                        >
                          <span
                            ><img
                              src="/assets/themes/cm/default/img/{{
                                getIcon('5')
                              }}"
                              alt=""
                          /></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </codx-detail-tmp>
</ng-container>
<ng-template #body let-data>
  <div style="overflow: hidden">
    <ejs-tab>
      <e-tabitems>
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top">
              <span class="icon-info icon-16 me-2"></span>
              <span>
                <codx-label
                  class="fw-bold"
                  default="Thông tin chung"
                  [formModel]="formModel"
                  name="lblInformation"
                ></codx-label>
              </span>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="d-flex flex-column mt-4">
              <div class="text-dark text-primary fw-bold fs-6 mb-3">
                <codx-label default="Thông tin chung"></codx-label>
              </div>
              <div class="mb-3">
                <div class="row">
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label default="Mã cơ hội"></codx-label>:
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        {{ dataSelected?.dealID }}
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          fiedName="ChannelID"
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #channelID
                          [innerHTML]="
                            dataSelected?.channelID
                              | formatvalue
                                : formModel
                                : 'channelID'
                                : channelID
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          fiedName="Category"
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          default="Loại cơ hội"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        {{ getNameCategory(dataSelected?.category) }}
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          fiedName="CampaignID"
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #campaignID
                          [innerHTML]="
                            dataSelected?.campaignID
                              | formatvalue
                                : formModel
                                : 'campaignID'
                                : campaignID
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="ExpectedClosed"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #expectedClosed
                          [innerHTML]="
                            dataSelected?.expectedClosed
                              | formatvalue
                                : formModel
                                : 'expectedClosed'
                                : expectedClosed
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="ConsultantID"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #consultantID
                          [innerHTML]="
                            dataSelected?.consultantID
                              | formatvalue
                                : formModel
                                : 'consultantID'
                                : consultantID
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="Probability"
                        ></codx-label>
                      </div>
                      <div
                        class="text-dark fw-bold codx-textcontent d-flex justify-content-start"
                      >
                        <span
                          #probability
                          *ngIf="dataSelected?.probability; else defaultNull"
                          [innerHTML]="
                            dataSelected?.probability
                              | formatvalue
                                : formModel
                                : 'probability'
                                : probability
                              | async
                          "
                        ></span
                        >%
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="SalespersonID"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #salespersonID
                          [innerHTML]="
                            dataSelected?.salespersonID
                              | formatvalue
                                : formModel
                                : 'salespersonID'
                                : salespersonID
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>
                <!--
                <div class="row">

                </div> -->

                <div class="row">
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="DealValue"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #dealValue
                          *ngIf="dataSelected?.dealValue; else defaultNull"
                          [innerHTML]="
                            dataSelected?.dealValue
                              | formatvalue
                                : formModel
                                : 'dealValue'
                                : dealValue
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="DealValueTo"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #dealValueTo
                          [innerHTML]="
                            dataSelected?.dealValueTo
                              | formatvalue
                                : formModel
                                : 'dealValueTo'
                                : dealValueTo
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="ExpectedFrom"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #expectedFrom
                          *ngIf="dataSelected?.expectedFrom"
                          [innerHTML]="
                            dataSelected?.expectedFrom
                              | formatvalue
                                : formModel
                                : 'expectedFrom'
                                : expectedFrom
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-1 d-flex align-items-top">
                      <div
                        class="w-150px min-w-150px text-gray-600 codx-textlabel"
                      >
                        <codx-label
                          class="me-2 label-colon"
                          [setRequire]="false"
                          [formModel]="formModel"
                          fiedName="ExpectedTo"
                        ></codx-label>
                      </div>
                      <div class="text-dark fw-bold codx-textcontent">
                        <span
                          #expectedTo
                          [innerHTML]="
                            dataSelected?.expectedTo
                              | formatvalue
                                : formModel
                                : 'expectedTo'
                                : expectedTo
                                : 'CMDeals'
                                : 'grvCMDeals'
                              | async
                          "
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-5">
                <div class="text-dark text-primary fw-bold fs-6 mb-3">
                  <codx-label
                    fiedName="Memo"
                    [setRequire]="false"
                    [formModel]="formModel"
                  ></codx-label>
                </div>
                <span
                  #memo
                  [innerHTML]="
                    dataSelected.memo
                      | formatvalue : formModel : 'memo' : memo
                      | async
                  "
                ></span>
              </div>
              <div *ngIf="dataSelected?.steps?.isHaveField">
                <div class="d-flex flex-column mt-5">
                  <ng-container *ngFor="let item of listSteps">
                    <codx-fields-detail-temp
                      *ngIf="item?.fields?.length > 0"
                      [dataStep]="item"
                      [showColumnControl]="showColumnControl(item.stepID)"
                      [isUpdate]="
                        ['1', '2'].includes(dataSelected.status) &&
                        dataSelected?.roles?.isOnwer
                      "
                      (saveDataStep)="saveDataStep($event)"
                    >
                    </codx-fields-detail-temp>
                  </ng-container>
                </div>
              </div>
            </div>
          </ng-template>
        </e-tabitem>
        <!-- <e-tabitem *ngIf="dataSelected?.steps?.isHaveField">
        <ng-template #headerText>
          <div class="d-flex align-items-top">
            <span class="icon-add_to_photos icon-16 me-1"></span>
            <codx-label
              class="fw-bold"
              default="Trường tùy chỉnh"
              [formModel]="formModel"
              name="lblField"
            ></codx-label>
          </div>
        </ng-template>
        <ng-template #content>
          <div class="d-flex flex-column mt-4">
            <ng-container *ngFor="let item of listSteps">
              <codx-fields-detail-temp
                *ngIf="item?.fields?.length > 0"
                [dataStep]="item"
                [showColumnControl]="showColumnControl(item.stepID)"
                [isUpdate]=" ['1', '2'].includes(dataSelected.status) && dataSelected?.roles?.isOnwer"
                (saveDataStep)="saveDataStep($event)"
              >
              </codx-fields-detail-temp>
            </ng-container>
          </div>
        </ng-template>
        </e-tabitem> -->
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top">
              <span class="icon-add_to_photos icon-16 me-1"></span>
              <codx-label
                class="fw-bold"
                default="Liên hệ"
                [formModel]="formModel"
                name="lblContanct"
              ></codx-label>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="mt-4">
              <codx-list-contacts
                #loadContactDeal
                [selectAll]="false"
                [funcID]="'CM0205'"
                [objectID]="dataSelected?.recID"
                [objectName]="dataSelected.dealName"
                [customerID]="dataSelected?.customerID"
                [objectType]="'4'"
                [type]="'formDetail'"
                [hidenMF]="
                  !dataSelected?.write ||
                  dataSelected?.closed ||
                  ['1', '0', '3', '5'].includes(dataSelected.status)
                "
                (contactEvent)="contactChange($event)"
              ></codx-list-contacts>
            </div>
          </ng-template>
        </e-tabitem>
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top">
              <span class="icon-add_to_photos icon-16 me-1"></span>
              <codx-label
                class="fw-bold"
                default="Đối thủ"
                [formModel]="formModel"
                name="lblOpponent"
              ></codx-label>
            </div>
          </ng-template>
          <ng-template #content>
            <div class="mt-4">
              <codx-tab-dealcompetitors
                [dealID]="dataSelected.recID"
                [hidenMF]="
                  !dataSelected?.write ||
                  dataSelected.closed ||
                  ['1', '0', '3', '5'].includes(dataSelected.status)
                "
              ></codx-tab-dealcompetitors>
            </div>
          </ng-template>
        </e-tabitem>
        <e-tabitem>
          <ng-template #headerText>
            <div class="d-flex align-items-top">
              <span class="icon-more icon-16 me-2"></span>
              <codx-label
                class="fw-bold"
                default="Quy trình xử lý"
                [formModel]="formModel"
                name="lblProcess"
              ></codx-label>
            </div>
          </ng-template>
          <ng-template #content let-data="value">
            <div *ngIf="listSteps?.length > 0 && listSteps">
              <step-task
                [isDataLoading]="isDataLoading"
                [dataSelected]="dataSelected"
                [formModel]="formModel"
                [listInstanceStep]="listSteps"
                [applyFor]="'1'"
                (continueStep)="continueStep($event)"
                (saveAssignTask)="saveAssignTask($event)"
                (changeProgress)="autoStart($event)"
              ></step-task>
            </div>
          </ng-template>
        </e-tabitem>
      </e-tabitems>
    </ejs-tab>
  </div>
</ng-template>
<ng-template #tabs let-data>
  <codx-tabs
    [entityName]="formModel.entityName"
    [formModel]="formModel"
    [TabControl]="tabControl"
    [objectID]="dataSelected.recID"
    [funcID]="formModel.funcID"
    [dataTree]="treeTask"
    [funcIDQuotations]="'CM0202'"
    [predicates]="'RefType==@0 && RefID==@1'"
    [dataValues]="formModel.entityName + ';' + dataSelected.recID"
    [refType]="formModel.entityName"
    [refID]="dataSelected.recID"
    [transID]="dataSelected?.recID"
    [approveStatus]="dataSelected.approveStatus"
    (tabChange)="changeFooter($event)"
  ></codx-tabs>
</ng-template>

<ng-template #referencesDeal>
  <div *ngIf="mergedList?.length > 0 && mergedList != null; else noData">
    <div *ngFor="let item of mergedList" class="p-3">
      <div class="d-flex justify-content-start">
        <div>
          <i [class]="getSettingValue(item?.type, 'icon')"></i>
        </div>
        <div class="d-flex align-items-stretch">
          <codx-label
            [default]="getSettingValue(item?.type, 'headerText')"
            class="pe-2"
          ></codx-label>
          <span
            *ngIf="item?.type == '1'"
            class="text-gray-700 line-clamp-menu"
            [ngbTooltip]="grvSetupQuotation['VersionName']?.headerText"
            #versionName
            [innerHTML]="
              item?.versionName
                | formatvalue : formModelQuotations : 'versionName'
                | async
            "
          ></span>
        </div>
        <div
          class="ms-auto"
          [ngbTooltip]="getSettingValue(item?.type, 'deadValue')"
        >
          <span
            class="icon-monetization_on pe-1 text-warning icon-16 mt-1"
          ></span>
          <span
            class="text-gray-700 line-clamp-menu pe-2"
            #totalAmt
            [innerHTML]="
              item?.totalAmt
                | formatvalue : formModelQuotations : 'totalAmt'
                | async
            "
          ></span>
          <span
            class="text-gray-700 line-clamp-menu"
            #currencyID
            [innerHTML]="
              item?.currencyID
                | formatvalue
                  : getSettingValue(item?.type, 'formModel')
                  : 'currencyID'
                | async
            "
          ></span>
        </div>
      </div>
      <div class="d-flex justify-content-start">
        <span [ngbTooltip]="getSettingValue(item?.type, 'name')">
          {{ item?.name }}
        </span>
      </div>
      <div class="d-flex justify-content-between">
        <div class="first-div d-flex align-items-start">
          <codx-vll
            [name]="getSettingValue(item?.type, 'status')"
            [field]="'Status'"
            [value]="item?.status"
            [showText]="true"
            [showBgColor]="true"
            class="badge badge-light badge-sm me-0"
          >
          </codx-vll>
          <div
            class="d-flex align-items-center"
            [ngbTooltip]="getSettingValue(item?.type, 'createOn')"
          >
            <span class="icon-16 icon-av_timer me-1"></span>
            <span
              class="text-gray-700 line-clamp-menu"
              #createdOn
              [innerHTML]="
                item?.createdOn
                  | formatvalue
                    : getSettingValue(item?.type, 'formModel')
                    : 'createdOn'
                  | async
              "
            ></span>
          </div>
        </div>
        <div class="last-div h-20px">
          <codx-imgs
            [isToolTip]="true"
            [width]="20"
            [objectId]="item?.createdBy"
            objectType="AD_Users"
            [numberImages]="1"
          >
          </codx-imgs>
        </div>
      </div>
    </div>
  </div>
  <ng-template #noData>
    <codx-no-data> </codx-no-data>
  </ng-template>
</ng-template>
<ng-template #defaultNull> <span class="pe-1">0</span></ng-template>
