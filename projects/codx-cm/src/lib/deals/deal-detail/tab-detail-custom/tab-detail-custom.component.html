
<div class="main-right">

<container-element [ngSwitch]="tabClicked">
  <some-element
    *ngSwitchCase="tabInformation"
    [ngTemplateOutlet]="information"
  ></some-element>
  <some-element
    *ngSwitchCase="tabField"
    [ngTemplateOutlet]="field"
  ></some-element>
  <some-element
  *ngSwitchCase="tabTask"
  [ngTemplateOutlet]="task"
></some-element>
  <some-element
    *ngSwitchCase="tabContact"
    [ngTemplateOutlet]="contact"
  ></some-element>
  <some-element
    *ngSwitchCase="tabOpponent"
    [ngTemplateOutlet]="opponent"
  ></some-element>
  <some-element
    *ngSwitchCase="tabQuotation"
    [ngTemplateOutlet]="quotation"
  ></some-element>
  <some-element
    *ngSwitchCase="tabContract"
    [ngTemplateOutlet]="contract"
  ></some-element>

  <some-element *ngSwitchDefault></some-element>
</container-element>

</div>
<!-- nvthuan công việc -->
<ng-template #task let-data="value">
  <step-task
    [isDataLoading]="isDataLoading"
    [dataSelected]="dataSelected"
    [listInstanceStep]="listStep"
    [applyFor]="'1'"
    (continueStep)="continueStep($event)"
    (saveAssignTask)="saveAssignTask($event)"
  ></step-task>
</ng-template>
<!-- nvthuan sản phẩm -->
<ng-template #product>
  <div class="h-100">
    <codx-gridview-v2
      #gridProductsLine
      [formName]="fmProcductsLines.formName"
      [gridViewName]="fmProcductsLines.gridViewName"
      [entityName]="fmProcductsLines.entityName"
      [editSettings]="editSettings"
      [allowFiltering]="true"
      [allowSorting]="true"
      service="CM"
      [autoLoad]="false"
      rowHeight="40"
    ></codx-gridview-v2>
  </div>
</ng-template>

<ng-template #information>
  <div class="d-flex flex-column">
    <div class="text-dark text-primary fw-bold fs-6 mb-3">
      <codx-label default="Thông tin chung"></codx-label>
    </div>

    <div class="mb-3">
      <div class="row">
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label default="Mã cơ hội"></codx-label>:
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              {{ dataSelected?.dealID }}
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                fiedName="ChannelID"
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              <span
                #channelID
                [innerHTML]="
                  dataSelected?.channelID
                    | formatvalue
                      : formModel
                      : 'channelID'
                      : channelID
                      : 'CMDeals'
                      : 'grvCMDeals'
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                fiedName="Category"
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
                default="Loại cơ hội"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              {{ getNameCategory(dataSelected?.category) }}
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                fiedName="CampaignID"
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              <span
                #campaignID
                [innerHTML]="
                  dataSelected?.campaignID
                    | formatvalue
                      : formModel
                      : 'campaignID'
                      : campaignID
                      : 'CMDeals'
                      : 'grvCMDeals'
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
                fiedName="DealValue"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              <span
                #dealValue
                *ngIf="dataSelected?.dealValue; else defaultNull"
                [innerHTML]="
                  dataSelected?.dealValue
                    | formatvalue
                      : formModel
                      : 'dealValue'
                      : dealValue
                      : 'CMDeals'
                      : 'grvCMDeals'
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
                fiedName="ConsultantID"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              <span
                #consultantID
                [innerHTML]="
                  dataSelected?.consultantID
                    | formatvalue
                      : formModel
                      : 'consultantID'
                      : consultantID
                      : 'CMDeals'
                      : 'grvCMDeals'
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
                fiedName="Probability"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent d-flex justify-content-start">
              <span
                #probability
                *ngIf="dataSelected?.probability; else defaultNull"
                [innerHTML]="
                  dataSelected?.probability
                    | formatvalue
                      : formModel
                      : 'probability'
                      : probability
                    | async
                "
              ></span>%
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
                fiedName="SalespersonID"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              <span
                #salespersonID
                [innerHTML]="
                  dataSelected?.salespersonID
                    | formatvalue
                      : formModel
                      : 'salespersonID'
                      : salespersonID
                      : 'CMDeals'
                      : 'grvCMDeals'
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <div class="mb-3 d-flex align-items-top">
            <div class="w-150px min-w-150px text-gray-600 codx-textlabel">
              <codx-label
                class="me-2 label-colon"
                [setRequire]="false"
                [formModel]="formModel"
                fiedName="ExpectedClosed"
              ></codx-label>
            </div>
            <div class="text-dark fw-bold codx-textcontent">
              <span
                #expectedClosed
                [innerHTML]="
                  dataSelected?.expectedClosed
                    | formatvalue
                      : formModel
                      : 'expectedClosed'
                      : expectedClosed
                    | async
                "
              ></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-5">
      <div class="text-dark text-primary fw-bold fs-6 mb-3">
        <codx-label fiedName="Memo"                 [setRequire]="false"
        [formModel]="formModel" ></codx-label>
      </div>
      <span
      #memo
      [innerHTML]="
      dataSelected.memo
          | formatvalue
            : formModel
            : 'memo'
            : memo
          | async
      "
    ></span>
    </div>
  </div>
</ng-template>

<ng-template #contact>
  <div>
    <codx-list-contacts
      #loadContactDeal
      [selectAll]="false"
      [funcID]="'CM0205'"
      [objectID]="dataSelected?.recID"
      [objectName]="dataSelected.dealName"
      [customerID]="dataSelected?.customerID"
      [objectType]="'4'"
      [type]="'formDetail'"
      [hidenMF]="false"
      (contactEvent)="contactChange($event)"
    ></codx-list-contacts>
  </div>
</ng-template>

<ng-template #field>
  <div class="d-flex flex-column">
    <ng-container *ngFor="let item of listStep">
      <codx-fields-detail-temp
        *ngIf="item?.fields?.length > 0"
        [dataStep]="item"
        [showColumnControl]="showColumnControl(item.stepID)"
        [isUpdate]="dataSelected.status == '1' || dataSelected.status == '2' "
      >
      </codx-fields-detail-temp>
    </ng-container>
  </div>
</ng-template>

<ng-template #opponent>
  <codx-tab-dealcompetitors
    [dealID]="dataSelected.recID"
  ></codx-tab-dealcompetitors>
</ng-template>
<ng-template #quotation>
  <!-- <codx-quotations
    [typeModel]="'deals'"
    [showButton]="true"
    [predicates]="'RefID==@0'"
    [dataValues]="dataSelected.recID"
    [refID]="dataSelected.recID"
    [refType]="'CM_Deals'"
    [disableRefID]="true"
  >
  </codx-quotations> -->
  <codx-quotations-tab-view
  [typeModel]="'deals'"
  [showButton]="true"
  [predicates]="'RefID==@0'"
  [dataValues]="dataSelected.recID"
  [refID]="dataSelected.recID"
  [refType]="'CM_Deals'"
  [disableRefID]="true"
  [disableCusID]="true"
  [customerID]="dataSelected.customerID"
  ></codx-quotations-tab-view>
</ng-template>

<ng-template #contract let-data>
  <list-contracts
    [dealID]="dataSelected?.recID"
    [listContract]="listContract"
    [type]="'deal'"
  ></list-contracts>
</ng-template>
<ng-template #defaultNull> <p class="p-0 m-0">0</p></ng-template>
