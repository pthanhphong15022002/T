<codx-views
  #view
  [views]="views"
  [autoLoad]="false"
  [funcID]="funcID"
  (filterReportChange)="filterChange($event)"
  (onActions)="onActions($event)"
>
</codx-views>

<ng-template #template>
  <div class="w-100 h-100" *ngIf="isLoaded">
    <codx-dashboard
      [templates]="dashBoardDeals"
      [panels]="panelsDeals"
      [datas]="datasDeals"
      [isEditMode]="isEditMode"
      [cellSpacing]="[22, 20]"
    ></codx-dashboard>
  </div>
  <div class="w-100 h-100" *ngIf="!isLoaded">
    <div id="loader"></div>
  </div>
</ng-template>

<!-- cơ hội mới -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="1" [title]="getTitle('1')">
    <count-chart
      class="w-100 h-100"
      [hasIcon]="true"
      [iconUrl]="
        'assets/themes/cm/default/img/dashboard-status-new-i-clipboard-plus.svg'
      "
      [title]="getNameStatus('1')"
      [value]="dataDashBoard?.counts?.countNew ?? 0"
    ></count-chart>
  </div>
</ng-template>

<!-- cơ hội đang thực hiện -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="2" [title]="getTitle('2')">
    <count-chart
      class="w-100 h-100"
      [hasIcon]="true"
      [iconUrl]="
        'assets/themes/cm/default/img/dashboard-status-inprogress-i-clipboard-data.svg'
      "
      [title]="getNameStatus('2')"
      [value]="dataDashBoard?.counts?.countProcessing ?? 0"
    ></count-chart>
  </div>
</ng-template>

<!-- cơ hội thành công  -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="3" [title]="getTitle('3')">
    <count-chart
      class="w-100 h-100"
      [hasIcon]="true"
      [iconUrl]="
        'assets/themes/cm/default/img/dashboard-status-win-i-clipboard-check.svg'
      "
      [title]="getNameStatus('3')"
      [value]="dataDashBoard?.counts?.countSuccess ?? 0"
    ></count-chart>
  </div>
</ng-template>

<!-- cơ hội thất bại  -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="4" [title]="getTitle('5')">
    <count-chart
      class="w-100 h-100"
      [hasIcon]="true"
      [iconUrl]="
        'assets/themes/cm/default/img/dashboard-status-fail-i-clipboard-minus.svg'
      "
      [title]="getNameStatus('5')"
      [value]="dataDashBoard?.counts?.countFail ?? 0"
    ></count-chart>
  </div>
</ng-template>

<!-- Tỷ lệ phân bổ cơ hội theo dòng sản phẩm -->
<!-- title="Tỷ lệ phân bổ cơ hội theo dòng sản phẩm" -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="5" style="overflow: hidden">
    <div>
      <codx-label
        class="fs-5 fw-bold"
        name="lblPercentageOfBusinessLinesByDeals"
        default="Tỷ lệ phân bổ cơ hội theo dòng sản phẩm"
      ></codx-label>
    </div>
    <ng-container
      *ngIf="dataDashBoard?.countsBussinessLines?.length > 0; else noData"
    >
      <ejs-treemap
        class="w-100"
        style="display: block"
        [dataSource]="dataSourceBussnessLine ?? []"
        weightValuePath="quantity"
        rangeColorValuePath="quantity"
        [palette]="palette"
        [leafItemSettings]="leafItemSettings"
        [tooltipSettings]="{
          visible: true,
          format:
            '${businessLineName}<br>${quantity} ' +
            this.titLeModule +
            '-(${percentage} %)'
        }"
      >
      </ejs-treemap>
    </ng-container>
  </div>
</ng-template>

<!-- Thống kê tỷ lệ thành công thất bại trong năm theo dòng sản phẩm -->
<!-- title="Thống kê tỷ lệ thành công ,thất bại trong năm theo dòng sản phẩm" -->
<ng-template #templateDeals>
  <div class="chartBusinessLines w-100 h-100" id="6" style="overflow: hidden">
    <codx-label
      id="chartBusinessLinesHeader"
      class="fs-5 fw-bold"
      name="lblChartBusinessLines"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Thống kê tỷ lệ thành công, thất bại trong năm theo dòng sản phẩm"
    ></codx-label>
    <div id="chartBusinessLinesButton" class="mt-3">
      <div class="d-flex justify-content-center align-items-center">
        <div
          [ngClass]="checkBtnSuscess ? 'button-selected' : 'button-no-selected'"
          class="btn-left py-1 d-flex justify-content-center align-items-center"
        >
          <codx-label
            name="btSuccess"
            formModel=""
            default="Thành công"
          ></codx-label>
        </div>
        <div
          [ngClass]="checkBtnFail ? 'button-selected' : 'button-no-selected'"
          class="btn-right py-1 d-flex justify-content-center align-items-center"
        >
          <codx-label
            name="btFail"
            formModel=""
            default="Thất bại"
          ></codx-label>
        </div>
      </div>
    </div>

    <ng-container
      *ngIf="dataDashBoard?.countsBussinessLines?.length > 0; else noData"
    >
      <div class="w-100" [style.height]="'92%'">
        <ejs-chart
          id="chart-container"
          class="w-100"
          [primaryXAxis]="primaryXAxis"
          [primaryYAxis]="primaryYAxis"
          [title]=""
          [tooltip]="tooltipChartLine"
        >
          <e-series-collection>
            <ng-container
              *ngFor="let item of dataDashBoard?.countsBussinessLines"
            >
              <e-series
                *ngIf="checkBtnSuscess"
                [dataSource]="item?.chartDataSuscess ?? []"
                type="Line"
                xName="month"
                yName="percentage"
                [name]="item.businessLineName"
                width="3"
                [fillColor]="item.color"
              ></e-series>

              <e-series
                *ngIf="checkBtnFail"
                [dataSource]="item?.chartDataFail ?? []"
                type="Line"
                xName="month"
                yName="percentage"
                [name]="item.businessLineName"
                width="3"
                [fillColor]="item.color"
              ></e-series>
            </ng-container>
          </e-series-collection>
        </ejs-chart>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- Top nhân viên có nhiều cơ hội thành công nhất -->
<!-- title="Top nhân viên có nhiều cơ hội thành công nhất" -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="7" style="overflow-y: hiden">
    <codx-label
      class="fs-5 fw-bold"
      name="lblChartOwners"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Top nhân viên có nhiều cơ hội thành công nhất"
    ></codx-label>
    <div class="mt-5" style="overflow-y: auto; max-height: 85%">
      <div class="d-flex justify-content-center align-items-center">
        <div
          [ngClass]="checkBtnMax ? 'button-selected' : 'button-no-selected'"
          class="btn-left py-1 d-flex justify-content-center align-items-center"
          (click)="clickButton('btnMax')"
        >
          <codx-label
            name="btnMax"
            formModel=""
            default="Cao nhất"
          ></codx-label>
        </div>
        <div
          [ngClass]="checkBtnMin ? 'button-selected' : 'button-no-selected'"
          class="btn-right py-1 d-flex justify-content-center align-items-center"
          (click)="clickButton('btnMin')"
        >
          <codx-label
            name="btnMin"
            formModel=""
            default="Thấp nhất"
          ></codx-label>
        </div>
      </div>
    </div>

    <div class="mt-3">
      <ng-container *ngIf="checkBtnMax">
        <ng-container *ngIf="maxOwners?.length > 0; else noData">
          <div
            *ngFor="let ownerCount of maxOwners; let i = index"
            class="d-flex align-items-center justify-content-end cursor-pointer"
            [title]="ownerCount.objectName"
          >
            <div class="fw-bold me-2">{{ ownerCount?.quantity }}</div>
            <div
              class="owners-top"
              style="color: #000000"
              [style.background-color]="ownerCount?.color"
              [style.width]="ownerCount.percentage + '%'"
            >
              <span class="">{{ ownerCount.objectName }}</span>
            </div>
          </div>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="checkBtnMin">
        <ng-container *ngIf="minOwners?.length > 0; else noData">
          <div
            *ngFor="let ownerCount of minOwners; let i = index"
            class="d-flex align-items-center justify-content-end cursor-pointer"
            [title]="ownerCount.objectName"
          >
            <div class="fw-bold me-2">{{ ownerCount?.quantity }}</div>
            <div
              class="owners-top"
              style="color: #000000; background-color: aqua"
              [style.background-color]="ownerCount?.color"
              [style.width]="ownerCount.percentage + '%'"
            >
              <span class="">{{ ownerCount.objectName }}</span>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>
</ng-template>

<!-- Lý do thành công -->
<!-- title="Lý do thành công" -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="8" style="overflow: hidden">
    <codx-label
      class="fs-5 fw-bold"
      name="lblReasonSuscess"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Lý do thành công"
    ></codx-label>
    <div
      style="overflow-y: auto; max-height: 95%"
      *ngIf="dataDashBoard?.countsReasonsSuscess?.length > 0; else noData"
    >
      <div
        *ngFor="let data of dataDashBoard?.countsReasonsSuscess"
        class="mt-4"
      >
        <div class="mx-2 my-5">
          <div class="d-flex justify-content-between">
            <div>
              <span>{{ data?.reasonName }}</span>
              <span>&nbsp;(</span>
              <span>{{ data?.quantity }}</span>
              <span>)</span>
            </div>
            <div>
              <span>{{ data?.percentage }}</span
              ><span>% </span>
            </div>
          </div>
          <div class="d-flex align-items-center min-w-200px">
            <div class="h-5px w-100 bg-gray-200 rounded-4">
              <div
                class="rounded-4 h-5px"
                [ngStyle]="{ backgroundColor: colorReasonSuscess }"
                role="progressbar"
                [style.width]="data.percentage + '%'"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Lý do thất bại -->
<!-- title="Lý do thất bại " -->
<!-- <ng-template #templateDeals>
  <div class="w-100 h-100" id="9" style="overflow: hidden">
    <codx-label
      class="fs-5 fw-bold"
      name="lblReasonFails"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Lý do thất bại"
    ></codx-label>
    <div
      style="overflow-y: auto; max-height: 95%"
      *ngIf="dataDashBoard?.countsReasonsFails?.length > 0; else noData"
    >
      <div *ngFor="let data of dataDashBoard?.countsReasonsFails" class="mt-4">
        <div class="mx-2 my-5">
          <div class="d-flex justify-content-between">
            <div>
              <span>{{ data?.reasonName }}</span>
              <span>&nbsp;(</span>
              <span>{{ data.quantity }}</span>
              <span>)</span>
            </div>
            <div>
              <span>{{ data?.percentage }}</span
              ><span>% </span>
            </div>
          </div>
          <div class="d-flex align-items-center min-w-200px">
            <div class="h-5px w-100 bg-gray-200 rounded-4">
              <div
                class="rounded-4 h-5px"
                role="progressbar"
                [ngStyle]="{ backgroundColor: colorReasonFails }"
                [style.width]="data.percentage + '%'"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template> -->

<!-- chart pyramid -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="9" style="overflow: hidden">
    <codx-label
      class="fs-5 fw-bold"
      name="lblConversionRate"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Tỷ lệ chuyển đổi tiềm năng thành cơ hội"
    ></codx-label>
    <div style="overflow-y: auto; max-height: 95%" *ngIf="true; else noData">
      <div class="control-section">
        <div>
          <ejs-accumulationchart
            id="pyramidcontainer"
            #pyramid
            style="display: block; width: 92%"
            [legendSettings]="legendSettingsPy"
            [tooltip]="tooltipPy"
          >
            <e-accumulation-series-collection>
              <e-accumulation-series
                name="ConversionRate"
                [dataSource]="dataSourcePy"
                xName="name"
                yName="quantity"
                [neckWidth]="neckWidth"
                [neckHeight]="neckHeight"
                [gapRatio]="gapRatio"
                [emptyPointSettings]="emptyPointSettings"
                width="70%"
                height="80%"
                [explode]="explode"
                [dataLabel]="dataLabel"
                type="Funnel"
              >
              </e-accumulation-series>
            </e-accumulation-series-collection>
          </ejs-accumulationchart>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thống kê hiệu suất trong năm -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="10" title="">
    <codx-label
      class="fs-5 fw-bold"
      name="lblEfficiency"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Thống kê hiệu suất trong năm"
    ></codx-label>
    <ng-container *ngIf="dataStatisticTarget; else noData">
      <div class="row w-100">
        <div class="col-10">
          <div class="control-section mb-10">
            <div class="trackball-control-section" align="center">
              <ejs-chart
                style="display: block"
                id="chartcontainer"
                [primaryXAxis]="primaryXAxisRatio"
                [primaryYAxis]="primaryYAxisRatio"
                [tooltip]="tooltip"
                [legendSettings]="legend"
                (pointRender)="setColorPoint($event)"
              >
                <e-series-collection>
                  <e-series
                    [dataSource]="dataStatisticTarget"
                    [minRadius]="minRadius"
                    [maxRadius]="maxRadius"
                    type="Bubble"
                    xName="totalTarget"
                    yName="totalDealValue"
                    size="quantity"
                    [marker]="markerRatio"
                    tooltipMappingName="businessLineName"
                    [border]="border"
                  >
                  </e-series>
                </e-series-collection>
              </ejs-chart>
            </div>
          </div>
        </div>
        <div class="col-2">
          <codx-label
            class="codx-label fw-bold"
            name="lblNote"
            formName="CMMyDashboard"
            gridViewName="grvCMMyDashboard"
            default="Chú thích"
          ></codx-label>
          <ng-container *ngFor="let item of dataStatisticTarget">
            <div class="d-flex mb-2 align-items-center">
              <span
                class="color-note me-2"
                [style.background-color]="item.color"
              ></span>
              <span
                [ngbTooltip]="item.businessLineName"
                class="line-clamp-name"
                [innerHTML]="item.businessLineName"
              ></span>
            </div>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- Thống kê năng suất nhân viên -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="11" title="" style="overflow: hidden">
    <codx-label
      class="fs-5 fw-bold"
      name="lblProductivityOfOwners"
      default="Thống kê năng suất nhân viên"
    ></codx-label>
    <ng-container *ngIf="productivityOwner?.length > 0; else noData">
      <div style="overflow-y: auto; max-height: 90%">
        <div *ngFor="let productivity of productivityOwner">
          <div class="mx-2 my-3">
            <div class="d-flex justify-content-between">
              <div class="mb-2">
                <span class="fw-bold">{{ productivity?.objectName }}</span>
              </div>
              <div class="d-flex align-items-end">
                <span class="text-gray-400">{{
                  productivity?.sumTarget | currency : productivity?.currencyID
                }}</span>
              </div>
            </div>
            <div
              class="d-flex align-items-center min-w-200px"
              [title]="
                productivity?.sumDealValueSuccess
                  | currency : productivity?.currencyID
              "
            >
              <div class="w-100 bg-gray-200 rounded-4" style="height: 15px">
                <div class="h-5px w-100 bg-gray-200 rounded-4">
                  <div
                    class="rounded-4 h-15px align-items-center progress-bar"
                    role="progressbar"
                    [ngStyle]="{
                      backgroundColor:
                        productivity?.percentage >= 50
                          ? '#187de4'
                          : colorReasonFails
                    }"
                    [style.width]="productivity?.percentage + '%'"
                  >
                    <div class="fw-bold text-light">
                      {{ productivity?.percentage + "%" }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #noData>
  <codx-no-data></codx-no-data>
</ng-template>
