<codx-views
  #view
  [views]="views"
  [autoLoad]="false"
  [funcID]="funcID"
  (filterReportChange)="filterChange($event)"
  (onActions)="onActions($event)"
>
</codx-views>

<ng-template #template>
  <div class="w-100 h-100 cm-chart" *ngIf="isLoaded">
    <ng-container *ngIf="funcID == 'CMD001'">
      <codx-dashboard
        [templates]="dashBoardTaget"
        [panels]="panelsDeals1"
        [datas]="datasDeals1"
        [isEditMode]="isEditMode"
        [cellSpacing]="[10, 10]"
        [columns]="60"
      ></codx-dashboard>
    </ng-container>

    <ng-container *ngIf="funcID == 'CMD002' || funcID == 'CMD003'">
      <codx-dashboard
        [templates]="dashBoardDeals"
        [panels]="panelsDeals2"
        [datas]="datasDeals2"
        [isEditMode]="isEditMode"
        [cellSpacing]="[10, 10]"
        [columns]="60"
      ></codx-dashboard>
    </ng-container>

    <ng-container *ngIf="funcID == 'CMD004'">
      <cm-targets [viewDashboard]="true"></cm-targets>
    </ng-container>
  </div>

  <div class="w-100 h-100" *ngIf="!isLoaded">
    <div id="loader"></div>
  </div>
</ng-template>

<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->
<!-- cơ hội mới -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="1" [title]="getTitle('1')">
    <div class="w-100 h-100 border border-secondary rounded border-2">
      <count-chart
        class="w-100 h-100"
        [height]="'75%'"
        [hasIcon]="true"
        [iconUrl]="
          'assets/themes/cm/default/img/dashboard-status-new-i-clipboard-plus.svg'
        "
        [title]="getNameStatus('1')"
        [value]="countNew ?? 0"
      ></count-chart>
    </div>
  </div>
</ng-template>

<!-- cơ hội đang thực hiện -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="2" [title]="getTitle('2')">
    <div class="w-100 h-100 border border-warning rounded border-2">
      <count-chart
        class="w-100 h-100"
        [height]="'75%'"
        [hasIcon]="true"
        [iconUrl]="
          'assets/themes/cm/default/img/dashboard-status-inprogress-i-clipboard-data.svg'
        "
        [title]="getNameStatus('2')"
        [value]="countProcessing ?? 0"
      ></count-chart>
    </div>
  </div>
</ng-template>

<!-- cơ hội thành công  -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="3" [title]="getTitle('3')">
    <div class="w-100 h-100 border border-success rounded border-2">
      <count-chart
        class="w-100 h-100"
        [height]="'75%'"
        [hasIcon]="true"
        [iconUrl]="
          'assets/themes/cm/default/img/dashboard-status-win-i-clipboard-check.svg'
        "
        [title]="getNameStatus('3')"
        [value]="countSuccess ?? 0"
      ></count-chart>
    </div>
  </div>
</ng-template>

<!-- cơ hội thất bại  -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="4" [title]="getTitle('5')">
    <div class="w-100 h-100 border border-danger rounded border-2">
      <count-chart
        class="w-100 h-100"
        [height]="'75%'"
        [hasIcon]="true"
        [iconUrl]="
          'assets/themes/cm/default/img/dashboard-status-fail-i-clipboard-minus.svg'
        "
        [title]="getNameStatus('5')"
        [value]="countFail ?? 0"
      ></count-chart>
    </div>
  </div>
</ng-template>

<!-- Tỷ lệ phân bổ cơ hội theo dòng sản phẩm -->
<ng-template #templateDeals>
  <div class="w-100 h-100 position-relative" id="5" style="overflow: hidden">
    <div>
      <codx-label
        class="fw-bold"
        name="lblPercentageOfDeals"
        default="Tỷ lệ phân bổ cơ hội"
      ></codx-label>
    </div>
    <div id="chartPercentageOfDeals" class="mt-3">
      <div class="d-flex justify-content-center h-10">
        <div id="group1" class="btn-group">
          <input
            class="btn-check"
            type="radio"
            id="btBussinessLine"
            name="align1"
            #btBussinessLine
            checked
            (change)="
              changeChart(btBussinessLine, {
                chart1: { view: viewBus, temp: pie1 },
                chart2: { view: viewIndus, temp: pie2 }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btBussinessLine"
            ><codx-label
              name="btBussinessLine"
              formModel="CMMyDashboard"
              default="Dòng sản phẩm"
            ></codx-label
          ></label>
          <input
            class="btn-check"
            type="radio"
            id="btIndustries"
            name="align1"
            #btIndustries
            (change)="
              changeChart(btIndustries, {
                chart1: { view: viewBus, temp: pie1 },
                chart2: { view: viewIndus, temp: pie2 }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btIndustries">
            <codx-label
              name="btIndustries"
              formModel="CMMyDashboard"
              default="Lĩnh vực hoạt động"
            ></codx-label
          ></label>
        </div>
      </div>
    </div>
    <div class="w-100 position-absolute" style="bottom: 0 px">
      <div #viewBus>
        <ejs-treemap
          #pie1
          class="h-100 w-100"
          style="height: 90% !important; width: 100% !important"
          [dataSource]="dataSourceBussnessLine"
          weightValuePath="quantity"
          rangeColorValuePath="quantity"
          [palette]="palette"
          [leafItemSettings]="leafItemSettings"
          [tooltipSettings]="{
            visible: true,
            format:
              '${businessLineName}<br>${quantity} ' +
              this.titLeModule +
              '-(${percentage} %)'
          }"
        >
        </ejs-treemap>
      </div>
      <div #viewIndus class="d-none">
        <ejs-treemap
          #pie2
          class="h-100 w-100 d-none"
          style="height: 90% !important; width: 100% !important"
          [dataSource]="dataSourceIndustry"
          weightValuePath="quantity"
          rangeColorValuePath="quantity"
          [palette]="paletteIndustry"
          [leafItemSettings]="leafItemSettingsIns"
          [tooltipSettings]="{
            visible: true,
            format:
              '${industryName}<br>${quantity} ' +
              this.titLeModule +
              '-(${percentage} %)'
          }"
        >
        </ejs-treemap>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thống kê tỷ lệ thành công thất bại trong năm theo dòng sản phẩm -->
<ng-template #templateDeals>
  <div
    class="chartBusinessLines w-100 h-100 position-relative"
    id="6"
    style="overflow: hidden"
  >
    <codx-label
      id="chartBusinessLinesHeader"
      class="fw-bold"
      name="lblChartBusinessLines"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Thống kê tỷ lệ thành công, thất bại trong năm theo dòng sản phẩm"
    ></codx-label>
    <div id="chartBusinessLinesButton" class="mt-3">
      <div class="d-flex justify-content-center h-5">
        <div id="group3" class="btn-group">
          <input
            class="btn-check"
            type="radio"
            id="btSuccess"
            name="lineSelect"
            #btSuccess
            checked
            (change)="
              changeChart(btSuccess, {
                chart1: { view: viewLineSuc, temp: lineSuc },
                chart2: { view: viewLineFail, temp: lineFail }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btSuccess"
            ><codx-label
              name="btSuccess"
              formModel=""
              default="Thành công"
            ></codx-label
          ></label>
          <input
            class="btn-check"
            type="radio"
            id="btFail"
            name="lineSelect"
            #btFail
            (change)="
              changeChart(btFail, {
                chart1: { view: viewLineSuc, temp: lineSuc },
                chart2: { view: viewLineFail, temp: lineFail }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btFail">
            <codx-label
              name="btFail"
              formModel=""
              default="Thất bại"
            ></codx-label
          ></label>
        </div>
      </div>
    </div>

    <ng-container>
      <div class="w-100 position-absolute" style="bottom: 0 px">
        <div #viewLineSuc>
          <ejs-chart
            #lineSuc
            id="chart-container"
            class="w-100"
            [primaryXAxis]="primaryXAxis"
            [primaryYAxis]="primaryYAxis"
            [title]=""
            [tooltip]="tooltipChartLine"
          >
            <e-series-collection>
              <ng-container *ngFor="let item of chartBussnessLine">
                <e-series
                  [dataSource]="item?.chartDataSuscess"
                  type="Line"
                  xName="month"
                  yName="percentage"
                  [name]="item.businessLineName"
                  width="3"
                  [fillColor]="item.color"
                ></e-series>
              </ng-container>
            </e-series-collection>
          </ejs-chart>
        </div>
        <div #viewLineFail class="d-none">
          <ejs-chart
            #lineFail
            id="chart-container"
            class="w-100"
            [primaryXAxis]="primaryXAxis"
            [primaryYAxis]="primaryYAxis"
            [title]=""
            [tooltip]="tooltipChartLine"
          >
            <e-series-collection>
              <ng-container *ngFor="let item of chartBussnessLine">
                <e-series
                  #lineFail
                  [dataSource]="item?.chartDataFail"
                  type="Line"
                  xName="month"
                  yName="percentage"
                  [name]="item.businessLineName"
                  width="3"
                  [fillColor]="item.color"
                ></e-series>
              </ng-container>
            </e-series-collection>
          </ejs-chart>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- Top nhân viên có nhiều cơ hội thành công nhất -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="7" style="overflow-y: hiden">
    <codx-label
      class="fw-bold"
      name="lblChartOwners"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Top nhân viên có nhiều cơ hội thành công nhất"
    ></codx-label>
    <div class="mt-5">
      <div class="d-flex justify-content-center h-10">
        <div id="group2" class="btn-group">
          <input
            class="btn-check"
            type="radio"
            id="btMax"
            name="alignMaxMin"
            #eleMax
            checked
            (change)="
              changeChart(eleMax, {
                chart1: { view: maxView },
                chart2: { view: minView }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btMax">
            <codx-label
              name="btMax"
              formModel=""
              default="Cao nhất"
            ></codx-label>
          </label>
          <input
            class="btn-check"
            type="radio"
            id="btMin"
            name="alignMaxMin"
            #eleMin
            (change)="
              changeChart(eleMin, {
                chart1: { view: maxView },
                chart2: { view: minView }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btMin">
            <codx-label
              name="btMin"
              formModel=""
              default="Thấp nhất"
            ></codx-label>
          </label>
        </div>
      </div>
    </div>

    <div class="mt-3" style="overflow-y: auto; max-height: 70%">
      <div #maxView class="">
        <div
          *ngFor="let ownerCount of maxOwners; let i = index"
          class="d-flex align-items-center justify-content-end cursor-pointer"
          [title]="ownerCount.objectName"
        >
          <div class="fw-bold me-2">
            {{ ownerCount?.quantity }}
          </div>
          <div
            class="owners-top"
            style="color: #000000"
            [style.background-color]="ownerCount?.color"
            [style.width]="ownerCount.percentage + '%'"
          >
            <span class="">{{ ownerCount.objectName }}</span>
          </div>
        </div>
      </div>

      <div #minView class="d-none">
        <div
          *ngFor="let ownerCount of minOwners; let i = index"
          class="d-flex align-items-center justify-content-end cursor-pointer"
          [title]="ownerCount.objectName"
        >
          <div class="fw-bold me-2">
            {{ ownerCount?.quantity }}
          </div>
          <div
            class="owners-top"
            style="color: #000000; background-color: aqua"
            [style.background-color]="ownerCount?.color"
            [style.width]="ownerCount.percentage + '%'"
          >
            <span class="">{{ ownerCount.objectName }}</span>
          </div>
        </div>
      </div>
      <!-- </ng-container>
      </ng-container> -->
    </div>
  </div>
</ng-template>

<!-- Lý do thành công -->
<!-- title="Lý do thành công" -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="8" style="overflow: hidden">
    <codx-label
      class="fw-bold"
      name="lblReasonSuscessFail"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Lý do thành công/Lý do thất bại"
    ></codx-label>

    <div class="mt-5">
      <div class="d-flex justify-content-center h-10">
        <div id="group5" class="btn-group">
          <input
            class="btn-check"
            type="radio"
            id="btReasonSucess"
            name="reasonSF"
            #btReasonSucess
            checked
            (change)="
              changeChart(btReasonSucess, {
                chart1: { view: reasonSucsess },
                chart2: { view: reasonFails }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btReasonSucess">
            <codx-label
              name="btReasonSucess"
              formModel=""
              default="Thành công"
            ></codx-label>
          </label>
          <input
            class="btn-check"
            type="radio"
            id="btReasonFail"
            name="reasonSF"
            #eleMin
            (change)="
              changeChart(eleMin, {
                chart1: { view: reasonSucsess },
                chart2: { view: reasonFails }
              })
            "
          />
          <label class="btn btn-outline-primary" for="btReasonFail">
            <codx-label
              name="btReasonFail"
              formModel=""
              default="Thất bại"
            ></codx-label>
          </label>
        </div>
      </div>
    </div>

    <div #reasonSucsess style="overflow-y: auto; max-height: 75%">
      <div *ngFor="let data of dataReasonsSuscess" class="mt-4">
        <div class="mx-2 my-5">
          <div class="d-flex justify-content-between">
            <div>
              <span>{{ data?.reasonName }}</span>
              <span>&nbsp;(</span>
              <span>{{ data?.quantity }}</span>
              <span>)</span>
            </div>
            <div>
              <span>{{ data?.percentage }}</span
              ><span>% </span>
            </div>
          </div>
          <div class="d-flex align-items-center min-w-200px">
            <div class="h-5px w-100 bg-gray-200 rounded-4">
              <div
                class="rounded-4 h-5px"
                [ngStyle]="{ backgroundColor: colorReasonSuscess }"
                role="progressbar"
                [style.width]="data.percentage + '%'"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div #reasonFails class="d-none" style="overflow-y: auto; max-height: 75%">
      <div *ngFor="let data of dataReasonsFails" class="mt-4">
        <div class="mx-2 my-5">
          <div class="d-flex justify-content-between">
            <div>
              <span>{{ data?.reasonName }}</span>
              <span>&nbsp;(</span>
              <span>{{ data.quantity }}</span>
              <span>)</span>
            </div>
            <div>
              <span>{{ data?.percentage }}</span
              ><span>% </span>
            </div>
          </div>
          <div class="d-flex align-items-center min-w-200px">
            <div class="h-5px w-100 bg-gray-200 rounded-4">
              <div
                class="rounded-4 h-5px"
                role="progressbar"
                [ngStyle]="{ backgroundColor: colorReasonFails }"
                [style.width]="data.percentage + '%'"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- chart pyramid  style="height: 100% !important; overflow: hidden"-->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="9">
    <codx-label
      class="fw-bold"
      name="lblConversionRate"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Tỷ lệ chuyển đổi tiềm năng thành cơ hội"
    ></codx-label>

    <div id="chartCoverionButton" class="mt-3">
      <div class="d-flex justify-content-center align-items-center">
        <div class="d-flex justify-content-center">
          <div id="group4" class="btn-group">
            <input
              class="btn-check"
              type="radio"
              id="btStatus"
              name="chartPy"
              #btStatus
              checked
              (change)="
                changeChart(btStatus, {
                  chart1: { view: viewStatus, temp: pyramidStatus },
                  chart2: { view: viewStages, temp: pyramidStages }
                })
              "
            />
            <label class="btn btn-outline-primary" for="btStatus"
              ><codx-label
                name="btStatus"
                formModel=""
                default="Status"
              ></codx-label
            ></label>
            <input
              class="btn-check"
              type="radio"
              id="btStages"
              name="chartPy"
              #btStages
              (change)="
                changeChart(btStages, {
                  chart1: { view: viewStatus, temp: pyramidStatus },
                  chart2: { view: viewStages, temp: pyramidStages }
                })
              "
            />
            <label class="btn btn-outline-primary" for="btStages">
              <codx-label
                name="btStages"
                formModel=""
                default="Stages"
              ></codx-label
            ></label>
          </div>
        </div>
      </div>
      <div>
        <div #viewStatus>
          <ejs-accumulationchart
            id="pyramidcontainer"
            #pyramidStatus
            style="height: 90%"
            [legendSettings]="legendSettingsPy"
            [tooltip]="{
              header: '',
              enable: true,
              format: '${point.tooltip}'
            }"
            (pointRender)="formatCrrView($event)"
          >
            <e-accumulation-series-collection>
              <e-accumulation-series
                name="ConversionRate"
                [dataSource]="dataSourcePyStatus"
                xName="name"
                yName="quantity"
                [neckWidth]="neckWidth"
                [neckHeight]="neckHeight"
                [gapRatio]="gapRatio"
                [emptyPointSettings]="emptyPointSettings"
                width="60%"
                height="50%"
                [explode]="explode"
                [dataLabel]="dataLabel"
                type="Funnel"
              >
              </e-accumulation-series>
            </e-accumulation-series-collection>
          </ejs-accumulationchart>
        </div>

        <div #viewStages class="d-none">
          <ejs-accumulationchart
            id="pyramidcontainer"
            #pyramidStages
            style="height: 90%"
            [legendSettings]="legendSettingsPy"
            [tooltip]="{
              header: '',
              enable: true,
              format: '${point.tooltip}'
            }"
            (pointRender)="formatCrrView($event)"
          >
            <e-accumulation-series-collection>
              <e-accumulation-series
                name="ConversionRate"
                [dataSource]="dataSourcePyStage"
                xName="name"
                yName="quantity"
                [neckWidth]="neckWidth"
                [neckHeight]="neckHeight"
                [gapRatio]="gapRatio"
                [emptyPointSettings]="emptyPointSettings"
                width="60%"
                height="50%"
                [explode]="explode"
                [dataLabel]="dataLabel"
                type="Funnel"
              >
              </e-accumulation-series>
            </e-accumulation-series-collection>
          </ejs-accumulationchart>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thống kê hiệu suất trong năm -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="10" title="" style="overflow: hidden">
    <codx-label
      class="fw-bold"
      name="lblEfficiency"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Thống kê hiệu suất trong năm"
    ></codx-label>
    <ng-container *ngIf="dataStatisticTarget?.length > 0; else noData">
      <div class="d-flex row w-100" style="height: 95% !important">
        <div class="col-10">
          <!-- <div class="control-section mb-10"> -->
          <!-- <div class="trackball-control-section" align="center"> -->
          <ejs-chart
            id="chartcontainer"
            style="height: 100%"
            [primaryXAxis]="primaryXAxisRatio"
            [primaryYAxis]="primaryYAxisRatio"
            [tooltip]="tooltip"
            [legendSettings]="legend"
            (pointRender)="setColorPoint($event)"
          >
            <e-series-collection>
              <e-series
                [dataSource]="dataStatisticTarget"
                [minRadius]="minRadius"
                [maxRadius]="maxRadius"
                type="Bubble"
                xName="totalTarget"
                yName="totalDealValue"
                size="quantity"
                [marker]="markerRatio"
                tooltipMappingName="businessLineName"
                [border]="border"
              >
              </e-series>
            </e-series-collection>
          </ejs-chart>
          <!-- </div> -->
          <!-- </div> -->
        </div>
        <div class="col-2">
          <codx-label
            class="codx-label fw-bold"
            name="lblNote"
            formName="CMMyDashboard"
            gridViewName="grvCMMyDashboard"
            default="Chú thích"
          ></codx-label>
          <ng-container *ngFor="let item of dataStatisticTarget">
            <div class="d-flex mb-2 align-items-center">
              <span
                class="color-note me-2"
                [style.background-color]="item.color"
              ></span>
              <span
                [ngbTooltip]="item.businessLineName"
                class="line-clamp-name"
                [innerHTML]="item.businessLineName"
              ></span>
            </div>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- Thống kê năng suất nhân viên -->
<ng-template #templateDeals>
  <div class="w-100 h-100" id="11" title="" style="overflow: hidden">
    <codx-label
      class="fw-bold"
      name="lblProductivityOfOwners"
      default="Thống kê năng suất nhân viên"
    ></codx-label>
    <ng-container *ngIf="productivityOwner?.length > 0; else noData">
      <div style="overflow-y: auto; max-height: 95%">
        <div *ngFor="let productivity of productivityOwner">
          <div class="mx-2 my-3">
            <div class="d-flex justify-content-between">
              <div class="mb-2">
                <span class="fw-bold">{{ productivity?.objectName }}</span>
              </div>
              <div class="d-flex align-items-end">
                <span class="text-gray-400">{{
                  productivity?.sumTarget | currency : productivity?.currencyID
                }}</span>
              </div>
            </div>
            <div
              class="d-flex align-items-center min-w-200px"
              [title]="
                productivity?.sumDealValueSuccess
                  | currency : productivity?.currencyID
              "
            >
              <div class="w-100 bg-gray-200 rounded-4" style="height: 15px">
                <div class="h-5px w-100 bg-gray-200 rounded-4">
                  <div
                    class="rounded-4 h-15px align-items-center progress-bar"
                    role="progressbar"
                    [ngStyle]="{
                      backgroundColor:
                        productivity?.percentage >= 50
                          ? '#187de4'
                          : colorReasonFails
                    }"
                    [style.width]="productivity?.percentage + '%'"
                  >
                    <div class="fw-bold text-light">
                      {{ productivity?.percentage + "%" }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>
<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->

<!-- SALE TAGET =>CMD001  templateTarget-->
<!-- Tem TOp sale Tager -->
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="1" title="">
    <div class="d-flex flex-column">
      <codx-label
        class="fw-bold"
        name="lblDealValue"
        formName="CMMyDashboard"
        gridViewName="grvCMMyDashboard"
        default="Doanh số bán hàng"
      ></codx-label>
      <div
        class="d-flex justify-content-between mb-1"
        [ngStyle]="{
          color: findTmpDeals('1')
            ? getIcon(findTmpDeals('1')?.isAsc, 'color')
            : getIcon('1', 'color')
        }"
      >
        <div class="d-flex justify-content-start">
          <span class="fw-bold" *ngIf="findTmpDeals('1')">{{
            findTmpDeals("1")?.count
          }}</span>
        </div>
        <div class="d-flex justify-content-end">
          <span
            class="me-1 icon-14"
            [ngClass]="getIcon(findTmpDeals('1')?.isAsc, 'icon')"
          >
          </span>
          <span class="fw-bold me-1">{{
            findTmpDeals("1")?.countAsc
          }}</span>
          <span class="fw-bold">({{ findTmpDeals("1")?.valueAsc }})</span>
        </div>
      </div>
      <div class="d-flex fw-bold">
        <codx-label
          class="fw-bold mb-1 label-colon me-1"
          [name]="textTitle"
          formName="CMMyDashboard"
          gridViewName="grvCMMyDashboard"
          [default]="textTitle"
        ></codx-label>
        <span>{{ findTmpDeals("1")?.countOld }}</span>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="2" title="">
    <div class="d-flex flex-column">
      <codx-label
        class="fw-bold"
        name="lblDeals"
        formName="CMMyDashboard"
        gridViewName="grvCMMyDashboard"
        default="Cơ hội bán hàng"
      ></codx-label>
      <div
        class="d-flex justify-content-between mb-1"
        [ngStyle]="{
          color: findTmpDeals('2')
            ? getIcon(findTmpDeals('2')?.isAsc, 'color')
            : getIcon('2', 'color')
        }"
      >
        <div class="d-flex justify-content-start">
          <span class="fw-bold" *ngIf="findTmpDeals('2')">{{
            findTmpDeals("2")?.count
          }}</span>
        </div>
        <div class="d-flex justify-content-end">
          <span
            class="me-1 icon-14"
            [ngClass]="getIcon(findTmpDeals('2')?.isAsc, 'icon')"
          >
          </span>
          <span class="fw-bold me-1">{{
            findTmpDeals("2")?.countAsc
          }}</span>
          <span class="fw-bold">({{ findTmpDeals("2")?.valueAsc }})</span>
        </div>
      </div>
      <div class="d-flex fw-bold">
        <codx-label
          class="fw-bold mb-1 label-colon me-1"
          [name]="textTitle"
          formName="CMMyDashboard"
          gridViewName="grvCMMyDashboard"
          [default]="textTitle"
        ></codx-label>
        <span>{{ findTmpDeals("2")?.countOld }}</span>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="3" title="">
    <div class="d-flex flex-column">
      <codx-label
        class="fw-bold"
        name="lblDealWons"
        formName="CMMyDashboard"
        gridViewName="grvCMMyDashboard"
        default="Cơ hội thành công"
      ></codx-label>
      <div
        class="d-flex justify-content-between mb-1"
        [ngStyle]="{
          color: findTmpDeals('3')
            ? getIcon(findTmpDeals('3')?.isAsc, 'color')
            : getIcon('3', 'color')
        }"
      >
        <div class="d-flex justify-content-start">
          <span class="fw-bold" *ngIf="findTmpDeals('3')">{{
            findTmpDeals("3")?.count
          }}</span>
        </div>
        <div class="d-flex justify-content-end">
          <span
            class="me-1 icon-14"
            [ngClass]="getIcon(findTmpDeals('3')?.isAsc, 'icon')"
          >
          </span>
          <span class="fw-bold me-1">{{
            findTmpDeals("3")?.countAsc
          }}</span>
          <span class="fw-bold">({{ findTmpDeals("3")?.valueAsc }})</span>
        </div>
      </div>
      <div class="d-flex fw-bold">
        <codx-label
          class="fw-bold mb-1 label-colon me-1"
          [name]="textTitle"
          formName="CMMyDashboard"
          gridViewName="grvCMMyDashboard"
          [default]="textTitle"
        ></codx-label>
        <span>{{ findTmpDeals("3")?.countOld }}</span>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="4" title="">
    <div class="d-flex flex-column">
      <codx-label
        class="fw-bold"
        name="lblDealLosts"
        formName="CMMyDashboard"
        gridViewName="grvCMMyDashboard"
        default="Cơ hội thất bại"
      ></codx-label>
      <div
        class="d-flex justify-content-between mb-1"
        [ngStyle]="{
          color: findTmpDeals('4')
            ? getIcon(findTmpDeals('4')?.isAsc, 'color')
            : getIcon('4', 'color')
        }"
      >
        <div class="d-flex justify-content-start">
          <span class="fw-bold" *ngIf="findTmpDeals('4')">{{
            findTmpDeals("4")?.count
          }}</span>
        </div>
        <div class="d-flex justify-content-end">
          <span
            class="me-1 icon-14"
            [ngClass]="getIcon(findTmpDeals('4')?.isAsc, 'icon')"
          >
          </span>
          <span class="fw-bold me-1">{{
            findTmpDeals("4")?.countAsc
          }}</span>
          <span class="fw-bold">({{ findTmpDeals("4")?.valueAsc }})</span>
        </div>
      </div>
      <div class="d-flex fw-bold">
        <codx-label
          class="fw-bold mb-1 label-colon me-1"
          [name]="textTitle"
          formName="CMMyDashboard"
          gridViewName="grvCMMyDashboard"
          [default]="textTitle"
        ></codx-label>
        <span>{{ findTmpDeals("4")?.countOld }}</span>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="5" title="">
    <div class="d-flex flex-column">
      <codx-label
        class="fw-bold"
        name="lblLeadConvertDeals"
        formName="CMMyDashboard"
        gridViewName="grvCMMyDashboard"
        default="Tỉ lệ chuyển đổi"
      ></codx-label>
      <div
        class="d-flex justify-content-between mb-1"
        [ngStyle]="{
          color: findTmpDeals('5')
            ? getIcon(findTmpDeals('5')?.isAsc, 'color')
            : getIcon('5', 'color')
        }"
      >
        <div class="d-flex justify-content-start">
          <span class="fw-bold" *ngIf="findTmpDeals('5')">{{
            findTmpDeals("5")?.count
          }}</span>
        </div>
        <div class="d-flex justify-content-end">
          <span
            class="me-1 align-items-center icon-14"
            [ngClass]="getIcon(findTmpDeals('5')?.isAsc, 'icon')"
          >
          </span>
          <span class="fw-bold">{{ findTmpDeals("5")?.valueAsc }}</span>
        </div>
      </div>
      <div class="d-flex fw-bold">
        <codx-label
          class="fw-bold mb-1 label-colon me-1"
          [name]="textTitle"
          formName="CMMyDashboard"
          gridViewName="grvCMMyDashboard"
          [default]="textTitle"
        ></codx-label>
        <span>{{ findTmpDeals("5")?.countOld }}</span>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="6" title="">
    <codx-label
      class="fw-bold mb-3"
      name="lblSalesPipeline"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Sales pipline"
    ></codx-label>

    <div class="d-flex justify-content-center align-items-center">
      <div class="d-flex justify-content-center">
        <div id="group3" class="btn-group">
          <input
            #ele1
            class="btn-check"
            type="radio"
            id="btSaleStages"
            name="align3"
            value="left"
            checked
            (change)="changeGroupType(ele1,{btSaleStages,btSaleStatus,btSaleStatusCodes})"
          />
          <label class="btn btn-outline-primary" for="btSaleStages"
            ><codx-label
              name="btSaleStages"
              formName="sys"
              default="Sale Stages"
            ></codx-label
          ></label>
          <input
            #ele2
            class="btn-check"
            type="radio"
            id="btSaleStatus"
            name="align3"
            value="center"
            (change)="changeGroupType(ele2,{btSaleStages,btSaleStatus,btSaleStatusCodes})"
          />
          <label class="btn btn-outline-primary" for="btSaleStatus">
            <codx-label
              name="btSaleStatus"
              formName="sys"
              default="Status"
            ></codx-label
          ></label>
          <input
            #ele3
            class="btn-check"
            type="radio"
            id="btSaleStatusCodes"
            name="align3"
            value="right"
            (change)="changeGroupType(ele3,{btSaleStages,btSaleStatus,btSaleStatusCodes})"
          />
          <label class="btn btn-outline-primary" for="btSaleStatusCodes"
            ><codx-label
              name="btSaleStatusCodes"
              formName="sys"
              default="Status codes"
            ></codx-label
          ></label>
        </div>
      </div>
    </div>
    <div
      class="position-relative"
      style="height: 90%"
      #btSaleStages
      [ngClass]="statusPip == 'btSaleStages' ? '' : 'd-none'"
    >
      <div *ngIf="lstSalesStages?.length > 0; else noData"></div>
      <ejs-accumulationchart
        id="pyramidcontainer1"
        #pie1
        style="height: 90%"
        [legendSettings]="legendSettings"
        [enableSmartLabels]="false"
        [tooltip]="{
          header: '',
          enable: true,
          format: '${point.tooltip}'
        }"
        (pointRender)="formatCrrView($event)"
      >
        <e-accumulation-series-collection>
          <e-accumulation-series
            #accumulationPipe
            name="ConversionRate"
            [dataSource]="lstSalesStages"
            xName="name"
            yName="quantity"
            width="60%"
            height="50%"
            [gapRatio]="gapRatio"
            [explode]="explode"
            [dataLabel]="datalabelAc"
            [palettes]="palettePipsStages"
            type="Funnel"
          >
          </e-accumulation-series>
        </e-accumulation-series-collection>
      </ejs-accumulationchart>
    </div>
    <div
      class="position-relative"
      style="height: 90%"
      #btSaleStatus
      [ngClass]="statusPip == 'btSaleStatus' ? '' : 'd-none'"
    >
      <div *ngIf="lstSalesStatus?.length > 0; else noData"></div>
      <ejs-accumulationchart
        id="pyramidcontainer2"
        #pie2
        style="height: 90%"
        [legendSettings]="legendSettings"
        [enableSmartLabels]="false"
        [tooltip]="{
          header: '',
          enable: true,
          format: '${point.tooltip}'
        }"
        (pointRender)="formatCrrView($event)"
      >
        <e-accumulation-series-collection>
          <e-accumulation-series
            #accumulationPipe
            name="ConversionRate"
            [dataSource]="lstSalesStatus"
            xName="name"
            yName="quantity"
            width="60%"
            height="50%"
            [gapRatio]="gapRatio"
            [explode]="explode"
            [dataLabel]="datalabelAc"
            [palettes]="palettePipsStatus"
            type="Funnel"
          >
          </e-accumulation-series>
        </e-accumulation-series-collection>
      </ejs-accumulationchart>
    </div>
    <div
      class="position-relative"
      style="height: 90%"
      #btSaleStatusCodes
      [ngClass]="statusPip == 'btSaleStatusCodes' ? '' : 'd-none'"
    >
      <div *ngIf="lstSalesStatusCodes?.length > 0; else noData"></div>
      <ejs-accumulationchart
        id="pyramidcontainer3"
        #pie3
        style="height: 90%"
        [legendSettings]="legendSettings"
        [enableSmartLabels]="false"
        [tooltip]="{
          header: '',
          enable: true,
          format: '${point.tooltip}'
        }"
        (pointRender)="formatCrrView($event)"
      >
        <e-accumulation-series-collection>
          <e-accumulation-series
            #accumulationPipe
            name="ConversionRate"
            [dataSource]="lstSalesStatusCodes"
            xName="name"
            yName="quantity"
            width="60%"
            height="50%"
            [gapRatio]="gapRatio"
            [explode]="explode"
            [dataLabel]="datalabelAc"
            type="Funnel"
          >
          </e-accumulation-series>
        </e-accumulation-series-collection>
      </ejs-accumulationchart>
    </div>
  </div>
</ng-template>
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="7" title="">
    <codx-label
      class="fw-bold mb-3"
      name="lblSalesTrend"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Sales trend - Last 12 months"
    ></codx-label>
    <ng-container *ngIf="lstMonthsSeries?.length > 0; else noData">
      <div style="max-height: 92%; overflow: scroll">
        <ejs-chart
          style="display: block"
          [chartArea]="chartArea"
          [width]="'50%'"
          style="height: 100%"
          id="chartcontainer"
          [primaryXAxis]="primaryXAxisY"
          [primaryYAxis]="primaryYAxisY"
          [legendSettings]="legendSeri"
          [tooltip]="toolTipSeri"
          (textRender)="textSeriRender($event)"
          (pointRender)="poinSeriRender($event)"
          (tooltipRender)="tooltipSeriRender($event)"
        >
          <e-series-collection>
            <e-series
              [dataSource]="lstMonthsSeries"
              type="StackingColumn"
              xName="month"
              yName="expected"
              name="Doanh thu dự kiến"
              opacity="0.75"
              [cornerRadius]="cornerRadius"
              columnWidth="0.4"
              [paretoOptions]="paretoOptions"
              width="2"
            >
            </e-series>
          </e-series-collection>
        </ejs-chart>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="8" title="">
    <codx-label
      class="fw-bold mb-3"
      name="lblSalesTargets"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Sales targets"
    ></codx-label>
    <ng-container *ngIf="lstQuarters?.length > 0; else noData">
      <ejs-bulletchart
        align="center"
        id="revenue0"
        width="800px"
        height="70%"
        style="display: block; text-align: center"
        valueField="value"
        targetField="target"
        [minimum]="minimumBullet"
        [maximum]="maximumBulletQ0"
        [interval]="intervalQ0"
        [width]="'800px'"
        height="70%"
        [title]="titleQ0"
        (tooltipRender)="tooltipRender($event, '0')"
        [dataSource]="dataBulletQ0s"
        [animation]="{ enable: false }"
        [labelFormat]="labelFormatQ0"
        (load)="load($event)"
        [tooltip]="tooltipBullet0"
        valueFill="#FF4500"
        [dataLabel]="dataLabelBuleet"
      >
        <e-bullet-range-collection>
          <e-bullet-range
            [end]="dealValueWonQ0"
            color="#FF4500"
          ></e-bullet-range>
          <e-bullet-range [end]="targetQ0" color="#d8d8d8"></e-bullet-range>
        </e-bullet-range-collection>
      </ejs-bulletchart>
      <div class="row">
        <ejs-bulletchart
          class="col-6"
          align="center"
          id="revenue1"
          width="500px"
          height="70%"
          style="display: block; text-align: center"
          valueField="value"
          targetField="target"
          [minimum]="minimumBullet"
          [maximum]="maximumBulletQ1"
          [interval]="intervalQ1"
          [title]="titleQ1"
          (tooltipRender)="tooltipRender($event, '1')"
          [dataSource]="dataBulletQ1s"
          [animation]="{ enable: false }"
          [labelFormat]="labelFormatQ1"
          (load)="load($event)"
          [tooltip]="tooltipBullet1"
          valueFill="#FF4500"
          [dataLabel]="dataLabelBuleet"
        >
          <e-bullet-range-collection>
            <e-bullet-range
              [end]="dealValueWonQ1"
              color="#FF4500"
            ></e-bullet-range>
            <e-bullet-range [end]="targetQ1" color="#d8d8d8"></e-bullet-range>
          </e-bullet-range-collection>
        </ejs-bulletchart>
        <ejs-bulletchart
          class="col-6"
          align="center"
          id="revenue2"
          width="500px"
          height="70%"
          style="display: block; text-align: center"
          valueField="value"
          targetField="target"
          [minimum]="minimumBullet"
          [maximum]="maximumBulletQ2"
          [interval]="intervalQ2"
          [title]="titleQ2"
          (tooltipRender)="tooltipRender($event, '2')"
          [dataSource]="dataBulletQ2s"
          [animation]="{ enable: false }"
          [labelFormat]="labelFormatQ2"
          (load)="load($event)"
          [tooltip]="tooltipBullet2"
          valueFill="#FF4500"
          [dataLabel]="dataLabelBuleet"
        >
          <e-bullet-range-collection>
            <e-bullet-range
              [end]="dealValueWonQ2"
              color="#FF4500"
            ></e-bullet-range>
            <e-bullet-range [end]="targetQ2" color="#d8d8d8"></e-bullet-range>
          </e-bullet-range-collection>
        </ejs-bulletchart>
      </div>
      <div class="row">
        <ejs-bulletchart
          class="col-6"
          align="center"
          id="revenue3"
          width="500px"
          height="70%"
          style="display: block; text-align: center"
          valueField="value"
          targetField="target"
          [minimum]="minimumBullet"
          [maximum]="maximumBulletQ3"
          [interval]="intervalQ3"
          [title]="titleQ3"
          (tooltipRender)="tooltipRender($event, '3')"
          [dataSource]="dataBulletQ3s"
          [animation]="{ enable: false }"
          [labelFormat]="labelFormatQ3"
          (load)="load($event)"
          [tooltip]="tooltipBullet3"
          valueFill="#FF4500"
          [dataLabel]="dataLabelBuleet"
        >
          <e-bullet-range-collection>
            <e-bullet-range
              [end]="dealValueWonQ3"
              color="#FF4500"
            ></e-bullet-range>
            <e-bullet-range [end]="targetQ3" color="#d8d8d8"></e-bullet-range>
          </e-bullet-range-collection>
        </ejs-bulletchart>
        <ejs-bulletchart
          class="col-6"
          align="center"
          id="revenue4"
          width="500px"
          height="70%"
          style="display: block; text-align: center"
          valueField="value"
          targetField="target"
          [minimum]="minimumBullet"
          [maximum]="maximumBulletQ4"
          [interval]="intervalQ4"
          [title]="titleQ4"
          (tooltipRender)="tooltipRender($event, '4')"
          [dataSource]="dataBulletQ4s"
          [animation]="{ enable: false }"
          [labelFormat]="labelFormatQ4"
          (load)="load($event)"
          [tooltip]="tooltipBullet4"
          valueFill="#FF4500"
          [dataLabel]="dataLabelBuleet"
        >
          <e-bullet-range-collection>
            <e-bullet-range
              [end]="dealValueWonQ4"
              color="#FF4500"
            ></e-bullet-range>
            <e-bullet-range [end]="targetQ4" color="#d8d8d8"></e-bullet-range>
          </e-bullet-range-collection>
        </ejs-bulletchart>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- Tem templateSaker -->
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="9" title="">
    <codx-label
      class="fw-bold mb-3"
      name="lblSakerQuarters"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Sales last 4 quarters"
    ></codx-label>
    <ng-container *ngIf="piedata?.length > 0; else noData">
      <ejs-accumulationchart
        id="container"
        #pie
        style="display: block; width: 92%"
        [legendSettings]="legendSettings"
        [enableSmartLabels]="false"
        (textRender)="onTextRender($event)"
        [enableBorderOnMouseMove]="false"
        [tooltip]="{
        enable: true,
        format: '${point.y}%',
      }"
      >
        <e-accumulation-series-collection>
          <e-accumulation-series
            [dataSource]="piedata"
            xName="x"
            yName="y"
            [startAngle]="startAngle"
            [endAngle]="endAngle"
            innerRadius="0%"
            radius="70%"
            [dataLabel]="dataLabel"
            [explode]="false"
            explodeOffset="10%"
            [explodeIndex]="explodeIndex"
          >
          </e-accumulation-series>
        </e-accumulation-series-collection>
      </ejs-accumulationchart>
    </ng-container>
  </div>
</ng-template>

<!-- Tem TOp sale performan -->
<ng-template #templateTarget>
  <div class="w-100 h-100 p-2" id="10" title="">
    <codx-label
      class="fw-bold mb-3"
      name="lblSalePerformance"
      formName="CMMyDashboard"
      gridViewName="grvCMMyDashboard"
      default="Top sales performance"
    ></codx-label>
    <ng-container *ngIf="lstUsers?.length > 0; else noData">
      <div class="table-container border" style="overflow-x: auto">
        <table class="table">
          <thead class="thead-light">
            <tr>
              <th
                class="min-w-200px w-200px"
                style="border-bottom: 1px var(--gray-100) solid !important"
              ></th>
              <ng-container *ngFor="let item of lstUsers">
                <th
                  class="min-w-50px w-50px"
                  style="border-bottom: 1px var(--gray-100) solid !important"
                >
                  <div class="d-flex flex-column justify-content-center">
                    <codx-imgs
                      [width]="30"
                      [objectId]="item?.userID"
                      [objectName]="item?.userName"
                      objectType="AD_Users"
                      [numberImages]="1"
                      class=""
                    >
                    </codx-imgs>
                    <div class="mt-1">{{ item?.userName }}</div>
                  </div>
                </th>
              </ng-container>
            </tr>
          </thead>
          <tbody *ngFor="let item of lstVllTopSales">
            <tr>
              <td style="border-bottom: 1px var(--gray-100) solid !important">
                <span class="fw-bold">{{ item.text }}</span>
              </td>
              <ng-container *ngFor="let user of lstUsers">
                <td
                  class="min-w-50px w-50px"
                  *ngIf="findItemUser(item.value, user?.performances)"
                  style="border-bottom: 1px var(--gray-100) solid !important"
                >
                  <div class="text-gray-800 d-flex justify-content-between">
                    <div class="w-80">
                      <span class="d-flex justify-content-end">
                        {{
                          findItemUser(item.value, user?.performances)?.count
                        }}
                      </span>
                    </div>
                    <div
                      class="w-20 d-flex justify-content-end"
                      [ngStyle]="{
                        color: getIcon(
                          findItemUser(item.value, user?.performances)?.isAsc,
                          'color'
                        )
                      }"
                      *ngIf="item.value != '7' && item.value != '9'"
                    >
                      <span
                        class="me-1 icon-14"
                        [ngClass]="
                          getIcon(
                            findItemUser(item.value, user?.performances)?.isAsc,
                            'icon'
                          )
                        "
                      >
                      </span>
                      <span>
                        {{
                          findItemUser(item.value, user?.performances)?.valueAsc
                        }}</span
                      >
                    </div>
                  </div>
                </td>
              </ng-container>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>
  </div>
</ng-template>
<!-- END  -->
<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->

<ng-template #noData>
  <codx-no-data [size]="150"></codx-no-data>
</ng-template>

<!-- temp filter -->
<ng-template #filterTemplate>
  <!-- <codx-input
    [cssClass]="'rounded-pill border-1'"
    cssPopup="h-350px w-300px"
    type="valuelist"
    [crrValue]="'2'"
    refValue="AC083"
    field="payType"
    (valueChange)="valueChangeFilter($event)"
  ></codx-input> -->
</ng-template>
