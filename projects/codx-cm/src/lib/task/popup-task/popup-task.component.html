<codx-form
  #form
  [headerText]="title"
  subHeaderText=""
  [subHeader]="subHeader"
  [body]="body"
  [footer]="footer"
  [dialog]="dialog"
  [formModel]="formModelMenu"
  [data]="stepsTasks"
  [openMore]="false"
></codx-form>

<ng-template #subHeader>
  <div class="ms-4" *ngIf="typeTask == 'A'">
    <codx-input
      class="me-2"
      type="colorpicker"
      [showText]="false"
      [modeSwitcher]="false"
      [crrValue]=""
      field="color"
    >
    </codx-input>
  </div>
</ng-template>
<!-- Form Group -->
<ng-template #body>
  <div class="card-form mt-5">
    <!-- Ten Cong Viec -->
    <div
      class="form-group d-flex justify-content-between align-item-center w-100"
      *ngIf="typeTask != 'Q'"
    >
      <!-- name -->
      <div class="step-name w-100" [ngClass]="typeTask === 'P' ? 'me-4' : ''">
        <div>
          <codx-label
            fiedName="taskName"
            [formModel]="frmModel"
            default="Tên công việc"
          >
          </codx-label>
        </div>
        <codx-input
          field="taskName"
          [formModel]="frmModel"
          type="text"
          [crrValue]="stepsTasks?.taskName"
          (valueChange)="valueChangeText($event)"
        >
        </codx-input>
      </div>
      <!--End name -->
      <!-- Cuoc goi -->
      <div *ngIf="typeTask === 'C'" class="w-100 ms-4" style="flex-basis: 100%">
        <div>
          <codx-label
            fiedName="callType"
            [formModel]="frmModel"
            default="Loại cuộc gọi"
          >
          </codx-label>
        </div>
        <codx-input
          field="callType"
          type="valuelist"
          refValue="DP023"
          [crrValue]="stepsTasks?.callType"
          (valueChange)="valueChangeCombobox($event)"
        >
        </codx-input>
      </div>
      <!--end Cuoc goi -->

      <!-- Cuoc hop -->
      <div *ngIf="typeTask === 'M'" style="flex-basis: 15%" class="">
        <div class="d-flex justify-content-end">
          <codx-label
            fiedName="isOnline"
            [formModel]="frmModel"
            default="Họp trực tuyến"
          >
          </codx-label>
        </div>
        <div class="d-flex justify-content-center mt-2 ms-2">
          <codx-input
            type="switch"
            class="test-check"
            [checked]="stepsTasks?.isOnline"
            field="isOnline"
            (valueChange)="valueChangeAlert($event)"
          >
          </codx-input>
        </div>
      </div>
      <!-- End cuoc hop -->
      <!-- Gui mail -->
      <!-- TODO: mail chưa có tài liệu -->
      <div
        *ngIf="typeTask === 'E' || typeTask === 'Q'"
        class=""
        style="flex-basis: 5%"
      >
        <div>
          <codx-label
          [formModel]="frmModel"
          default=""
        >
        </codx-label>
        </div>
        <div
          *ngIf="typeTask === 'E'"
          class="d-flex justify-content-end"
          style="margin-top: 3px"
        >
          <button
            class="button-mail"
            *ngIf="typeTask == 'E'"
            (click)="handelMail()"
          >
            <span
              class="icon-email icon-20 text-primary-600 py-2 text-muted"
            ></span>
          </button>
        </div>
      </div>
      <!-- End gui mail -->
    </div>
    <!--End ten Cong Viec -->

    <!-- Khảo sát -->
    <div class="form-group" *ngIf="typeTask == 'S'">
      <div class="d-flex justify-content-between align-items-center mail">
        <codx-label
          fiedName="Reference"
          [formModel]="frmModel"
          default="Bảng khảo sát"
        ></codx-label>
        <a
          class="d-flex justify-content-end align-items-center cursor-pointer"
          *ngIf="stepsTasks?.reference"
          (click)="viewDetailSurveys()"
        >
          <span
            class="icon-insert_link icon-20 text-primary-600 me-2 m-2"
          ></span>
        </a>
      </div>
      <codx-input
        field="reference"
        [formModel]="frmModel"
        (valueChange)="changeQuestion($event)"
      >
      </codx-input>
      <a
        *ngIf="linkQuesiton"
        class="cursor-pointer text-primary"
        (click)="viewDetailSurveys()"
      >
        {{ linkQuesiton }}</a
      >
    </div>
    <!-- Khảo sát -->

    <div class="form-group d-flex justify-content-between row">
      <div class="col-6">
        <codx-label
          fiedName="startDate"
          [formModel]="frmModel"
          default="Ngày bắt đầu"
        >
        </codx-label>
        <codx-input
          field="startDate"
          (valueChange)="changeValueDate($event)"
          [crrValue]="stepsTasks?.startDate"
          type="datetime"
          format="F"
        >
        </codx-input>
      </div>
      <div class="col-6">
        <codx-label
          fiedName="endDate"
          [formModel]="frmModel"
          default="Ngày kết thúc"
        >
        </codx-label>
        <codx-input
          field="endDate"
          (valueChange)="changeValueDate($event)"
          [crrValue]="stepsTasks?.endDate"
          type="datetime"
          format="F"
        >
        </codx-input>
      </div>
    </div>

    <div class="form-group" *ngIf="typeTask == 'Q'">
      <div class="d-flex justify-content-between align-items-center mail">
        <codx-label name="Reference" default="Tên khảo sát"></codx-label>
        <a class="d-flex justify-content-end align-items-center cursor-pointer">
          <span
            class="icon-insert_link icon-20 text-primary-600 me-2 m-2"
          ></span>
        </a>
      </div>
      <codx-input
        field="stepName"
        [formModel]="frmModel"
        type="text"
        [Group]=""
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
      <a class="cursor-pointer text-primary"> {{ linkQuesiton }}</a>
    </div>

    <div class="form-group">
      <div class="d-flex justify-content-between row">
        <div class="col-6">
          <codx-label
            fiedName="durationDay"
            [formModel]="frmModel"
            default="Thời lượng công việc"
          ></codx-label>
          <div class="d-flex justify-content-between row">
            <div class="col-6 position-relative">
              <codx-input
                field="durationDay"
                [formModel]="frmModel"
                [crrValue]="stepsTasks?.durationDay"
                type="text"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
              <div
                class="position-absolute text-gray-400"
                style="top: 7px; right: 14px"
              >
                <codx-label fiedName="" [formModel]="frmModel" default="Ngày">
                </codx-label>
              </div>
            </div>

            <div class="col-6 position-relative ps-0">
              <codx-input
                field="durationHour"
                [formModel]="frmModel"
                type="text"
                [crrValue]="stepsTasks?.durationHour"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
              <div
                class="position-absolute text-gray-400"
                style="top: 7px; right: 14px"
              >
                <codx-label fiedName="" [formModel]="frmModel" default="Giờ">
                </codx-label>
              </div>
            </div>
          </div>
        </div>
        <div class="col-6">
          <codx-label
            fiedName="reminders"
            [formModel]="frmModel"
            default="Nhắc nhở trước khi bắt đầu"
          >
          </codx-label>
          <div>
            <codx-input
              field="reminders"
              [formModel]="frmModel"
              [crrValue]="stepsTasks?.reminders"
              refValue="DP030"
              type="valuelist"
              (valueChange)="valueChangeText($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <div
        class="d-flex justify-content-between align-item-center"
        *ngIf="typeTask === 'M'"
      >
        <div>
          <codx-label
            fiedName="roles"
            [formModel]="frmModel"
            default="Người tham gia"
          ></codx-label>
        </div>
        <codx-input
          type="Share"
          [refValue]="vllShare"
          field=""
          [dataShared]="[]"
          [multiple]="true"
          [showInput]="false"
          (valueChange)="applyOwner($event, listChair)"
        >
        </codx-input>
      </div>
      <ng-container
        *ngIf="listChair.length > 0"
        [ngTemplateOutlet]="showUser"
        [ngTemplateOutletContext]="{ users: listChair }"
      ></ng-container>
    </div>

    <div class="form-group">
      <div>
        <codx-label
          fiedName="memo"
          [formModel]="frmModel"
          default="Ghi chú"
        ></codx-label>
      </div>
      <codx-input
        field="memo"
        [formModel]="frmModel"
        [crrValue]="stepsTasks?.memo"
        [Group]=""
        format="ed"
        type="text"
        [height]="'100'"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>

    <div class="form-group">
      <codx-input
        type="switch"
        class="test-check"
        [checked]="stepsTasks?.createTask"
        field="createTask"
        (valueChange)="valueChangeAlert($event)"
      >
      </codx-input>
      <span style="margin-left: 10px">
        <codx-label
          name="lblAlert"
          [formModel]="frmModel"
          default="Tạo tack trong phân hệ quản lý công việc"
        >
        </codx-label>
      </span>
    </div>
  </div>

  <ng-container>
    <div
      class="d-flex align-items-center justify-content-between mt-4"
      *ngIf="showLabelAttachment"
      style="float: left; clear: left"
    >
      <div class="d-flex align-items-center mb-2">
        <div class="fw-bold text-primary">
          <codx-label
            fiedName="lblAttachments"
            [formModel]="frmModel"
            default="Tài liệu"
          >
          </codx-label>
        </div>
      </div>
    </div>
    <div>
      <codx-attachment
        #attachment
        [objectId]="stepsTasks?.recID"
        hideFolder="1"
        hideImageUpload="0"
        hideImageThumb="0"
        hideUploadBtn="1"
        hideDes="1"
        type="inline"
        allowMultiFile="1"
        [functionID]="funcIDparent"
        (fileAdded)="fileAdded($event)"
        (fileCount)="getfileCount($event)"
        (viewFile)="getfileDelete($event)"
        displayThumb="full"
        showMessage="0"
        [fdID]="folderID"
        [fdName]="stepsTasks?.stepID"
        [parentID]="folderID"
        [dataSelected]="stepsTasks"
      >
      </codx-attachment>
    </div>
  </ng-container>
</ng-template>
<!-- End Form Group -->

<ng-template #footer>
  <button
    style="float: left"
    type="button"
    class="btn btn-light-primary me-3"
    (click)="addFile($event)"
  >
    <i class="icon-cloud_upload fs-5"></i
    ><span>
      <codx-label
        name="UploadFile"
        formName="Tasks"
        default="Đính kèm"
      ></codx-label>
    </span>
  </button>
  <button type="button" class="btn btn-primary" (click)="saveData()">
    <codx-label name="Save" formName="Sprints" default="Lưu"></codx-label>
  </button>
</ng-template>

<ng-template #showUser let-data="users">
  <div class="mt-3" style="display: block">
    <ng-container *ngFor="let item of data; index as i">
      <div class="user-mini-nav" style="background-color: #f4f7ff">
        <span>
          <codx-img
            [width]="25"
            class="me-2"
            [objectId]="item?.objectID"
            objectType="AD_Users"
            [objectName]="item?.objectName"
          ></codx-img>
        </span>
        <span class="text-dark fw-bold"> {{ item?.objectName }} </span>
        <span class="mt-1">
          <a
            (click)="onDeleteOwner(item?.objectID, data)"
            style="cursor: pointer"
          >
            <span class="icon-close icon-16 text-danger ms-3"></span>
          </a>
        </span>
      </div>
    </ng-container>
  </div>
</ng-template>
