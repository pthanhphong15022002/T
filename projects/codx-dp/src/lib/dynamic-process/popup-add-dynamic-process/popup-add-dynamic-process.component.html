<div class="card-body p-0 codx-card-custom">
  <div class="codx-stepper stepper stepper-pills">
    <div class="stepper-header d-flex flex-wrap flex-stack ps-6">
      <div class="d-flex align-items-center">
        <h2 class="h2-title">
          <!-- xài code label truyền lên không load lại data, bật lần 2 thì load -->
          <!-- <codx-label default="titleAction"> </codx-label> -->
          <span>{{ titleAction }}</span>
        </h2>
      </div>
      <div class="d-flex align-items-center">
        <div class="stepper-nav flex-center flex-wrap" #status>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item active' : 'stepper-item approve'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(0)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 0 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblGeneral"
                  [formModel]="dialog.formModel"
                  default="Thông tin quy trình"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(1)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 1 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblStage"
                  [formModel]="dialog.formModel"
                  default="Thiết lập giai đoạn"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(2)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 2 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblCustom"
                  [formModel]="dialog.formModel"
                  default="Trường tùy chỉnh"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(3)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 3 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblFormTemp"
                  [formModel]="dialog.formModel"
                  default="Biểu mẫu"
                ></codx-label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <div class="btn btn-sm btn-bg-white text-inverse-white mb-2">
          <i
            class="icon-close icon-18 text-hover-danger"
            (click)="closePopup()"
          ></i>
        </div>
      </div>
    </div>
    <!-- body rieng -->
    <div class="stepper-body pt-2 w-100">
      <div class="card shadow-none border-0 rounded-2 mx-auto w-1200px h-100">
        <div class="mt-6 pb-3 tab-pane-header px-9 border-bottom">
          <h2 *ngIf="currentTab != 1 && currentTab != 3" class="h2-title">
            <codx-label
              *ngIf="currentTab == 0"
              name="lblGeneral"
              [formModel]="dialog.formModel"
              default="Thông tin quy trình"
            >
            </codx-label>
            <codx-label
              *ngIf="currentTab == 2"
              name="lblDynamicField"
              [formModel]="dialog.formModel"
              default="Trường tùy chỉnh"
            >
            </codx-label>
          </h2>
          <ng-container
            *ngIf="currentTab == 1"
            [ngTemplateOutlet]="stageHeader"
          ></ng-container>
          <ng-container
            *ngIf="currentTab == 3"
            [ngTemplateOutlet]="headerFormTemp"
          ></ng-container>
        </div>
        <div
          [ngClass]="
            currentTab == 1 || currentTab == 3 ? 'scroll-stask' : 'scroll-y'
          "
          class="dp-step pt-4 px-5 mx-1"
          data-kt-scroll="true"
          data-kt-scroll-activate="{default: true}"
          data-kt-scroll-height="auto"
          data-kt-scroll-dependencies=".tab-pane-header,.tab-pane-footer"
          data-kt-scroll-wrappers=".stepper-body"
          data-kt-scroll-offset="0px"
        >
          <div class="tab-content">
            <!--Phần thông tin quy trình - Phúc làm-->
            <div
              class="tab-pane fade"
              id="pane_1"
              [ngClass]="currentTab == 0 ? 'active show' : ''"
            >
              <ng-container [ngTemplateOutlet]="General"></ng-container>
            </div>
            <div
              class="tab-pane fade"
              id="pane_2"
              [ngClass]="currentTab == 1 ? 'active show' : ''"
            >
              <!-- Thiet lap giai doan thuan -->
              <ng-container [ngTemplateOutlet]="stage"></ng-container>
            </div>
            <div
              class="tab-pane fade"
              id="pane_3"
              [ngClass]="currentTab == 2 ? 'active show' : ''"
            >
              <ng-container
                [ngTemplateOutlet]="dynamicFieldsAllSteps"
              ></ng-container>
            </div>
            <div
              class="tab-pane fade"
              id="pane_4"
              [ngClass]="currentTab == 3 ? 'active show' : ''"
            >
              <ng-container [ngTemplateOutlet]="dynamicFormTemp"></ng-container>
            </div>
          </div>
        </div>

        <div
          class="d-flex flex-stack justify-content-between card-footer border-top"
        >
          <div class="left">
            <button
              type="button"
              class="btn btn-outline-primary me-3"
              *ngIf="currentTab != 0"
              (click)="previous(currentTab)"
            >
              <codx-label name="lblBack" default="Quay lại"> </codx-label>
            </button>
          </div>
          <div *ngIf="currentTab == 0"></div>
          <div>
            <button
              *ngIf="currentTab != 3"
              type="button"
              [ngClass]="checkSaveNow() ? '' : 'disabled'"
              class="btn btn-primary me-5"
              (click)="onSaveNow()"
            >
              <codx-label
                [name]="'lblSaveNow'"
                [default]="'Lưu ngay'"
              ></codx-label>
            </button>

            <button
              *ngIf="currentTab != 3"
              type="button"
              [ngClass]="checkButtonContinue() ? '' : 'disabled'"
              class="btn btn-primary"
              (click)="continue(currentTab)"
            >
              <codx-label
                [name]="'lblContinue'"
                [default]="'Tiếp tục'"
              ></codx-label>
            </button>

            <button
              *ngIf="currentTab == 3"
              type="button"
              class="btn btn-primary"
              (click)="onSave()"
            >
              <codx-label [name]="'lblSave'" [default]="'Lưu'"></codx-label>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #footer> </ng-template>

<!--Phần của Phúc - Thông tin quy trình-->
<ng-template #General>
  <!--Thông tin chung-->
  <div class="background">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblGeneral"
            [formModel]="dialog.formModel"
            default="Thông tin chung"
          ></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            name="lblGeneral"
            [formModel]="dialog.formModel"
            default="Thông tin chung của quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'general-main')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div id="general-main" class="main" [ngClass]="'show-main'">
      <div class="row">
        <div class="col-6">
          <div class="form-group margin-form">
            <div>
              <codx-label fiedName="GroupID" [formModel]="dialog.formModel">
              </codx-label>
            </div>
            <!-- <codx-input field="groupID" [crrValue]="process.groupID" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
            <codx-input
              field="groupID"
              type="combobox"
              [placeholder]="gridViewSetup['GroupID']?.description"
              [crrValue]="process?.groupID"
              [refValue]="gridViewSetup?.GroupID?.referedValue"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
            <div
              *ngIf="!checkGroup"
              class="errorMessage text-danger ms-3"
              data-field=""
            >
              {{ errorMessage }}
            </div>
          </div>
          <div class="form-group margin-form">
            <div>
              <codx-label fiedName="ProcessName" [formModel]="dialog.formModel">
              </codx-label>
            </div>
            <!-- <codx-input field="processName" [crrValue]="process.processName" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
            <codx-input
              field="processName"
              [placeholder]="gridViewSetup['ProcessName']?.description"
              type="text"
              [crrValue]="process.processName"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
          <div class="form-group margin-form">
            <div>
              <codx-label fiedName="AutoName" [formModel]="dialog.formModel">
              </codx-label>
            </div>
            <!-- <codx-input field="processName" [crrValue]="process.processName" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
            <codx-input
              field="autoName"
              type="text"
              [crrValue]="process.autoName"
              [placeholder]="gridViewSetup['AutoName']?.description"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
          <div class="form-group margin-form">
            <div>
              <codx-label fiedName="ApplyFor" [formModel]="dialog.formModel">
              </codx-label>
            </div>
            <!-- <codx-input field="applyFor" [crrValue]="process.applyFor" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup">
            </codx-input> -->
            <codx-input
              field="applyFor"
              type="valuelist"
              [crrValue]="process.applyFor"
              [refValue]="gridViewSetup?.ApplyFor?.referedValue"
              (valueChange)="valueChange($event)"
              [placeholder]="gridViewSetup['ApplyFor']?.description"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div class="form-group ms-5">
            <codx-label name="lblAvatarProcess" default="Ảnh đại diện">
            </codx-label>
            <ng-container [ngTemplateOutlet]="avatarProcess"></ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--Các vai trò quy trình-->
  <div class="background">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblPermissions"
            [formModel]="dialog.formModel"
            default="Các vai trò trong quy trình"
          >
          </codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            name="lblPerm"
            [formModel]="dialog.formModel"
            default="Những người liên quan và có thể thực hiện các chức năng
            trong quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'role-main')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div id="role-main" class="main" [ngClass]="'show-main'">
      <div class="d-flex flex-column mb-4">
        <div class="d-flex align-items-center mb-2">
          <codx-label
            class="fw-bold fs-4 text-dark me-3"
            name="lblSupervisor"
            [formModel]="dialog.formModel"
            default="Người giám sát"
          >
          </codx-label>
          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            (click)="sharePerm(controlShare, 'supervisor')"
          >
            <i class="icon-person_add_alt_1 icon-16"></i>
          </button>

          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            (click)="clickRoles('O')"
          >
            <i class="icon-settings icon-16"></i>
          </button>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblLocationControl"
            default="Có quyền xem và giám sát tất cả nhiệm vụ của các thành
            viên trong quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div
        class="d-flex flex-wrap"
        *ngIf="process.permissions != null && process.permissions?.length > 0"
      >
        <ng-container *ngFor="let perm of process.permissions; index as i">
          <div
            *ngIf="perm.roleType == 'O'"
            class="cursor-pointer has-action-menu-od me-6 d-flex align-items-center mb-2 position-relative"
          >
            <div class="me-2">
              <codx-img
                [width]="20"
                [objectId]="perm.objectName"
                objectType="AD_Users"
              >
              </codx-img>
            </div>
            <div class="text-gray-600 fw-bold">{{ perm.objectName }}</div>
            <ng-container *ngIf="checkAssignRemove(i)">
              <div class="action-menu-od" (click)="removeUser(i)">
                <i class="icon-close text-danger icon-16"></i>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
      <hr />

      <div class="d-flex flex-column mb-4">
        <div class="d-flex align-items-center mb-2">
          <codx-label
            class="fw-bold fs-5 text-dark me-3"
            name="lblParticipants"
            [formModel]="dialog.formModel"
            default="Thành viên tham gia"
          >
          </codx-label>
          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            (click)="sharePerm(controlShare, 'participants')"
          >
            <i class="icon-person_add_alt_1 icon-16"></i>
          </button>

          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            (click)="clickRoles('P')"
          >
            <i class="icon-settings icon-16"></i>
          </button>
        </div>
        <div>
          <codx-label
            class="fw-normal text-gray-400"
            name="lblParticipantControl"
            [formModel]="dialog.formModel"
            default="Có quyền tạo nhiệm vụ trong quy trình"
          >
          </codx-label>
        </div>
      </div>

      <div
        class="d-flex flex-wrap"
        *ngIf="process.permissions != null && process.permissions?.length > 0"
      >
        <ng-container *ngFor="let perm of process.permissions; index as i">
          <div
            *ngIf="perm.roleType == 'P'"
            class="cursor-pointer has-action-menu-od me-6 d-flex align-items-center mb-2 position-relative"
          >
            <div class="me-2">
              <codx-img
                [width]="20"
                [objectId]="perm.objectName"
                objectType="AD_Users"
              >
              </codx-img>
            </div>
            <div class="text-gray-600 fw-bold">{{ perm.objectName }}</div>
            <ng-container *ngIf="checkAssignRemove(i)">
              <div class="action-menu-od" (click)="removeUser(i)">
                <i class="icon-close text-danger icon-16"></i>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>

      <hr />
      <div class="d-flex flex-column mb-4">
        <div class="d-flex align-items-center mb-2">
          <codx-label
            class="fw-bold fs-5 text-dark me-3"
            name="lblFollowers"
            [formModel]="dialog.formModel"
            default="Người theo dõi"
          >
          </codx-label>
          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            (click)="sharePerm(controlShare, 'followers')"
          >
            <i class="icon-person_add_alt_1 icon-16"></i>
          </button>
          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            (click)="clickRoles('F')"
          >
            <i class="icon-settings icon-16"></i>
          </button>
        </div>
        <div>
          <codx-label
            class="fw-normal text-gray-400"
            name="lblFollowerControl"
            [formModel]="dialog.formModel"
            default="Có quyền xem các nhiệm vụ trong quy trình"
          >
          </codx-label>
        </div>
      </div>

      <div
        class="d-flex flex-wrap"
        *ngIf="process.permissions != null && process.permissions?.length > 0"
      >
        <ng-container *ngFor="let perm of process.permissions; index as i">
          <div
            *ngIf="perm.roleType == 'F'"
            class="cursor-pointer has-action-menu-od me-6 d-flex align-items-center mb-2 position-relative"
          >
            <div class="me-2">
              <codx-img
                [width]="20"
                [objectId]="perm.objectName"
                objectType="AD_Users"
              >
              </codx-img>
            </div>
            <div class="text-gray-600 fw-bold">{{ perm.objectName }}</div>
            <ng-container *ngIf="checkAssignRemove(i)">
              <div class="action-menu-od" (click)="removeUser(i)">
                <i class="icon-close text-danger icon-16"></i>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
      <hr />
      <div class="d-flex flex-column mb-4">
        <div class="d-flex align-items-center mb-2">
          <codx-label
            class="fw-bold fs-5 text-dark me-3"
            fiedName="ApproveRule"
            [formModel]="dialog.formModel"
          >
          </codx-label>
          <div class="me-3">
            <codx-input
              type="switch"
              class="test-check"
              [checked]="process?.approveRule"
              field="approveRule"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
          <button
            type="button"
            class="btn btn-icon btn-sm btn-light-primary me-2"
            [disabled]="!process?.approveRule"
            (click)="clickSettingApprove()"
          >
            <i class="icon-settings icon-16"></i>
          </button>
        </div>
        <ng-container *ngIf="process?.approveRule">
          <div class="mb-2" >
            <codx-label
              class="fw-normal text-gray-400"
              name="lblDescriptionApproveRule"
              [formModel]="dialog.formModel"
              default="Các bước duyệt khi thực hiện trình kí"
            >
            </codx-label>
          </div>
          <div
            class="progress-approval ms-3 mx-3"
            *ngIf="listStepApproverView?.length > 0"
          >
            <ng-container
              *ngFor="let item of listStepApproverView; let i = index"
            >
              <div class="process-step" placement="top">
                <div
                  class="step-node cursor-pointer"
                  [style.color]="''"
                  [ngStyle]="{ border: '2px solid ' + '' }"
                  #popoverDetails="ngbPopover"
                  [ngbPopover]="popupViewApproverStep"
                  (mouseenter)="popoverApproverStep(popoverDetails, item)"
                  (mouseleave)="popoverApproverStep(popoverDetails, null)"
                  popoverClass="approverStepClass"
                  container="body"
                  placement="top bottom"
                >
                  {{ i + 1 }}
                </div>
                <div class="text-gray-600 fw-bold">
                  {{ item.stepType | vll : "ES002" : "text" | async }}
                </div>
              </div>
            </ng-container>
          </div>
          <div
            class="center w-400 mt-5 mb-3"
            *ngIf="listStepApproverView && listStepApproverView.length == 0"
          >
            <codx-label
              name="lblNotSetup"
              default="Chưa thiết lập"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
        </ng-container>
      </div>
      <ng-template #popupViewApproverStep>
        <div class="">
          <div class="text-gray-600 fw-bold">
            {{ viewApproverStep.stepName }}
          </div>
          <div class="d-flex flex-wrap">
            <ng-container *ngFor="let approver of viewApproverStep.approvers">
              <div
                class="border border-1 border-gray-300 rounded min-w-250px mw-250px me-4 mb-2"
              >
                <codx-temp-full
                  cardCss="card-template p-3"
                  *ngIf="
                    approver.roleType?.length == 1 || approver.roleType == 'PA'
                  "
                  [imageId]="approver.approver"
                  [title]="approver.name"
                  [subTitle]="approver.position"
                  [imageObjType]="'AD_Users'"
                  [modeImgs]="true"
                  [titleLine]="3"
                >
                </codx-temp-full>

                <codx-temp-full
                  cardCss="card-template p-3"
                  *ngIf="
                    approver.roleType.length > 1 && approver.roleType != 'PA'
                  "
                  [imageSrc]="
                    './assets/themes/sys/default/img/' +
                    (viewApproverStep.icon
                      ? viewApproverStep.icon
                      : 'share_default.svg')
                  "
                  imgCss="me-3 p-3 user-mini-icon w-40px h-40px"
                  [title]="approver.approver | vll : 'ES014' : 'text' | async"
                  [subTitle]="
                    approver.approver | vll : 'ES014' : 'text' | async
                  "
                  [modeImgs]="true"
                  [titleLine]="3"
                >
                </codx-temp-full>

                <!-- <ng-template #footer1 let-data>
                <div
                  class="d-flex align-items-center justify-content-end"
                >
                  <span
                    class="icon-access_time icon-14 me-1"
                  ></span
                  >{{ data.leadtime }} giờ
                </div>
              </ng-template> -->
              </div>
            </ng-container>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
  <!--Tùy chỉnh quy trình-->
  <div class="background">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblSetting"
            [formModel]="dialog.formModel"
            default="Tùy chỉnh quy trình"
          ></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            name="lblActived"
            [formModel]="dialog.formModel"
            default="Cách thức hoạt động của quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'setting-main')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div id="setting-main" class="main" [ngClass]="'show-main'">
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="InstanceNoSetting"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div #autoNumberSetting class="position-relative col-6">
              <codx-input
                type="text"
                [crrValue]="instanceNoSetting"
                [placeholder]="gridViewSetup['InstanceNoSetting']?.description"
                (valueChange)="valueChangeAutoNoCode($event)"
                field="instanceNoSetting"
              >
              </codx-input>
              <div
                class="position-absolute cursor-pointer"
                style="top: 7px; right: 13px"
              >
                <i
                  class="icon-settings form-control-feedback"
                  (click)="openAutoNumPopup()"
                ></i>
              </div>
            </div>
            <div *ngIf="instanceNoEx" class="col-6 fs-6 mt-2 mb-2">
              <codx-label
                class=""
                name="lblPreview"
                [formModel]="dialog.formModel"
                default="Xem trước: "
              ></codx-label>
              <span class="text-gray-600">{{ instanceNoEx }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="AddFieldsControl"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                field="addFieldsControl"
                type="valuelist"
                [crrValue]="process?.addFieldsControl"
                [refValue]="gridViewSetup?.AddFieldsControl?.referedValue"
                (valueChange)="valueChange($event)"
                [placeholder]="gridViewSetup['AddFieldsControl']?.description"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label fiedName="ViewMode" [formModel]="dialog.formModel">
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                field="viewMode"
                type="valuelist"
                [crrValue]="process.viewMode"
                [refValue]="gridViewSetup?.ViewMode?.referedValue"
                (valueChange)="valueChange($event)"
                [placeholder]="gridViewSetup['ViewMode']?.description"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="ViewModeDetail"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                field="viewModeDetail"
                type="valuelist"
                [crrValue]="process.viewModeDetail"
                [refValue]="gridViewSetup?.ViewModeDetail?.referedValue"
                (valueChange)="valueChange($event)"
                [placeholder]="gridViewSetup['ViewModeDetail']?.description"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="ShowInstanceControl"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                type="valuelist"
                [refValue]="gridViewSetup?.ShowInstanceControl?.referedValue"
                [placeholder]="
                  gridViewSetup['ShowInstanceControl']?.description
                "
                [crrValue]="process.showInstanceControl"
                (valueChange)="valueChange($event)"
                field="showInstanceControl"
              >
              </codx-input>
            </div>
            <!-- <codx-input [crrValue]="process.showInstanceControl" (valueChange)="valueChange($event)" field="showInstanceControl" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="CloseInstanceControl"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <!-- <codx-input [crrValue]="process.closeInstanceControl" (valueChange)="valueChange($event)" field="closeInstanceControl" [formModel]="formModel" [Group]="formGroup" >
              </codx-input> -->
            <div class="position-relative col-6">
              <codx-input
                field="closeInstanceControl"
                type="number"
                [min]="0"
                [showSpinButton]="false"
                [placeholder]="
                  gridViewSetup['CloseInstanceControl']?.description
                "
                (valueChange)="valueChange($event)"
                [crrValue]="process.closeInstanceControl"
                field="closeInstanceControl"
              ></codx-input>
              <div
                class="position-absolute text-gray-400"
                style="top: 7px; right: 13px"
              >
                <codx-label fiedName="lblDate" default="Ngày"></codx-label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label fiedName="AllowCopy" [formModel]="dialog.formModel">
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <div class="d-flex align-items-center">
                <div class="me-5">
                  <codx-input
                    name="copy-radio"
                    type="radio"
                    style="width: 100%"
                    field="yes"
                    [label]="titleRadioYes"
                    [checked]="process?.allowCopy ?? false"
                    [crrValue]="process?.allowCopy"
                    (valueChange)="valueRadioInfo($event, 'AllowCopyView')"
                  >
                  </codx-input>
                </div>
                <div class="me-5">
                  <codx-input
                    name="copy-radio"
                    type="radio"
                    style="width: 100%"
                    field="no"
                    [label]="titleRadioNo"
                    [checked]="!process?.allowCopy ?? false"
                    [crrValue]="process?.allowCopy"
                    (valueChange)="valueRadioInfo($event, 'AllowCopyView')"
                    readonly
                  >
                  </codx-input>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--Hướng dẫn làm việc với quy trình-->
  <div class="background">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="Memo"
            [formModel]="dialog.formModel"
            default="Hướng dẫn làm việc với quy trình"
          >
          </codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            name="lblMemo"
            [formModel]="dialog.formModel"
            default="Mô tả chi tiết quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <div class="group-button">
            <button
              *ngIf="isShowstage"
              class="button-custom"
              (click)="clickShow($event, 'memo-main')"
            >
              <span
                class="icon-expand_less icon-20 text-primary-600 py-2"
                style="font-weight: 500"
              ></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="memo-main" class="main" [ngClass]="'show-main'">
      <div class="form-group margin-form mb-4">
        <codx-input
          field="memo"
          type="textarea"
          [crrValue]="process?.memo"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
    </div>
  </div>
</ng-template>

<!--AVT Thông tin chung-->
<ng-template #avatarProcess>
  <div
    class="dropzone dropzone-default dropzone-primary d-flex flex-center flex-column"
    (click)="addAvatar()"
  >
    <div class="dropzone-msg dz-message needsclick">
      <ng-container *ngIf="linkAvatar != ''">
        <img [src]="linkAvatar" class="image-maxsize" />
      </ng-container>
      <ng-container *ngIf="linkAvatar == ''">
        <div class="dropzone-msg-title mb-2">
          <i class="icon-image icon-30"></i>
        </div>
      </ng-container>
    </div>
  </div>
  <codx-attachment
    #imageAvatar
    [objectId]="process.recID"
    [objectType]="dialog.formModel.entityName"
    hideFolder="1"
    hideImageUpload="1"
    hideImageThumb="1"
    hideUploadBtn="1"
    hideDes="1"
    type="inline"
    allowMultiFile="0"
    [formModel]="dialog.formModel"
    allowExtensions=".jpg,.png"
    [isSaveSelected]="0"
    (fileAdded)="fileImgAdded($event)"
    displayThumb="full"
    showMessage="0"
    category="0"
  >
  </codx-attachment>
</ng-template>

<!--Control share-->
<ng-template #controlShare let-dialogControl>
  <codx-share
    [dialog]="dialogControl"
    [multiple]="multiple"
    [listCombobox]="listCombobox"
    (eventApply)="applyShare($event, typeShare)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #popupParticipants let-dialogPar>
  <codx-popup-participants
    [lstParticipants]="lstParticipants"
    [dialog]="dialogPar"
    [isType]="'S'"
    (eventUser)="eventUser($event)"
  ></codx-popup-participants>
</ng-template>
<!--End-->
<!--End-->

<!-- Quy trình động - All in ------------------------------------------------------------------------------- -->
<ng-template #dynamicFieldsAllSteps>
  <ng-container
    *ngIf="stepList?.length > 0"
    [ngTemplateOutlet]="dynamicFields"
    [ngTemplateOutletContext]="{ $implicit: stepList, haveTitle: false }"
  >
  </ng-container>
</ng-template>

<ng-template #dynamicFieldsOneSteps>
  <ng-container
    [ngTemplateOutlet]="dynamicFields"
    [ngTemplateOutletContext]="{ $implicit: [step], haveTitle: true }"
  >
  </ng-container>
</ng-template>

<ng-template #dynamicFields let-datas let-haveTitle="haveTitle">
  <div
    cdkDropList
    class="list"
    (cdkDropListDropped)="dropCustomFile($event, null)"
  >
    <div cdkDropListGroup>
      <ng-container *ngFor="let item of datas">
        <div
          *ngIf="!item.isFailStep && !item.isSuccessStep"
          cdkDrag
          [cdkDragDisabled]="true"
          [cdkDragStartDelay]="200"
          [cdkDragData]="item"
        >
          <div class="background-job mb-5">
            <div
              class="header-job d-flex align-items-center justify-content-between py-2 px-5"
            >
              <div class="d-flex flex-column">
                <div class="title text-primary fs-4 fw-bold">
                  <span class="me-2" *ngIf="haveTitle">{{
                    titleDefaultCF
                  }}</span>
                  <span class="me-2" *ngIf="!haveTitle">{{
                    item.stepName
                  }}</span>
                </div>
                <div class="text-gray-600">
                  <codx-label
                    name="lblExpression"
                    formName="DPStepsFields"
                    gridViewName="grvDPStepsFields"
                    [default]="'Kéo thả để sắp xếp các trường tùy chỉnh'"
                  >
                  </codx-label>
                </div>
              </div>
              <div class="d-flex align-items-center">
                <button
                  type="button"
                  class="btn btn-icon btn-sm btn-light-primary ms-2"
                  (click)="
                    addCustomField(item.recID, item.processID, !haveTitle)
                  "
                >
                  <i class="icon-add icon-18"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-icon btn-sm btn-light-primary ms-2"
                  #p="ngbPopover"
                  [ngbPopover]="popperHandelSetting"
                  (mouseenter)="popoverSelectView(p, item)"
                  placement="bottom right top left"
                  [popoverClass]=""
                >
                  <i class="icon-settings icon-18"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-icon btn-sm btn-light-primary ms-2"
                  (click)="
                    clickShow(
                      $event,
                      haveTitle ? item.recID : 'v-' + item.recID
                    )
                  "
                >
                  <i class="icon-expand_less icon-18"></i>
                </button>
              </div>
            </div>
            <div
              id="{{ haveTitle ? item.recID : 'v-' + item.recID }}"
              class="show-main"
              cdkDropList
              [cdkDropListData]="item?.fields || []"
              (cdkDropListDropped)="dropCustomFile($event, item.recID)"
            >
              <div
                *ngIf="!item?.fields || item?.fields?.length == 0"
                class="p-6"
              >
                <div
                  class="d-flex align-items-center justify-content-center w-100"
                >
                  <div cdkDrag [cdkDragDisabled]="true" [cdkDragData]="null">
                    <button
                      type="button"
                      class="btn btn-outline-primary"
                      (click)="
                        addCustomField(item.recID, item.processID, !haveTitle)
                      "
                    >
                      <i class="icon-add icon-18 text-primary"></i>
                      <codx-label
                        [name]="'lblAddCustomField'"
                        [formName]="'DPStepsFields'"
                        [gridViewName]="'grvDPStepsFields'"
                        [default]="'Thêm trường tùy chỉnh'"
                      ></codx-label>
                    </button>
                  </div>
                </div>
              </div>

              <div *ngIf="item?.fields?.length > 0">
                <div class="class-field p-6 row">
                  <ng-container *ngFor="let item1 of item?.fields">
                    <div
                      class="col-{{
                        12 / item.showColumnControl
                      }} has-action-menu crr-fiels"
                      cdkDrag
                      [cdkDragStartDelay]="200"
                      [cdkDragData]="item1"
                    >
                      <!-- <div class="fw-bold text-gray-700 fs-6 text-dark mt-2">
                        {{ item1?.title }} ( {{ item1?.fieldName }} )
                      </div>
                      <div class="text-gray-400">{{ item1.note }}</div>
                      <div class="d-flex">
                        <div class="datatypes me-4">
                          <codx-vll
                            [name]="vllType"
                            [value]="item1?.dataType"
                            [showText]="true"
                            [showBgColor]="true"
                          >
                          </codx-vll>
                        </div>
                        <codx-label
                          class="text-danger"
                          fiedName="IsRequired"
                          formName="DPStepsFields"
                          gridViewName="grvDPStepsFields"
                          default="Bắt buộc *"
                        ></codx-label>
                        <codx-input
                          type="switch"
                          field="isRequired"
                          [checked]="item1?.isRequired"
                          (valueChange)="changeRequired($event, item1)"
                        >
                        </codx-input>
                      </div> -->
                      <codx-input-custom-field
                        [customField]="item1"
                        [objectId]="item1.recID"
                        [disable]="true"
                        [viewFieldName]="true"
                      >
                      </codx-input-custom-field>
                      <codx-mfunc
                        [formModel]="formModelField"
                        (clickMF)="clickMFFields($event, item1, !haveTitle)"
                        [dataItem]="action != 'edit' ? moreDefaut : item"
                        [type]="'hover'"
                      >
                      </codx-mfunc>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <ng-template #popperHandelSetting>
    <div
      class="d-flex m-3 text-hover-primary cursor-pointer"
      (click)="selectView(1)"
    >
      <span class="icon-view_column icon-20"></span
      ><span>
        <codx-label
          name="lblSelectFirst"
          formName="DPStepsFields"
          gridViewName="grvDPStepsFields"
          default="1 cột"
        >
        </codx-label>
      </span>
    </div>
    <div
      class="d-flex m-3 text-hover-primary cursor-pointer"
      (click)="selectView(2)"
    >
      <span class="icon-view_column icon-20"></span>
      <span>
        <codx-label
          name="lblSelectSecond"
          formName="DPStepsFields"
          gridViewName="grvDPStepsFields"
          default="2 cột"
        >
        </codx-label>
      </span>
    </div>
    <!-- <div
      class="d-flex m-3 text-hover-primary cursor-pointer"
      (click)="selectView(3)"
    >
      <span class="icon-view_column icon-20"></span>
      <span>
        <codx-label
          name="lblSelectThree"
          formName="DPStepsFields"
          gridViewName="grvDPStepsFields"
          default="3 cột"
        >
        </codx-label>
      </span>
    </div> -->
  </ng-template>
</ng-template>

<!-- Biểu mẫu -->
<ng-template #dynamicFormTemp>
  <div class="background-stage dp-step">
    <div class="stage-body d-flex">
      <div class="stage-body-left w-300px minw-300px pe-1">
        <div class="example-list stage-body-left-main">
          <ul
            ngbNav
            #nav="ngbNav"
            [(activeId)]="active"
            class="nav-export h-100 p-0 m-0"
            orientation="vertical"
            (navChange)="navChanged($event)"
          >
            <li class="p-0 m-0" ngbNavItem="1">
              <a ngbNavLink
                ><div class="d-flex align-items-center py-2">
                  <i
                    class="fa-solid fa-file-excel fs-2 me-3"
                    style="color: #347442"
                  ></i
                  ><codx-label
                    [default]="'Excel Template'"
                    [class]="
                      'fw-bold ' + (type == 'excel' ? 'text-primary' : '')
                    "
                  ></codx-label></div
              ></a>
            </li>
            <li class="p-0 m-0" ngbNavItem="2">
              <a ngbNavLink
                ><div class="d-flex align-items-center py-2">
                  <i
                    class="fa-solid fa-file-word fs-2 me-3"
                    style="color: #005dc7"
                  ></i
                  ><codx-label
                    [default]="'Word Template'"
                    [class]="
                      'fw-bold ' + (type == 'word' ? 'text-primary' : '')
                    "
                  ></codx-label></div
              ></a>
            </li>
          </ul>
          <div
            [ngbNavOutlet]="nav"
            class="tmp-content ms-4 ps-6 border-start w-100 h-100"
          ></div>
        </div>
      </div>
      <div class="stage-body-right w-100 ps-6">
        <ng-container *ngIf="type == 'excel'">
          <div class="mb-4">
            <div>
              <codx-label
                [default]="'Excel Template'"
                class="fs-4 fw-bold"
              ></codx-label>
            </div>
            <div class="fs-7 text-gray-500">
              <codx-label
                [default]="'Danh sách file excel đã import'"
              ></codx-label>
            </div>
          </div>
          <div (scroll)="onScroll($event)" class="export-content mt-3">
            <ng-container
              [ngTemplateOutlet]="
                dataEx?.length > 0 ? tempDataEx : emptyTemplate
              "
            >
            </ng-container>
            <ng-template #tempDataEx>
              <div
                class="d-flex align-items-start justify-content-between py-2 border-bottom"
                *ngFor="let item of dataEx"
              >
                <div class="d-flex align-items-top w-100">
                  <!-- <div class="w-20px h-20px me-2">
                  <codx-input type="radio" name="format"  ControlName="format" [crrValue]="'excelTemp_' + item.recID" ></codx-input>
                </div> -->
                  <div class="d-flex flex-column w-100">
                    <div class="fw-bold text-dark">
                      {{ item.templateName }}
                    </div>
                    <div class="fs-7 text-gray-500 text-italic">
                      {{ item.description }}
                    </div>
                  </div>
                </div>
                <div class="d-flex align-items-start ms-6">
                  <button
                    type="button"
                    class="btn btn-icon btn-sm btn-outline-primary"
                    triggers="click"
                    [autoClose]="true"
                    [ngbTooltip]="tool"
                    ngClass="border-0"
                  >
                    <span class="icon-more_vert icon-16"></span>
                  </button>
                  <ng-template #tool>
                    <ng-container *ngFor="let x of moreFunction">
                      <div
                        class="d-flex p-2 cursor-pointer"
                        (click)="openFormTemplet(x?.id, item)"
                      >
                        <span
                          class="icon-16 me-2"
                          [ngClass]="x?.icon"
                          [style.color]="x?.textColor"
                        ></span>
                        <codx-label
                          [formModel]="dialog.formModel"
                          [default]="x?.text"
                        ></codx-label>
                      </div>
                    </ng-container>
                  </ng-template>
                </div>
              </div>
            </ng-template>
          </div>
        </ng-container>
        <ng-container *ngIf="type == 'word'">
          <div class="mb-4">
            <div>
              <codx-label
                [default]="'Word Template'"
                class="fs-4 fw-bold"
              ></codx-label>
            </div>
            <div class="fs-7 text-gray-500">
              <codx-label
                [default]="'Danh sách file word đã import'"
              ></codx-label>
            </div>
          </div>
          <div class="export-content mt-3">
            <ng-container
              [ngTemplateOutlet]="
                dataWord?.length > 0 ? tempDataWord : emptyTemplate
              "
            >
            </ng-container>
            <ng-template #tempDataWord>
              <div
                class="d-flex align-items-start justify-content-between py-2 border-bottom"
                *ngFor="let item of dataWord"
              >
                <div class="d-flex align-items-top w-100">
                  <!-- <div class="w-20px h-20px me-2">
                  <codx-input type="radio" name="format" ControlName="format" [crrValue]="item.recID" ></codx-input>
                </div> -->
                  <div class="d-flex flex-column w-100">
                    <div class="fw-bold text-dark">
                      {{ item.templateName }}
                    </div>
                    <div class="fs-7 text-gray-500 text-italic">
                      {{ item.description }}
                    </div>
                  </div>
                </div>
                <div class="d-flex align-items-start ms-6">
                  <div ngbDropdown class="dropdown ms-6">
                    <button
                      ngbDropdownToggle
                      class="btn"
                      type="button"
                      id="dropdownMenuButton1"
                      aria-haspopup="true"
                      aria-expanded="false"
                    >
                      <span class="icon-more_vert icon-18"></span>
                    </button>
                    <div ngbDropdownMenu aria-labelledby="dropdownMenuButton1">
                      <a ngbDropdownItem class="dropdown-item">
                        <div
                          class="d-flex align-items-center cursor-pointer"
                          (click)="openFormTemplet('edit', item)"
                        >
                          <span class="icon-edit text-primary icon-16"></span>
                          <span class="ms-2">
                           <codx-label name="lblEdit"  default='Chỉnh sửa' ></codx-label>
                          </span>
                        </div>
                      </a>
                      <a ngbDropdownItem class="dropdown-item">
                        <div
                          class="d-flex align-items-center cursor-pointer"
                          (click)="openFormTemplet('delete', item)"
                        >
                          <span class="icon-delete text-danger icon-16"></span>
                          <codx-label name="lblDelete" default='Xóa'></codx-label>
                        </div>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>
            <!-- <ng-template #elseWord>
              <div class="export-container">
                <div
                  class="d-flex flex-column flex-center justify-content-center"
                >
                  <img
                    src="../assets/themes/sys/default/img/DataEmpty.svg"
                    class="w-200px"
                  />
                  <div class="fw-bold mt-1 text-center">
                    <div class="mt-2 text-center">Chưa có dữ liệu word</div>
                  </div>
                </div>
              </div>
            </ng-template> -->
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #headerFormTemp>
  <div class="d-flex justify-content-between align-items-center">
    <h2 class="h2-title">
      <codx-label
        name="lblFormTemp"
        [formModel]="dialog.formModel"
        default="Biểu mẫu"
      ></codx-label>
    </h2>
    <button
      type="button"
      class="btn btn-sm btn-outline-primary"
      (click)="openFormTemplet('add', null)"
    >
      <i class="icon-add icon-14 text-primary ms-n1"></i>
      <codx-label [name]="'lblAdd'" [default]="'Thêm'"></codx-label>
    </button>
  </div>
</ng-template>
<!-- Thiết lập giai đoạn của nvthuan + Bảo -->

<ng-template #stageHeader>
  <div class="d-flex justify-content-between align-items-center">
    <h2 class="h2-title">
      <codx-label fiedName="settingStep" default="Thiết lập giai đoạn">
      </codx-label>
    </h2>
  </div>
</ng-template>

<ng-template #stage>
  <div class="background-stage dp-step">
    <div class="stage-body d-flex">
      <div class="stage-body-left w-300px minw-300px pe-1">
        <div
          class="fw-bold fs-5 text-dark pb-2 mb-1 border-bottom stage-header d-flex align-items-center justify-content-between"
        >
          <codx-label fiedName="step" default="Giai đoạn"></codx-label>
          <button
            type="button"
            class="btn btn-sm btn-outline-primary"
            (click)="openPopupStep('add')"
          >
            <i class="icon-add icon-14 text-primary ms-n1"></i>
            <codx-label [name]="'lblAdd'" [default]="'Thêm'"></codx-label>
          </button>
        </div>
        <div
          class="example-list stage-body-left-main"
          cdkDropList
          (cdkDropListDropped)="dropStep($event)"
        >
          <!-- danh sách giai đoạn -->
          <div class="stage-scroll">
            <div
              cdkDrag
              *ngFor="let itemStep of stepList; let i = index"
              class="list-stage example-box drap-drop cursor-pointer border-bottom has-action-menu"
              [style.display]="
                itemStep.isSuccessStep || itemStep.isFailStep ? 'none' : ''
              "
              (click)="
                clickViewStep($event, viewStepCustom, itemStep ?? strEmpty)
              "
              [ngStyle]="{ 'background-color': itemStep?.backgroundColor }"
              [ngClass]="itemStep?.recID === step?.recID ? 'click' : ''"
            >
              <ng-container
                *ngIf="!itemStep['isSuccessStep'] && !itemStep['isFailStep']"
              >
                <div class="d-flex flex-column">
                  <div class="d-flex">
                    <span
                      *ngIf="itemStep?.icon"
                      class="me-2 d-flex align-items-center"
                      [ngClass]="itemStep?.icon"
                      [ngStyle]="{ color: itemStep?.iconColor }"
                    ></span>
                    <span
                      class="fw-bold line-clamp line-clamp-1"
                      [ngStyle]="{ color: itemStep?.textColor }"
                    >
                      {{ itemStep?.stepName }}
                    </span>
                  </div>

                  <div class="fs-7" [ngStyle]="{ color: itemStep?.textColor }">
                    <codx-label
                      fiedName="durationTime"
                      [formModel]="dialog.formModel"
                      [default]="'Thời hạn: '"
                    >
                    </codx-label>
                    <span>{{ itemStep?.durationDay || 0 }}</span>
                    <codx-label
                      fiedName="day"
                      [formModel]="dialog.formModel"
                      [default]="strDay"
                    ></codx-label>
                    <span>{{ itemStep?.durationHour || 0 }}</span>
                    <codx-label
                      fiedName="hour"
                      [formModel]="dialog.formModel"
                      [default]="strHour"
                    ></codx-label>
                  </div>
                  <div class="fs-7" [ngStyle]="{ color: itemStep?.textColor }">
                    <codx-label
                      fiedName="task"
                      [formModel]="dialog.formModel"
                      [default]="'Công việc:'"
                    ></codx-label>
                    <span class="fw-bold">{{ itemStep?.tasks?.length }}</span>
                  </div>
                </div>
                <codx-mfunc
                  *ngIf="viewStepCrr == viewStepCustom"
                  [formModel]="grvMoreFunction"
                  (clickMF)="clickMFStep($event, itemStep)"
                  [dataItem]="moreDefaut"
                  [type]="'hover'"
                  (changeDataMF)="changeDataMF($event, 'step')"
                >
                </codx-mfunc>
              </ng-container>
            </div>
          </div>
          <div class="stage-fix">
            <!-- Step Reason successs -->
            <div class="fw-bold fs-5 text-dark pt-2 pb-1 mb-1 border-top">
              {{ noteResult }}
            </div>
            <div
              class="list-stage cursor-pointer drap-drop cursor-pointer border-bottom"
              [ngClass]="viewStepCrr === viewStepReasonSuccess ? 'click' : ''"
              (click)="clickViewStep($event, viewStepReasonSuccess, strEmpty)"
            >
              <div
                class="order"
                [ngStyle]="{ background: iconReasonSuccess?.textColor }"
              >
                <i
                  [class]="iconReasonSuccess?.icon"
                  [ngStyle]="{ color: iconReasonSuccess?.color }"
                >
                </i>
              </div>
              <div class="d-flex flex-column">
                <div class="text-dark fw-bold">
                  {{ stepNameSuccess }}
                </div>
                <div class="text-gray-500 fs-7 line-clamp line-clamp-1">
                  {{ noteSuccess }}
                </div>
              </div>
            </div>
            <!-- Reason fail -->
            <div
              class="list-stage cursor-pointer drap-drop"
              [ngClass]="viewStepCrr === viewStepReasonFail ? 'click' : ''"
              (click)="clickViewStep($event, viewStepReasonFail, strEmpty)"
            >
              <div
                class="order"
                [ngStyle]="{ background: iconReasonFail?.textColor }"
              >
                <i
                  [class]="iconReasonFail?.icon"
                  [ngStyle]="{ color: iconReasonFail?.color }"
                >
                </i>
              </div>
              <div class="d-flex flex-column">
                <div class="text-dark fw-bold">
                  {{ stepNameFail }}
                </div>
                <div class="text-gray-500 fs-7 line-clamp line-clamp-1">
                  {{ noteFail }}
                </div>
              </div>
            </div>
          </div>
          <!--end danh sách giai đoạn -->
        </div>
      </div>
      <div class="stage-body-right w-100 ps-6">
        <div
          class="d-flex align-items-center justify-content-between pe-1 pb-2 mb-1 border-bottom stage-header"
        >
          <div class="fw-bold fs-4 text-dark w-100">{{ titleViewStepCrr }}</div>
          <div class="d-flex align-items-center">
            <div
              *ngIf="isSwitchReason && viewStepCrr === viewStepReasonSuccess"
            >
              <codx-input
                class="test-check"
                type="switch"
                style="width: 100%"
                field="isUsed"
                [checked]="stepSuccess?.isUsed ?? true"
                [crrValue]="stepSuccess?.isUsed"
                (valueChange)="turnOnReason($event, viewStepReasonSuccess)"
              >
              </codx-input>
            </div>
            <!-- more function step -->
            <div *ngIf="isSwitchReason && viewStepCrr === viewStepReasonFail">
              <codx-input
                class="test-check"
                type="switch"
                style="width: 100%"
                field="isUsed"
                [checked]="stepFail?.isUsed ?? true"
                [crrValue]="stepFail?.isUsed"
                (valueChange)="turnOnReason($event, viewStepReasonFail)"
              >
              </codx-input>
            </div>
            <!-- more function step -->
          </div>
        </div>
        <div class="stage-right-main pe-3">
          <ng-container
            [ngTemplateOutlet]="
              viewStepCrr === viewStepCustom
                ? task
                : viewStepCrr === viewStepReasonSuccess
                ? reasonSuccess
                : reasonFail
            "
          ></ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thiết lập giai đoạn -- main -- nvthuan -->
<ng-template #task>
  <div *ngIf="stepList.length > 0 && stepList">
    <ng-container [ngTemplateOutlet]="rolesInStep"> </ng-container>
    <ng-container [ngTemplateOutlet]="setupInStep"> </ng-container>
    <ng-container [ngTemplateOutlet]="durationInStep"> </ng-container>
    <ng-container [ngTemplateOutlet]="job"> </ng-container>
    <ng-container [ngTemplateOutlet]="dynamicFieldsOneSteps"> </ng-container>
    <ng-container [ngTemplateOutlet]="memoInStep"> </ng-container>
  </div>
</ng-template>

<!-- template công việc -->
<ng-template #job>
  <div class="background-job">
    <div
      class="header-job d-flex align-items-center justify-content-between w-100 py-2 px-5"
    >
      <div class="row w-100">
        <div class="d-flex flex-column col-7">
          <div class="title text-primary fs-4 fw-bold">
            <codx-label class="title" fiedName="TaskType" default="Công việc">
            </codx-label>
          </div>
          <div class="text-gray-600">
            <codx-label
              fiedName="taskMemo"
              default="Công việc mặc định người phụ trách phải thực hiện trong
              giai đoạn"
              [formModel]="dialog.formModel"
            >
            </codx-label>
          </div>
        </div>
        <div class="d-flex align-items-center justify-content-end col-5 pe-0">
          <div class="d-flex justify-content-end flex-column">
            <div class="text-gray-500 fs-7">
              <codx-label
                fiedName="taskMemo"
                default="Thời hạn công việc so với giai đoạn"
                [formModel]="dialog.formModel"
              >
              </codx-label>
            </div>
            <div class="text-primary">
              {{ dayStep + strDay + hourStep + strHour }}/
              {{ step?.durationDay + strDay + step?.durationHour + strHour }}
            </div>
          </div>
          <div class="d-flex align-items-center ms-5">
            <button
              type="button"
              class="btn btn-icon btn-sm btn-light-primary"
              (click)="openTaskGroup()"
            >
              <i class="icon-add icon-16"></i>
            </button>
            <button
              type="button"
              class="btn btn-icon btn-sm btn-light-primary ms-2"
              (click)="openTypeJob()"
            >
              <i class="icon-add_task icon-16"></i>
            </button>
            <button
              type="button"
              class="btn btn-icon btn-sm btn-light-primary ms-2"
              (click)="clickShow($event, 'job-main')"
            >
              <i class="icon-expand_less icon-16"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="job-main" class="main-job p-6" [ngClass]="'show-main'">
      <!-- drap drop công việc ngoài-->
      <div class="main-body" *ngIf="taskGroupList?.length > 0">
        <div
          cdkDropList
          class="list"
          (cdkDropListDropped)="drop($event, taskGroupList, true)"
        >
          <div cdkDropListGroup>
            <ng-container *ngFor="let taskList of taskGroupList">
              <div
                class="card-job-list"
                cdkDrag
                [cdkDragData]="taskList"
                [cdkDragStartDelay]="100"
                [cdkDragDisabled]="taskList?.recID ? false : true"
              >
                <div class="card-job task-main">
                  <div
                    *ngIf="taskList?.recID"
                    class="d-flex align-items-center has-action-menu mb-4 task-groups"
                  >
                    <!-- show hiden group task -->
                    <span class="me-4">
                      <button
                        type="button"
                        class="btn btn-icon btn-light-primary"
                        (click)="toggleTask($event, taskList?.recID)"
                      >
                        <i class="icon-horizontal_rule icon-18"></i>
                      </button>
                    </span>
                    <div class="me-3">
                      <codx-img
                        [width]="30"
                        [objectId]="taskList?.roles[0]?.objectID"
                        objectType="AD_Users"
                        [objectName]="taskList?.roles[0]?.objectName"
                      >
                      </codx-img>
                    </div>
                    <div class="steplist-hearder">
                      <div class="text-dark fw-bold fs-6">
                        {{ taskList?.taskGroupName }}
                      </div>
                      <div class="d-flex align-items-center fs-7">
                        <span class="text-gray-600 me-1">
                          <codx-label
                            fiedName="StepName"
                            [formModel]=""
                            [default]="'Thời hạn'"
                          >
                          </codx-label>
                        </span>
                        <span class="me-1 fw-bold">
                          {{
                            (+taskList?.durationDay || 0) * 24 +
                              (+taskList?.durationHour || 0)
                          }}
                        </span>
                        <codx-label
                          class="text-gray-600"
                          fiedName="StepName"
                          [formModel]=""
                          [default]="'Giờ'"
                        >
                        </codx-label>
                      </div>
                    </div>
                    <codx-mfunc
                      [formModel]="grvMoreFunction"
                      (clickMF)="clickMFTaskGroup($event, taskList)"
                      [dataItem]="moreDefaut"
                      [type]="'hover'"
                      (changeDataMF)="changeDataMF($event, 'group')"
                    >
                    </codx-mfunc>
                  </div>
                  <div
                    *ngIf="!taskList?.recID"
                    [ngStyle]="
                      taskList?.task?.length == 0 ? { 'min-height': '5px' } : {}
                    "
                  ></div>
                  <!-- kéo thả ở trong  -->
                  <div
                    [id]="'group' + taskList?.recID"
                    cdkDropList
                    [cdkDropListData]="taskList?.task || []"
                    (cdkDropListDropped)="drop($event, taskList, false)"
                    class="task ps-14"
                    [ngStyle]="taskList?.recID ? {} : {}"
                  >
                    <ng-container *ngFor="let task of taskList?.task">
                      <div
                        cdkDrag
                        [cdkDragStartDelay]="200"
                        [cdkDragData]="task"
                        class="drap-drop"
                      >
                        <div class="has-action-menu">
                          <div
                            class="d-flex justify-content-start align-items-center"
                          >
                            <!-- icon task -->
                            <div
                              class="icon-container"
                              [ngStyle]="getColor(task)"
                            >
                              <span
                                class="icon-16"
                                [ngClass]="getIconTask(task)"
                              ></span>
                            </div>
                            <!-- avata -->
                            <div class="mx-3">
                              <codx-img
                                [width]="30"
                                [objectId]="getRole(task, 'ID')"
                                objectType="AD_Users"
                                [objectName]="getRole(task,'name')"
                              >
                              </codx-img>
                            </div>
                            <div class="steplist-hearder">
                              <div class="text-dark fw-bold fs-6">
                                {{ task?.taskName }}
                              </div>
                              <div class="d-flex align-items-center fs-7">
                                <span class="text-gray-600 me-1">
                                  <codx-label
                                    fiedName="StepName"
                                    [formModel]=""
                                    [default]="'Thời hạn'"
                                  >
                                  </codx-label>
                                </span>
                                <span class="me-1 fw-bold">
                                  {{
                                    (+task?.durationDay || 0) * 24 +
                                      (+task?.durationHour || 0)
                                  }}
                                </span>
                                <codx-label
                                  class="text-gray-600"
                                  fiedName="StepName"
                                  [formModel]=""
                                  [default]="'Giờ'"
                                >
                                </codx-label>
                              </div>
                            </div>
                          </div>
                          <codx-mfunc
                            [formModel]="grvMoreFunction"
                            (clickMF)="
                              clickMFTask($event, taskList?.task, task)
                            "
                            [isBookMark]="true"
                            [dataItem]="moreDefaut"
                            [type]="'hover'"
                            (changeDataMF)="changeDataMF($event, 'task')"
                          >
                          </codx-mfunc>
                        </div>
                        <div class="task-att">
                          <codx-attachment
                          #attachment
                          [objectType]="dialog.formModel.entityName"
                          [objectId]="task?.recID"
                          hideFolder="1"
                          hideImageUpload="0"
                          hideImageThumb="0"
                          hideUploadBtn="1"
                          [showMessage]="0"
                          hideDes="1"
                          type="inline"
                          allowMultiFile="1"
                          referType="source"
                          [formModel]="dialog.formModel"
                          displayThumb="full"
                        >
                        </codx-attachment>
                        </div>
                      </div>
                    </ng-container>
                    <div
                      *ngIf="taskList?.task?.length === 0"
                      style="height: 20px"
                    ></div>
                  </div>
                </div>
              </div>
              <hr />
            </ng-container>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-center mt-3">
        <button
          type="button"
          class="btn btn-outline-primary me-2"
          (click)="openTaskGroup()"
        >
          <i class="icon-add icon-18 text-primary"></i>
          <codx-label
            [name]="'lblAddGroup'"
            [formName]="'DPStepsFields'"
            [gridViewName]="'grvDPStepsFields'"
            [default]="'Thêm nhóm công việc'"
          ></codx-label>
        </button>
        <button
          type="button"
          class="btn btn-outline-primary"
          (click)="openTypeJob()"
        >
          <i class="icon-add_task icon-18 text-primary"></i>
          <codx-label
            [name]="'lblAddTask'"
            [formName]="'DPStepsFields'"
            [gridViewName]="'grvDPStepsFields'"
            [default]="'Thêm công việc'"
          ></codx-label>
        </button>
      </div>
    </div>
  </div>
</ng-template>
<!-- Popup thêm giai đoạn  -->
<ng-template #addStagePopup>
  <div class="d-flex flex-column p-5 h-100">
    <div>
      <ng-container [ngTemplateOutlet]="addStageHeader"></ng-container>
    </div>
    <div style="flex-grow: 1">
      <ng-container [ngTemplateOutlet]="addStageBody"></ng-container>
    </div>
    <div class="">
      <ng-container [ngTemplateOutlet]="addStageFooter"></ng-container>
    </div>
  </div>
</ng-template>

<ng-template #addStageHeader>
  <div class="d-flex justify-content-between">
    <codx-label
      class="h3"
      [fiedName]="
        actionStep == 'edit' ? headerStep?.edit[1] : headerStep?.add[1]
      "
      [formModel]="grvStep"
      [default]="
        actionStep == 'edit' ? headerStep?.edit[0] : headerStep?.add[0]
      "
    ></codx-label>
    <span
      class="icon-close icon-18 cursor-pointer"
      (click)="popupAddStage.close()"
    ></span>
  </div>
</ng-template>

<ng-template #addStageBody>
  <div class="form-group mt-5">
    <div class="fw-bold text-dark mb-1">
      <codx-label
        fiedName="StepName"
        [formModel]="grvStep"
        default="Tên giai đoạn"
      ></codx-label>
    </div>
    <codx-input
      field="stepName"
      [formModel]="grvStep"
      [Group]=""
      type="text"
      [crrValue]="stepName"
      (valueChange)="changeNameStep($event)"
    >
    </codx-input>

    <div class="fs-7 text-gray-500 text-italic mt-1" *ngIf="isAddStage">
      <codx-label
        [formModel]="grvStep"
        default="Mặc định giai đoạn sẽ được thêm vào vị trí cuối cùng (trước
        giai đoạn hoàn tất)"
      ></codx-label>
    </div>
  </div>

  <div class="form-group row">
    <div class="col-6 d-flex align-items-center justify-content-between">
      <codx-label
        fiedName="backgroundColor"
        [formModel]="grvStep"
        default="Màu nền giai đoạn:"
      >
      </codx-label>
      <codx-input
        class="me-2"
        type="colorpicker"
        [showText]="false"
        [modeSwitcher]="false"
        field="backgroundColor"
        [crrValue]="stepNew?.backgroundColor"
        (valueChange)="chanvalueColor($event, stepNew)"
      >
      </codx-input>
    </div>
    <div class="col-6 d-flex align-items-center">
      <codx-label
        class="me-4"
        fiedName="textColor"
        [formModel]="grvStep"
        default="Màu chữ:"
      >
      </codx-label>
      <codx-input
        field="textColor"
        class="ms-4"
        type="colorpicker"
        [showText]="false"
        [modeSwitcher]="false"
        [crrValue]="stepNew?.textColor"
        (valueChange)="chanvalueColor($event, stepNew)"
      >
      </codx-input>
    </div>
  </div>

  <div class="form-group row">
    <div class="col-6 d-flex justify-content-between align-items-center">
      <codx-label
        fiedName="icon"
        [formModel]="grvStep"
        default="Icon hiển thị:"
      >
      </codx-label>
      <div class="d-flex">
        <codx-valuelist
          class="me-4"
          field="icon"
          [name]="'Sys008'"
          [iconOnly]="true"
          [crrValue]="stepNew?.icon"
          (valueChange)="changeIcon($event, 'icon', stepNew)"
        >
        </codx-valuelist>
        <codx-input
          field="iconColor"
          class="ms-4"
          type="colorpicker"
          [showText]="false"
          [modeSwitcher]="false"
          [crrValue]="stepNew?.iconColor"
          (valueChange)="chanvalueColor($event, stepNew)"
        >
        </codx-input>
      </div>
    </div>
  </div>
  <hr />
  <div class="form-group mt-5">
    <codx-label
      fiedName="icon"
      [formModel]="grvStep"
      default="Demo:"
      class="me-4"
    >
    </codx-label>
    <div
      [ngStyle]="{ background: stepNew?.backgroundColor }"
      class="d-flex align-items-center box-demo"
    >
      <div class="me-2">
        <span
          [ngClass]="stepNew?.icon"
          [ngStyle]="{ color: stepNew?.iconColor }"
        ></span>
      </div>
      <span
        class="line-clamp line-clamp-1"
        style="flex-grow: 1"
        [ngStyle]="{ color: stepNew?.textColor }"
      >
        {{ stepName }}
      </span>
    </div>
  </div>

  <!-- [crrValue]="field?.rankIcon"
    (valueChange)="valueChangeIcon($event)" -->
</ng-template>

<ng-template #addStageFooter>
  <div class="d-flex justify-content-end">
    <button
      type="button"
      class="btn btn-outline-primary me-2"
      (click)="popupAddStage.close()"
    >
      <codx-label name="lblCancel" formName="Tasks" default="Hủy"></codx-label>
    </button>
    <button
      type="button"
      class="btn btn-primary"
      [disabled]="isSaveStep"
      (click)="saveStep()"
    >
      <codx-label
        name="lblSuscess"
        formName="Tasks"
        default="Đồng ý"
      ></codx-label>
    </button>
  </div>
</ng-template>

<!-- End Công Việc -->

<ng-template #reasonSuccess>
  <div class="background-job form-setting-step-success mb-5">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label default="Tùy chỉnh giai đoạn"></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label default="Cách thức hoạt động của giai đoạn"></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            [disabled]="stepSuccess?.isUsed ? false : true"
            (click)="clickShow($event, 'setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job"
      id="setup-step"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-6">
        <div class="row mb-5">
          <div class="col-6">
            <div class="text-dark fw-bold">
              <codx-label
                field="ReasonControl"
                default="Chọn phép chọn lý do thành công"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  name="success-radio"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [disabled]="stepSuccess?.isUsed ? false : true"
                  [checked]="stepSuccess?.reasonControl ?? false"
                  [crrValue]="stepSuccess?.reasonControl"
                  (valueChange)="
                    valueChangeRadio($event, viewStepReasonSuccess)
                  "
                >
                </codx-input>
              </div>
              <div class="me-5">
                <codx-input
                  name="success-radio"
                  type="radio"
                  style="width: 100%"
                  field="no"
                  [label]="titleRadioNo"
                  [checked]="!stepSuccess?.reasonControl ?? false"
                  [disabled]="stepSuccess?.isUsed ? false : true"
                  [crrValue]="stepSuccess?.reasonControl"
                  (valueChange)="
                    valueChangeRadio($event, viewStepReasonSuccess)
                  "
                  readonly
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                fiedName="NewProcessID"
                [default]="gridViewSetupStep['NewProcessID']?.headerText"
              >
              </codx-label>
            </div>
            <codx-label
              class="text-gray-600"
              default="Chọn quy trình được chuyển đến khi nhiệm vụ được đánh
              dấu thành công"
            ></codx-label>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <!-- <codx-input field="" type="valuelist" refValue="CRM009"> </codx-input> -->
            <ejs-combobox
              id="recID"
              [dataSource]="listCbxProccess"
              [fields]="fieldCbxProccess"
              (valueChange)="cbxChange($event, viewStepReasonSuccess)"
              [value]="moveProccessIsNull(stepSuccess?.newProcessID)"
              [readonly]="stepSuccess.isUsed ? false : true"
            >
            </ejs-combobox>
            <codx-label
              class="text-danger fst-italic fs-7"
              default="Lưu ý chỉ chuyển đến các quy trình có nhiệm vụ cùng loại
              đối tượng áp dụng"
            >
            </codx-label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="background-job form-reason-success">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            [default]="joinTwoString(stepNameReason, stepNameSuccess)"
          ></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            default="Lý do nhiệm vụ được ghi nhận là thành công"
          ></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            class="button-custom"
            [disabled]="stepSuccess?.isUsed ? false : true"
            (click)="openPopupReason(viewStepReasonSuccess, null, null)"
          >
            <span
              class="icon-add icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
          <button
            *ngIf="isShowstage"
            class="button-custom"
            [disabled]="stepSuccess?.isUsed ? false : true"
            (click)="clickShow($event, 'reason-success')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job has-actions-menu"
      id="reason-success"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
      #view
    >
      <div class="main-body p-6">
        <div *ngIf="stepSuccess.reasons?.length > 0">
          <div *ngFor="let item of stepSuccess?.reasons" class="pb-2">
            <ul class="text-left drap-drop me-5 py-2 has-action-menu">
              <li>
                <div *ngIf="stepSuccess.isUsed; else other_content">
                  {{ item?.reasonName }}
                  <codx-mfunc
                    [formModel]="dialog.formModel"
                    (clickMF)="
                      clickMFReason($event, item, viewStepReasonSuccess)
                    "
                    (changeDataMF)="changeReasonMF($event)"
                    [dataItem]="moreDefaut"
                    [type]="'hover'"
                  >
                  </codx-mfunc>
                </div>
              </li>
            </ul>
            <ng-template #other_content>
              <div>
                {{ item?.reasonName }}
                <codx-mfunc
                  [formModel]="dialog.formModel"
                  (clickMF)="clickMFReason($event, item, viewStepReasonSuccess)"
                  (changeDataMF)="changeReasonMF($event)"
                  [dataItem]="''"
                  [type]="'hover'"
                >
                </codx-mfunc>
              </div>
            </ng-template>
          </div>
        </div>

        <div class="d-flex justify-content-center">
          <button
            type="button"
            class="btn btn-outline-primary"
            [disabled]="stepSuccess?.isUsed ? false : true"
            (click)="openPopupReason(viewStepReasonSuccess, null, null)"
          >
            <i class="icon-add icon-18 text-primary"> </i>
            <codx-label [name]="''" [default]="'Thêm lý do'"></codx-label>
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #reasonFail>
  <div class="background-job form-setting-step-fail mb-5">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label default="Tùy chỉnh giai đoạn"></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label default="Cách thức hoạt động của giai đoạn"></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            [disabled]="stepFail?.isUsed ? false : true"
            (click)="clickShow($event, 'setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job"
      id="setup-step"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-6">
        <div class="row mb-5">
          <div class="col-6">
            <div class="text-dark fw-bold">
              <codx-label
                fiedName="ReasonControl"
                default="Chọn phép chọn lý do thất bại"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  name="fail-radio"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="stepFail?.reasonControl ?? false"
                  [crrValue]="stepFail?.reasonControl"
                  [disabled]="stepFail?.isUsed ? false : true"
                  (valueChange)="valueChangeRadio($event, viewStepReasonFail)"
                >
                </codx-input>
              </div>
              <div class="me-5">
                <codx-input
                  type="radio"
                  name="fail-radio"
                  field="no"
                  [checked]="!stepFail?.reasonControl"
                  [crrValue]="stepFail?.reasonControl ?? false"
                  [label]="titleRadioNo"
                  [disabled]="stepFail?.isUsed ? false : true"
                  (valueChange)="valueChangeRadio($event, viewStepReasonFail)"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                field="NewProcessID"
                [default]="gridViewSetupStep['NewProcessID']?.headerText"
              ></codx-label>
            </div>
            <codx-label
              class="text-gray-600"
              default="Chọn quy trình được chuyển đến khi nhiệm vụ được đánh
              dấu thất bại"
            ></codx-label>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <ejs-combobox
              id="recID"
              [dataSource]="listCbxProccess"
              [fields]="fieldCbxProccess"
              [placeholder]="'Chọn quy trình kìa'"
              (valueChange)="cbxChange($event, viewStepReasonFail)"
              [readonly]="stepFail?.isUsed ? false : true"
              [value]="stepFail?.newProcessID"
            ></ejs-combobox>
            <codx-label
              class="text-danger fst-italic fs-7"
              default="Lưu ý chỉ chuyển đến các quy trình có nhiệm vụ cùng loại
              đối tượng áp dụng"
            >
            </codx-label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="background-job form-reason-fail">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            [default]="joinTwoString(stepNameReason, stepNameFail)"
          ></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            default="Lý do nhiệm vụ được ghi nhận là thất bại"
          ></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            class="button-custom"
            [disabled]="stepFail?.isUsed ? false : true"
            (click)="openPopupReason(viewStepReasonFail, null, null)"
          >
            <span
              class="icon-add icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
          <button
            *ngIf="isShowstage"
            [disabled]="stepFail?.isUsed ? false : true"
            class="button-custom"
            (click)="clickShow($event, 'reason-success')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job has-actions-menu"
      id="reason-success"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
      #view
    >
      <div class="main-body p-6">
        <div *ngFor="let item of stepFail?.reasons" class="pb-2">
          <ul class="text-left drap-drop me-5 py-2 has-action-menu">
            <li>
              <div *ngIf="stepFail?.isUsed; else other_fail">
                {{ item?.reasonName }}
                <codx-mfunc
                  [formModel]="dialog.formModel"
                  (clickMF)="clickMFReason($event, item, viewStepReasonFail)"
                  (changeDataMF)="changeReasonMF($event)"
                  [dataItem]="moreDefaut"
                  [type]="'hover'"
                >
                </codx-mfunc>
              </div>
            </li>
          </ul>

          <ng-template #other_fail>
            <div>
              {{ item?.reasonName }}
              <codx-mfunc
                [formModel]="dialog.formModel"
                (clickMF)="clickMFReason($event, item, viewStepReasonFail)"
                (changeDataMF)="changeReasonMF($event)"
                [dataItem]="''"
                [type]="'hover'"
              >
              </codx-mfunc>
            </div>
          </ng-template>
        </div>
        <div class="d-flex mt-6 justify-content-center">
          <button
            type="button"
            class="btn btn-outline-primary"
            [disabled]="stepFail?.isUsed ? false : true"
            (click)="openPopupReason(viewStepReasonFail, null, null)"
          >
            <i class="icon-add icon-18 text-primary"> </i>
            <codx-label [name]="''" [default]="'Thêm lý do'"></codx-label>
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #rolesInStep>
  <div class="background-job form-setup-role mb-5">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblRoles"
            default="Các vai trò trong giai đoạn"
          ></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            name="lblRoleControl"
            default="Những người liên quan đến giai đoạn"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'role-setup-step')"
          >
            <span class="icon-expand_less icon-20 text-primary-600 py-2"></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="role-setup-step"
      class="main-job p-6"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="row">
        <div class="col-6">
          <div class="d-flex flex-column">
            <div class="d-flex align-items-center mb-2">
              <codx-label
                class="fw-bold fs-6 text-dark me-3"
                name="lblParticipantRole"
                default="Người phụ trách giai đoạn"
              >
              </codx-label>
              <button
                type="button"
                class="btn btn-icon btn-sm btn-light-primary"
                (click)="sharePerm(controlShare, 'participants-2')"
              >
                <i class="icon-person_add_alt_1 icon-16"></i>
              </button>
            </div>
            <div class="text-gray-600">
              <codx-label
                name="lblParticipantRoleControl"
                default="Có quyền xem và giám sát tất cả nhiệm vụ của các thành
                viên trong quy trình"
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 d-flex flex-wrap"
          *ngIf="step.roles != null && step.roles?.length > 0"
        >
          <ng-container *ngFor="let perm of step.roles; index as i">
            <div
              *ngIf="perm.roleType == 'S'"
              class="cursor-pointer has-action-menu-od me-6 d-flex align-items-center mb-2 position-relative"
            >
              <div class="me-2">
                <codx-img
                  class=""
                  [width]="20"
                  [objectId]="perm.objectName"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div class="text-gray-600">{{ perm.objectName }}</div>
              <ng-container>
                <div class="action-menu-od" (click)="removeRole(perm.objectID)">
                  <i class="icon-close text-danger icon-16"></i>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
      <hr />
      <div class="row mt-3">
        <div class="col-6">
          <div class="d-flex flex-column">
            <div class="d-flex align-items-center mb-2">
              <codx-label
                class="fw-bold fs-6 text-dark me-3"
                name="lblInvolved"
                default="Người liên quan"
              >
              </codx-label>
              <button
                type="button"
                class="btn btn-icon btn-sm btn-light-primary"
                (click)="sharePerm(controlShare, 'involved')"
              >
                <i class="icon-person_add_alt_1 icon-16"></i>
              </button>
            </div>
            <div class="text-gray-600">
              <codx-label
                name="lblInvolvedControl"
                default="Người liên quan có thể cập nhật công việc mà họ đang
                phụ trách
                "
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 group-permission witdh-roles scroll-user"
          *ngIf="step.roles != null && step.roles?.length > 0"
        >
          <ng-container *ngFor="let role of step.roles; index as i">
            <div
              *ngIf="role.roleType == 'R'"
              class="me-4 d-flex align-items-center margin-form mb-4"
            >
              <div class="roles-step d-flex align-items-center">
                <div class="d-flex align-items-center position-relative">
                  <codx-img
                    class="me-2"
                    [width]="25"
                    [objectId]="role.objectName"
                    objectType="AD_Users"
                  >
                  </codx-img>
                </div>
                <div class="text-dark fw-bold">{{ role.objectName }}</div>
                <span class="mt-1">
                  <a
                    (click)="deleteRoleInstep(step, role, true)"
                    style="cursor: pointer"
                  >
                    <span class="icon-close icon-16 text-danger ms-3"></span>
                  </a>
                </span>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #setupInStep>
  <div class="background-job form-setup-step mb-5">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label name="" default="Tùy chỉnh giai đoạn"></codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label name="" default="Cách thức hoạt động của giai đoạn">
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'step-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="step-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-6">
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                fiedName="AssignControl"
                default="Phân bố người phụ trách cho nhiệm vụ"
                [formModel]="dialog.formModel"
              >
              </codx-label>
            </div>
            <div class="text-gray-500">
              <codx-label
                default="Mặc định khi nhiệm vụ được tạo hoặc chuyển đến
                giai đoạn sẽ tự động phân bố người phụ trách cho nhiệm vụ"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <codx-input
              field=""
              type="valuelist"
              field="AssignControl"
              refValue="DP019"
              [crrValue]="step.assignControl"
              (valueChange)="valueChangeAssignCtrl($event)"
            >
            </codx-input>
          </div>
        </div>
        <hr />
        <div class="row mt-3">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                fiedName="TransferControl"
                default="Tự động chuyển nhiệm vụ qua giai đoạn tiếp theo
                khi"
                [formModel]="dialog.formModel"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <codx-input
              field="transferControl"
              crrValue="1"
              type="valuelist"
              refValue="DP020"
              [crrValue]="step.transferControl"
              (valueChange)="valueChangeTransferCtrl($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #durationInStep>
  <div class="background-job form-setup-step mb-5">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <!-- chưa có -->
          <codx-label fiedName="" default="Thời hạn"></codx-label>
        </div>
        <div class="text-gray-600">
          <!-- chưa có -->
          <codx-label
            fiedName=""
            default="Lên kế hoạch cho các nhiệm vụ trong giai đoạn"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'duration-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="duration-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-6">
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                fiedName=""
                default="Thời hạn hoàn tất nhiệm vụ trong giai đoạn"
              >
              </codx-label>
            </div>
            <div class="text-gray-600">
              <codx-label
                default="Thời hạn mà nhiệm vụ cần được đến giai đoạn tiếp
                theo"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <div class="position-relative">
                  <codx-input
                    field="durationDay"
                    [formModel]=""
                    [Group]=""
                    type="number"
                    [height]="'100'"
                    [min]="0"
                    [crrValue]="step?.durationDay"
                    (valueChange)="valueChangeDuration($event)"
                  ></codx-input>
                  <div
                    class="position-absolute text-muted"
                    style="top: 7px; right: 7px"
                  >
                    <codx-label
                      fiedName="StepName"
                      [formModel]=""
                      [default]="strDay"
                    ></codx-label>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="position-relative">
                  <codx-input
                    field="durationHour"
                    [formModel]=""
                    [Group]=""
                    type="number"
                    [height]="'100'"
                    [min]="0"
                    [placeholder]="'00.00'"
                    [crrValue]="step?.durationHour"
                    (valueChange)="valueChangeDuration($event)"
                  >
                  </codx-input>
                  <div
                    class="position-absolute text-gray-400"
                    style="top: 7px; right: 7px"
                  >
                    <codx-label
                      fiedName="StepName"
                      [formModel]=""
                      [default]="strHour"
                    ></codx-label>
                  </div>
                </div>
              </div>
            </div>


            <!-- <codx-input-number-duration [textDay]="strDay" [textHour]="strHour"  field="durationDay">

            </codx-input-number-duration> -->
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold">
              <codx-label
                default="Bỏ qua ngày nghỉ trong tuần khi tính toán ngày đến
                hạn cho nhiệm vụ trong giai đoạn"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  [name]="viewSaturday"
                  type="checkbox"
                  style="width: 100%"
                  field="excludeDayoff"
                  [label]="titleCheckBoxSat"
                  [checked]="checkedSat"
                  (valueChange)="valueChangeDayoff($event, viewSaturday, '7')"
                >
                </codx-input>
              </div>
              <div class="me-2">
                <codx-input
                  type="checkbox"
                  [name]="viewSunday"
                  field="excludeDayoff"
                  style="width: 100%"
                  [checked]="checkedSun"
                  [label]="titleCheckBoxSun"
                  (valueChange)="valueChangeDayoff($event, viewSunday, '8')"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold">
              <codx-label
                fiedName="StartControl"
                default="Bắt đầu tính thời gian thực tế cho nhiệm vụ trong
                giai đoạn lúc"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <codx-input
              field="startControl"
              [formModel]="dialog.formModel"
              type="valuelist"
              refValue="DP021"
              [crrValue]="step.startControl"
              (valueChange)="valueChangeStartCtrl($event)"
            >
            </codx-input>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold">
              <codx-label
                default="Cho phép người phụ trách chỉnh sửa thời gian hoàn
                thành giai đoạn thực tế"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  [name]="formDurationCtrl"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="step.durationControl"
                  [crrValue]="step.durationControl"
                  (valueChange)="valueChangeDuraCtrl($event, formDurationCtrl)"
                >
                </codx-input>
              </div>
              <div class="me-5">
                <codx-input
                  type="radio"
                  [name]="formDurationCtrl"
                  field="no"
                  [checked]="!step.durationControl"
                  [crrValue]="step.durationControl"
                  [label]="titleRadioNo"
                  (valueChange)="valueChangeDuraCtrl($event, formDurationCtrl)"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold">
              <codx-label
                default="Cho phép người phụ trách chỉnh sửa thời hạn công việc
                mặc định"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  [name]="formLeaTimeCtrl"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="step?.leadtimeControl"
                  [crrValue]="step?.leadtimeControl"
                  (valueChange)="valueChangeDuraCtrl($event, formLeaTimeCtrl)"
                >
                </codx-input>
              </div>
              <div class="me-5">
                <codx-input
                  type="radio"
                  [name]="formLeaTimeCtrl"
                  field="no"
                  [checked]="!step?.leadtimeControl"
                  [crrValue]="step?.leadtimeControl"
                  [label]="titleRadioNo"
                  (valueChange)="valueChangeDuraCtrl($event, formLeaTimeCtrl)"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                fiedName="ProgressTaskGroupControl"
                default="Cho phép người phụ trách cập nhật tiến độ giai đoạn"
              >
              </codx-label>
            </div>
            <div class="text-gray-600">
              <codx-label
                default="Tiến độ người phụ trách cập nhật cần lớn hơn tiến độ mà
                hệ thống tự động cập nhật"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  type="radio"
                  [name]="formStepsRoleCtrl"
                  field="yes"
                  [checked]="step.progressStepControl"
                  [crrValue]="step.progressStepControl"
                  [label]="titleRadioYes"
                  (valueChange)="
                    valueChangeApproveRoleCtrl($event, formStepsRoleCtrl)
                  "
                >
                </codx-input>
              </div>
              <div class="me-5">
                <codx-input
                  type="radio"
                  [name]="formStepsRoleCtrl"
                  field="no"
                  [checked]="!step.progressStepControl"
                  [crrValue]="step.progressStepControl"
                  [label]="titleRadioNo"
                  (valueChange)="
                    valueChangeApproveRoleCtrl($event, formStepsRoleCtrl)
                  "
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-6">
            <div class="text-dark fw-bold mb-1">
              <codx-label
                fiedName=""
                default="Cho phép người phụ trách cập nhật tiến độ nhóm công
                việc"
              >
              </codx-label>
            </div>
            <div class="text-gray-600">
              <codx-label
                default="Tiến độ người phụ trách cập nhật cần lớn hơn tiến độ mà
                hệ thống tự động cập nhật"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="d-flex align-items-center">
              <div class="me-5">
                <codx-input
                  type="radio"
                  [name]="formTaskRoleCtrl"
                  field="yes"
                  [checked]="step.progressTaskGroupControl"
                  [crrValue]="step.progressTaskGroupControl"
                  [label]="titleRadioYes"
                  (valueChange)="
                    valueChangeApproveRoleCtrl($event, formTaskRoleCtrl)
                  "
                >
                </codx-input>
              </div>
              <div class="me-5">
                <codx-input
                  type="radio"
                  [name]="formTaskRoleCtrl"
                  field="no"
                  [checked]="!step.progressTaskGroupControl"
                  [crrValue]="step.progressTaskGroupControl"
                  [label]="titleRadioNo"
                  (valueChange)="
                    valueChangeApproveRoleCtrl($event, formTaskRoleCtrl)
                  "
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #memoInStep>
  <div class="background-job form-setup-step mb-5">
    <div
      class="header-job d-flex align-items-center justify-content-between py-2 px-5"
    >
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            fiedName="Memo"
            [formModel]="dialog.formModel"
            default="Hướng dẫn hoàn thành giai đoạn"
          >
          </codx-label>
        </div>
        <div class="text-gray-600">
          <codx-label
            name=""
            default="Mô tả chi tiết cách hoàn thành giai đoạn cho người phụ
            trách"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'memo-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="memo-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-6">
        <codx-input
          field="memo"
          type="textarea"
          [placeholder]=""
          [crrValue]="step.memo"
          (valueChange)="valueChangeMemo($event)"
        >
        </codx-input>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #addReasonPopup>
  <codx-form
    [headerText]="headerText"
    [body]="addReasonContent"
    [footer]="addReasonFooter"
    [dialog]="popupAddReason"
  >
  </codx-form>
</ng-template>
<ng-template #addReasonContent>
  <div class="mt-5">
    <div class="form-group">
      <div>
        <codx-label
          fiedName="ReasonName"
          [formModel]="dialog.formModel"
          [default]="gridViewSetupStepReason['ReasonName']?.headerText"
        ></codx-label>
      </div>
      <codx-input
        field="reasonName"
        type="text"
        [crrValue]="reason?.reasonName"
        (valueChange)="changeValueReaName($event)"
      >
      </codx-input>
    </div>
  </div>
</ng-template>

<ng-template #addReasonFooter>
  <div class="d-flex justify-content-end">
    <button
      type="button"
      class="btn btn-outline-primary me-2"
      (click)="popupAddReason.close()"
    >
      <codx-label
        name=" lblfail"
        formName="DPStepsReasons"
        default="Hủy"
      ></codx-label>
    </button>
    <button
      type="button"
      [disabled]="isClick"
      class="btn btn-primary"
      (click)="addReason()"
    >
      <codx-label
        name=" lblSuscess"
        formName="DPStepsReasons"
        default="Đồng ý"
      ></codx-label>
    </button>
  </div>
</ng-template>
<!-- End Thiết lập giai đoạn -->
<ng-template #emptyTemplate>
  <div class="container h-100">
    <div class="list-empty card card-flush h-100">
      <div class="d-flex flex-column flex-center justify-content-center">
        <img
          src="../assets/themes/sys/default/img/DataEmpty.svg"
          class="w-250px"
        />
        <div class="fw-bold mt-1 text-center">
          {{ "SYS011" | mssg | async }}
        </div>
      </div>
    </div>
  </div>
</ng-template>
