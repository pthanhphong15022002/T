<div class="card-body p-0 codx-card-custom">
  <div class="codx-stepper stepper stepper-pills">
    <div class="stepper-header d-flex flex-wrap flex-stack ps-6">
      <div class="d-flex align-items-center">
        <h2 class="h2-title">
          <!-- xài code label truyền lên không load lại data, bật lần 2 thì load -->
          <!-- <codx-label default="titleAction"> </codx-label> -->
          <span>{{ titleAction }}</span>
        </h2>
      </div>
      <div class="d-flex align-items-center">
        <div class="stepper-nav flex-center flex-wrap" #status>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item active' : 'stepper-item approve'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(0)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 0 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblGeneral"
                  [formModel]="dialog.formModel"
                  default="Thông tin quy trình"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(1)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 1 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblStage"
                  default="Thiết lập giai đoạn"
                ></codx-label>
              </div>
            </div>
          </div>
          <div
            [ngClass]="
              action == 'add' ? 'stepper-item' : 'stepper-item approve-disabled'
            "
            data-kt-stepper-element="nav"
            data-kt-stepper-action="step"
            (click)="clickTab(2)"
          >
            <div class="stepper-wrapper d-flex align-items-center flex-column">
              <div class="stepper-icon h-30px">
                <i
                  class="stepper-default icon-24 icon-radio_button_checked"
                ></i>
                <i
                  class="stepper-active icon-30 text-primary icon-radio_button_checked"
                ></i>
                <div
                  class="stepper-approve badge badge-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
                <div
                  class="stepper-approve-disabled badge badge-light-primary badge-lg badge-circle p-1"
                >
                  <span class="icon-check icon-18"></span>
                </div>
              </div>
              <div
                class="stepper-label"
                [ngClass]="currentTab == 2 ? 'fw-bold text-primary' : ''"
              >
                <codx-label
                  name="lblCustom"
                  default="Trường tùy chỉnh"
                ></codx-label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <div class="btn btn-sm btn-bg-white text-inverse-white mb-2">
          <i
            class="icon-close icon-18 text-hover-danger"
            (click)="closePopup()"
          ></i>
        </div>
      </div>
    </div>
    <!-- body rieng -->
    <div class="stepper-body pt-2 w-100">
      <div class="card shadow-none border-0 rounded-0 mx-auto w-1100px h-100">
        <div class="mt-6 pb-3 tab-pane-header px-9 border-bottom">
          <h2 *ngIf="currentTab != 1" class="h2-title">
            <codx-label
              *ngIf="currentTab == 0"
              name="lblGeneral"
              [formModel]="dialog.formModel"
              default="Thông tin quy trình"
            >
            </codx-label>
            <codx-label
              *ngIf="currentTab == 2"
              name="lblDynamicField"
              [formModel]="'Khanh thêm thì phải sửa'"
              default="Trường tùy chỉnh"
            >
            </codx-label>
          </h2>
          <ng-container
            *ngIf="currentTab == 1"
            [ngTemplateOutlet]="stageHeader"
          ></ng-container>
        </div>
        <div
          [ngClass]="currentTab == 1 ? 'scroll-stask' : 'scroll-y'"
          class="dp-step pt-4 px-6 mx-3"
          data-kt-scroll="true"
          data-kt-scroll-activate="{default: true}"
          data-kt-scroll-height="auto"
          data-kt-scroll-dependencies=".tab-pane-header,.tab-pane-footer"
          data-kt-scroll-wrappers=".stepper-body"
          data-kt-scroll-offset="0px"
        >
          <div class="tab-content">
            <!--Phần thông tin quy trình - Phúc làm-->
            <div
              class="tab-pane fade"
              id="pane_1"
              [ngClass]="currentTab == 0 ? 'active show' : ''"
            >
              <ng-container [ngTemplateOutlet]="General"></ng-container>
            </div>
            <div
              class="tab-pane fade"
              id="pane_2"
              [ngClass]="currentTab == 1 ? 'active show' : ''"
            >
              <!-- Thiet lap giai doan thuan -->
              <ng-container [ngTemplateOutlet]="stage"></ng-container>
            </div>
            <div
              class="tab-pane fade"
              id="pane_3"
              [ngClass]="currentTab == 2 ? 'active show' : ''"
            >
              <ng-container
                [ngTemplateOutlet]="dynamicFieldsAllSteps"
              ></ng-container>
            </div>
          </div>
        </div>

        <div
          class="d-flex flex-stack justify-content-between card-footer border-top"
        >
          <div class="left">
            <button
              type="button"
              class="btn btn-primary me-3"
              *ngIf="currentTab != 0"
              (click)="previous(currentTab)"
            >
              <codx-label name="lblBack" default="Quay lại"> </codx-label>
            </button>
          </div>
          <div *ngIf="currentTab == 0"></div>
          <button
            *ngIf="currentTab != 2"
            type="button"
            [ngClass]="checkButtonContinue() ? '' : 'disabled'"
            class="btn btn-primary"
            (click)="continue(currentTab)"
          >
            <codx-label
              [name]="'lblContinue'"
              [default]="'Tiếp tục'"
            ></codx-label>
          </button>

          <button
            *ngIf="currentTab == 2"
            type="button"
            class="btn btn-primary"
            (click)="onSave()"
          >
            <codx-label [name]="'lblSave'" [default]="'Lưu'"></codx-label>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #footer> </ng-template>

<!--Phần của Phúc - Thông tin quy trình-->
<ng-template #General>
  <!--Thông tin chung-->
  <div class="background">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblGeneral"
            [formModel]="dialog.formModel"
            default="Thông tin chung"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblGeneral"
            [formModel]="dialog.formModel"
            default="Thông tin chung của quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'general-main')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div id="general-main" class="main" [ngClass]="'show-main'">
      <div class="row">
        <div class="col-6">
          <div class="form-group margin-form">
            <div>
              <codx-label
                fiedName="GroupID"
                [formModel]="dialog.formModel"
                default="Nhóm quy trình"
              >
              </codx-label>
            </div>
            <!-- <codx-input field="groupID" [crrValue]="process.groupID" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
            <codx-input
              field="groupID"
              type="combobox"
              [placeholder]="gridViewSetup['GroupID']?.description"
              [crrValue]="process.groupID"
              [refValue]="gridViewSetup?.GroupID?.referedValue"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
            <div *ngIf="!checkGroup" class="errorMessage text-danger ms-3" data-field="">
              {{errorMessage}}
            </div>
          </div>
          <div class="form-group margin-form">
            <div>
              <codx-label
                fiedName="ProcessName"
                [formModel]="dialog.formModel"
                default="Tên quy trình"
              >
              </codx-label>
            </div>
            <!-- <codx-input field="processName" [crrValue]="process.processName" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
            <codx-input
              field="processName"
              [placeholder]="gridViewSetup['ProcessName']?.description"
              type="text"
              [crrValue]="process.processName"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
          <div class="form-group margin-form">
            <div>
              <codx-label
                fiedName="AutoName"
                [formModel]="dialog.formModel"
                default="Tên đối tượng khi tạo mới"
              >
              </codx-label>
            </div>
            <!-- <codx-input field="processName" [crrValue]="process.processName" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
            <codx-input
              field="autoName"
              type="text"
              [crrValue]="process.autoName"
              [placeholder]="gridViewSetup['AutoName']?.description"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
          <div class="form-group margin-form">
            <div>
              <codx-label
                fiedName="ApplyFor"
                [formModel]="dialog.formModel"
                default="Đối tượng nhiệm vụ áp dụng trong quy trình"
              >
              </codx-label>
            </div>
            <!-- <codx-input field="applyFor" [crrValue]="process.applyFor" (valueChange)="valueChange($event)" [formModel]="formModel" [Group]="formGroup">
            </codx-input> -->
            <codx-input
              field="applyFor"
              type="valuelist"
              [crrValue]="process.applyFor"
              [refValue]="gridViewSetup?.ApplyFor?.referedValue"
              (valueChange)="valueChange($event)"
              [placeholder]="gridViewSetup['ApplyFor']?.description"
            >
            </codx-input>
          </div>
        </div>
        <div class="col-6">
          <div class="form-group ms-5">
            <codx-label name="lblAvatarProcess" default="Ảnh đại diện">
            </codx-label>
            <ng-container [ngTemplateOutlet]="avatarProcess"></ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--Các vai trò quy trình-->
  <div class="background">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblPermissions"
            [formModel]="dialog.formModel"
            default="Các vai trò trong quy trình"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblPerm"
            [formModel]="dialog.formModel"
            default="Những người liên quan và có thể thực hiện các chức năng
            trong quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'role-main')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div id="role-main" class="main" [ngClass]="'show-main'">
      <div class="row">
        <div class="col-6">
          <div class="d-flex flex-column margin-form mb-4">
            <div class="d-flex flex">
              <codx-label
                class="fw-bolder"
                name="lblSupervisor"
                [formModel]="dialog.formModel"
                default="Người giám sát"
              >
              </codx-label>
              <i
                class="icon-person_add_alt_1 text-hover-primary icon-20 margin-user"
                (click)="sharePerm(controlShare, 'supervisor')"
              ></i>
              <i
                class="icon-settings icon-20 margin-user"
                (click)="clickRoles()"
              ></i>
            </div>
            <div>
              <codx-label
                class="fw-normal text-gray-400"
                name="lblLocationControl"
                default="Có quyền xem và giám sát tất cả nhiệm vụ của các thành
                viên trong quy trình nhưng không có quyền tạo hoặc chỉnh sửa
                nhiệm vụ"
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 group-permission witdh-permission scroll-user"
          *ngIf="process.permissions != null && process.permissions?.length > 0"
        >
          <ng-container *ngFor="let perm of process.permissions; index as i">
            <div
              *ngIf="perm.roleType == 'O'"
              class="cursor-pointer has-action-menu-od me-4 d-flex align-items-center margin-form mb-4"
            >
              <div class="d-flex align-items-center position-relative">
                <codx-img
                  class=""
                  [width]="25"
                  [objectId]="perm.objectName"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div class="ms-1">
                <div class="text-dark fw-bold">{{ perm.objectName }}</div>
              </div>
              <ng-container *ngIf="checkAssignRemove(i)">
                <div
                  class="action-menu-od ms-2 d-flex justify-content-center align-items-center cursor-pointer"
                  (click)="removeUser(i)"
                >
                  <i class="icon-close text-danger icon-16"></i>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="row">
        <div class="col-6">
          <div class="d-flex flex-column margin-form mb-4">
            <div class="d-flex flex">
              <codx-label
                class="fw-bolder"
                name="lblParticipants"
                [formModel]="dialog.formModel"
                default="Thành viên tham gia"
              >
              </codx-label>
              <i
                class="icon-person_add_alt_1 text-hover-primary icon-20 margin-user"
                (click)="sharePerm(controlShare, 'participants')"
              ></i>
              <i
                class="icon-settings icon-20 margin-user"
                (click)="clickRoles()"
              ></i>
            </div>
            <div>
              <codx-label
                class="fw-normal text-gray-400"
                name="lblParticipantControl"
                [formModel]="dialog.formModel"
                default="Có quyền tạo nhiệm vụ trong quy trình"
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 group-permission witdh-permission scroll-user"
          *ngIf="process.permissions != null && process.permissions?.length > 0"
        >
          <ng-container *ngFor="let perm of process.permissions; index as i">
            <div
              *ngIf="perm.roleType == 'P'"
              class="cursor-pointer has-action-menu-od me-4 d-flex align-items-center margin-form mb-4"
            >
              <div class="d-flex align-items-center position-relative">
                <codx-img
                  class=""
                  [width]="25"
                  [objectId]="perm.objectName"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div class="ms-1">
                <div class="text-dark fw-bold">{{ perm.objectName }}</div>
              </div>
              <ng-container *ngIf="checkAssignRemove(i)">
                <div
                  class="action-menu-od ms-2 d-flex justify-content-center align-items-center cursor-pointer"
                  (click)="removeUser(i)"
                >
                  <i class="icon-close text-danger icon-16"></i>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="row">
        <div class="col-6">
          <div class="d-flex flex-column margin-form mb-4">
            <div class="d-flex flex">
              <codx-label
                class="fw-bolder"
                name="lblFollowers"
                [formModel]="dialog.formModel"
                default="Người theo dõi"
              >
              </codx-label>
              <i
                class="icon-person_add_alt_1 text-hover-primary icon-20 margin-user"
                (click)="sharePerm(controlShare, 'followers')"
              ></i>
              <i
                class="icon-settings icon-20 margin-user"
                (click)="clickRoles()"
              ></i>
            </div>
            <div>
              <codx-label
                class="fw-normal text-gray-400"
                name="lblFollowerControl"
                [formModel]="dialog.formModel"
                default="Có quyền xem các nhiệm vụ trong quy trình"
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 group-permission witdh-permission scroll-user"
          *ngIf="process.permissions != null && process.permissions?.length > 0"
        >
          <ng-container *ngFor="let perm of process.permissions; index as i">
            <div
              *ngIf="perm.roleType == 'F'"
              class="cursor-pointer has-action-menu-od me-4 d-flex align-items-center margin-form mb-4"
            >
              <div class="d-flex align-items-center position-relative">
                <codx-img
                  class=""
                  [width]="25"
                  [objectId]="perm.objectName"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div class="ms-1">
                <div class="text-dark fw-bold">{{ perm.objectName }}</div>
              </div>
              <ng-container *ngIf="checkAssignRemove(i)">
                <div
                  class="action-menu-od ms-2 d-flex justify-content-center align-items-center cursor-pointer"
                  (click)="removeUser(i)"
                >
                  <i class="icon-close text-danger icon-16"></i>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <!--Tùy chỉnh quy trình-->
  <div class="background">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblSetting"
            [formModel]="dialog.formModel"
            default="Tùy chỉnh quy trình"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblActived"
            [formModel]="dialog.formModel"
            default="Cách thức hoạt động của quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'setting-main')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div id="setting-main" class="main" [ngClass]="'show-main'">
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="InstanceNoSetting"
              [formModel]="dialog.formModel"
              default="Định dạng đánh số tự động cho nhiệm vụ khi tạo mới"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div #autoNumberSetting class="position-relative col-6">
              <codx-input
                type="text"
                [crrValue]="instanceNoSetting"
                [placeholder]="gridViewSetup['InstanceNoSetting']?.description"
                (valueChange)="valueChangeAutoNoCode($event)"
                field="instanceNoSetting"
              >
              </codx-input>
              <div
                class="position-absolute cursor-pointer"
                style="top: 7px; right: 13px"
              >
                <i
                  class="icon-settings form-control-feedback"
                  (click)="openAutoNumPopup()"
                ></i>
              </div>
            </div>
            <div *ngIf="instanceNoEx" class="col-6 fs-6 mt-2 mb-2">
              <codx-label
                class=""
                name="lblPreview"
                [formModel]="dialog.formModel"
                default="Xem trước: "
              ></codx-label>
              <span class="text-gray-600">{{ instanceNoEx }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="ViewMode"
              [formModel]="dialog.formModel"
              default="Mặc định giao diện xem danh sách nhiệm vụ"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                field="viewMode"
                type="valuelist"
                [crrValue]="process.viewMode"
                [refValue]="gridViewSetup?.ViewMode?.referedValue"
                (valueChange)="valueChange($event)"
                [placeholder]="gridViewSetup['ViewMode']?.description"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="ViewModeDetail"
              [formModel]="dialog.formModel"
              default="Mặc định giao diện xem đầu tiên khi xem chi tiết nhiệm vụ"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                field="viewModeDetail"
                type="valuelist"
                [crrValue]="process.viewModeDetail"
                [refValue]="gridViewSetup?.ViewModeDetail?.referedValue"
                (valueChange)="valueChange($event)"
                [placeholder]="gridViewSetup['ViewModeDetail']?.description"
              >
              </codx-input>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="ShowInstanceControl"
              [formModel]="dialog.formModel"
              default="Chỉ xem nhiệm vụ ở tình trạng"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <div class="col-6">
              <codx-input
                type="valuelist"
                [refValue]="gridViewSetup?.ShowInstanceControl?.referedValue"
                [placeholder]="
                  gridViewSetup['ShowInstanceControl']?.description
                "
                [crrValue]="process.showInstanceControl"
                (valueChange)="valueChange($event)"
                field="showInstanceControl"
              >
              </codx-input>
            </div>
            <!-- <codx-input [crrValue]="process.showInstanceControl" (valueChange)="valueChange($event)" field="showInstanceControl" [formModel]="formModel" [Group]="formGroup" >
            </codx-input> -->
          </div>
        </div>
      </div>
      <div class="form-group margin-form mb-4">
        <div class="row">
          <div class="col-6">
            <codx-label
              fiedName="CloseInstanceControl"
              [formModel]="dialog.formModel"
              default="Tự đóng nhiệm vụ khi không có bất kỳ hoạt động nào sau"
            >
            </codx-label>
          </div>
          <div class="col-6 row">
            <!-- <codx-input [crrValue]="process.closeInstanceControl" (valueChange)="valueChange($event)" field="closeInstanceControl" [formModel]="formModel" [Group]="formGroup" >
              </codx-input> -->
            <div class="position-relative col-6">
              <codx-input
                field="closeInstanceControl"
                type="text"
                [placeholder]="
                  gridViewSetup['CloseInstanceControl']?.description
                "
                (valueChange)="valueChange($event)"
                [crrValue]="process.closeInstanceControl"
                field="closeInstanceControl"
              ></codx-input>
              <div
                class="position-absolute text-gray-400"
                style="top: 7px; right: 13px"
              >
                <codx-label fiedName="lblDate" default="Ngày"></codx-label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--Hướng dẫn làm việc với quy trình-->
  <div class="background">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="Memo"
            [formModel]="dialog.formModel"
            default="Hướng dẫn làm việc với quy trình"
          >
          </codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblMemo"
            [formModel]="dialog.formModel"
            default="Mô tả chi tiết quy trình"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <div class="group-button">
            <button
              *ngIf="isShowstage"
              class="button-custom"
              (click)="clickShow($event, 'memo-main')"
            >
              <span
                class="icon-expand_less icon-20 text-primary-600 py-2"
                style="font-weight: 500"
              ></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="memo-main" class="main" [ngClass]="'show-main'">
      <div class="form-group margin-form mb-4">
        <codx-input
          field="memo"
          type="textarea"
          headerposition="none"
          format="ed"
          height="150"
          [crrValue]="process?.memo"
          (valueChange)="valueChange($event)"
          [placeholder]="gridViewSetup['Memo']?.description"
        >
        </codx-input>
      </div>
    </div>
  </div>
</ng-template>

<!--AVT Thông tin chung-->
<ng-template #avatarProcess>
  <div
    class="dropzone dropzone-default dropzone-primary d-flex flex-center flex-column"
    (click)="addAvatar()"
  >
    <div class="dropzone-msg dz-message needsclick">
      <ng-container *ngIf="linkAvatar != ''">
        <img [src]="linkAvatar" class="image-maxsize" />
      </ng-container>
      <ng-container *ngIf="linkAvatar == ''">
        <div class="dropzone-msg-title mb-2">
          <i class="icon-image icon-30"></i>
        </div>
      </ng-container>
    </div>
  </div>
  <codx-attachment
    #imageAvatar
    [objectId]="process.recID"
    [objectType]="dialog.formModel.entityName"
    hideFolder="1"
    hideImageUpload="1"
    hideImageThumb="1"
    hideUploadBtn="1"
    hideDes="1"
    type="inline"
    allowMultiFile="0"
    [formModel]="dialog.formModel"
    allowExtensions=".jpg,.png"
    [isSaveSelected]="0"
    (fileAdded)="fileImgAdded($event)"
    displayThumb="full"
    showMessage="0"
    category="0"
  >
  </codx-attachment>
</ng-template>

<!--Control share-->
<ng-template #controlShare let-dialogControl>
  <codx-share
    [dialog]="dialogControl"
    [multiple]="multiple"
    [listCombobox]="listCombobox"
    (eventApply)="applyShare($event, typeShare)"
    [listName]="vllShare"
  >
  </codx-share>
</ng-template>

<ng-template #popupParticipants let-dialogPar>
  <codx-popup-participants
    [lstParticipants]="lstParticipants"
    [dialog]="dialogPar"
    [isType]="'S'"
    (eventUser)="eventUser($event)"
  ></codx-popup-participants>
</ng-template>
<!--End-->
<!--End-->

<!-- Quy trình động - All in ------------------------------------------------------------------------------- -->
<ng-template #dynamicFieldsAllSteps>
  <!-- <ng-container *ngFor="let st of stepList">
    <ng-container
      *ngIf="!st.isFailStep && !st.isSuccessStep"
      [ngTemplateOutlet]="dynamicFields"
      [ngTemplateOutletContext]="{ $implicit: st }"
    ></ng-container>
  </ng-container> -->
  <ng-container
    *ngIf="stepList?.length > 0"
    [ngTemplateOutlet]="dynamicFields"
    [ngTemplateOutletContext]="{ $implicit: stepList, haveTitle: false }"
  >
  </ng-container>
</ng-template>

<ng-template #dynamicFieldsOneSteps>
  <ng-container
    [ngTemplateOutlet]="dynamicFields"
    [ngTemplateOutletContext]="{ $implicit: [step], haveTitle: true }"
  >
  </ng-container>
</ng-template>

<ng-template #dynamicFields let-datas let-haveTitle="haveTitle">
  <div
    cdkDropList
    class="list"
    (cdkDropListDropped)="dropCustomFile($event, null)"
  >
    <div cdkDropListGroup>
      <ng-container *ngFor="let item of datas">
        <div
          *ngIf="!item.isFailStep && !item.isSuccessStep"
          cdkDrag
          [cdkDragDisabled]="true"
          [cdkDragStartDelay]="200"
          [cdkDragData]="item"
        >
          <div class="background-job mb-5">
            <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
              <div class="d-flex flex-column">
                <div class="title text-primary fs-4 fw-bold">
                  <span class="me-2" *ngIf="haveTitle">{{
                    titleDefault
                  }}</span>
                  <span class="me-2" *ngIf="!haveTitle">{{
                    item.stepName
                  }}</span>
                </div>
                <div class="text-gray-500">
                  <codx-label
                      name="lblExpression"
                      formName="DPStepsFields"
                      gridViewName="grvDPStepsFields"
                      [default]="'Kéo thả để sắp xếp các trường tùy chỉnh'"
                    >
                    </codx-label>
                </div>
              </div>
              <div class="right">
                <div class="group-button d-flex align-items-center ms-2">
                  <button
                    class="button-custom"
                    (click)="addCustomField(item.recID, item.processID)"
                  >
                    <span
                      class="icon-add icon-20 cursor-pointer text-hover-primary py-2"
                    ></span>
                  </button>
                  <button
                    class="button-custom"
                    #p="ngbPopover"
                    [ngbPopover]="popperHandelSetting"
                    (mouseenter)="popoverSelectView(p, item)"
                    placement="bottom right top left"
                    [popoverClass]=""
                  >
                    <span
                      class="icon-settings icon-24 cursor-pointer text-hover-primary py-2"
                    ></span>
                  </button>
                  <button
                    class="button-custom"
                    (click)="clickShow($event, item.recID)"
                  >
                    <span
                      class="icon-expand_less icon-24 cursor-pointer text-hover-primary py-2"
                    ></span>
                  </button>
                </div>
              </div>
            </div>
            <div
              id="{{ item.recID }}"
              class="show-main"
              cdkDropList
              [cdkDropListData]="item?.fields || []"
              (cdkDropListDropped)="dropCustomFile($event, item.recID)"
            >
              <div
                *ngIf="!item?.fields || item?.fields?.length == 0"
                class="position-relative p-9"
              >
                <div
                  class="position-absolute top-50 start-50 translate-middle"
                  cdkDrag
                  [cdkDragDisabled]="true"
                  [cdkDragData]="null"
                >
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm pb-5 d-flex align-items-center justify-content-between"
                    (click)="addCustomField(item.recID, item.processID)"
                  >
                    <span class="icon-add icon-20 text-primary-600 py-2"></span>
                    <codx-label
                      class="text-primary-600"
                      [name]="'lblAddCustomField'"
                      [formName]="'DPStepsFields'"
                      [gridViewName]="'grvDPStepsFields'"
                      [default]="'Thêm trường tùy chỉnh'"
                    ></codx-label>
                  </button>
                </div>
              </div>

              <div *ngIf="item?.fields?.length > 0">
                <div class="d-flex row class-field m-5">
                  <ng-container *ngFor="let item1 of item?.fields">
                    <div
                      class="col-{{
                        12 / item.showColumnControl
                      }} p-3 has-action-menu crr-fiels mb-5"
                      cdkDrag
                      [cdkDragStartDelay]="200"
                      [cdkDragData]="item1"
                    >
                      <div class="fw-bold text-gray-700 fs-6 text-dark mt-2">
                        {{ item1?.title }} ( {{ item1?.fieldName }} )
                      </div>
                      <div class="text-gray-400">{{ item1.note }}</div>
                      <div class="d-flex">
                        <div class="datatypes me-4">
                          <codx-vll
                            [name]="vllType"
                            [value]="item1?.dataType"
                            [showText]="true"
                            [showBgColor]="true"
                          >
                          </codx-vll>
                        </div>
                        <codx-label
                          class="text-danger"
                          fiedName="IsRequired"
                          formName="DPStepsFields"
                          gridViewName="grvDPStepsFields"
                          default="Bắt buộc *"
                        ></codx-label>
                        <codx-input
                          type="switch"
                          field="isRequired"
                          [checked]="item1?.isRequired"
                          (valueChange)="changeRequired($event, item1)"
                        >
                        </codx-input>
                      </div>
                      <codx-mfunc
                        [formModel]="dialog.formModel"
                        (clickMF)="clickMFFields($event, item1)"
                        [dataItem]="action != 'edit' ? moreDefaut : item"
                        [type]="'hover'"
                      >
                      </codx-mfunc>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <ng-template #popperHandelSetting>
    <div
      class="d-flex m-3 text-hover-primary cursor-pointer"
      (click)="selectView(1)"
    >
      <span class="icon-view_column icon-20"></span
      ><span>
        <codx-label
          name="lblSelectFirst"
          formName="DPStepsFields"
          gridViewName="grvDPStepsFields"
          default="1 cột"
        ></codx-label>
      </span>
    </div>
    <div
      class="d-flex m-3 text-hover-primary cursor-pointer"
      (click)="selectView(2)"
    >
      <span class="icon-view_column icon-20"></span>
      <span>
        <codx-label
          name="lblSelectSecond"
          formName="DPStepsFields"
          gridViewName="grvDPStepsFields"
          default="2 cột"
        ></codx-label>
      </span>
    </div>
    <div
      class="d-flex m-3 text-hover-primary cursor-pointer"
      (click)="selectView(3)"
    >
      <span class="icon-view_column icon-20"></span>
      <span>
        <codx-label
          name="lblSelectThree"
          formName="DPStepsFields"
          gridViewName="grvDPStepsFields"
          default="3 cột"
        ></codx-label>
      </span>
    </div>
  </ng-template>
</ng-template>

<!-- Thiết lập giai đoạn của nvthuan + Bảo -->

<ng-template #stageHeader>
    <div class="d-flex justify-content-between align-items-center">
      <codx-label
            class="h2 h2-title float-left"
            fiedName="settingStep"
            default="Thiết lập giai đoạn"
          >
          </codx-label>
      <div class="d-flex align-items-center">
        <button
          type="button"
          class="btn btn-sm btn-primary"

          (click)="openPopupStep('add')"
        >
          <i
            class="icon-add icon-20"
          >
          </i>
          <codx-label [name]="'lblContinue'" [default]="'Thêm'"></codx-label>
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #stage>
  <div class="background-stage mt-3">
    <div class="stage-body row">
      <div class="stage-body-left col-3">
        <div class="header">
          <codx-label
            fiedName="step"
            default="Giai đoạn"
          ></codx-label>
        </div>
        <div
          class="example-list stage-body-left-main"
          cdkDropList
          (cdkDropListDropped)="dropStep($event)"
        >
          <!-- danh sách giai đoạn -->
          <div
            cdkDrag
            *ngFor="let itemStep of stepList; let i = index"
            class="list-stage example-box drap-drop cursor-pointer"
            [ngClass]="itemStep?.recID === step?.recID ? 'click' : ''"
            (click)="
              clickViewStep($event, viewStepCustom, itemStep ?? strEmpty)
            "
          >
            <div class="order">{{ i + 1 }}</div>
            <div class="p-3 content">
              <div style="font-weight: 600; font-size: 1.2rem">
                <span>{{ itemStep?.stepName }}</span>
              </div>

              <div style="font-size: 1.1rem; font-weight: 500">
                Thời hạn {{ itemStep?.durationDay || 0 }} ngày
                {{ itemStep?.durationHour || 0 }} giờ
              </div>
              <div style="font-size: 1.1rem; font-weight: 500">
                Công việc {{ itemStep?.taskGroups?.length }}
              </div>
            </div>
          </div>
          <!-- Step Reason successs -->
          <div
            class="list-stage cursor-pointer drap-drop"
            (click)="clickViewStep($event, viewStepReasonSuccess, strEmpty)"
          >
            <div class="order">T</div>
            <div class="content p-3">
              <div style="font-weight: 600; font-size: 1.2rem">
                <codx-label [default]="stepNameSuccess"></codx-label>
              </div>
              <codx-label default="Hoàn thành tất cả giai đoạn"></codx-label>
            </div>
          </div>

          <!-- Reason fail -->
          <div
            class="list-stage cursor-pointer drap-drop"
            (click)="clickViewStep($event, viewStepReasonFail, strEmpty)"
          >
            <div class="order">F</div>
            <div class="content p-3">
              <div style="font-weight: 600; font-size: 1.2rem">
                <codx-label [default]="stepNameFail"></codx-label>
              </div>
              <codx-label
                default="Thất bại ở một giai đoạn bất kỳ"
              ></codx-label>
            </div>
          </div>

          <!--end danh sách giai đoạn -->
        </div>
      </div>
      <div class="stage-body-right col-9">
        <div>
          <div class="d-flex justify-content-end ms-3">
            <div class="me-auto">
              <h2>
                <strong>{{ titleViewStepCrr }}</strong>
              </h2>
            </div>
            <div *ngIf="isSwitchReason">
              <codx-input
                class="test-check"
                type="switch"
                style="width: 100%"
                field="read"
              >
              </codx-input>
            </div>
            <!-- more function step -->
            <div
              *ngIf="step"
              class="icon-more_vert has-action-menu more-funtion-step"
              style="cursor: pointer"
            >
              <codx-mfunc
                *ngIf="viewStepCrr == viewStepCustom"
                [formModel]="dialog.formModel"
                (clickMF)="clickMFStep($event, step)"
                [dataItem]="moreDefaut"
                [type]="'hover'"
                (changeDataMF)="changeDataMF($event, 'step')"
              >
              </codx-mfunc>
            </div>
          </div>
        </div>
        <div class="main">
          <ng-container
            [ngTemplateOutlet]="
              viewStepCrr === viewStepCustom
                ? task
                : viewStepCrr === viewStepReasonSuccess
                ? reasonSuccess
                : reasonFail
            "
          ></ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- Thiết lập giai đoạn -- main -- nvthuan -->
<ng-template #task>
  <div *ngIf="stepList.length > 0 && stepList">
    <ng-container [ngTemplateOutlet]="rolesInStep"> </ng-container>
    <ng-container [ngTemplateOutlet]="setupInStep"> </ng-container>
    <ng-container [ngTemplateOutlet]="durationInStep"> </ng-container>
    <ng-container [ngTemplateOutlet]="job"> </ng-container>
    <ng-container [ngTemplateOutlet]="dynamicFieldsOneSteps"> </ng-container>
    <ng-container [ngTemplateOutlet]="memoInStep"> </ng-container>
  </div>
</ng-template>

<!-- template công việc -->
<ng-template #job>
  <div class="background-job">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            class="title"
            fiedName="TaskType"
            default="Công việc"
          >
          </codx-label>
        </div>
        <div>
          <codx-label
            class="fw-normal text-gray-400"
            fiedName="taskMemo"
            default="Công việc mặc định người phụ trách phải thực hiện trong giai đoạn"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="time ml-2">
          <div class="d-flex align-items-center text-gray-400">
            <codx-label
              class="fw-normal text-gray-400"
              fiedName="taskMemo"
              default="Thời hạn công việc so với giai đoạn"
            >
            </codx-label>
          </div>
          <div>
            <span style="float: right; color: #2274ae; font-size: 1.1rem"
              >{{ dayStep }} ngày {{ hourStep }} giờ /
              {{ step?.durationDay }} ngày {{ step?.durationHour }} giờ</span
            >
          </div>
        </div>
        <div class="group-button">
          <button class="button-custom" (click)="openTaskGroup()">
            <span
              class="icon-add icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
          <button class="button-custom" (click)="openTypeJob()">
            <span
              class="icon-add_task icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
          <button class="button-custom" (click)="clickShow($event, 'job-main')">
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>

    <div
      id="job-main"
      class="main-job p-3"
      [ngClass]="'show-main'"
      style="margin-top: 10px"
    >
      <!-- drap drop công việc ngoài-->
      <div class="main-body" *ngIf="taskGroupList?.length > 0">
        <div
          cdkDropList
          class="list"
          (cdkDropListDropped)="drop($event, taskGroupList, true)"
        >
          <div cdkDropListGroup>
            <ng-container *ngFor="let taskList of taskGroupList">
              <div
                class="card-job-list"
                cdkDrag
                [cdkDragData]="taskList"
                [cdkDragStartDelay]="100"
                [cdkDragDisabled]="taskList?.recID ? false : true"
              >
                <div class="card-job">
                  <div
                    *ngIf="taskList?.recID"
                    class="d-flex justify-content-start align-items-center has-action-menu ps-4 pt-3"
                  >
                    <!-- show hiden group task -->
                    <div
                      class="d-flex justify-content-center align-items-center cursor-pointer"
                      style="
                        border: 1px solid #6c757d;
                        width: 25px;
                        height: 25px;
                      "
                      (click)="toggleTask('group' + taskList?.recID)"
                    >
                      <!-- <span style="font-size: 30px; font-weight: 400; color: #6c757d">-</span> -->
                      <span style="font-size: 20px;font-weight: 400; color: #6c757d">+</span>
                    </div>
                    <div class="ms-5">
                      <codx-img
                        [width]="40"
                        class="me-2"
                        [objectId]="taskList?.roles[0]?.objectID"
                        objectType="AD_Users"
                        [objectName]="taskList?.roles[0]?.objectName"
                      >
                      </codx-img>
                    </div>
                    <div class="steplist-hearder ms-5">
                      <div>
                        <span
                          class=""
                          style="font-size: 1.2rem; font-weight: 500"
                          >{{ taskList?.taskGroupName }}</span
                        >
                      </div>
                      <div class="" style="font-weight: 400; font-size: 1.1rem">
                        <!-- TODO -->
                        <span style="color: #06a9f7; font-weight: 500;">0% </span>
                        <codx-label
                          fiedName="StepName"
                          [formModel]=""
                          [default]="'Thời hạn'"
                        >
                        </codx-label>
                        <span>
                          {{
                            (+taskList?.durationDay || 0) * 24 +
                              (+taskList?.durationHour || 0)
                          }}
                        </span>
                        <codx-label
                          fiedName="StepName"
                          [formModel]=""
                          [default]="'Giờ'"
                        >
                        </codx-label>
                      </div>
                    </div>
                    <codx-mfunc
                      [formModel]="grvMoreFunction"
                      (clickMF)="clickMFTaskGroup($event, taskList)"
                      [dataItem]="moreDefaut"
                      [type]="'hover'"
                      (changeDataMF)="changeDataMF($event, 'group')"
                    >
                    </codx-mfunc>
                  </div>
                  <div
                    *ngIf="!taskList?.recID"
                    [ngStyle]="
                      taskList?.task?.length == 0 ? { 'min-height': '20px' } : {}
                    "
                  ></div>
                  <!-- kéo thả ở trong  -->
                  <div
                    [id]="'group' + taskList?.recID"
                    cdkDropList
                    [cdkDropListData]="taskList?.task || []"
                    (cdkDropListDropped)="drop($event, taskList, false)"
                    class="task"
                    [ngStyle]=" taskList?.recID ? { 'margin-left': '45px' } : {} "
                  >
                    <ng-container *ngFor="let task of taskList?.task">
                      <div
                        cdkDrag
                        [cdkDragStartDelay]="200"
                        [cdkDragData]="task"
                        class="drap-drop ps-3 pt-2"
                      >
                        <div class="has-action-menu">
                          <div
                            class="d-flex justify-content-start align-items-center"
                            style="font-size: 1rem"
                          >
                            <!-- icon task -->
                            <div
                              class="icon-container"
                              [ngStyle]="getColor(task)"
                            >
                              <span
                                class="icon-20 text-primary-600 py-2"
                                [ngClass]="getIconTask(task)"
                              ></span>
                            </div>
                            <!-- avata -->
                            <div class="ms-3">
                              <codx-img
                                [width]="40"
                                class="me-2"
                                [objectId]="task?.roles[0]?.objectID"
                                objectType="AD_Users"
                                [objectName]="task?.roles[0]?.objectName"
                              >
                              </codx-img>
                            </div>
                            <div class="steplist-hearder ms-5">
                              <div>
                                <span
                                  class=""
                                  style="font-size: 1.2rem; font-weight: 500"
                                  >{{ task?.taskName }}</span
                                >
                              </div>
                              <div
                                class=""
                                style="font-weight: 400; font-size: 1.1rem"
                              >
                                <!-- TODO -->
                                <span style="color: #06a9f7">0% </span>
                                <codx-label
                                  fiedName="StepName"
                                  [formModel]=""
                                  [default]="'Thời hạn'"
                                >
                                </codx-label>
                                <span>
                                  {{
                                    (+task?.durationDay || 0) * 24 +
                                      (+task?.durationHour || 0)
                                  }}
                                </span>
                                <codx-label
                                  fiedName="StepName"
                                  [formModel]=""
                                  [default]="'Giờ'"
                                >
                                </codx-label>
                              </div>
                            </div>
                          </div>
                          <div class="ms-5">
                            <codx-attachment
                              #attachment
                              hideFolder="1"
                              hideImageUpload="0"
                              hideImageThumb="0"
                              hideUploadBtn="1"
                              hideDes="1"
                              type="inline"
                              allowMultiFile="1"
                              displayThumb="full"
                              showMessage="1"
                            >
                            </codx-attachment>
                          </div>
                          <codx-mfunc
                            [formModel]="grvMoreFunction"
                            (clickMF)="
                              clickMFTask($event, taskList?.task, task)
                            "
                            [isBookMark]="true"
                            [dataItem]="moreDefaut"
                            [type]="'hover'"
                            (changeDataMF)="changeDataMF($event, 'task')"
                          >
                          </codx-mfunc>
                        </div>
                        <div style="margin-left: 70px">
                          <codx-attachment
                            #attachment
                            [objectId]="task?.recID"
                            hideFolder="1"
                            hideImageUpload="0"
                            hideImageThumb="0"
                            hideUploadBtn="1"
                            hideDes="1"
                            type="inline"
                            allowMultiFile="1"
                            displayThumb="full"
                            showMessage="0"
                            [fdName]="task?.stepID"
                            [dataSelected]="task"
                          >
                          </codx-attachment>
                        </div>
                      </div>
                    </ng-container>
                    <div
                      *ngIf="taskList?.task?.length === 0"
                      style="height: 10px"
                    ></div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-center pb-3">
        <div class="me-2">
          <button
            class="btn btn-outline-primary btn-sm pb-5 d-flex align-items-center justify-content-between"
            (click)="openTaskGroup()"
          >
            <span class="icon-add icon-20 text-primary-600 py-2"></span>
            <codx-label
              class="text-primary-600"
              [name]="'lblAddGroup'"
              [formName]="'DPStepsFields'"
              [gridViewName]="'grvDPStepsFields'"
              [default]="'Thêm nhóm công việc'"
            ></codx-label>
          </button>
        </div>
        <div class="ms-2">
          <button
            class="btn btn-outline-primary btn-sm pb-5 d-flex align-items-center justify-content-between"
            (click)="openTypeJob()"
          >
            <span class="icon-add_task icon-20 text-primary-600 py-2"></span>
            <codx-label
              class="text-primary-600"
              [name]="'lblAddTask'"
              [formName]="'DPStepsFields'"
              [gridViewName]="'grvDPStepsFields'"
              [default]="'Thêm công việc'"
            ></codx-label>
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<!-- Popup thêm giai đoạn  -->
<ng-template #addStage>
  <codx-form
    [headerText]="headerText"
    [body]="addStageBody"
    [footer]="addStageFooter"
    [dialog]="popupAddStage"
  >
  </codx-form>
</ng-template>

<ng-template #addStageBody>
  <div class="mt-5">
    <div class="form-group">
      <div>
        <codx-label
          fiedName="StepName"
          [formModel]="grvStep"
          default="Tên giai đoạn"
        ></codx-label>
      </div>
      <codx-input
        field="stepName"
        [formModel]="grvStep"
        [Group]=""
        type="text"
        [crrValue]="stepName"
        (valueChange)="changeValueInput($event, stepNew)"
      >
      </codx-input>
    </div>
    <div class="form-group text-gray-400" *ngIf="isAddStage">
      <codx-label
        [formModel]="grvStep"
        default="Mặc định giai đoạn sẽ được thêm vào vị trí cuối cùng (trước
        giai đoạn hoàn tất)"
      ></codx-label>
    </div>
  </div>
</ng-template>

<ng-template #addStageFooter>
  <div class="d-flex justify-content-end">
    <button
      type="button"
      class="btn btn-outline-primary me-5"
      (click)="popupAddStage.close()"
    >
      <codx-label name="lblCancel" formName="Tasks" default="Hủy"></codx-label>
    </button>
    <button
      type="button"
      class="btn btn-primary"
      [disabled]="isSaveStep"
      (click)="saveStep()"
    >
      <codx-label
        name="lblSuscess"
        formName="Tasks"
        default="Đồng ý"
      ></codx-label>
    </button>
  </div>
</ng-template>

<!-- End Công Việc -->

<ng-template #reasonSuccess>
  <div class="background-job form-setting-step-success mb-5">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label default="Tùy chỉnh giai đoạn"></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            default="Cách thức hoạt động của giai đoạn"
          ></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job"
      id="setup-step"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-3">
        <div class="row pt-3 pb-5">
          <div class="col-6">
            <div class="title-switch">
              <codx-label
                default="Bắt buộc chọn lý do khi đánh dấu nhiệm vụ là thành
                công:"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <codx-input
                  name="success-radio"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="stepSuccess?.reasonControl ?? false"
                  [crrValue]="stepSuccess?.reasonControl"
                  (valueChange)="
                    valueChangeRadio($event, viewStepReasonSuccess)
                  "
                >
                </codx-input>
              </div>
              <div class="col-6">
                <codx-input
                  name="success-radio"
                  type="radio"
                  style="width: 100%"
                  field="no"
                  [label]="titleRadioNo"
                  [checked]="!stepSuccess?.reasonControl ?? false"
                  [crrValue]="stepSuccess?.reasonControl"
                  (valueChange)="
                    valueChangeRadio($event, viewStepReasonSuccess)
                  "
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <div class="row pb-5">
          <div class="col-6">
            <div class="col-12">
              <codx-label default="Quy trình được chuyển đến"></codx-label>
            </div>
            <div class="col-12">
              <codx-label
                class="fw-lighter fs-6"
                default="Chọn quy trình được chuyển đến khi nhiệm vụ được đánh
                dấu thành công"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <!-- <codx-input field="" type="valuelist" refValue="CRM009"> </codx-input> -->
            <ejs-combobox
              id="recID"
              [dataSource]="listCbxProccess"
              [fields]="fieldCbxProccess"
              (valueChange)="cbxChange($event, viewStepReasonSuccess)"
              [value]="stepSuccess.newProcessID"
            >
            </ejs-combobox>
            <codx-label
              class="text-danger fst-italic fs-6"
              default="Lưu ý chỉ chuyển đến các quy trình có nhiệm vụ cùng loại
              đối tượng áp dụng"
            >
            </codx-label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="background-job form-reason-success">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label default="Lý do thành công"></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            default="Lý do nhiệm vụ được ghi nhận là thành công"
          ></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            class="button-custom"
            (click)="openPopupReason(viewStepReasonSuccess, null, null)"
          >
            <span
              class="icon-add icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'reason-success')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job has-actions-menu"
      id="reason-success"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
      #view
    >
      <div class="main-body pt-5 ps-5" *ngIf="stepSuccess.reasons?.length > 0">
        <div *ngFor="let item of stepSuccess?.reasons" class="pb-2">
          <ul class="text-left drap-drop me-5 py-2 has-action-menu">
            <li>
              {{ item.reasonName }}
              <codx-mfunc
                [formModel]="dialog.formModel"
                (clickMF)="clickMFReason($event, item, viewStepReasonSuccess)"
                (changeDataMF)="changeReasonMF($event)"
                [dataItem]="moreDefaut"
                [type]="'hover'"
              >
              </codx-mfunc>
            </li>
          </ul>
        </div>
      </div>
      <div class="main-body">
        <div class="position-relative p-9">
          <div class="position-absolute top-50 start-50 translate-middle">
            <button
              type="button"
              class="btn btn-outline-primary btn-sm pb-5"
              (click)="openPopupReason(viewStepReasonSuccess, null, null)"
            >
              <i class="icon-add icon-18"> </i>
              <codx-label [name]="''" [default]="'Thêm lý do'"></codx-label>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #reasonFail>
  <div class="background-job form-setting-step-fail mb-5">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label default="Tùy chỉnh giai đoạn"></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            default="Cách thức hoạt động của giai đoạn"
          ></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job"
      id="setup-step"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-3">
        <div class="row pt-3 pb-5">
          <div class="col-6">
            <div class="title-switch">
              <codx-label
                default="Bắt buộc chọn lý do khi đánh dấu nhiệm vụ là thất bại"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <codx-input
                  name="fail-radio"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="stepFail?.reasonControl ?? false"
                  [crrValue]="stepFail?.reasonControl"
                  (valueChange)="valueChangeRadio($event, viewStepReasonFail)"
                >
                </codx-input>
              </div>
              <div class="col-6">
                <codx-input
                  type="radio"
                  name="fail-radio"
                  field="no"
                  [checked]="!stepFail?.reasonControl"
                  [crrValue]="stepFail?.reasonControl ?? false"
                  [label]="titleRadioNo"
                  (valueChange)="valueChangeRadio($event, viewStepReasonFail)"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
        <div class="row pb-5">
          <div class="col-6">
            <div class="col-12">
              <codx-label default="Quy trình được chuyển đến"></codx-label>
            </div>
            <div class="col-12">
              <codx-label
                class="fw-lighter fs-6"
                default="Chọn quy trình được chuyển đến khi nhiệm vụ được đánh
                dấu thất bại"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <ejs-combobox
              id="recID"
              [dataSource]="listCbxProccess"
              [fields]="fieldCbxProccess"
              [placeholder]="'Chọn quy trình kìa'"
              (valueChange)="cbxChange($event, viewStepReasonFail)"
              [value]="stepFail?.newProcessID"
            ></ejs-combobox>
            <codx-label
              class="text-danger fst-italic fs-6"
              default="Lưu ý chỉ chuyển đến các quy trình có nhiệm vụ cùng loại
              đối tượng áp dụng"
            >
            </codx-label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="background-job form-reason-fail">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label default="Lý do thất bại"></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            default="Lý do nhiệm vụ được ghi nhận là thất bại"
          ></codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            class="button-custom"
            (click)="openPopupReason(viewStepReasonFail, null, null)"
          >
            <span
              class="icon-add icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'reason-success')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      class="main-job has-actions-menu"
      id="reason-success"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
      #view
    >
      <div class="main-body pt-5 ps-5">
        <div *ngFor="let item of stepFail.reasons" class="pb-2">
          <ul class="text-left drap-drop me-5 py-2 has-action-menu">
            <li>
              {{ item.reasonName }}
              <codx-mfunc
                [formModel]="dialog.formModel"
                (clickMF)="clickMFReason($event, item, viewStepReasonFail)"
                (changeDataMF)="changeReasonMF($event)"
                [dataItem]="moreDefaut"
                [type]="'hover'"
              >
              </codx-mfunc>
            </li>
          </ul>
        </div>
      </div>
      <div class="main-body">
        <div
          class="position-relative p-9"
          *ngIf="stepFail.reasons?.length == 0"
        >
          <div class="position-absolute top-50 start-50 translate-middle">
            <button
              type="button"
              class="btn btn-outline-primary btn-sm pb-5"
              (click)="openPopupReason(viewStepReasonFail, null, null)"
            >
              <i class="icon-add icon-18"> </i>
              <codx-label [name]="''" [default]="'Thêm lý do'"></codx-label>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #rolesInStep>
  <div class="background-job form-setup-role mb-5">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name="lblRoles"
            default="Các vai trò trong giai đoạn"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name="lblRoleControl"
            default="Những người liên quan đến giai đoạn"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'role-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="role-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="row">
        <div class="col-6">
          <div class="d-flex flex-column margin-form mb-4">
            <div class="d-flex flex">
              <codx-label
                class="fw-bolder"
                name="lblParticipantRole"
                default="Người giám sát"
              >
              </codx-label>
              <i
                class="icon-person_add_alt_1 text-hover-primary icon-20 margin-user"
                (click)="sharePerm(controlShare, 'participants-2')"
              ></i>
            </div>
            <div>
              <codx-label
                class="fw-normal text-gray-400"
                name="lblParticipantRoleControl"
                default="Có quyền xem và giám sát tất cả nhiệm vụ của các thành
              viên trong quy trình nhưng không có quyền tạo hoặc chỉnh sửa
              nhiệm vụ"
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 group-permission witdh-roles scroll-user"
          *ngIf="step.roles != null && step.roles?.length > 0"
        >
          <ng-container *ngFor="let perm of step.roles; index as i">
            <div
              *ngIf="perm.roleType == 'S'"
              class="me-4 d-flex align-items-center margin-form mb-4"
            >
              <div class="d-flex align-items-center position-relative">
                <codx-img
                  class=""
                  [width]="25"
                  [objectId]="perm.objectName"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div class="ms-1">
                <div class="text-dark fw-bold">{{ perm.objectName }}</div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
      <div class="row">
        <div class="col-6">
          <div class="d-flex flex-column margin-form mb-4">
            <div class="d-flex flex">
              <codx-label
                class="fw-bolder"
                name="lblInvolved"
                default="Người liên quan"
              >
              </codx-label>
            </div>
            <div>
              <codx-label
                class="fw-normal text-gray-400"
                name="lblInvolvedControl"
                default="Người liên quan có thể cập nhật công việc mà họ đang
                phụ trách"
              >
              </codx-label>
            </div>
          </div>
        </div>
        <div
          class="col-6 group-permission witdh-roles scroll-user"
          *ngIf="step.roles != null && step.roles?.length > 0"
        >
          <ng-container *ngFor="let perm of step.roles; index as i">
            <div
              *ngIf="perm.roleType == 'R'"
              class="me-4 d-flex align-items-center margin-form mb-4"
            >
              <div class="d-flex align-items-center position-relative">
                <codx-img
                  class=""
                  [width]="25"
                  [objectId]="perm.objectName"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div class="ms-1">
                <div class="text-dark fw-bold">{{ perm.objectName }}</div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #setupInStep>
  <div class="background-job form-setup-step mb-5">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            name=""
            default="Tùy chỉnh giai đoạn"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name=""
            default="Cách thức hoạt động của giai đoạn"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'step-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="step-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-3">
        <div class="row pt-3 pb-5">
          <div class="col-6">
            <div class="d-flex align-items-start">
              <div>
                <div class="flex-row">
                  <div>
                    <strong>
                      <codx-label
                        class="text-muted text-opacity-25"
                        fiedName="AssignControl"
                        default="Phân bố người phụ trách cho nhiệm vụ"
                        [formModel]="dialog.formModel"
                      >
                      </codx-label>
                    </strong>
                  </div>
                  <div>
                    <codx-label
                      class="text-muted "
                      default="Mặc định khi nhiệm vụ được tạo hoặc chuyển đến
                      giai đoạn sẽ tự động phân bố người phụ trách cho nhiệm vụ"
                    >
                    </codx-label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <codx-input
              field=""
              type="valuelist"
              field="AssignControl"
              refValue="DP019"
              [crrValue]="step.assignControl"
              (valueChange)="valueChangeAssignCtrl($event)"
            >
            </codx-input>
          </div>
        </div>
        <div class="row pb-5">
          <div class="col-6">
            <div class="d-flex align-items-start">
              <div>
                <strong>
                  <codx-label
                    class="text-muted text-opacity-25"
                    fiedName=""
                    default="Tự động chuyển nhiệm vụ qua giai đoạn tiếp theo
                    khi"
                    [formModel]="dialog.formModel"
                  >
                  </codx-label>
                </strong>
              </div>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <codx-input
              field="transferControl"
              crrValue="1"
              type="valuelist"
              refValue="DP020"
              crrValue="0"
              (valueChange)="valueChangeTransferCtrl($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #durationInStep>
  <div class="background-job form-setup-step mb-5">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <!-- chưa có -->
          <codx-label fiedName="" default="Thời hạn"></codx-label>
        </div>
        <div class="text-gray-500">
          <!-- chưa có -->
          <codx-label
            fiedName=""
            default="Lên kế hoạch cho các nhiệm vụ trong giai đoạn"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'duration-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="duration-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-3">
        <div class="row pb-5">
          <div class="col-6">
            <div class="d-flex align-items-start">
              <div>
                <div class="d-flex flex-column">
                  <codx-label
                        class="text-gray-500 fw-bold"
                        fiedName=""
                        default="Thời hạn hoàn tất nhiệm vụ trong giai đoạn"
                      >
                      </codx-label>
                  <div class="mt-1">
                    <codx-label
                      class="text-gray-500"
                      default="Thời hạn mà nhiệm vụ cần được đến giai đoạn tiếp
                      theo"
                    >
                    </codx-label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <div class="position-relative">
                  <codx-input
                    field="DurationDay"
                    [formModel]=""
                    [Group]=""
                    type="text"
                    [height]="'100'"
                    [min]="0"
                    [placeholder]="step?.durationDay"
                    [crrValue]="step?.durationDay"
                    (valueChange)="valueChangeDuraDay($event)"
                  ></codx-input>
                  <div
                    class="position-absolute text-muted"
                    style="top: 7px; right: 7px"
                  >
                    <codx-label
                      fiedName="StepName"
                      [formModel]=""
                      default="Ngày"
                    ></codx-label>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="position-relative">
                  <codx-input
                    field="durationHour"
                    [formModel]=""
                    [Group]=""
                    type="text"
                    [height]="'100'"
                    [min]="0"
                    [placeholder]="'00.00'"
                    [crrValue]="step?.durationHour"
                    (valueChange)="valueChangeDuraHour($event)"
                  >
                  </codx-input>
                  <div
                    class="position-absolute text-gray-400"
                    style="top: 7px; right: 7px"
                  >
                    <codx-label
                      fiedName="StepName"
                      [formModel]=""
                      default="Giờ"
                    ></codx-label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row pb-5">
          <div class="col-6">
            <div class="title-switch">
              <strong>
                <codx-label
                  class="text-muted"
                  default="Bỏ qua ngày nghỉ trong tuần khi tính toán ngày đến
                  hạn cho nhiệm vụ trong giai đoạn"
                >
                </codx-label>
              </strong>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <codx-input
                  [name]="viewSaturday"
                  type="checkbox"
                  style="width: 100%"
                  field="excludeDayoff"
                  [label]="titleCheckBoxSat"
                  [checked]="checkedSat"
                  (valueChange)="valueChangeDayoff($event, viewSaturday, '7')"
                >
                </codx-input>
              </div>
              <div class="col-6">
                <codx-input
                  type="checkbox"
                  [name]="viewSunday"
                  field="excludeDayoff"
                  style="width: 100%"
                  [checked]="checkedSun"
                  [label]="titleCheckBoxSun"
                  (valueChange)="valueChangeDayoff($event, viewSunday, '8')"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>

        <div class="row pb-5">
          <div class="col-6">
            <div class="d-flex align-items-start">
              <div>
                <strong>
                  <codx-label
                    class="text-muted text-opacity-25"
                    fiedName="StartControl"
                    default="Bắt đầu tính thời gian thực tế cho nhiệm vụ trong
                    giai đoạn lúc"
                  >
                  </codx-label>
                </strong>
              </div>
            </div>
          </div>
          <div class="col-6">
            <!-- Gán tạm chờ refvalue -->
            <codx-input
              field="startControl"
              [formModel]="dialog.formModel"
              type="valuelist"
              refValue="DP021"
              [crrValue]="step.startControl"
              (valueChange)="valueChangeStartCtrl($event)"
            >
            </codx-input>
          </div>
        </div>

        <div class="row pb-5">
          <div class="col-6">
            <div class="title-switch">
              <codx-label
                class="text-muted"
                default="Cho phép người phụ trách chỉnh sửa thời gian hoành
                thành giai đoạn thực tế"
              >
              </codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <codx-input
                  [name]="formDurationCtrl"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="step.durationControl"
                  [crrValue]="step.durationControl"
                  (valueChange)="valueChangeDuraCtrl($event, formDurationCtrl)"
                >
                </codx-input>
              </div>
              <div class="col-6">
                <codx-input
                  type="radio"
                  [name]="formDurationCtrl"
                  field="no"
                  [checked]="!step.durationControl"
                  [crrValue]="step.durationControl"
                  [label]="titleRadioNo"
                  (valueChange)="valueChangeDuraCtrl($event, formDurationCtrl)"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>

        <div class="row pb-5">
          <div class="col-6">
            <div class="title-switch">
              <codx-label
                class="text-muted"
                default="Cho phép người phụ trách chỉnh sửa thời hạn công việc
                mặc định"
              ></codx-label>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-6">
                <codx-input
                  [name]="formLeaTimeCtrl"
                  type="radio"
                  style="width: 100%"
                  field="yes"
                  [label]="titleRadioYes"
                  [checked]="step.leadtimeControl"
                  [crrValue]="step.leadtimeControl"
                  (valueChange)="valueChangeDuraCtrl($event, formLeaTimeCtrl)"
                >
                </codx-input>
              </div>
              <div class="col-6">
                <codx-input
                  type="radio"
                  [name]="formLeaTimeCtrl"
                  field="no"
                  [checked]="!step.leadtimeControl"
                  [crrValue]="step.leadtimeControl"
                  [label]="titleRadioNo"
                  (valueChange)="valueChangeDuraCtrl($event, formLeaTimeCtrl)"
                >
                </codx-input>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #memoInStep>
  <div class="background-job form-setup-step mb-5">
    <div class="header-job d-flex align-items-center justify-content-between py-3 px-6">
      <div class="d-flex flex-column">
        <div class="title text-primary fs-4 fw-bold">
          <codx-label
            fiedName="Memo"
            [formModel]="dialog.formModel"
            default="Hướng dẫn hoàn thành giai đoạn"
          ></codx-label>
        </div>
        <div class="text-gray-500">
          <codx-label
            name=""
            default="Mô tả chi tiết cách hoàn thành giai đoạn cho người phụ
            trách"
          >
          </codx-label>
        </div>
      </div>
      <div class="right">
        <div class="group-button">
          <button
            *ngIf="isShowstage"
            class="button-custom"
            (click)="clickShow($event, 'memo-setup-step')"
          >
            <span
              class="icon-expand_less icon-20 text-primary-600 py-2"
              style="font-weight: 500"
            ></span>
          </button>
        </div>
      </div>
    </div>
    <div
      id="memo-setup-step"
      class="main-job"
      [ngClass]="isShowstage ? 'show-main' : 'hidden-main'"
    >
      <div class="main-body p-3">
        <div class="row pt-3 pb-5">
          <codx-input
            field="memo"
            type="textarea"
            [placeholder]=""
            [crrValue]="step.memo"
            (valueChange)="valueChangeMemo($event)"
          >
          </codx-input>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #addReasonPopup>
  <codx-form
    [headerText]="headerText"
    [body]="addReasonContent"
    [footer]="addReasonFooter"
    [dialog]="popupAddReason"
  >
  </codx-form>
</ng-template>
<ng-template #addReasonContent>
  <div class="mt-5">
    <div class="form-group">
      <div>
        <codx-label
          fiedName="ReasonName"
          [formModel]="dialog.formModel"
          default="Tên lý do"
        ></codx-label>
      </div>
      <codx-input
        field="reasonName"
        type="text"
        [crrValue]="reason?.reasonName"
        (valueChange)="changeValueReaName($event)"
      >
      </codx-input>
    </div>
  </div>
</ng-template>

<ng-template #addReasonFooter>
  <div class="d-flex justify-content-end">
    <button
      type="button"
      class="btn btn-outline-primary me-5"
      (click)="popupAddReason.close()"
    >
      <codx-label
        name=" lblfail"
        formName="DPStepsReasons"
        default="Hủy"
      ></codx-label>
    </button>
    <button
      type="button"
      [disabled]="isClick"
      class="btn btn-primary"
      (click)="addReason()"
    >
      <codx-label
        name=" lblSuscess"
        formName="DPStepsReasons"
        default="Đồng ý"
      ></codx-label>
    </button>
  </div>
</ng-template>
<!-- End Thiết lập giai đoạn -->
