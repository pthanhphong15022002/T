<codx-form
  #form
  [headerText]="titleAction"
  [body]="body"
  [footer]="footer"
  [dialog]="dialog"
  [formModel]="dialog?.formModel"
  [data]="field"
  [openMore]="false"
>
  <ng-template #body>
    <div class="card-form">
      <div class="form-group">
        <codx-label
          fiedName="StepID"
          [formModel]="form.formModel"
          [default]="'Giai đoạn liên kết'"
        >
        </codx-label>
        <ejs-combobox
          [enabled]="enabled"
          [dataSource]="stepList"
          [fields]="fieldsResource"
          [value]="field.stepID"
          [allowFiltering]="true"
          [placeholder]="grvSetup['StepID']?.description"
          (valueChange)="cbxChange($event)"
        ></ejs-combobox>
      </div>
      <div class="form-group row">
        <div class="col-6">
          <codx-label
            fiedName="Title"
            [formModel]="form.formModel"
            default="Tên trường dữ liệu"
          >
          </codx-label>
          <codx-input
            field="title"
            [formModel]="form.formModel"
            [Group]="form.formGroup"
            (valueChange)="valueChange($event)"
          >
          </codx-input>
        </div>
        <!-- cai nay chua có -->
        <div class="col-6">
          <codx-label
            fiedName="FieldName"
            [formModel]="form.formModel"
            default="ID trường dữ liệu"
          >
          </codx-label>
          <codx-input
            field="fieldName"
            [type]="'text'"
            [crrValue]="field.fieldName"
            [formName]="'DPStepsFields'"
            [gridViewName]="'grvDPStepsField'"
            (valueChange)="valueChange($event)"
          >
          </codx-input>
          <!-- <codx-input
          field="fieldName"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
          (valueChange)="valueChange($event)"
        >
        </codx-input> -->
        </div>
      </div>
      <div class="form-group">
        <codx-label
          fiedName="DataType"
          [formModel]="form.formModel"
          [default]="'Loại dữ liệu'"
        ></codx-label>
        <!-- <codx-input
          field="dataType"
          [formModel]="form.formModel"
          [Group]="form.formGroup"
          (valueChange)="valueChange($event)"
          [disabled]="action == 'edit'"
        >
        </codx-input> -->
        <codx-input
          type="valuelist"
          ngDefaultControl
          field="dataType"
          [crrValue]="field?.dataType"
          [refValue]="refValueDataType"
          [placeholder]="grvSetup['DataType']['headerText']"
          (valueChange)="valueChange($event)"
          [disabled]="action == 'edit'"
        >
        </codx-input>
      </div>
      <div
        class="form-group"
        *ngIf="
          field.dataType &&
          field.dataType != 'A' &&
          field.dataType != 'R' &&
          field.dataType != 'C'
        "
      >
        <codx-label
          fiedName="DataFormat"
          [formModel]="form.formModel"
          [default]="'Định dạng dữ liệu'"
        >
        </codx-label>
        <codx-input
          *ngIf="field.dataType == 'N'"
          type="valuelist"
          ngDefaultControl
          field="dataFormat"
          [crrValue]="field?.dataFormat"
          refValue="DP0271"
          [placeholder]="grvSetup['DataFormat']['headerText']"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
        <codx-input
          *ngIf="field.dataType == 'L'"
          type="valuelist"
          ngDefaultControl
          field="dataFormat"
          [crrValue]="field?.dataFormat"
          refValue="DP0272"
          [placeholder]="grvSetup['DataFormat']['headerText']"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
        <codx-input
          *ngIf="field.dataType == 'T'"
          type="valuelist"
          ngDefaultControl
          field="dataFormat"
          [crrValue]="field?.dataFormat"
          refValue="DP0273"
          [placeholder]="grvSetup['DataFormat']['headerText']"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
        <codx-input
          *ngIf="field.dataType == 'D'"
          type="valuelist"
          ngDefaultControl
          field="dataFormat"
          [crrValue]="field?.dataFormat"
          refValue="DP0274"
          [placeholder]="grvSetup['DataFormat']['headerText']"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
        <codx-input
          *ngIf="field.dataType == 'P'"
          type="valuelist"
          ngDefaultControl
          field="dataFormat"
          [crrValue]="field?.dataFormat"
          refValue="DP0275"
          [placeholder]="grvSetup['DataFormat']['headerText']"
          (valueChange)="valueChange($event)"
        >
        </codx-input>
      </div>
      <ng-container
        *ngIf="
          field.dataType == 'L' &&
          (field.dataFormat == 'C' || field.dataFormat == 'V')
        "
      >
        <div class="form-group">
          <div class="d-flex justify-content-between">
            <div class="'justify-content-start">
              <codx-label
                fiedName="RefValue"
                [formModel]="form.formModel"
                [default]="'Danh sách tùy chọn'"
              >
              </codx-label>
            </div>
            <div
              class="d-flex justify-content-end"
              *ngIf="field.dataFormat == 'V'"
            >
              <button
                *ngIf="field.refValue"
                type="button"
                class="btn btn-icon btn-sm btn-light-primary me-2"
                (click)="clickDeletedVll()"
              >
                <i class="icon-close icon-16 text-danger"></i>
              </button>

              <button
                type="button"
                class="btn btn-icon btn-sm btn-light-primary me-2"
                (click)="clickAddVll()"
              >
                <i
                  class=" {{
                    !field.refValue ? 'icon-add_box' : 'icon-edit'
                  }} icon-16"
                ></i>
              </button>
            </div>
          </div>
          <codx-input
            *ngIf="field.dataFormat == 'C'"
            type="combobox"
            field="refValue"
            [crrValue]="field.refValue"
            [refValue]="'DPComboboxList'"
            (valueChange)="valueChange($event)"
          ></codx-input>

          <ng-container *ngIf="field.dataFormat == 'V'">
            <ejs-combobox
              #datasVllCbx
              [enabled]="enabled"
              [dataSource]="listVll"
              [fields]="fieldsVll"
              [value]="field.refValue"
              [allowFiltering]="true"
              [placeholder]="grvSetup['refValue']?.description"
              (valueChange)="cbxChangeVll($event, datasVllCbx)"
            ></ejs-combobox
          ></ng-container>
        </div>
        <div class="form-group" *ngIf="field.dataFormat == 'V'">
          <codx-label
            class="label-colon"
            name="demoVll"
            formName="SYS_ValueList"
            default="Xem trước"
            class="me-4"
          >
          </codx-label>
          <ng-container *ngIf="!this.crrVll?.multiSelect">
            <ejs-combobox
              #comboxView
              [enabled]="enabled"
              [dataSource]="datasVllCrr"
              [fields]="fieldsCrrVll"
              [value]="crrValueFirst"
              [allowFiltering]="false"
              [placeholder]="this.crrVll?.note"
            ></ejs-combobox>
          </ng-container>
          <ng-container *ngIf="this.crrVll?.multiSelect">
            <ejs-multiselect
              [dataSource]="datasVllCrr"
              [mode]="'Default'"
              [fields]="fieldsCrrVll"
              [value]=""
              [showDropDownIcon]="true"
              [placeholder]="this.crrVll?.note"
            ></ejs-multiselect>
          </ng-container>
        </div>
      </ng-container>

      <div class="form-group" *ngIf="field.dataType == 'A'">
        <codx-input
          type="checkbox"
          field="multiselect"
          (valueChange)="valueChange($event)"
          labelPosition="After"
          label="Cho phép chọn nhiều giá trị"
          [crrValue]="field?.multiselect"
        ></codx-input>
      </div>

      <div class="row" *ngIf="field.dataType == 'R'">
        <div class="form-group col-3">
          <codx-label
            fiedName="RankIcon"
            [formModel]="form.formModel"
            default="Loại icon hiển thị"
          >
          </codx-label>
          <div class="mt-1">
            <codx-input
              type="vllicon"
              field="rankIcon"
              [refValue]="'L1470'"
              [iconOnly]="true"
              [crrValue]="field?.rankIcon"
              (valueChange)="valueChangeIcon($event)"
            >
            </codx-input>
          </div>
        </div>
        <div class="form-group col-9">
          <codx-label
            fiedName="rank"
            [formModel]="form.formModel"
            default="Điểm tối đa"
          >
          </codx-label>
          <div class="pt-3">
            <ejs-slider
              id="slider"
              style="width: 375px !important"
              [value]="field?.rank"
              [min]="min"
              [max]="max"
              [type]="type"
              [ticks]="ticks"
              [tooltip]="tooltip"
              (change)="sliderChange($event)"
            ></ejs-slider>
          </div>
        </div>
      </div>
      <div class="form-group">
        <codx-label
          name="Note"
          [formModel]="form.formModel"
          default="Mô tả nhập liệu"
        ></codx-label>

        <div class="d-flex justify-content-between align-items-center">
          <div style="width: 100%">
            <codx-input
              [field]="'note'"
              [formModel]="form.formModel"
              [Group]="form.formGroup"
              (valueChange)="valueChange($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <codx-label
          class="text-danger me-3"
          fiedName="IsRequired"
          [formModel]="form?.formModel"
          default="Bắt buộc *"
        ></codx-label>
        <codx-input
          type="switch"
          field="isRequired"
          [checked]="field?.isRequired"
          (valueChange)="changeRequired($event)"
        >
        </codx-input>
      </div>
    </div>
  </ng-template>
  <ng-template #footer>
    <div class="d-flex justify-content-end">
      <button type="button" class="btn btn-primary" (click)="saveData()">
        <codx-label
          name="Save"
          formName="StepsFields"
          default="Lưu"
        ></codx-label>
      </button>
    </div>
  </ng-template>

  <!-- //form Add VLL -->
  <ng-template #addVll>
    <codx-form
      class="h-100"
      [headerText]="titleForm"
      [body]="bodyVll"
      [footer]="footerVll"
      [dialog]="dialogVll"
      [data]="crrVll"
    >
    </codx-form>
    <ng-template #bodyVll>
      <div class="">
        <div class="form-group">
          <codx-label
            [fiedName]="'Note'"
            [formModel]="formModelVll"
            default="Nội dung"
          >
          </codx-label>
          <codx-input
            type="text"
            field="note"
            [formModel]="formModelVll"
            [crrValue]="crrVll.note"
            (valueChange)="onChangeVll($event)"
          >
          </codx-input>
        </div>
        <div class="form-group">
          <codx-label
            name="ListName"
            [formModel]="formModelVll"
            default="Tên value list"
          >
          </codx-label>
          <codx-input
            type="text"
            field="listName"
            [disabled]="crrVll.listName"
            [formModel]="formModelVll"
            [crrValue]="crrVll.listName"
            (valueChange)="onChangeVll($event)"
          >
          </codx-input>
        </div>
        <div class="form-group">
          <!-- labelPosition="After"
        label="Cho phép chọn nhiều giá trị" -->
          <codx-input
            class="me-2"
            type="checkbox"
            field="multiSelect"
            (valueChange)="onChangeVll($event)"
            [crrValue]="crrVll?.multiSelect"
          ></codx-input>
          <span>
            <codx-label
              class=""
              name="multiSelect"
              [formName]="'SYS_ValueList'"
              default="Cho phép chọn nhiều giá trị"
            ></codx-label>
          </span>
        </div>
        <div class="d-flex flex-column form-group mt-3">
          <codx-label
            name="inputDefautValue"
            [formModel]="formModelVll"
            default="Danh sách lựa chọn"
          >
          </codx-label>
          <ng-container *ngFor="let item of datasVll; index as i">
            <div
              class="cursor-pointer ms-5 mb-2 has-action-menu d-flex position-relative"
            >
              <div>
                <span
                  class="no-border"
                  *ngIf="i != idxEdit"
                  (click)="handelTextValue(i)"
                  [innerText]="item?.textValue ?? ''"
                ></span>

                <!-- 
                  [ngbPopover]="toolDeleted"
                #p="ngbPopover"
                (mouseenter)="showPopoverDeleted(p, i)"
                autoClose="outside"
                placement="right left"
                <div class="d-flex">
              <span>
                <span class="label-colon" [innerHTML]="i"></span>
              </span> -->
                <input
                  *ngIf="i == idxEdit"
                  class="no-border"
                  #textEditValue
                  type="text"
                  name="textEditValue"
                  matInput
                  autofocus
                  [value]="item.textValue"
                  (blur)="onEditTextValue(textEditValue, item.value)"
                  placeholder="Nhập giá trị value"
                  (keydown.enter)="onEditTextValue(textEditValue, item.value)"
                />
              </div>
              <div
                *ngIf="i != idxEdit"
                class="action-menu-deleted d-flex justify-content-end"
              >
                <span
                  class="icon-close icon-16 text-danger me-1"
                  (click)="deletedValue(i)"
                ></span>
              </div>
            </div>
            <!-- </div> -->
          </ng-container>

          <div class="form-group">
            <input
              id="textAddValue"
              class="form-control no-border"
              #textAddValue
              type="text"
              name="textAddValue"
              matInput
              (blur)="onAddTextValue(textAddValue)"
              placeholder="Nhập giá trị value"
              (keydown.enter)="onAddTextValue(textAddValue)"
            />
          </div>

          <div class="form-group">
            <codx-label
              class="label-colon"
              name="demoVll"
              [formModel]="formModelVll"
              default="Xem trước"
              class="me-4"
            >
            </codx-label>
            <ejs-combobox
              #viewComboxForm
              [enabled]="enabled"
              [dataSource]="datasVll"
              [fields]="fieldsResourceVll"
              [value]="crrValue"
              [allowFiltering]="false"
              [placeholder]=""
            ></ejs-combobox>
          </div>
        </div>
      </div>
    </ng-template>
    <ng-template #footerVll>
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-primary" (click)="saveVll()">
          <codx-label
            name="Save"
            [formModel]="formModelVll"
            default="Lưu"
          ></codx-label>
        </button>
      </div>
    </ng-template>

    <!-- <ng-template #toolDeleted>
      <ng-container>
        <span
          class="icon-close icon-16 text-danger me-1"
          (click)="deletedValue()"
        ></span>
      </ng-container>
    </ng-template> -->
  </ng-template>
</codx-form>
