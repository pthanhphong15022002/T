<codx-form
  #form
  [headerText]="title"
  [body]="body"
  [dialog]="dialog"
  [formModel]="frmModel"
  [openMore]="false"
></codx-form>

<!-- Form Group -->
<ng-template #body>
  <ng-container [ngTemplateOutlet]="header"></ng-container>
  <ng-container [ngTemplateOutlet]="main"></ng-container>
</ng-template>

<ng-template #header>
  <div class="d-flex justify-content-between align-items-center py-1">
    <div>
      <div class="icon-container" [ngStyle]="getColor(dataInput)">
        <span class="icon-16" [ngClass]="getIconTask(dataInput)"></span>
      </div>
      <div>
        <div class="fs-4 fw-bold text-dark" [ngStyle]="getColorTile(dataInput)">
          <span class="ms-2">{{ dataInput["name"] }}</span>
        </div>
      </div>
    </div>

    
    <div class="d-flex">
      <div
        class="d-flex align-items-center me-2"
        *ngIf="dataInput['reminders']"
      >
        <span class="icon-notifications icon-20 text-primary-500 me-1"></span>
        <span>
          {{ dataInput["reminders"] }}
        </span>
      </div>

      <div class="d-flex align-items-center me-2">
        <span class="icon-access_time icon-20 text-primary-500 me-1"></span>
        <span
          class="date"
          *ngIf="dataInput['startDate'] && dataInput['endDate']"
        >
          {{ dataInput["startDate"] | date : dateFomat }} -
          {{ dataInput["endDate"] | date : dateFomat }}
        </span>
        <span>(</span>
        <span class="mx-1 text-primary-500">{{
          dataInput["durationDay"]
        }}</span>
        <codx-label name="durationDay" default="ngày"></codx-label>
        <span class="mx-1 text-primary-500">{{
          dataInput["durationHour"]
        }}</span>
        <codx-label name="durationHour" default="giờ"></codx-label>
        <span>)</span>
      </div>

      <div *ngIf="type == 'C'" class="d-flex align-items-center me-2">
        <span class="icon-local_phone icon-18 me-1"></span>
        <span class="mx-1 text-primary-500">{{ dataInput["callType"] }}</span>
      </div>
      <div
        *ngIf="type === 'M'"
        class="d-flex justify-content-center align-items-center"
      >
        <codx-input
          type="switch"
          class="test-check me-2 mt-2"
          [checked]="dataInput['isOnline']"
          field="isOnline"
          [disabled]="true"
        >
        </codx-input>
        <codx-label
          fiedName="isOnline"
          [formModel]="frmModel"
          default="Họp trực tuyến"
        >
        </codx-label>
      </div>

      <codx-update-progress
        [progress]="dataInput['progress']"
        [dataSource]="dataInput"
        [type]="dataInput?.type"
        [typeProgress]="2"
        [step]="step"
      ></codx-update-progress>

      <div class="d-flex align-items-center">
        <span class="icon-more_vert icon-16"></span>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #main>
  <div class="d-flex tab-header">
    <ul class="nav nav-tabs w-100">
      <ng-container *ngFor="let item of tabInstances; let i = index">
        <li class="nav-item">
          <a
            (click)="clickMenu(item.type)"
            [class]="
              'tab-item text-dark fw-bold d-flex align-item-center' +
              ' ' +
              (item.type == viewModelDetail ? 'tab-active' : '')
            "
          >
            <i
              [class]="
                'me-2 ' +
                item.icon +
                ' ' +
                (item.type == viewModelDetail ? 'text-primary' : '')
              "
            ></i
            ><span>
              <codx-label
                [name]="'lbl' + item.type"
                [formName]="'SYS'"
                [default]="item.title"
              >
              </codx-label>
            </span>
          </a>
        </li>
      </ng-container>
    </ul>
  </div>
  <div class="mt-5">
    <ng-container *ngIf="viewModelDetail == 'view'" [ngTemplateOutlet]="view">
    </ng-container>
    <ng-container
      *ngIf="viewModelDetail == 'history'"
      [ngTemplateOutlet]="history"
    >
    </ng-container>
  </div>
</ng-template>

<ng-template #view>
  <div class="d-flex align-items-center" *ngIf="type == 'M'">
    <codx-label
      class="h4 font-weight-400 me-4"
      fiedName="roles"
      [formModel]="frmModel"
      [default]="'Người chủ trì'"
      style="min-width: 130px"
    >
    </codx-label>
    <div>
      <ng-container
        *ngIf="owner.length > 0"
        [ngTemplateOutlet]="showUser"
        [ngTemplateOutletContext]="{ users: owner }"
      ></ng-container>
    </div>
  </div>

  <div class="d-flex align-items-center" *ngIf="type != 'M'">
    <codx-label
      class="h4 font-weight-400 me-4"
      fiedName="roles"
      [formModel]="frmModel"
      default="Người phụ trách"
      style="min-width: 130px"
    >
    </codx-label>
    <div>
      <ng-container
        [ngTemplateOutlet]="showUser"
        [ngTemplateOutletContext]="{ users: type == 'P' ? person : owner }"
      ></ng-container>
    </div>
  </div>

  <div class="d-flex align-items-center" *ngIf="type !== 'P' && type !== 'G'">
    <codx-label
      *ngIf="type == 'M'"
      class="h4 font-weight-400 me-4"
      fiedName="roles"
      [formModel]="frmModel"
      default="Người tham gia"
      style="min-width: 130px"
    >
    </codx-label>
    <codx-label
      *ngIf="type != 'M'"
      class="h4 font-weight-400 me-4"
      fiedName="roles"
      [formModel]="frmModel"
      default="Vai trò/bộ phận thực hiện"
    >
    </codx-label>

    <div>
      <ng-container
        *ngIf="participant.length > 0"
        [ngTemplateOutlet]="showUser"
        [ngTemplateOutletContext]="{ users: participant }"
      ></ng-container>
    </div>
  </div>
  <hr />
  <div *ngIf="type == 'P'">
    <codx-label
      class="h4 font-weight-400"
      fiedName=""
      [formModel]="frmModel"
      default="Trường nhập liệu"
    >
    </codx-label>
    <ul *ngIf="dataInput['fieldName']?.length > 0">
      <li *ngFor="let feil of dataInput['fieldName']" class="fs-5">
        {{ feil }}
      </li>
    </ul>
  </div>

  <div
    class="d-flex justify-content-start align-items-center"
    *ngIf="type !== 'G' && type !== 'P'"
  >
    <codx-label
      class="h4 font-weight-400 me-3"
      fiedName="memo"
      [formModel]="frmModel"
      default="Tài liệu"
    >
    </codx-label>
    <div>
      <codx-attachment
        #attachment
        [objectId]="dataInput['recID']"
        hideFolder="1"
        hideImageUpload="0"
        hideImageThumb="0"
        hideUploadBtn="1"
        hideDelete="1"
        hideDes="1"
        type="inline"
        allowMultiFile="1"
        displayThumb="full"
        showMessage="0"
        [dataSelected]="dataInput"
      >
      </codx-attachment>
    </div>
  </div>
  <hr *ngIf="type !== 'G' && type !== 'P'" />

  <div *ngIf="type !== 'P'">
    <codx-label
      class="h4 font-weight-400"
      fiedName="memo"
      [formModel]="frmModel"
      default="Ghi chú: "
    >
    </codx-label>
    <p [innerHTML]="dataInput['memo']"></p>
  </div>
  <hr *ngIf="type !== 'P'" />

  <div *ngIf="type !== 'P'">
    <codx-label
      *ngIf="type !== 'G'"
      class="h4 font-weight-400"
      fiedName="parentID"
      [formModel]="frmModel"
      default="Công việc liên kết"
    >
    </codx-label>
    <codx-label
      *ngIf="type === 'G'"
      class="h4 font-weight-400"
      fiedName=""
      [formModel]="frmModel"
      default="Công việc"
    >
    </codx-label>
    <div>
      <div
        *ngFor="let task of listDataLink"
        class="d-flex align-items-center m-2"
      >
        <div class="icon-container" [ngStyle]="getColor(task)">
          <span
            class="icon-20 text-primary-600 py-2"
            [ngClass]="getIconTask(task)"
          ></span>
        </div>
        <div class="d-flex align-items-center ms-2">
          <span class="" style="font-size: 1.2rem; font-weight: 500">{{
            task?.name
          }}</span>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #history>
  <div>
    <codx-history
      #history
      [objectID]="dataInput['recID']"
      [formModel]="form.formModel"
    ></codx-history>
  </div>
</ng-template>

<!-- End Form Group -->
<ng-template #showUser let-data="users">
  <div>
    <ng-container *ngFor="let item of data; index as i">
      <div class="user-mini-nav">
        <span>
          <codx-img
            [width]="30"
            class="me-2"
            [objectId]="item?.objectID"
            objectType="item?.objectType"
            [objectName]="item?.objectName"
          ></codx-img>
        </span>
        <div>
          <h4 class="m-0">{{ item?.objectName }}</h4>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>
