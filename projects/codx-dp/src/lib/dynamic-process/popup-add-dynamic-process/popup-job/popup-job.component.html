<codx-form
  #form
  [headerText]="title"
  subHeaderText=""
  [subHeader]="subHeader"
  [body]="body"
  [footer]="footer"
  [dialog]="dialog"
  [formModel]="formModelMenu"
  [data]="job"
  [openMore]="false"
></codx-form>

<ng-template #subHeader>
  <div class="ms-4" *ngIf="stepType == 'A'">
    <codx-input
      class="me-2"
      type="colorpicker"
      [showText]="false"
      [modeSwitcher]="false"
      [crrValue]=""
      field="color"
    >
    </codx-input>
  </div>
</ng-template>
<!-- Form Group -->
<ng-template #body>
  <div class="card-form">
    <!-- Link group -->
    <div class="form-group">
      <div class="text-primary mb-1">
        <codx-label
          fiedName="StepName"
          [formModel]="dialog?.formModel"
          default="Thuộc giai đoạn/nhóm"
        >
        </codx-label>
      </div>
      <div>
        <codx-label
          fiedName="StepName"
          [formModel]="dialog?.formModel"
          [default]="taskName"
        >
        </codx-label>
        <span> > </span>
        <codx-label
          fiedName="StepName"
          [formModel]="dialog?.formModel"
          [default]="jobName"
        >
        </codx-label>
      </div>
    </div>
    <!--End Link group -->
    <div
      class="form-group d-flex justify-content-between align-item-center w-100"
    >
      <div class="step-name w-100">
        <div>
          <codx-label
            fiedName="StepName"
            [formModel]="dialog?.formModel"
            default="Nhóm công việc"
          >
          </codx-label>
        </div>
        <div>
          <ejs-dropdownlist
            id="ddlelement"
            #samples
            [dataSource]="groupTackList"
            [fields]="fields"
            [placeholder]="''"
            [(ngModel)]="tasksItem"
            [itemTemplate]="itemTemplate"
            [valueTemplate]="valueTemplate"
            [(value)]="tasksItem"
            (change)="filterText($event)"
            [allowFiltering]="false"
          >
            <ng-template #itemTemplate="" let-data="">
              <span>{{ data.taskGroupName }}</span>
            </ng-template>
            <ng-template #valueTemplate="" let-data="">
              <span>{{ data.taskGroupName }}</span>
            </ng-template>
          </ejs-dropdownlist>
        </div>
      </div>
    </div>
    <!-- Ten Cong Viec -->
    <div
      class="form-group d-flex justify-content-between align-item-center w-100"
      *ngIf="stepType != 'Q'"
    >
      <!-- name -->
      <div class="step-name w-100" [ngClass]="stepType === 'P' ? 'me-4' : ''">
        <div>
          <codx-label
            fiedName="taskName"
            [formModel]="dialog?.formModel"
            default="Tên công việc"
          >
          </codx-label>
        </div>
        <codx-input
          field="taskName"
          [formModel]="dialog?.formModel"
          type="text"
          (valueChange)="valueChangeText($event)"
        >
        </codx-input>
      </div>
      <!--End name -->
      <!-- Cuoc goi -->
      <div *ngIf="stepType === 'P'" class="w-100 ms-4" style="flex-basis: 100%">
        <div>
          <codx-label
            fiedName="taskType"
            [formModel]="dialog?.formModel"
            default="Loại cuộc gọi"
          >
          </codx-label>
        </div>
        <codx-input
          field="taskType"
          type="valuelist"
          refValue="DP023"
          (valueChange)="valueChangeCombobox($event)"
        >
        </codx-input>
      </div>
      <!--end Cuoc goi -->

      <!-- Cuoc hop -->
      <div *ngIf="stepType === 'M'" style="flex-basis: 25%" class="">
        <div class="d-flex justify-content-end">
          <codx-label
            fiedName="isOnline"
            [formModel]="dialog?.formModel"
            default="Họp trực tuyến"
          >
          </codx-label>
        </div>
        <div class="d-flex justify-content-center mt-2 ms-2">
          <codx-input
            type="switch"
            class="test-check"
            [checked]=""
            field="isOnline"
            (valueChange)="valueChangeAlert($event)"
          >
          </codx-input>
        </div>
      </div>
      <!-- End cuoc hop -->
      <!-- Gui mail -->
      <!-- TODO: mail chưa có tài liệu -->
      <div
        *ngIf="stepType === 'E' || stepType === 'Q'"
        class=""
        style="flex-basis: 10%"
      >
        <div>
          <codx-label></codx-label>
        </div>
        <div
          *ngIf="stepType === 'E'"
          class="d-flex justify-content-end"
          style="margin-top: 2px"
        >
          <button
            class="button-mail"
            *ngIf="stepType == 'E'"
            (click)="handelMail()"
          >
            <span
              class="icon-email icon-20 text-primary-600 py-2 text-muted"
            ></span>
          </button>
        </div>
      </div>
      <!-- End gui mail -->
    </div>
    <!--End ten Cong Viec -->

    <div class="form-group" *ngIf="stepType == 'Q'">
      <div class="d-flex justify-content-between align-items-center mail">
        <codx-label name="Reference" default="Tên khảo sát"></codx-label>
        <a class="d-flex justify-content-end align-items-center cursor-pointer">
          <span
            class="icon-insert_link icon-20 text-primary-600 me-2 m-2"
          ></span>
        </a>
      </div>
      <codx-input
        field="stepName"
        [formModel]="dialog?.formModel"
        type="text"
        [Group]=""
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
      <a class="cursor-pointer text-primary"> {{ linkQuesiton }}</a>
    </div>

    <div class="form-group">
      <div class="d-flex justify-content-between row">
        <div class="col-6">
          <codx-label
            fiedName="durationDay"
            [formModel]="dialog?.formModel"
            default="Thời lượng công việc"
          >
          </codx-label>
          <div class="d-flex justify-content-between row">
            <div class="col-6">
              <codx-input
                field="durationDay"
                [formModel]="dialog?.formModel"
                type="text"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
            </div>

            <div class="col-6">
              <codx-input
                field="durationHour"
                [formModel]="dialog?.formModel"
                type="text"
                (valueChange)="valueChangeText($event)"
              >
              </codx-input>
            </div>
          </div>
        </div>
        <div class="col-6">
          <codx-label
            fiedName="reminders"
            [formModel]="dialog?.formModel"
            default="Nhắc nhở trước khi bắt đầu"
          >
          </codx-label>
          <div>
            <!-- combobox -->
            <codx-input
              field="reminders"
              [formModel]="dialog?.formModel"
              refValue="DP024"
              type="valuelist"
              (valueChange)="valueChangeText($event)"
            >
            </codx-input>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <div>
        <codx-label
          fiedName="parentID"
          [formModel]="dialog?.formModel"
          default="Công việc liên kết"
        >
        </codx-label>
      </div>
      <codx-input
        field="parentID"
        [formModel]="dialog.formModel"
        (valueChange)="valueChangeCombobox($event)"
      >
      </codx-input>
    </div>

    <div class="form-group">
      <div>
        <codx-label
          fiedName="dependRule"
          [formModel]="dialog?.formModel"
          default="Bắt đầu công việc khi"
        >
        </codx-label>
      </div>
      <codx-input
        field="dependRule"
        refValue="DP024"
        type="valuelist"
        (valueChange)="valueChangeCombobox($event)"
      >
      </codx-input>
    </div>

    <div class="form-group">
      <div
        class="d-flex justify-content-between align-item-center"
        *ngIf="stepType === 'M'"
      >
        <div>
          <codx-label
            fiedName="roles"
            [formModel]="dialog?.formModel"
            default="Người chủ trì"
          ></codx-label>
        </div>
        <codx-input
          type="Share"
          [refValue]="vllShare"
          field=""
          [dataShared]="[]"
          [multiple]="true"
          [showInput]="false"
          (valueChange)="eventApply($event, listChair)"
        >
        </codx-input>
      </div>
      <ng-container
        *ngIf="listChair.length > 0"
        [ngTemplateOutlet]="showUser"
        [ngTemplateOutletContext]="{ users: listChair }"
      ></ng-container>
    </div>

    <div class="form-group">
      <div class="d-flex justify-content-between align-item-center">
        <div>
          <codx-label
            fiedName="roles"
            [formModel]="dialog?.formModel"
            default="Vai trò bộ phận thực hiện"
          >
          </codx-label>
        </div>
        <codx-input
          type="Share"
          [refValue]="vllShare"
          field="roles"
          [dataShared]="[]"
          [multiple]="true"
          [showInput]="false"
          (valueChange)="eventApply($event, listOwner)"
        >
        </codx-input>
      </div>
      <ng-container
        *ngIf="listOwner.length > 0"
        [ngTemplateOutlet]="showUser"
        [ngTemplateOutletContext]="{ users: listOwner }"
      ></ng-container>
    </div>

    <div class="form-group">
      <div>
        <codx-label
          fiedName="assignControl"
          [formModel]="dialog?.formModel"
          default="Phân công công việc khi"
        >
        </codx-label>
      </div>
      <codx-input
        field="assignControl"
        refValue="DP025"
        type="valuelist"
        (valueChange)="valueChangeCombobox($event)"
      >
      </codx-input>
    </div>

    <div class="form-group">
      <div>
        <codx-label
          fiedName="memo"
          [formModel]="dialog?.formModel"
          default="Ghi chú"
        ></codx-label>
      </div>
      <codx-input
        field="memo"
        [formModel]="dialog?.formModel"
        [Group]=""
        type="text"
        [height]="'100'"
        (valueChange)="valueChangeText($event)"
      >
      </codx-input>
    </div>

    <div class="form-group">
      <codx-input
        type="switch"
        class="test-check"
        [checked]=""
        field="isAlert"
        (valueChange)="valueChangeAlert($event)"
      >
      </codx-input>
      <span style="margin-left: 10px">
        <codx-label
          name="lblAlert"
          [formModel]="form.formModel"
          default="Tạo tack trong phân hệ quản lý công việc"
        >
        </codx-label>
      </span>
    </div>

    <div class="form-group">
      <codx-input
        type="switch"
        class="test-check"
        [checked]=""
        field="createTask"
        (valueChange)="valueChangeAlert($event)"
      >
      </codx-input>
      <span style="margin-left: 10px">
        <codx-label
          name="createTask"
          [formModel]="form.formModel"
          default="Phải được hoàn tất trước khi chuyển công đoạn"
        >
        </codx-label>
      </span>
    </div>
  </div>
</ng-template>
<!-- End Form Group -->

<ng-template #footer>
  <button
    style="float: left"
    type="button"
    class="btn btn-light-primary me-3"
    (click)="addFile($event)"
  >
    <i class="icon-cloud_upload fs-5"></i
    ><span>
      <codx-label
        name="UploadFile"
        formName="Tasks"
        default="Đính kèm"
      ></codx-label>
    </span>
  </button>
  <button type="button" class="btn btn-primary" (click)="saveData()">
    <codx-label name="Save" formName="Sprints" default="Lưu"></codx-label>
  </button>
</ng-template>

<ng-template #showUser let-data="users">
  <div class="mt-3" style="display: block">
    <ng-container *ngFor="let item of data; index as i">
      <div class="user-mini-nav" style="background-color: #f4f7ff">
        <span>
          <codx-img
            [width]="25"
            class="me-2"
            [objectId]="item?.id"
            objectType="AD_Users"
            [objectName]="item?.name"
          ></codx-img>
        </span>
        <span class="text-dark fw-bold"> {{ item?.name }} </span>
        <span class="mt-1">
          <a (click)="onDeleteOwner(item?.id, data)" style="cursor: pointer">
            <span class="icon-close icon-16 text-danger ms-3"></span>
          </a>
        </span>
      </div>
    </ng-container>
  </div>
</ng-template>
