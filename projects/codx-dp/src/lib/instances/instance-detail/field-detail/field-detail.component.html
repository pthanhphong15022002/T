<div class="back-info">
  <div class="header-info py-2 px-4 d-flex align-items-center justify-content-between mb-0">
    <div class="d-flex align-items-center">
      <span class="fs-" *ngIf="titleDefault">
        <codx-label
          name="titleDefault"
          formName="DPInstancesSteps"
          grvName="grvDPInstancesSteps"
          default="{{ titleDefault }}"
        ></codx-label>
      </span>
      <span class="title" *ngIf="!titleDefault">{{ dataStep.stepName }}</span>
    </div>
    <div class="d-flex align-items-center justify-content-end">
      <div class="group-button">
        <button type="button"
          class="btn btn-icon btn-outline-primary"
          *ngIf="dataStep?.stepStatus < 3 && isUpdate && !isClosed"
        >
          <i
            [ngClass]="'icon-edit-one icon-18'"
            (click)="popupCustomField(dataStep.fields)"
          ></i>
        </button>
        <button type="button"
          class="btn btn-icon btn-outline-primary ms-1"
          (click)="clickShow($event, dataStep.recID)"
        >
          <i
            class="icon-expand_less icon-18"
          ></i>
        </button>
      </div>
    </div>
  </div>
  <div id="{{ dataStep.recID }}" class="main" [ngClass]="'show-main'">
    <div
      class="d-flex row class-field m-5"
      *ngIf="dataStep.fields != null && dataStep.fields.length > 0"
    >
      <ng-container *ngFor="let field of dataStep.fields">
        <div
          class="col-{{
            12 / showColumnControl
          }} p-3 has-action-menu crr-fiels mb-5"
        >
          <ng-container
            [ngTemplateOutlet]="viewCustomFields"
            [ngTemplateOutletContext]="{ $implicit: field }"
          ></ng-container>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<ng-template #viewCustomFields let-data>
  <div class="text-gray-700 ms-5">
    {{ data.title }}
  </div>
  <div>
    <span class="place-holder margin-l" *ngIf="!data.dataValue">
      {{ data.title }}
    </span>
    <ng-container *ngIf="data.dataValue">
      <span class="text-dark margin-l" *ngIf="data.dataType == 'T'">
        {{ data.dataValue }}
      </span>

      <span
        class="text-dark margin-l"
        *ngIf="data.dataType == 'N' && data.dataFormat && data.dataValue"
        [innerHTML]="formatNumber(data)"
      >
        <span *ngIf="data.dataFormat == 'P'">%</span>
      </span>
      <span class="text-dark margin-l" *ngIf="data.dataType == 'D'">
        <span
          *ngIf="
            data?.dataFormat == '1' ||
            data?.dataFormat == '2' ||
            data.dataFormat == '3'
          "
        >
          {{ data.dataValue | date : fomatvalue(data.dataFormat) }}</span
        >
        <span *ngIf="data.dataFormat == '4' || data.dataFormat == '5'">
          {{
            getFormatTime(data.dataValue) | date : fomatvalue(data.dataFormat)
          }}</span
        >
      </span>
      <ng-container *ngIf="data.dataType == 'R'">
        <ngb-rating
          [rate]="partNum(data.dataValue)"
          [max]="data?.rank"
          [readonly]="true"
          [starTemplate]="temp"
        >
          <ng-template #temp let-fill="fill" let-index="index">
            <span
              class="rankIcon {{ data?.rankIcon }} filled"
              [class.filled]="fill === 100"
              [class.bad]="index < data?.rank"
            ></span>
          </ng-template>
        </ngb-rating>
      </ng-container>

      <ng-container *ngIf="data.dataType == 'P'">
        <codx-imgs
          [width]="35"
          [objectId]="data.dataValue"
          [objectType]="'AD_Users'"
          [numberImages]="5"
        ></codx-imgs>
      </ng-container>

      <ng-container *ngIf="data.dataType == 'A' && data.dataValue">
        <codx-attachment
          #attachment
          [objectId]="data.dataValue.split(';')[0]"
          [objectType]="data.dataValue.split(';')[1]"
          hideFolder="1"
          hideImageUpload="0"
          hideImageThumb="0"
          hideUploadBtn="1"
          hideDes="1"
          type="inline"
          [allowMultiFile]="data.multiple ? '1' : '0'"
          displayThumb="full"
          showMessage="0"
          [hideDelete]="'1'"
          [hideMoreF]="'0'"
        >
        </codx-attachment>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="dataStep?.stepStatus < 3">
      <codx-mfunc
        [formModel]="formModel"
        (clickMF)="clickMF($event, data)"
        [isBookMark]="true"
        [dataItem]="data"
        [type]="'hover'"
        (changeDataMF)="changeFieldMF($event)"
      >
      </codx-mfunc>
    </ng-container>
  </div>
</ng-template>
