<div id="step-task" class="main p-3" [ngClass]="'show-main'">
   <!-- drap drop công việc ngoài-->
   <div class="main-body" *ngIf="taskGroupList?.length > 0">
     <div
       cdkDropList
       class="list"
       (cdkDropListDropped)="drop($event, taskGroupList, true)"
     >
       <div cdkDropListGroup>
         <ng-container *ngFor="let groupTask of taskGroupList">
           <div
             class="card-job-list"
             cdkDrag
             [cdkDragData]="groupTask"
             [cdkDragStartDelay]="100"
             [cdkDragDisabled]="true"
           >
             <div class="card-job stages-task">
               <div
                 *ngIf="groupTask?.recID"
                 class="d-flex align-items-center justify-content-between card-job-expand"
               >
                 <div
                   class="d-flex justify-content-start align-items-center has-action-menu ps-5 pt-3"
                   style="flex-grow: 1"
                 >
                   <!-- show hiden group task -->
                   <span class="">
                     <button
                       type="button"
                       class="btn btn-icon btn-light-primary"
                       (click)="toggleTask($event, groupTask?.recID)"
                     >
                       <i class="icon-horizontal_rule icon-18"></i>
                     </button>
                   </span>
                   <div class="steplist-hearder ms-3">
                     <div class="text-dark fw-bold fs-6">
                       {{ groupTask?.taskGroupName }}
                     </div>
                     <div class="text-gray-500">
                       <codx-label
                         class="title"
                         fiedName="updateTime"
                         default="Cập nhật:"
                         [formModel]="formModel"
                       >
                       </codx-label>
                       <span>
                         {{
                           groupTask?.modifiedOn || groupTask?.createdOn
                             | date : dateTimeFomat
                         }}</span
                       >
                       <span>, {{ groupTask?.note || "" }}</span>
                     </div>
                   </div>
                 </div>
                 <ng-container
                   [ngTemplateOutlet]="timeAndProgress"
                   [ngTemplateOutletContext]="{ value: {value: groupTask, group: null} }"
                 >
                 </ng-container>
               </div>
               <div
                 *ngIf="!groupTask?.recID"
                 [ngStyle]="
                   groupTask?.task?.length == 0 ? { height: '30px' } : {}
                 "
               ></div>

               <!-- kéo thả ở trong  -->
               <div
                 cdkDropList
                 [cdkDropListData]="groupTask?.task || []"
                 (cdkDropListDropped)="drop($event, groupTask)"
                 [id]="'group' + groupTask?.recID"
                 class="task"
                 [ngStyle]="groupTask?.recID ? { 'margin-left': '50px' } : {'margin-left': '10px'}"
               >
                 <ng-container *ngFor="let task of groupTask?.task">
                   <div
                     cdkDrag
                     [cdkDragStartDelay]="100"
                     [cdkDragData]="task"
                     [cdkDragDisabled]="true"
                     class="drap-drop"
                   >
                     <div
                       class="d-flex align-items-center justify-content-between"
                     >
                       <div style="flex-grow: 1" class="has-action-menu">
                         <div
                           class="d-flex justify-content-start align-items-center"
                         >
                           <!-- icon task -->
                           <div
                             class="icon-container me-3"
                             [ngStyle]="getColor(task)"
                           >
                             <span
                               class="icon-18 text-primary-600"
                               [ngClass]="getIconTask(task)"
                             ></span>
                           </div>
                           <div class="steplist-hearder">
                             <div class="text-dark fw-bold fs-6">
                               <span>{{ task?.taskName }}</span>
                               <span [ngClass]="checkExitsParentID(groupTask?.task, task)"class="h4">*</span
                               >
                             </div>
                             <div class="text-gray-600">
                               <codx-label
                                 class="title"
                                 fiedName="updateTime"
                                 default="Cập nhật:"
                                 [formModel]="formModel"
                               >
                               </codx-label>
                               <!-- <span [innerHTML]="task?.modifiedOn | formatvalue: frmModel : 'ModifiedOn' | async"> -->
                               <!-- <span>{{task?.modifiedOn | formatvalue: frmModel: "modifiedOn"| async}}</span> -->
                               <span>{{task?.modifiedOn || task?.createdOn| date : dateTimeFomat}}
                               </span>
                               <span *ngIf="groupTask?.note">, {{ groupTask?.note }}</span>
                             </div>
                           </div>
                         </div>
                         <div class="ms-5">
                           <codx-attachment
                             hideFolder="1"
                             hideImageUpload="0"
                             hideImageThumb="0"
                             hideUploadBtn="1"
                             hideDes="1"
                             type="inline"
                             allowMultiFile="1"
                             displayThumb="full"
                             showMessage="1"
                           >
                           </codx-attachment>
                         </div>
                       </div>
                       <div>
                         <ng-container
                           [ngTemplateOutlet]="timeAndProgress"
                           [ngTemplateOutletContext]="{ value: {value: task, group: groupTask} }"
                         ></ng-container>
                       </div>
                     </div>
                   </div>
                 </ng-container>
                 <div
                   *ngIf="groupTask?.task?.length === 0"
                   style="height: 10px"
                 ></div>
               </div>
             </div>
           </div>
         </ng-container>
       </div>
     </div>
   </div>
 </div>

 <ng-template #timeAndProgress let-data="value">
   <div class="d-flex align-items-center justify-content-end me-3 time-progress">
     <span class="date" *ngIf="data?.value?.startDate && data?.value?.endDate">
       {{ data?.value?.startDate | date : dateFomat }} -
       {{ data?.value?.endDate | date : dateFomat }}</span
     >
     <div
       class="disabled-inline"
     >
         <codx-update-progress 
            [dataSource]="data?.value" 
            [step]="currentStep"
         ></codx-update-progress>
     </div>
     <span>
       <codx-img
         [width]="25"
         class="me-2"
         [objectId]="getObjectIdRole(data?.value, data?.group)"
         objectType="AD_Users"
         [objectName]="getObjectNameRole(data?.value, data?.group)"
       ></codx-img>
     </span>
     <div class="notify">
       <span class="me-3">
         <codx-attachment-temp [objectID]="data?.value.refID"></codx-attachment-temp>
       </span>
     </div>
     <div class="notify">
       <span class="me-3">
         <codx-comment-temp [objectID]="data?.value.recID"></codx-comment-temp>
       </span>
     </div>
   </div>
 </ng-template>
