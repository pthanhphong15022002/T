<codx-form #form [headerText]="headerText" [subHeader]="subHeader" [body]="body" [formModel]="formModel"
  [footer]="footer" [dialog]="dialog" [data]="instancesStepOld"></codx-form>

<ng-template #subHeader>

</ng-template>
<ng-template #body>
  <div class="title-step mt-3">
    <div class="fs-5 text-primary">{{ stepName }}</div>
  </div>
  <div class="content-step mt-2">
    <ng-container [ngTemplateOutlet]="test"></ng-container>
    <div class="form-group">
      <div>
        <codx-label fiedName="owner" [formModel]="form.formModel" default="Phân bổ lại cho">
        </codx-label>
      </div>
      <div *ngIf="stepCurrent != null">
        <codx-popup-participants [lstParticipants]="lstParticipants" [dialog]="dialog" [isType]="'I'"
          (eventUser)="eventUser($event)" [owner]="owner"></codx-popup-participants>
      </div>
    </div>
    <div class="form-group">
      <div>
        <codx-label fiedName="ActualEnd" [formModel]="form.formModel" [Group]="form.formGroup"
          default="Ngày hoàn thành thực tế">
        </codx-label>
      </div>
    <codx-input
    type="datetime"
    class="test-datetime"
    field="actualEnd"
    format="d"
    [crrValue]="instancesStepOld.actualEnd"
    (valueChange)="changeTime($event)"
  >
  </codx-input>
    </div>

    <div class="form-group">
      <div>
        <codx-label fiedName="Note" [formModel]="form.formModel" [Group]="form.formGroup" default="Ghi chú">
        </codx-label>
      </div>
      <codx-input type="textarea" field="note" [crrValue]="instancesStepOld?.note"
        (valueChange)="valueChange($event)">
      </codx-input>
    </div>
    <div class="form-group" *ngIf="!!listTree">
      <div>
        <div class="d-flex justify-content-between align-items-center">
          <div class="w-100">
            <codx-label fiedName="TaskGroups" [formModel]="form.formModel" [Group]="form.formGroup"
            default="Công việc chưa hoàn tất">
          </codx-label>
          </div>
        </div>
        <div class="pt-5 ms-6">
          <div class="accordion" id="accordion1">
            <codx-step-task
              [dataSources]="instancesStepOld"
              [isSaveProgress]="false"
              [isLockSuccess]="true"
              [typeProgress]="2"
              (valueChangeProgress)="changeProgress($event)"
<<<<<<< HEAD
              [isShowButton]="false"
              [isShowMore]="false"
            ></codx-step-task>
=======
            ></codx-task>
>>>>>>> 7b35195bdf0df2d562fff94cc1e7ff8dbb851e5a
          </div>
        </div>
      </div>
    </div>

    <div class="form-group" *ngIf="fieldsNull?.length > 0">
      <div>
        <div class="d-flex justify-content-end">
          <div class="me-auto">
            <codx-label fiedName="Fields" [formModel]="form.formModel" [Group]="form.formGroup"
            default="Trường tùy chỉnh">
          </codx-label>
          </div>
        </div>
        <div class="pt-5">
            <ng-container *ngFor="let item of fieldsNull">
                <codx-input-custom-field
                  [customField]="item"
                  [checkValid]="true"
                  [objectId]="item.recID"
                  [objectType]="'DP_Instances'"
                  [formModel]="dialog.formModel"
                  (valueChangeCustom)="valueChangeCustom($event)"
                >
                </codx-input-custom-field>
            </ng-container>
        </div>
      </div>
    </div>

  </div>
</ng-template>

<ng-template #footer>
  <div class="d-flex justify-content-end">
    <div class="" id="buttonSave">
      <button type="button" class="btn btn-primary ms-1" [disabled]="isLockStep" (click)="onSave()">
        <codx-label name="Save" [formModel]="form.formModel" [Group]="form.formGroup" default="Lưu">
        </codx-label>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #test>
  <div class="form-group">
    <codx-label fiedName="stepID" formName="Instances" gridViewName="grvInstances" default="Giai đoạn chuyển đến">
    </codx-label>
    <ejs-combobox [dataSource]="listStepsCbx" [fields]="fieldCbxStep" [value]="stepIdClick"
    [allowFiltering]="true" [readonly]="false" (valueChange)="cbxChange($event)"></ejs-combobox>
  </div>
</ng-template>

<ng-template #popupParticipants let-dialog>
  <codx-popup-participants [lstParticipants]="lstParticipants" [dialog]="dialog" [isType]="'I'"
    (eventUser)="eventUser($event)"></codx-popup-participants>
</ng-template>
