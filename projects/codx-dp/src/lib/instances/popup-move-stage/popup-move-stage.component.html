<codx-form #form [headerText]="headerText" [subHeader]="subHeader" [body]="body" [formModel]="formModel"
  [footer]="footer" [dialog]="dialog" [data]="instancesStepOld"></codx-form>

<ng-template #subHeader>
  <span>{{ stepName }}</span>
</ng-template>
<ng-template #body>
  <div class="title-step pb-12"></div>
  <div class="content-step">
    <ng-container [ngTemplateOutlet]="test"></ng-container>
    <div class="form-group">
      <div>
        <codx-label fiedName="owner" [formModel]="form.formModel" default="Phân bổ lại cho">
        </codx-label>
      </div>
      <div *ngIf="stepCurrent != null">
        <codx-popup-participants [lstParticipants]="lstParticipants" [dialog]="dialog" [isType]="'I'"
          (eventUser)="eventUser($event)" [owner]="owner"></codx-popup-participants>
      </div>
    </div>
    <div class="form-group">
      <div>
        <codx-label fiedName="ActualEnd" [formModel]="form.formModel" [Group]="form.formGroup"
          default="Ngày hoàn thành thực tế">
        </codx-label>
      </div>

      <codx-input [formModel]="form.formModel" field="actualEnd" [Group]="form.formGroup"
        (valueChange)="valueChange($event)">
      </codx-input>
    </div>

    <div class="form-group">
      <div>
        <codx-label fiedName="Memo" [formModel]="form.formModel" [Group]="form.formGroup" default="Ghi chú">
        </codx-label>
      </div>
      <codx-input [formModel]="form.formModel" [Group]="form.formGroup" field="memo"
        (valueChange)="valueChange($event)">
      </codx-input>
    </div>

    <div class="form-group">
      <div>
        <div class="d-flex justify-content-end">
          <div class="me-auto">
            <codx-label fiedName="taskGroups" [formModel]="form.formModel" [Group]="form.formGroup"
            default="Công việc chưa hoàn tất">
          </codx-label>
          </div>
          <div>
            <codx-label fiedName="taskGroups" [formModel]="form.formModel" [Group]="form.formGroup"
            default="Hoàn thành tất cả">
          </codx-label>
          </div>
          <div class="ps-2">
            <!-- <codx-input type="checkbox"  class="rounded-circle" [checked]="true"
            (valueChange)="checkAllValue($event)">

          </codx-input> -->
            <input
            class="form-check-input rounded-circle"
            type="checkbox"
            [checked]="isCheckAll"
            (change)="checkAllValue($event,'all','custom')"

            />
          </div>
        </div>
        <div class="pt-5">
          <div class="accordion" id="accordion1">
            <ng-container *ngFor="let item of listTree; let i = index">
              <div *ngIf="item.taskGroupID === null; else taskGroup">
                <ol class="list-unstyled" >
                  <li>
                    <div class="d-flex justify-content-start pb-1">

                      <div
                      class="icon-container"
                      [ngStyle]="getColor(item)"
                    >
                      <span
                        class="icon-18 text-primary-600 py-2"
                        [ngClass]="getIconTask(item)"
                      ></span>
                    </div>
                      <div class="ps-5 mt-3">
                        {{item.taskName}}
                        <span style="color: red;" *ngIf="item.requireCompleted" >*</span>
                      </div>
                      <div class="ms-auto">
                        <div class="d-flex justify-content-end">
                          <div>
                            <codx-imgs [isToolTip]="true" [width]="25"   [objectId]="item?.roles[0]?.objectID" ojectType="AD_Users" [numberImages]="1">
                            </codx-imgs>
                          </div>
                          <div class="notify">
                            <span class="me-3">
                              <codx-attachment-temp [objectID]="item.refID"></codx-attachment-temp>
                            </span>
                          </div>
                          <div class="notify">
                            <span class="me-3">
                              <codx-comment-temp [objectID]="item.recID"></codx-comment-temp>
                            </span>
                          </div>
                          <div>
                            <input
                            class="form-check-input rounded-circle"
                            type="checkbox"
                            [checked]="isCheckAll"
                            (change)="checkAllValue($event,item,'task')"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                </ol>
              </div>
              <ng-template #taskGroup>
                <ol class="list-unstyled" >
                  <li>
                    <div class="d-flex justify-content-start pb-1">
                      <button class="btn btn-outline-secondary btnCustom" style="cursor: pointer;"
                      id="open"
                      type="button"
                      (click)="myFunction($event,i)"
                      ><i [id]="'parent'+i" [class]="item.children.length > 0 ?'icon-remove':'icon-add' " style="padding: 0.35rem;"></i> </button>
                      <div class="ps-5 mt-1">
                        {{item.taskGroupName}}

                      </div>
                      <div class="ms-auto">
                        <div class="d-flex justify-content-end">
                          <div>
                           <codx-imgs [isToolTip]="true" [width]="25"   [objectId]="item?.roles[0]?.objectID" ojectType="AD_Users" [numberImages]="1">
                            </codx-imgs>
                          </div>
                          <div class="notify">
                            <span class="me-3">
                              <codx-attachment-temp [objectID]="item.refID"></codx-attachment-temp>
                            </span>
                          </div>
                          <div class="notify">
                            <span class="me-3">
                              <codx-comment-temp [objectID]="item.recID"></codx-comment-temp>
                            </span>
                          </div>
                          <div>
                            <input
                            class="form-check-input rounded-circle"
                            type="checkbox"
                            [checked]="isCheckAll"
                            (change)="checkAllValue($event,item,'taskGroup')"

                            />
                          </div>
                        </div>
                      </div>
                    </div>
                      <ul class="tree ms-3 show" [id]="'children'+i" >
                        <ng-container *ngFor="let task of item.children">
                          <li >
                            <div class="d-inline-block" style="width: 96%;">
                                <div class="d-flex justify-content-start">
                                  <div
                                  class="icon-container"
                                  [ngStyle]="getColor(task)"
                                >
                                  <span
                                    class="icon-18 text-primary-600 py-2"
                                    [ngClass]="getIconTask(task)"
                                  ></span>
                                </div>
                                  <div class="ps-5 mt-1"> {{task.taskName}}
                                    <span style="color: red;" *ngIf="task.requireCompleted" >*</span>
                                  </div>
                                  <div class="ms-auto">
                                    <div class="d-flex justify-content-end">
                                      <div>
                                        <codx-imgs [isToolTip]="true" [width]="25"   [objectId]="task?.roles[0]?.objectID" ojectType="AD_Users" [numberImages]="1">
                                        </codx-imgs>
                                      </div>
                                      <div class="notify">
                                        <span class="me-3">
                                          <codx-attachment-temp [objectID]="task.refID"></codx-attachment-temp>
                                        </span>
                                      </div>
                                      <div class="notify">
                                        <span class="me-3">
                                          <codx-comment-temp [objectID]="task.recID"></codx-comment-temp>
                                        </span>
                                      </div>
                                      <div>
                                        <input
                                        class="form-check-input rounded-circle"
                                        type="checkbox"
                                        [checked]="isCheckAll"
                                        (change)="checkAllValue($event,task,'task')"

                                        />
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                          </li>
                        </ng-container>
                      </ul>
                  </li>
                </ol>


              </ng-template>
             </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #footer>
  <div class="d-flex justify-content-end">
    <div class="" id="buttonSave">
      <button type="button" class="btn btn-primary ms-1" [disabled]="isLockStep" (click)="onSave()">
        <codx-label name="Save" [formModel]="form.formModel" [Group]="form.formGroup" default="Lưu">
        </codx-label>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #test>
  <div class="form-group">
    <codx-label fiedName="stepID" formName="Instances" gridViewName="grvInstances" default="Giai đoạn chuyển đến">
    </codx-label>
    <ejs-combobox [dataSource]="listStepsCbx" [fields]="fieldCbxStep" [value]="stepIdClick"
      (valueChange)="cbxChange($event)"></ejs-combobox>
  </div>
</ng-template>

<ng-template #popupParticipants let-dialog>
  <codx-popup-participants [lstParticipants]="lstParticipants" [dialog]="dialog" [isType]="'I'"
    (eventUser)="eventUser($event)"></codx-popup-participants>
</ng-template>
