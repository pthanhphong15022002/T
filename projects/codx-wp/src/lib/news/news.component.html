<div class="codx-news" *ngIf="loaded">
  <codx-views #view  idField="recID" [views]="views">
  </codx-views>
  <div class="more-function">
    <div class="d-flex flex-column">
      <a (click)="openPopupSearch()" class="btn btn-icon btn-primary"><i class="icon-search fs-1"></i></a>
      <ng-container *ngIf="userPermission && userPermission.create">
        <span class="postnews mt-3" >
          <a class="btn btn-icon btn-primary"><i class="icon-add fs-1"></i></a>
          <div class="d-flex btn-postnews">
            <a (click)="openPopupAdd(NEWSTYPE.VIDEO)" class="btn btn-icon btn-primary me-3"><i
                class="icon-video_call fs-1"></i></a>
            <a (click)="openPopupAdd(NEWSTYPE.POST)" class="btn btn-icon btn-primary"><i
                class="icon-post_add fs-1"></i></a>
          </div>
        </span>
      </ng-container>
    </div>
  </div> 
</div>

<ng-template #panelLeftRef>
  <div class="fix-container rounded-4 position-relative">
    <div class="row">
      <div class="fw-bold text-dark fs-2 mt-5 mb-5 border-bottom border-gray">
        <codx-label [formModel]="view.formModel" name="lblNews" default="Tin mới nhất"></codx-label>
      </div>
    </div>
    <div class="row ">
      <div class="col-6 hot-left">
        <ng-container *ngIf="loaded && posts[0];else tmpEmptyNews1">
          <div class="post" (click)="clickViewDetail(posts[0])">
            <div class="w-100 position-relative cursor-pointer">
              <codx-img 
                imageType="square" 
                [isDefaulImg]="true" 
                [cssClass]="'image-300 w-100 pic-newshot'" 
                [width]="480"
                [objectId]="posts[0].recID" 
                [objectType]="'WP_News'"
                [referType]="'image'">
              </codx-img>
              <div *ngIf="posts[0].category" class="position-absolute bottom-0 end-0">
                <codx-vll 
                    [name]="'WP002'" 
                    [classList]="'badge badge-danger p-2 px-4 text-center'"
                    [value]="posts[0].category" 
                    [showText]="true">
                </codx-vll>
              </div>
            </div>
            <div class="fs-4 fw-bolder mt-2 news-title cursor-pointer">
              {{ posts[0].subject | maxlenght:150}}
            </div>
          </div>
          <div class="text-gray-700 mt-1">
            {{posts[0].subContent | maxlenght:500}}
          </div>
          <div class="d-flex justify-content-between fs-7 mt-3">
            <span *ngIf="posts[0].approveStatus == '1'">
              <codx-vll 
                  [name]="'CO003'" 
                  [classList]="'rounded-pill p-2 px-4 text-center'"
                  [value]="posts[0].approveStatus" 
                  [showText]="true" 
                  [showBgColor]="true">
              </codx-vll>
            </span>
            <span class="text-gray-400">
              {{ posts[0].createdOn | formatvalue:view.formModel:"CreatedOn" | async}}
            </span>
          </div>
        </ng-container>
      </div>
      <div class="col-6 hot-right">
        <div *ngIf="loaded && posts[1];else tmpEmptyNews2" class="row mb-5 post" (click)="clickViewDetail(posts[1])">
          <div class="col-4">
            <div class="w-100 position-relative cursor-pointer">
              <codx-img 
                imageType="square" 
                [isDefaulImg]="true" 
                [width]="180" 
                [cssClass]="'image w-100'" 
                [objectId]="posts[1].recID"
                [objectType]="'WP_News'" 
                [referType]="'image'">
              </codx-img>
              <div *ngIf="posts[1].category" class="position-absolute bottom-0 end-0">
                <codx-vll 
                    [name]="'WP002'" 
                    [classList]="'badge badge-danger p-2 px-4 text-center'"
                    [value]="posts[1].category" 
                    [showText]="true">
                </codx-vll>
              </div>
            </div>
          </div>
          <div class="col-8">
            <div class="fs-5 fw-bold news-title cursor-pointer">
              {{ posts[1].subject | maxlenght:100}}
            </div>
            <div class="text-gray-700 news-des line-clamp line-clamp-3">
              {{posts[1].subContent | maxlenght:300}}
            </div>
            <div class="d-flex justify-content-between fs-7 mt-3">
              <span *ngIf="posts[1].approveStatus == '1'">
                <codx-vll 
                    [name]="'CO003'" 
                    [classList]="'rounded-pill p-2 px-4 text-center'"
                    [value]="posts[1].approveStatus" 
                    [showText]="true" 
                    [showBgColor]="true">
                </codx-vll>
              </span>
              <span class="text-gray-400">
                {{ posts[1].createdOn | formatvalue:view.formModel:"CreatedOn" | async}}
              </span>  
            </div>
          </div>
        </div>
        <div *ngIf="loaded && posts[2];else tmpEmptyNews2" class="row mb-5 post" (click)="clickViewDetail(posts[2])">
          <div class="col-4 ">
            <div class="w-100 position-relative cursor-pointer">
              <codx-img [width]="180" 
                [isDefaulImg]="true" 
                imageType="square" 
                [cssClass]="'image w-100'" 
                [objectId]="posts[2].recID"
                [objectType]="'WP_News'" 
                [referType]="'image'">
              </codx-img>
              <div *ngIf="posts[2].category" class="position-absolute bottom-0 end-0">
                <codx-vll 
                    [name]="'WP002'" 
                    [classList]="'badge badge-danger p-2 px-4 text-center'"
                    [value]="posts[2].category" 
                    [showText]="true">
                </codx-vll>
              </div>
            </div>
          </div>
          <div class="col-8">
            <div class="fs-5 fw-bold news-title cursor-pointer">
              {{ posts[2].subject | maxlenght:70}}
            </div>
            <div class="text-gray-700 news-des line-clamp line-clamp-3">
              {{posts[2].subContent | maxlenght:300}}
            </div>
            <div class="d-flex justify-content-between fs-7 mt-3">
              <span *ngIf="posts[0].approveStatus == '1'">
                <codx-vll 
                    [name]="'CO003'" 
                    [classList]="'rounded-pill p-2 px-4 text-center'"
                    [value]="posts[2].approveStatus" 
                    [showText]="true" 
                    [showBgColor]="true">
                </codx-vll>
              </span>
              <span class="text-gray-400">
                {{ posts[2].createdOn | formatvalue:view.formModel:"CreatedOn" | async}}
              </span>  
            </div>
          </div>
        </div>
        <div *ngIf="loaded && posts[3];else tmpEmptyNews2" class="row mb-1 post" (click)="clickViewDetail(posts[3])">
          <div class="col-4 ">
            <div class="w-100 position-relative cursor-pointer">
              <codx-img 
                [width]="180" 
                [isDefaulImg]="true" 
                imageType="square" 
                [cssClass]="'image w-100'" 
                [objectId]="posts[3].recID"
                [objectType]="'WP_News'" 
                [referType]="'image'">
              </codx-img>
              <div *ngIf="posts[3].category"  class="position-absolute bottom-0 end-0">
                <codx-vll 
                    [name]="'WP002'" 
                    [classList]="'badge badge-danger p-2 px-4 text-center'"
                    [value]="posts[3].category" 
                    [showText]="true">
                </codx-vll>
              </div>
            </div>
          </div>
          <div class="col-8">
            <div class="fs-5 fw-bold news-title cursor-pointer">
              {{ posts[3].subject | maxlenght:70}}
            </div>
            <div class="text-gray-700 news-des line-clamp line-clamp-3">
              {{posts[3].subContent | maxlenght:300}}
            </div>
            <div class="d-flex justify-content-between fs-7 mt-3">
              <span>
                <codx-vll 
                    [name]="'CO003'" 
                    [classList]="'rounded-pill p-2 px-4 text-center'"
                    [value]="posts[3].approveStatus" 
                    [showText]="true" 
                    [showBgColor]="true">
                </codx-vll>
              </span>
              <span class="text-gray-400">
                {{ posts[3].createdOn | formatvalue:view.formModel:"CreatedOn" | async}}
              </span>  
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row my-8" style="height: 300px;">
      <ng-container *ngIf="videos.length > 0; else tmpEmptyListVideo">
        <ng-container *ngIf="slides.length > 0">
          <ngb-carousel #carousel 
            (slide)="slideChange($event)"  
            [pauseOnFocus]="true"
            [pauseOnHover]="true"
            [wrap]="false" 
            [keyboard]="false" 
            [showNavigationIndicators]="false" 
            [showNavigationArrows]="showNavigation">
            <ng-template ngbSlide *ngFor="let slide of slides">
              <div class="slide-item">
                <div class="silde-item-block">
                  <ng-container *ngFor="let item of slide">
                    <div (click)="clickViewDetail(item)" class="video">
                      <div class="video-block">
                        <codx-img 
                          [isDefaulImg]="true" 
                          [width]="250" 
                          imageType="square" 
                          [objectId]="item.recID"
                          objectType="WP_News" 
                          [referType]="'image'">
                        </codx-img>
                        <span class="video-title">{{item.subject | maxlenght:200 }}</span>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </ng-template>
          </ngb-carousel>
        </ng-container>
      </ng-container>
    </div>
    <div class="news-group">
      <codx-listview #listview 
        [service]="'WP'"
        [assemblyName]="'ERM.Business.WP'" 
        [className]="'NewsBusiness'" 
        [method]="'GetPostByCategoryAsync'"
        entityName="WP_News" 
        [selectFirst]="false"
        [dataValue]="category"
        [emptyTemplate]="null"
        [itemTemplate]="itemTemplate" 
        [formModel]="view.formModel">
    </codx-listview>
    </div>
  </div>
</ng-template>
<ng-template #itemTemplate let-item>
  <ng-container *ngIf="item.type;else content">
    <div class="row">
      <span *ngIf="item.type=='home';else oldValue" class="fw-bolder fs-2">{{item.subject}}</span>
      <ng-template #oldValue>
        <div class="">
          <codx-label [classList]="'fw-bold text-dark fs-2'" [formModel]="view.formModel"  default="Tin cũ hơn"></codx-label>
        </div>
      </ng-template>
    </div>
  </ng-container>
  <ng-template #content>
    <div (click)="clickViewDetail(item)" class="row my-4 post">
      <div class="col-2">
        <codx-img [width]="180" 
          [isDefaulImg]="true" 
          [cssClass]="'image-150 w-100'" 
          imageType="square" 
          [objectId]="item.recID"
          objectType="WP_News" [referType]="'image'">
        </codx-img>
      </div>
      <div class="col-10 d-flex flex-wrap">
        <div>
          <span class="d-block news-title fs-5 mt-2 fw-bolder ">{{item.subject}}</span>
          <span class="d-block text-gray-700 mt-1">
            {{item.subContent | maxlenght:500}}
          </span>
        </div>
        <div class="w-100 text-end fs-7 text-gray-400">{{ item.createdOn | fmDT }}</div>
      </div>
    </div>
  </ng-template> 
</ng-template>
<ng-template #tmpEmptyNews1>
  <div>
    <div>
      <img class="w-100 h-320px" src="/assets/themes/wp/default/img/Image_NoData.svg" />
    </div>
    <div>
      <div class="fw-bolder">{{mssgWP025}}</div>
      <div class="">{{mssgWP026}}</div>
      <div class="d-flex justify-content-end fs-7 text-gray-400 mt-1">dd/mm/yyyy</div>
    </div>
  </div>
</ng-template>
<ng-template #tmpEmptyNews2>
  <div class="row my-2">
    <div class="col-4">
      <img class="w-100 h-100px" src="/assets/themes/wp/default/img/Image_NoData.svg"/>
    </div>
    <div class="col-8">
      <div class="fw-bolder">{{mssgWP025}}</div>
      <div class="">{{mssgWP026}}</div>
      <div class="d-flex justify-content-end fs-7 text-gray-400 mt-1">dd/mm/yyyy</div>
    </div>
  </div>
</ng-template>
<ng-template #tmpEmptyListVideo>
  <div class="d-flex justify-content-between w-100 h-100">
    <div>
      <div class="w-100 video">
        <img style="width:300px; height: 200px;" src="/assets/themes/wp/default/img/Image_NoData.svg"/>
      </div>
      <div class="mt-2">
        <div class="fw-bolder">{{mssgWP025}}</div>
      </div>
    </div>
    <div>
      <div class="w-100 video">
        <img style="width:300px; height: 200px;" src="/assets/themes/wp/default/img/Image_NoData.svg"/>
      </div>
      <div class="mt-2">
        <div class="fw-bolder">{{mssgWP025}}</div>
      </div>
    </div>
    <div>
      <div class="w-100 video">
        <img style="width:300px; height: 200px;" src="/assets/themes/wp/default/img/Image_NoData.svg"/>
      </div>
      <div class="mt-2">
        <div class="fw-bolder">{{mssgWP025}}</div>
      </div>
    </div>
  </div>
</ng-template>