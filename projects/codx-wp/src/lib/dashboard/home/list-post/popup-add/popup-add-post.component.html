<codx-form
 [headerText]="headerText" 
 [body]="body" 
 [footer]="footer" 
 [dialog]="dialogRef">
</codx-form>
<ng-template #body>
    <div class="body body-addpost">
        <div class="d-flex">
            <div class="body-user-img me-2">
                <codx-img 
                    [objectId]="data.createdBy" 
                    [objectName]="data.createdName"
                    objectType="AD_Users" 
                    [width]="40">
                </codx-img>
            </div>
            <div class="d-flex flex-column">
                <div class="d-flex align-items-center">
                    <div class="user-name fw-bolder me-2">
                        <span>{{data.createdName}}</span>
                    </div>
                    <ng-container *ngIf="data.tagName">
                        <ng-container
                            *ngTemplateOutlet="templateTags; context: { $implicit: data }">
                        </ng-container>
                    </ng-container>
                </div>
                <div class="d-flex align-items-center justify-content-start ">
                    <ng-container *ngIf="data.shareControl">
                        <div (click)="openControlShare(controlShare)" class="bg-gray-200 rounded-1 px-1 d-flex align-items-center">
                            <codx-vll 
                                [name]="'WP001'" 
                                [value]="data.shareControl" 
                                [showText]="true" 
                                [className]="'fw-bolder'"
                                [showIcon]="true" 
                                [path]="'assets/themes/sys/default/img/'"
                                [icoCss]="'symbol-12px symbol-circle'"  
                                [showBgColor]="true">
                            </codx-vll>
                            <i class="icon-arrow_drop_down icon-18 text-dark"></i> 
                        </div>
                    </ng-container>
                    <ng-container *ngIf="data.shareName">
                        <div class="ms-2">
                            <ng-container
                                *ngTemplateOutlet="templateShares; context: { $implicit: data }">
                            </ng-container>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
        <div class="addpost-scroll">
            <!-- text -->
            <div>
                <codx-input 
                    format="ed3" 
                    [class]="'border-none'" 
                    type="textarea" 
                    [crrValue]="data.content" 
                    [placeholder]="placeholderText"
                    (valueChange)="valueChange($event)">
                </codx-input>
            </div>
            <!-- files -->
            <div>
                <ng-container *ngIf="status == 'edit';else codxFileNew">
                    <codx-file #codxFile 
                        [objectID]="data.recID" 
                        [edit]='true' 
                        [funcID]="dialogRef.formModel.funcID"
                        (evtAddFile)="addFile($event)"
                        (evtRemoveFile)="removeFile($event)">
                    </codx-file>
                </ng-container>
                <ng-template #codxFileNew>
                    <codx-file 
                        #codxFile
                        [isNew]="true" 
                        [funcID]="dialogRef.formModel.funcID"
                        (evtRemoveFile)="removeFile($event)" 
                        (evtAddFile)="addFile($event)" 
                        [edit]='true'>
                    </codx-file>
                </ng-template>
            </div>
            <!-- template chia sẻ -->
            <ng-container *ngIf="data.shares">
                <div class="border-start border rounded-3">
                    <div>
                        <ng-container [ngSwitch]="data.refType">
                            <!-- chia sẻ bài viết -->
                            <ng-container *ngSwitchCase="'WP_Comments'">
                                <ng-container
                                    *ngTemplateOutlet="templateSharePost; context: { $implicit: data.shares }">
                                </ng-container>
                            </ng-container>
                            <!-- chia sẻ tin tức sự kiện -->
                            
                            <!-- chia sẻ hệ thống phản hồi -->
                            <ng-container *ngSwitchCase="'FD_Cards'">
                                <ng-container
                                    *ngTemplateOutlet="templateShareCard; context: { $implicit: data.card }">
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </div>
            </ng-container>
        </div>
        <!-- template emoji, tag, uploadFile -->
        <div class="d-flex justify-content-between align-items-center body-function">
            <div class="text-gray-500 fw-bold">
                <codx-label [formModel]="dialogRef.formModel" name="lblMore" default="Thêm vào bài viết">
                </codx-label>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <div class="btn-emoji">
                    <button (click)="clickEmoji()" type="button" data-toggle="tooltip" title="Cảm xúc"
                        class="btn btn-icon btn-md ms-2 btn-emoji">
                        <i class="icon-tag_faces icon-24 text-warning"></i>
                    </button>
                    <ng-container *ngIf="showEmojiPicker">
                        <div class="emoji">
                            <emoji-mart [showSingleCategory]="true" 
                            [showPreview]="false" [set]="emojiMode" [perLine]="7"
                                (emojiSelect)="addEmoji($event)"></emoji-mart>
                        </div>
                    </ng-container>
                </div>
                <div>
                    <button (click)="clickTagsUser()" type="button" data-toggle="tooltip" title="Gắn thẻ"
                        class="btn btn-icon btn-md ms-2">
                        <i class="icon-local_offer icon-24 text-primary"></i>
                    </button>
                </div>
                <div class="btn-upload">
                    <button (click)="clickUploadFile()" type="button" data-toggle="tooltip" title="Hình ảnh"
                        class="btn btn-icon btn-md ms-2 ng-star-inserted">
                        <i class="icon-photo icon-24 text-success"></i>
                        <div class="d-none">
                            <codx-attachment #codxATM 
                                objectType="WP_Comments" 
                                hideFolder="1" 
                                hideUploadBtn="1" 
                                hideDes="1" type="inline"
                                allowExtensions=".jpg,.png" 
                                allowMultiFile="1" 
                                [showMessage]="0" 
                                (fileCount)="getfileCount($event)"
                                [functionID]="dialogRef.formModel.funcID">
                            </codx-attachment>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- template permissions chia sẻ -->
    <ng-template #templateShares let-post>
        <div ngbDropdown class="symbol-more">
            <div ngbDropdownToggle id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="cursor-pointer" [innerHTML]="post.shareName"></span>
            </div>
            <div ngbDropdownMenu class="dropdown-menu p-3" aria-labelledby="dropdownMenuButton">
                <div class="py-2">
                    <codx-label [formModel]="" default="Danh sách người được chia sẻ" class="fw-bolder"></codx-label>
                </div>
                <div class="hr-list-employee">
                    <ng-container *ngFor="let permisison of post.permissions">
                        <ng-container *ngIf="permisison.memberType == '2'">
                        <div class="d-flex align-items-center mt-3">
                            <codx-img 
                                [objectId]="permisison.objectID" 
                                [objectType]="'AD_Users'" 
                                [cssClass]="'me-3'"
                                [objectName]="permisison.objectName" 
                                [width]="30">
                            </codx-img>
                            <span class="ms-2 fs-6">{{permisison.objectName}}</span>
                        </div>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </div>
    </ng-template>
    <!-- template permissions gắn thẻ -->
    <ng-template #templateTags let-post>
        <div ngbDropdown class="symbol-more">
            <div ngbDropdownToggle id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="cursor-pointer" [innerHTML]="post.tagName"></span>
            </div>
            <div ngbDropdownMenu class="dropdown-menu p-3" aria-labelledby="dropdownMenuButton">
                <div class="py-2">
                    <codx-label [formModel]="" default="Danh sách người gắn thẻ" class="fw-bolder"></codx-label>
                </div>
                <div class="hr-list-employee">
                    <ng-container *ngFor="let permisison of post.permissions">
                        <ng-container *ngIf="permisison.memberType == '3'">
                        <div class="d-flex align-items-center mt-3">
                            <codx-img 
                                [objectId]="permisison.objectID" 
                                [objectType]="'AD_Users'" 
                                [cssClass]="'me-3'"
                                [objectName]="permisison.objectName" 
                                [width]="30">
                            </codx-img>
                            <span class="ms-2 fs-6">{{permisison.objectName}}</span>
                        </div>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </div>

    </ng-template>
    <!-- template share bài viết -->
    <ng-template #templateSharePost let-post>
        <div>
            <div class="pic-feed p-4">
                <div class="pic-feed-img">
                    <codx-file [objectID]="post.recID"></codx-file>
                </div>
            </div>
            <div class="text-dark text-feed p-4">
                <p [innerHTML]="post.content"></p>
            </div>
            <div class="d-flex border-top p-4">
                <codx-img 
                    [width]="30" 
                    [objectId]="post.createdBy" 
                    [objectName]="post.createdName" 
                    objectType="AD_Users">
                </codx-img>
                <div class="d-flex flex-column flex-grow-1 ms-2">
                    <div class="d-flex align-items-center">
                        <div class="user-name fw-bolder me-2">
                            <span>{{post.createdName}}</span>
                        </div>
                        <ng-container *ngIf="post.tagName">
                            <ng-container
                                *ngTemplateOutlet="templateTags; context: { $implicit: post }">
                            </ng-container>
                        </ng-container>
                    </div>
                    <div class="d-flex text-info-date">
                        <div class="text-gray-500 me-2">{{post.createdOn | timefrom}}</div>
                        <div class="d-flex align-items-center justify-content-start ">
                            <ng-container *ngIf="post.shareControl">
                                <div class="bg-gray-200 rounded-1 px-1 d-flex align-items-center">
                                    <codx-vll 
                                        [name]="'WP001'" 
                                        [value]="post.shareControl" 
                                        [showText]="true" 
                                        [className]="'fw-bolder'"
                                        [showIcon]="true" 
                                        [path]="'assets/themes/sys/default/img/'"
                                        [icoCss]="'symbol-12px symbol-circle'"  
                                        [showBgColor]="true">
                                    </codx-vll>
                                    <i class="icon-arrow_drop_down icon-18 text-dark"></i> 
                                </div>
                            </ng-container>
                            <ng-container *ngIf="post.shareName">
                                <div class="ms-2">
                                    <ng-container
                                        *ngTemplateOutlet="templateShares; context: { $implicit: post }">
                                    </ng-container>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>
    <!-- template share card -->
    <ng-template #templateShareCard let-card>
        <div>
            
        </div>
    </ng-template>
</ng-template>

<ng-template #footer>
    <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-primary btn-post" (click)="submit()">
            <codx-label formName="WP_Comments" name="lblSubmit"
                [default]="dialogData.status == 'edit'? 'Lưu':'Đăng'">
            </codx-label>
        </button>
    </div>
</ng-template>
<ng-template #controlShare let-dialog>
    <codx-share 
        [dialog]="dialog" 
        [multiple]="false" 
        listName="WP001" 
        (eventApply)="addPerrmissonShares($event)">
    </codx-share>
</ng-template>
<ng-container #controlTag *ngIf="showCBB">
    <codx-combobox-popup 
        [comboboxName]="'Users'" 
        [field]="'tagUser'" 
        [multiple]="true" 
        [width]="width"
        [height]="height" 
        (clickSave)="addPerrmissonTags($event)">
    </codx-combobox-popup>
</ng-container>




  