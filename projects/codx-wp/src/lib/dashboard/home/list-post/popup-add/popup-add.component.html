<codx-form [headerText]="headerText" [body]="body" [footer]="footer" [dialog]="dialogRef">

</codx-form>
<ng-template #body>
    <div class="body body-addpost">
        <div class="d-flex">
            <div class="body-user-img me-2">
                <ng-container *ngIf="dialogData.status == STATUS.EDIT;else tmpUserID">
                    <codx-img [objectId]="dataEdit.createdBy" objectType="AD_Users" [width]="40">
                    </codx-img>
                </ng-container>
                <ng-template #tmpUserID>
                    <codx-img [objectId]="user.userID" objectType="AD_Users" [width]="40">
                    </codx-img>
                </ng-template>
            </div>
            <div class="d-flex flex-column">
                <div class="d-flex align-items-center">
                    <div class="user-name fw-bolder me-2">
                        <ng-container *ngIf="dialogData.status == STATUS.EDIT;else tmpUserName">
                            <span>{{dataEdit.createdName}}</span>
                        </ng-container>
                        <ng-template #tmpUserName>
                            <span>{{user.userName}}</span>
                        </ng-template>
                    </div>
                    <div [innerHTML]="tagWith"></div>
                </div>
                <div class="d-flex align-items-center justify-content-start " (click)="openFormShare(controlShare)">
                    <div class="bg-gray-200 rounded-1 px-1 d-flex align-items-center">
                        <codx-vll 
                            [name]="'L1901'" 
                            [value]="shareControl" 
                            [showText]="true" 
                            [showIcon]="true" 
                            [path]="'assets/themes/sys/default/img/'"
                            [icoCss]="'symbol-12px symbol-circle'"
                            [showBgColor]="true">
                        </codx-vll>
                        <i class="icon-arrow_drop_down icon-18 text-dark"></i> 
                    </div>
                    <div class="ms-2">
                        <div class="fs-6">
                            <span class="me-2" [innerHTML]="shareName"></span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="addpost-scroll">
            <ng-container [ngSwitch]="dialogData.status">
                <ng-container *ngSwitchCase="STATUS.EDIT">
                    <ng-container *ngTemplateOutlet="edit"></ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="STATUS.SHARE">
                    <ng-container *ngTemplateOutlet="share"></ng-container>
                </ng-container>
                <ng-container *ngSwitchDefault>
                    <ng-container *ngTemplateOutlet="create"></ng-container>
                </ng-container>
            </ng-container>

        </div>
        <div class="d-flex justify-content-between align-items-center body-function">
            <div class="text-gray-500 fw-bold">
                <codx-label [formModel]="dialogRef.formModel" name="lblInsertPost" default="Thêm vào bài viết">
                </codx-label>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <div class="btn-emoji">
                    <button (click)="clickEmoji()" type="button" data-toggle="tooltip" title="Cảm xúc"
                        class="btn btn-icon btn-md ms-2 btn-emoji">
                        <i class="icon-tag_faces icon-24 text-warning"></i>
                    </button>
                    <ng-container *ngIf="showEmojiPicker">
                        <div class="emoji">
                            <emoji-mart [showSingleCategory]="true" 
                            [showPreview]="false" [set]="emojiMode" [perLine]="7"
                                (emojiSelect)="addEmoji($event)"></emoji-mart>
                        </div>
                    </ng-container>
                </div>
                <div>
                    <button (click)="clickTagsUser()" type="button" data-toggle="tooltip" title="Gắn thẻ"
                        class="btn btn-icon btn-md ms-2">
                        <i class="icon-local_offer icon-24 text-primary"></i>
                    </button>
                </div>
                <div class="btn-upload">
                    <button (click)="clickUploadFile()" type="button" data-toggle="tooltip" title="Hình ảnh"
                        class="btn btn-icon btn-md ms-2 ng-star-inserted">
                        <i class="icon-photo icon-24 text-success"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #footer>
    <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-primary btn-post" (click)="click()">
            <codx-label formName="WP_Comments" name="lblSubmit"
                [default]="dialogData.status == STATUS.EDIT? 'Lưu':'Đăng'"></codx-label>
        </button>
    </div>
</ng-template>
<ng-template #create>
    <div>
        <codx-input format="ed3" [class]="'border-none'" type="textarea" [crrValue]="message" [placeholder]="title"
            (valueChange)="valueChange($event)">
        </codx-input>
    </div>
    <div>
        <codx-file #codxFileCreated [isNew]="true" [funcID]="dialogRef.formModel.funcID"
            (evtRemoveFile)="removeFile($event)" (evtAddFile)="addFile($event)" [edit]='true'>
        </codx-file>
    </div>
    <div class="d-none">
        <codx-attachment #atmCreate objectType="WP_Comments" hideFolder="1" hideUploadBtn="1" hideDes="1" type="inline"
            allowMultiFile="1" [showMessage]="0" (fileCount)="getfileCount($event)"
            idBrowse="atmCreate" [functionID]="dialogRef.formModel.funcID">
        </codx-attachment>
    </div>
</ng-template>
<ng-template #edit>
    <ng-container *ngIf="dataEdit">
        <div class="row my-3">
            <div>
                <codx-input format="ed3" [class]="'border-none'" type="textarea" [crrValue]="message"
                    [placeholder]="title" (valueChange)="valueChange($event)">
                </codx-input>
            </div>
            <div>
                <codx-file #codxFileEdit 
                    [objectID]="dataEdit.recID" 
                    [edit]='true' 
                    (evtAddFile)="addFile($event)"
                    (evtRemoveFile)="removeFile($event)">
                </codx-file>
            </div>
            <div class="d-none">
                <codx-attachment #atmEdit objectType="WP_Comments" hideFolder="1" hideUploadBtn="1" hideDes="1"
                    type="inline" [showMessage]="0" allowMultiFile="1"
                    (fileCount)="getfileCount($event)" idBrowse="atmEdit" [functionID]="dialogRef.formModel.funcID">
                </codx-attachment>
            </div>
        </div>
    </ng-container>
</ng-template>
<ng-template #share>
    <div>
        <codx-input format="ed3" [class]="'border-none'" type="textarea" [crrValue]="message" [placeholder]="title"
            (valueChange)="valueChange($event)">
        </codx-input>
    </div>
    <div>
        <codx-file #codxFileCreated 
            [funcID]="dialogRef.formModel.funcID" (evtRemoveFile)="removeFile($event)"
            (evtAddFile)="addFile($event)" [edit]='true'>
        </codx-file>
    </div>
    <div class="d-none">
        <codx-attachment #atmCreate objectType="WP_Comments" hideFolder="1" hideUploadBtn="1" hideDes="1" type="inline"
            [showMessage]="0" allowMultiFile="1" (fileCount)="getfileCount($event)"
            idBrowse="atmCreate" [functionID]="dialogRef.formModel.funcID">
        </codx-attachment>
    </div>
    <div class="border-start border rounded-3 p-4">
        <div class="border-0" [class.border]="listFileUpload.length > 0">
            <ng-container *ngIf="!dataShare?.isPortal;else category2">
                <div class="pic-feed">
                    <div class="pic-feed-img">
                        <codx-file [objectID]="dataShare.recID"></codx-file>
                    </div>
                </div>
                <div class="">
                    <ng-container *ngIf="dataShare.refType == 'WP_Comments'; else WP_News">
                        <div class="text-dark text-feed">
                            <p [innerHTML]="dataShare.content"></p>
                        </div>
                    </ng-container>
                    <ng-template #WP_News>
                        <ng-container *ngIf="dataShare.subject || dataShare.subContent">
                            <div class="fw-bold fs-5 mt-3">{{dataShare.subject}}</div>
                            <div>{{dataShare.subContent}}</div>
                            <div class="text-gray-600 fs-7 me-2 mt-1">{{dataShare.createdOn | fmDT}}</div>
                        </ng-container>
                    </ng-template>

                </div>
            </ng-container>
            <ng-template #category2>
                <div class="p-0 m-0">
                    <span class="ion-text-wrap ion-text-justify" [innerHTML]="dataShare?.content"></span>
                </div>
                <div class="card-custom-img bgi-no-repeat"
                    [style.background]="dataShare?.card?.background| backgroundImage:dataShare?.card?.backgroundColor"
                    style="background-size: 100% auto;">
                    <div class="card-body card-custom-img-body ">
                        <div color="bg-transparent" class="ion-margin-vertical padding-start-0">
                            <h2 class="fw-bolder mb-6 mt-3" [ngStyle]="{'color':dataShare?.card?.pattern?.headerColor}">
                                {{dataShare?.card?.cardType | vll:'L1422':'text' | async}}
                            </h2>
                        </div>
                        <div class="d-flex align-items-center ion-wrap mar-auto">
                            <div *ngIf="dataShare?.card.senderID">
                                <codx-img [width]="40" [objectId]=" dataShare?.card?.senderID" objectType="AD_Users">
                                </codx-img>
                            </div>
                            <div style="width: 50px;" class="mar-auto text-center ion-justify-content-between">
                                <img src="../../../../assets/img/mail.png" class="icon-mail ion-margin-top-8" />
                            </div>
                            <div *ngIf="dataShare?.card?.receiverID">
                                <codx-img [width]="40" [objectId]="dataShare?.card?.receiverID" objectType="AD_Users">
                                </codx-img>
                            </div>
                        </div>
                        <div class="text-dark text-feed mt-6">
                            <read-more #readmore2 [content]="dataShare?.card?.situation" [limit]="800"
                                [completeWords]="true">
                            </read-more>
                        </div>


                        <div class="d-flex align-items-center group-hasGift mt-6">

                            <div class="d-flex align-items-center ion-wrap me-2"
                                *ngIf="dataShare?.card?.cardType=='2' || dataShare?.card?.cardType =='3'">
                                <div class="me-2">
                                    <img class="w-30px h-30px"
                                        src="../../../../assets/demos/card/rating/{{ dataShare?.card?.rating | vll:dataShare?.card?.cardType=='2' ?'L1419':'L1424':'icon' | async}}" />
                                </div>
                            </div>
                            <div class="d-flex align-items-center ion-wrap mar-auto"
                                *ngIf="dataShare?.card?.hasGift || dataShare?.card?.hasPoint">
                                <img src="../../../../assets/img/feedback/gift 1.png" *ngIf="dataShare?.card?.hasGift"
                                    class="symbol-image icon-surface1 h-30px me-1" />
                                <img src="../../../../assets/img/feedback/money-1.png" *ngIf="dataShare?.card?.hasPoint"
                                    class="symbol-image icon-money-1 h-30px" />
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
            <ng-container *ngIf="entityName != 'WP_News'">
                <div class="d-flex mb-3 card-border my-2">
                    <codx-img [width]="30" [objectId]="dataShare.createdBy" objectType="AD_Users">
                    </codx-img>
                    <div class="d-flex flex-column flex-grow-1 ms-2">
                        <div class="d-flex align-items-center">
                            <span class="text-gray-800 fw-bold">{{dataShare?.createdName}}</span>
                        </div>
                        <div class="text-info-date">
                            <span class="text-gray-500 me-2">{{dataShare?.createdOn | timefrom}}</span>
                        </div>
                    </div>
                </div>
            </ng-container>

        </div>
    </div>
</ng-template>
<ng-template #controlShare let-dialog>
    <ng-container *ngIf="dialogData.status == STATUS.EDIT;else creat_share">
        <codx-share [dialog]="dialog" [multiple]="false" [dataShare]="dataEdit.permissions"
            (eventApply)="addPerrmisson($event)">
        </codx-share>
    </ng-container>
    <ng-template #creat_share>
        <codx-share [dialog]="dialog" [multiple]="false" listName="WP001" (eventApply)="addPerrmisson($event)">
        </codx-share>
    </ng-template>
</ng-template>
<ng-container #controlTag *ngIf="showCBB">
    <codx-combobox-popup 
        [comboboxName]="'Users'" 
        [field]="'tagUser'" 
        [multiple]="true" 
        [width]="width"
        [height]="height" 
        (clickSave)="addTagsUser($event)">
    </codx-combobox-popup>
</ng-container>