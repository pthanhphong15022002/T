<codx-views #codxViews [views]="views" entityName="WP_Comments" idField="recID">
</codx-views>
<ng-template #panelLeftRef>
  <ng-container *ngIf="isShowCreate">
    <div class="card card-custom post-new" id="postnew">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <codx-img
              [objectId]="user.userID"
              objectType="AD_Users"
              [width]="40"
            >
            </codx-img>
          </div>
          <div class="d-flex flex-column flex-grow-1 share">
            <span
              class="text-gray-500 feed-box box-new share-input"
              (click)="openCreateModal()"
            >
              <codx-label
                class="fw-normal"
                formName="Comments"
                name="lblThinks"
                [default]="title"
              >
              </codx-label>
            </span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
  <div
    class="hover-scroll-overlay-y"
    data-kt-scroll="true"
    data-kt-scroll-activate="true"
    data-kt-scroll-height="auto"
    data-kt-scroll-dependencies="#postnew, .pw-profile, .pw-menu"
    data-kt-scroll-wrappers=".codx-wrapper, .wrapper,#newfeed, .pw-content"
    data-kt-scroll-offset="0"
  >
    <div id="newfeed">
      <codx-listview
        [emptyTemplate]="empty"
        [predicates]="predicate"
        [dataValues]="dataValue"
        [itemTemplate]="tmpPortal"
        #listview
        [funcId]="codxViews.formModel.funcID"
        [service]="service"
        [assemblyName]="assemblyName"
        class="h-100"
        [className]="className"
        [method]="method"
        entityName="WP_Comments"
        [itemTemplateLoading]="templateloading"
        [formModel]="codxViews.formModel"
      >
      </codx-listview>
    </div>
  </div>
</ng-template>

<ng-template #tmpPortal let-item>
  <div class="p-5">
    <div class="d-flex align-items-top">
      <div class="me-3">
        <codx-img
          [objectId]="item.createdBy"
          objectType="AD_Users"
          [width]="40"
        >
        </codx-img>
      </div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="d-flex align-items-center mb-2">
          <span class="text-dark fw-bolder">{{ item.createdName }}</span>
          <div
            *ngIf="item.tag > 0"
            class="ms-2 d-flex align-items-center"
            [autoClose]="'outside'"
            [popoverTitle]="popTitle"
            [ngbPopover]="popContent"
            (click)="getTagUser(item.recID)"
          >
            <div class="tag me-2">
              <img
                class="tag-img"
                src="../../../../assets/img/fed/user-tag.png"
              />
            </div>
            <span class="tag-count">{{ item.tag }}</span>
          </div>
        </div>
        <div class="text-info-date">
          <span class="text-gray-600 fs-7 me-2">{{
            item.createdOn | timefrom
          }}</span>
          <span class="rounded-1 py-1 px-2 bg-gray-200">
            <span class="symbol symbol-circle">
              <img
                class="h-13px w-13px"
                src="assets/themes/sys/default/img/{{
                  item.shareControl | vll: 'L1901':'icon' | async
                }}"
              />
            </span>
            <span class="fs-7">
              {{ item.shareControl | vll: "L1901":"text" | async }}
            </span>
          </span>

          <ng-container *ngIf="item.shareName">
            <span class="ms-2 me-2" [innerHTML]="item.shareName"></span>
          </ng-container>
        </div>
      </div>
      <div class="more">
        <div ngbDropdown class="dropdown">
          <a
            href="javascript:void(0)"
            class="btn btn-clean btn-hover-light-primary btn-sm btn-icon"
            ngbDropdownToggle
            id="dropdownMenuButton1"
            aria-expanded="false"
          >
            <i class="fas fa-ellipsis-h"></i>
          </a>
          <ul ngbDropdownMenu aria-labelledby="dropdownMenuButton1">
            <li *ngIf="item.write">
              <a
                (click)="openEditModal(item)"
                ngbDropdownItem
                href="javascript:void(0)"
              >
                <span class="icon-edit icon-16 me-2"></span>
                <codx-label
                  formName="Comments"
                  name="lblEdit_comments"
                  default="Chỉnh sửa"
                >
                </codx-label>
              </a>
            </li>
            <li *ngIf="item.delete">
              <a
                (click)="removePost(item)"
                ngbDropdownItem
                href="javascript:void(0)"
              >
                <span class="icon-delete icon-16 me-2"></span>
                <codx-label
                  formName="Comments"
                  name="lblDelete_comments"
                  default="Xóa"
                ></codx-label>
              </a>
            </li>
            <li *ngIf="item.share">
              <a
                (click)="openModalShare(item)"
                ngbDropdownItem
                href="javascript:void(0)"
              >
                <span class="icon-share icon-16 me-2"></span>
                <codx-label
                  formName="Comments"
                  name="lblShare_comments"
                  default="Chia sẻ"
                ></codx-label>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!--begin::Bottom-->

    <ng-container *ngIf="item.category == '4'; else shareTemplate">
      <div class="mt-3" [innerHTML]="item.content"></div>
      <div>
        <codx-file
          [objectID]="item.recID"
          objectType="WP_Comments"
          (viewDetail)="clickViewDetail($event)"
        >
        </codx-file>
      </div>
      <ng-container *ngIf="item.refType == 'WP_News'; else templateShare">
        <div class="post mt-3" (click)="naviagte(item.shares)">
          <codx-file
            [objectID]="item.refID"
            (evtGetFiles)="getFiles($event, item)"
          ></codx-file>
        </div>
      </ng-container>
      <ng-template #templateShare>
        <ng-container *ngIf="item.shares; else postShareDeleted">
          <div class="card card-custom mt-3">
            <div class="border border-1 rounded-3 p-3">
              <ng-container
                *ngTemplateOutlet="
                  containTemplate;
                  context: { $implicit: item.shares }
                "
              >
              </ng-container>
              <div class="mt-3">
                <div class="d-flex">
                  <div class="me-3">
                    <codx-img
                      slot="start"
                      [objectId]="item.shares.createdBy"
                      objectType="AD_Users"
                      [width]="30"
                    >
                    </codx-img>
                  </div>
                  <div class="d-flex flex-column flex-grow-1">
                    <span class="text-dark fw-bolder">{{
                      item.shares.createdName
                    }}</span>
                    <span class="text-gray-500 fs-7">{{
                      item.shares.createdOn | timefrom
                    }}</span>
                  </div>
                </div>
                <div [innerHTML]="item.shares.content" class="mt-3"></div>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-template #postShareDeleted>
          <div class="card card-custom card-border border border-1 mt-3">
            <div class="card-body p-5">
              <div class="d-flex">
                <div class="me-3">
                  <codx-img
                    slot="start"
                    objectId=""
                    objectType="AD_Users"
                    [width]="30"
                  >
                  </codx-img>
                </div>
                <div class="d-flex flex-column flex-grow-1">
                  <codx-label
                    formModel=""
                    name="lblPostDeleted"
                    default="Bài viết không còn tồn tại"
                  >
                  </codx-label>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </ng-template>

      <!-- end share -->
    </ng-container>
    <ng-template #shareTemplate>
      <div class="my-3">
        <div [innerHTML]="item.content"></div>
      </div>
      <ng-container
        *ngTemplateOutlet="containTemplate; context: { $implicit: item }"
      ></ng-container>
    </ng-template>

    <!-- <treeview-comment
      [funcID]="codxViews.formModel.funcID"
      [objectType]="codxViews.formModel.entityName"
      [rootData]="item.listComment"
      [dataComment]="item"
      (pushComment)="pushComment($event)"
    >
    </treeview-comment> -->
    <codx-comments
      [funcID]="codxViews.formModel.funcID"
      [objectType]="codxViews.formModel.entityName"
      [rootData]="item.listComment"
      [dataComment]="item"
      (pushComment)="pushComment($event)">
    </codx-comments>
  </div>
</ng-template>

<!-- content body -->
<ng-template #containTemplate let-item>
  <ng-container *ngIf="!item.isPortal; else category2">
    <div class="pic-feed">
      <ng-container *ngIf="item.files; else get">
        <div>
          <codx-file
            [lstFile]="item.files"
            (evtGetFiles)="getFiles($event, item)"
            (viewDetail)="clickViewDetail($event)"
          ></codx-file>
        </div>
      </ng-container>
      <ng-template #get>
        <div class="pic-feed-img">
          <codx-file
            [objectID]="item.recID"
            (evtGetFiles)="getFiles($event, item)"
            (viewDetail)="clickViewDetail($event)"
          ></codx-file>
        </div>
      </ng-template>
    </div>
  </ng-container>
  <ng-template #category2>
    <ng-container
      *ngIf="
        item?.card?.cardType == '4' || item?.card?.cardType == '5';
        else haveBg
      "
    >
      <div class="p-0 m-0">
        <read-more
          [content]="item?.content"
          [textColor]="item?.card?.pattern?.textColor"
          [maxmimun]="1003"
          [limit]="1000"
          [completeWords]="true"
        >
        </read-more>
      </div>
    </ng-container>
    <ng-template #haveBg>
      <div class="p-0 m-0">
        <read-more
          [content]="item?.content"
          [maxmimun]="1003"
          [limit]="1000"
          [completeWords]="true"
        >
        </read-more>
      </div>
      <div
        class="d-flex flex-column flex-grow-1 justify-content-center align-items-center pt-5"
      >
        <div
          class="card-img w-300px h-450px"
          [style.background]="
            item.card?.background | backgroundImage: item.card?.backgroundColor
          "
          style="background-size: 100% auto"
        >
          <div class="card-body text-center">
            <div color="bg-transparent" class="text-center">
              <h2
                class="fw-bolderer mb-6 mt-3"
                [ngStyle]="{ color: item?.card?.pattern?.headerColor }"
              >
                {{ item.card?.cardType | vll: "L1422":"text" | async }}
              </h2>
            </div>
            <div class="d-flex justify-content-center align-items-center">
              <div *ngIf="item?.card">
                <codx-img
                  [width]="40"
                  [objectId]="item?.card?.senderID"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
              <div
                style="width: 50px"
                class="mar-auto text-center ion-justify-content-between"
              >
                <img
                  src="/assets/themes/fd/default/img/img_SendCard.svg"
                  class="icon-mail ion-margin-top-8"
                />
              </div>
              <div *ngIf="item?.card?.receiverID">
                <codx-img
                  [width]="40"
                  [objectId]="item?.card?.receiverID"
                  objectType="AD_Users"
                >
                </codx-img>
              </div>
            </div>
            <div class="text-dark text-feed mt-6">
              <read-more
                #readmore2
                [content]="item?.card?.situation"
                [textColor]="item?.card?.pattern?.textColor"
                [limit]="800"
                [completeWords]="true"
              >
              </read-more>
            </div>
            <div class="d-flex align-items-center group-hasGift mt-6">
              <div
                class="d-flex align-items-center ion-wrap me-2"
                *ngIf="
                  item?.card?.cardType == '2' || item?.card?.cardType == '3'
                "
              >
                <div class="symbol symbol-30 me-2">
                  <img
                    class="w-100"
                    src="/assets/themes/fd/default/img/{{
                      item?.card?.rating
                        | vll
                          : (item?.card?.cardType == '2' ? 'L1419' : 'L1424')
                          : 'icon'
                        | async
                    }}"
                  />
                </div>
              </div>
              <div
                class="d-flex align-items-center ion-wrap mar-auto"
                *ngIf="item?.card?.hasGift || item?.card?.hasPoint"
              >
                <img
                  src="/assets/themes/fd/default/img/img_HasGifts.svg"
                  *ngIf="item?.card?.hasGift"
                  class="symbol-image icon-surface1 me-1"
                />
                <img
                  src="/assets/themes/fd/default/img/img_HasCoins.svg"
                  *ngIf="item?.card?.hasPoint"
                  class="symbol-image icon-money-1"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </ng-template>
</ng-template>
<!-- content body -->

<!-- tooltip for tagUser -->
<ng-template #popContent style="width: fit-content; height: fit-content">
  <div *ngIf="show()">
    <div *ngFor="let tagUser of tagUsers">
      <div class="d-flex algin-items-center my-3">
        <codx-img
          class="me-3"
          [width]="30"
          [objectId]="tagUser.objectID"
          objectType="AD_Users"
        >
        </codx-img>
        <div class="d-flex flex-column">
          <div class="text-dark fs-6 me-2">{{ tagUser.objectName }}</div>
          <div class="text-gray-800">{{ tagUser.positionName }}</div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #popTitle>
  <div class="text-dark mb-2 fs-6">
    <codx-label
      formName="Comments"
      name="lblTag"
      default="Danh sách người được tag"
    ></codx-label>
  </div>
  <div>
    <input
      type="text"
      class="form-control"
      [(ngModel)]="searchField"
      placeholder="Tìm kiếm"
    />
  </div>
</ng-template>
<!-- tooltip -->

<!-- tooltip for user shared -->
<ng-template #popContentOfShare style="width: fit-content; height: fit-content">
  <div *ngIf="show()">
    <div *ngFor="let tagUser of tagUsers | filter: searchField:'objectName'">
      <div *ngIf="tagUser.orgUnitName == undefined">
        <div
          class="row"
          style="margin-top: 10px; margin-bottom: 10px; margin-left: -10px"
        >
          <div class="col-md-2">
            <codx-img
              class="me-3"
              [width]="40"
              [objectId]="tagUser.userID"
              objectType=" HR_Employees"
            >
            </codx-img>
          </div>
          <div class="col-md-8">
            <div class="text-dark pb-1" style="font-weight: BOLD">
              {{ tagUser.objectName }}
            </div>
            <div class="row" style="margin-left: -10px">
              <div class="text-gray-600 col-md-12">
                {{ tagUser?.positionName }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #popTitleOfShare>
  <div class="text-dark mb-2">
    <codx-label
      formName="Comments"
      name="lblShare"
      default="Danh sách người được chia sẻ"
    ></codx-label>
  </div>
  <div>
    <input
      type="text"
      class="form-control"
      [(ngModel)]="searchField"
      placeholder="Tìm kiếm"
    />
  </div>
</ng-template>
<!-- tooltip -->
<ng-template #empty>
  <div class="card-body-nodata text-center">
    <img src="../../../../assets/img/EmptyDataPortal.png" />
  </div>
</ng-template>

<ng-template #templateloading let-data>
  <ngx-skeleton-loader count="5" animation="progress"></ngx-skeleton-loader>
</ng-template>
