<ng-container *ngIf="isShowCreate">
  <div class="card card-custom post-new" id="postnew">
    <div class="card-body">
      <div class="d-flex align-items-center">
        <div class="me-3">
          <codx-img [objectId]="user.userID" [objectName]="user.userName" objectType="AD_Users" [width]="40"
            [imgOn]="user?.modifiedOn">
          </codx-img>
        </div>
        <div class="d-flex flex-column flex-grow-1 share">
          <span class="text-gray-500 feed-box box-new share-input" (click)="openPopupAdd()">
            {{title}}
          </span>
        </div>
      </div>
    </div>
  </div>
</ng-container>
<div>
  <div id="newfeed" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-height="auto"
    data-kt-scroll-dependencies="#postnew, .pw-profile, .pw-menu"
    data-kt-scroll-wrappers=".wrapper-portal, .wrapper, #newfeed, .pw-content" data-kt-scroll-offset="0">
    <codx-listview #listview 
      [dataService]="dataService" 
      [funcId]="'WP'" 
      [service]="'WP'"
      [assemblyName]="'ERM.Business.WP'"
      [className]="'CommentsBusiness'" 
      [method]="'GetListPostAsync'" 
      entityName="WP_Comments"
      [itemTemplate]="itemTemplate" 
      [emptyTemplate]="empty" 
      [formModel]="formModel">
    </codx-listview>

  </div>
</div>
<ng-template #itemTemplate let-item>
  <div class="p-5 pb-0">
    <div class="d-flex align-items-top">
      <div class="me-3">
        <codx-img [objectId]="item.createdBy" [objectName]="item.createdName" objectType="AD_Users" [width]="40">
        </codx-img>
      </div>
      <div class="d-flex flex-column flex-grow-1">
        <div class="d-flex flex-wrap align-items-center mb-1">
          <ng-container *ngIf="item.createdName">
            <span class="text-dark fw-bolder me-2">{{ item.createdName }}</span>
          </ng-container>
          <ng-container *ngIf="item.tagName">
            <ng-container *ngTemplateOutlet="templateTags; context: { $implicit: item }">
            </ng-container>
          </ng-container>
        </div>
        <div class="d-flex align-items-center text-info-date mb-1">
          <span class="d-flex algin-items-center me-2 mt-1">
            <span class="text-gray-600 fs-7 me-2 mt-1">{{
              item.createdOn | timefrom
              }}</span>
            <span class="rounded-1 py-1 px-2 bg-gray-200 d-flex algin-items-center">
              <codx-vll 
                [name]="'WP001'" 
                [value]="item.shareControl" 
                [showText]="true" [showIcon]="true"
                [className]="'text-gray-600'" 
                [icoCss]="'w-13px h-13px'" 
                [path]="'assets/themes/sys/default/img/'"
                [showBgColor]="true">
              </codx-vll>
            </span>
          </span>
          <span class="mt-1" *ngIf="item.shareName">
            <ng-container *ngTemplateOutlet="templateShares; context: { $implicit: item }">
            </ng-container>
          </span>
        </div>
      </div>
      <!-- bổ sung moreFC và moreFCtmp cho Nguyên dùng bên MWP -->
      <ng-container *ngIf="moreFunc && moreFuncTmp; else defaultMoreFunc">
        <ng-container *ngTemplateOutlet="moreFuncTmp; context: { $implicit: item }"></ng-container>
      </ng-container>
      <!--  -->
      <ng-template #defaultMoreFunc>
        <div class="more">
          <div ngbDropdown class="dropdown">
            <a href="javascript:void(0)" class="btn btn-clean btn-hover-light-primary btn-sm btn-icon" ngbDropdownToggle
              id="dropdownMenuButton1" aria-expanded="false">
              <i class="fas fa-ellipsis-h"></i>
            </a>
            <ul ngbDropdownMenu aria-labelledby="dropdownMenuButton1">
              <li *ngIf="item.write">
                <a (click)="openPopupEdit(item)" ngbDropdownItem href="javascript:void(0)">
                  <span class="icon-edit icon-16 me-2 icon-editPost"></span>
                  <codx-label [formModel]="formModel" name="lblEdit_comments" default="Chỉnh sửa">
                  </codx-label>
                </a>
              </li>
              <li *ngIf="item.delete">
                <a (click)="removePost(item)" ngbDropdownItem href="javascript:void(0)">
                  <span class="icon-close icon-16 me-2 icon-removePost"></span>
                  <codx-label [formModel]="formModel" name="lblDelete_comments" default="Xóa"></codx-label>
                </a>
              </li>
              <li *ngIf="item.share">
                <a (click)="openPopupShare(item)" ngbDropdownItem href="javascript:void(0)">
                  <span class="icon-share icon-16 me-2"></span>
                  <codx-label [formModel]="formModel" name="lblShare_comments" default="Chia sẻ"></codx-label>
                </a>
              </li>
              <li>
                <a (click)="openPopupSave(item)" ngbDropdownItem href="javascript:void(0)">
                  <span class="icon-save icon-save_alt icon-16 me-2"></span>
                  <codx-label [formModel]="formModel" name="lblSave_comments" default="Thêm vào kho lưu trữ">
                  </codx-label>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </ng-template>
    </div>
    <!-- contents -->
    <div class="wp-contents">
      <div class="wp-contents-text">
        <ng-container *ngIf="item.content">
          <div [innerHTML]="item.content | safe: 'html'"></div>
        </ng-container>
      </div>
      <div class="wp-contents-files">
        <ng-container *ngIf="item.attachments">
          <codx-view-files 
            [objectID]="item.recID" 
            [objectType]="'WP_Comments'" 
            [formModel]="formModel"
            [medias]="item.medias"
            (fileClicked)="clickViewDetail($event)">
          </codx-view-files>
        </ng-container>  
      </div> 
    </div>
    <!-- end contents -->
    <!-- template share -->
    <ng-container *ngIf="item.category == CATEGORY.SHARE">
      <div class="wp-contents-shares">
        <ng-container [ngSwitch]="item.refType">
          <!-- WP_Comments -->
          <ng-container *ngSwitchCase="'WP_Comments'"> 
            <!-- isContentTmp && contentTmp  dùng cho bên tạo user của Nguyên -->
            <ng-container *ngIf="item.isContentTmp; else noContentTemp">
              <ng-container *ngTemplateOutlet="item.contentTmp; context: { $implicit: item }"></ng-container>
            </ng-container>
            <ng-template #noContentTemp>
              <ng-container *ngIf="item.shares;else postShareDeleted">
                <ng-container
                    *ngTemplateOutlet="templateSharePost; context: { $implicit: item.shares }">
                </ng-container>
              </ng-container>
            </ng-template>
          </ng-container>
          <!-- WP_News -->
          <ng-container *ngSwitchCase="'WP_News'">
            <ng-container *ngIf="item.news;else postShareDeleted">
              <ng-container
                  *ngTemplateOutlet="templateShareNews; context: { $implicit: item.news }">
              </ng-container>
            </ng-container>
          </ng-container>
          
        </ng-container>
      </div>
    </ng-container>
    <!-- end template share -->
    <!-- template feedback -->
    <ng-container *ngIf="item.isFeedBack">
      <div class="wp-contents-shares">
        <ng-container *ngIf="item.card && item.refType =='FD_Cards';else postShareDeleted">      
          <ng-container
              *ngTemplateOutlet="templateShareCard; context: { $implicit: item.card }">
          </ng-container>
        </ng-container>
      </div>
    </ng-container>
    <!-- end template feedback -->
    <!-- commemt -->
    <treeview-comment 
      [funcID]="formModel.funcID" 
      [formModel]="formModel" 
      [objectType]="'WP_Comments'"
      [dataComment]="item" 
      [objectID]="item.recID">
    </treeview-comment>
    <!-- end comment -->
  </div>
</ng-template>
<!-- template empty data -->
<ng-template #empty>
  <div class="d-flex justify-content-between align-items-center p-6 bg-body">
    <div [innerHTML]="strEmtyData">
    </div>
    <div>
      <img src="assets/themes/wp/default/img/Portal_NoData.svg" />
    </div>
  </div>
</ng-template>
<!-- template share WP_Comments -->
<ng-template #templateSharePost let-share>
  <div class="WP_Comments">
      <div class="wp-share-files">
        <ng-container *ngIf="share.recID">
          <codx-file [objectID]="share.recID" [objectType]="'WP_Comments'" [funcID]="listview.formModel.funcID"></codx-file>
        </ng-container>
      </div>
      <div class="wp-share-contents">
        <ng-container *ngIf="share.content">
          <div [innerHTML]="share.content | safe: 'html'"></div>
        </ng-container>
      </div>
      <div class="d-flex border-top p-4">
          <codx-img 
              [width]="30" 
              [objectId]="share.createdBy" 
              [objectName]="share.createdName" 
              objectType="AD_Users">
          </codx-img>
          <div class="d-flex flex-column flex-grow-1 ms-2">
              <div class="d-flex align-items-center">
                  <div class="user-name fw-bolder me-2">
                      <span>{{share.createdName}}</span>
                  </div>
                  <ng-container *ngIf="share.tagName">
                      <ng-container
                          *ngTemplateOutlet="templateTags; context: { $implicit: share }">
                      </ng-container>
                  </ng-container>
              </div>
              <div class="d-flex text-info-date">
                  <div class="text-gray-500 me-2">{{share.createdOn | timefrom}}</div>
                  <div class="d-flex align-items-center justify-content-start ">
                      <ng-container *ngIf="share.shareControl">
                          <div class="bg-gray-200 rounded-1 px-1 d-flex align-items-center">
                              <codx-vll 
                                  [name]="'WP001'" 
                                  [value]="share.shareControl" 
                                  [showText]="true" 
                                  [className]="'text-gray-600'"
                                  [showIcon]="true" 
                                  [path]="'assets/themes/sys/default/img/'"
                                  [icoCss]="'symbol-12px symbol-circle'"  
                                  [showBgColor]="true">
                              </codx-vll>
                              <i class="icon-arrow_drop_down icon-18 text-dark"></i> 
                          </div>
                      </ng-container>
                      <ng-container *ngIf="share.shareName">
                          <div class="ms-2">
                              <ng-container
                                  *ngTemplateOutlet="templateShares; context: { $implicit: share }">
                              </ng-container>
                          </div>
                      </ng-container>
                  </div>
              </div>
          </div>
      </div>
  </div>
</ng-template>
<!-- template share WP_News-->
<ng-template #templateShareNews let-news>
  <div class="WP_News" (click)="naviagteWPNew(news)">
      <div class="WP_News-images">
        <ng-container *ngIf="news.recID">
          <codx-img [cssClass]="'w-100'" [objectId]="news.recID" [objectType]="'WP_News'" [referType]="'image'" [width]="300" imageType="square"></codx-img>
        </ng-container>
      </div>
      <div class="WP_News-contents">
        <ng-container *ngIf="news.subject">
          <div class="fw-bolder">
            {{news.subject}}
          </div>
        </ng-container>
        <ng-container *ngIf="news.subContent">
          <div>
            {{news.subContent}}
          </div>
        </ng-container>
        <ng-container *ngIf="news.createdOn">
          <div class="text-gray-600">
            {{news.createdOn | formatvalue:listview.formModel:"CreatedOn" | async}}
          </div>
        </ng-container>
      </div>
  </div>
</ng-template>
<!-- template FD card -->
<ng-template #templateShareCard let-card>
  <div class="FD_Cards">
    <codx-view-card [card]="card"></codx-view-card>
  </div>
</ng-template>
<!-- template post deleted -->
<ng-template #postShareDeleted>
  <div class="card card-custom card-border border border-1 mt-3">
    <div class="card-body p-5">
      <div class="d-flex">
        <div class="me-3">
          <codx-img slot="start" objectId="" isDefaulImg="true" objectType="AD_Users" [width]="30">
          </codx-img>
        </div>
        <div class="d-flex flex-column flex-grow-1">
          <codx-label formModel="" name="lblPostDeleted" default="Bài viết không còn tồn tại">
          </codx-label>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<!-- template list permissions share -->
<ng-template #templateShares let-data>
  <div ngbDropdown class="symbol-more" [container]="'body'">
    <div ngbDropdownToggle id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span [innerHTML]="data.shareName"> </span>
    </div>
    <div ngbDropdownMenu class="dropdown-menu p-3" aria-labelledby="dropdownMenuButton">
      <div class="py-2">
        <codx-label [formModel]="" default="Danh sách người được chia sẻ" class="fw-bolder"></codx-label>
      </div>
      <div class="hr-list-employee">
        <ng-container *ngFor="let perrmisison of data.permissions">
          <ng-container *ngIf="perrmisison.memberType == '2'">
            <div class="d-flex align-items-center mt-3">
              <codx-img [objectId]="perrmisison.objectID" [objectType]="'AD_Users'" [cssClass]="'me-3'"
                [objectName]="perrmisison.objectName" [width]="30">
              </codx-img>
              <span class="ms-2 fs-6">{{perrmisison.objectName}}</span>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>
<!-- template list permissions tag -->
<ng-template #templateTags let-data>
  <div ngbDropdown class="symbol-more" [container]="'body'">
    <div ngbDropdownToggle id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span [innerHTML]="data.tagName"> </span>
    </div>
    <div ngbDropdownMenu class="dropdown-menu p-3" aria-labelledby="dropdownMenuButton">
      <div class="py-2">
        <codx-label [formModel]="" default="Danh sách người gắn thẻ" class="fw-bolder"></codx-label>
      </div>
      <div class="hr-list-employee">
        <ng-container *ngFor="let perrmisison of data.permissions">
          <ng-container *ngIf="perrmisison.memberType == '3'">
            <div class="d-flex align-items-center mt-3">
              <codx-img [objectId]="perrmisison.objectID" [objectType]="'AD_Users'" [cssClass]="'me-3'"
                [objectName]="perrmisison.objectName" [width]="30">
              </codx-img>
              <span class="ms-2 fs-6">{{perrmisison.objectName}}</span>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>