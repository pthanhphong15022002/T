<div class="chat-list d-flex flex-column h-100">
    <div class="chat-list-header">
        <!-- title -->
        <div class="row">
            <h3 class="fw-bolder">Chatting</h3>
        </div>
        <!-- end title -->
        <!-- feature -->
        <div class="row">
            <!-- users - check - chat -->
            <div class="d-flex align-items-center justify-content-end">
                <ul class="chat-list-header_func">
                    <li class="cursor-pointer" (click)="openPopupAddGroup()">
                        <i class="icon-people_alt"></i>
                    </li>
                    <li class="cursor-pointer" (click)="clickCheckSeenAll()">
                       <i class="icon-playlist_add_check"></i>
                    </li>
                    <li class="cursor-pointer">
                       <i class="icon-open_in_new"></i>
                    </li>
                </ul>
            </div>
            <!-- search -->
            <div>
                <codx-searchbar #codxSearch 
                    [iconPos]="'left'" 
                    [width]="300" 
                    (searchEvent)="search($event)">
                </codx-searchbar>
            </div>
        </div>
        <!-- end feature -->
    </div>
    <!-- list group chat -->
    <div class="chat-list-body">
        <ng-container *ngIf="searched;else tmpListGroup">
            <codx-listview #codxListViewSerach
                [itemTemplate]="itemTemplateSearch" 
                [funcId]="funcID"
                service="WP" 
                [emptyTemplate]="null"
                assemblyName="ERM.Business.WP" 
                className="GroupBusiness"
                method="SearchAsync"
                [selectFirst]="false">
            </codx-listview>
        </ng-container>
        <ng-template #tmpListGroup>
            <codx-listview #codxListViewGroup
                [itemTemplate]="itemTemplateGroup" 
                [funcId]="funcID"
                service="WP" 
                assemblyName="ERM.Business.WP" 
                className="GroupBusiness"
                method="GetGroupsChatAsync"
                [selectFirst]="false">
            </codx-listview>
        </ng-template>
    </div>
</div>
<!-- template group chat -->
<ng-template #itemTemplateGroup let-item>
    <div class="d-flex align-items-center my-2 p-2 w-100" (click)="clickGroupChat(item)">
        <!-- image -->
        <div class="me-2">
            <codx-img 
                [objectId]="item.groupType == '1'? item.groupID2:item.groupID" 
                [objectName]="item.groupType == '1'? item.groupName2:item.groupName" 
                [objectType]="item.groupType == '1'? 'AD_Users':'WP_Groups'"
                [width]="30">
            </codx-img>
        </div>
        <!-- group name - created - seen -->
        <div class="w-100">
            <div class="d-flex justify-content-between w-100">
                <span class="fw-bolder m-0 p-0">{{ item.groupType == '1' ? item.groupName2 : item.groupName}}</span>
                <span *ngIf="item.mssgCount > 0" class="topbar-badge badge badge-sm rounded-pill bg-danger px-2 ">{{item.mssgCount}}</span>
            </div>
            <div class="d-flex justify-content-between w-100">
                <span class="last-message" [classList]="item.isRead ? 'text-dark-500' : 'text-primary'">{{item.message}}</span>
                <span class="text-dark-500 me-2">{{item.createdOn | timefrom}}</span>
            </div>
        </div>
    </div>
</ng-template>
<!-- template search chat -->
<ng-template #itemTemplateSearch let-item>
    <div class="p-2" (click)="openChatBox(item)">
        <ng-container *ngIf="item.type == 'H';else tmpItem">
            <codx-label [formModel]="" [name]="'lblHeader'" [default]="item.name"></codx-label>
        </ng-container>
        <ng-template #tmpItem>
            <codx-temp-full 
                [dataItem]="item" 
                [title]="item.id" 
                [imageId]="item.id" 
                [imageObjType]="item.type == 'U' ? 'AD_Users':'WP_Groups'" 
                [imageObjName]="item.name">
            </codx-temp-full>
        </ng-template>
    </div>
</ng-template>

<ng-template #chatBox let-data>
    <codx-chat-box [groupID]="data"></codx-chat-box>
</ng-template>