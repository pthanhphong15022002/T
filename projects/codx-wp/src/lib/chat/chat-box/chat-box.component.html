<ng-container *ngIf="group">
    <div class="chat-box">
        <div class="chat-box-header">
            <div class="group-avatar">
                <ng-container *ngIf="group.groupType == '1' ; else group1_n">
                    <codx-img 
                        [objectId]="group.groupID2" 
                        [objectName]="group.groupName2" 
                        [width]="35"
                        [objectType]="'AD_Users'">
                    </codx-img>
                </ng-container>
                <ng-template #group1_n>
                    <codx-img 
                        [objectId]="group.groupID" 
                        [objectName]="group.groupName" 
                        [width]="35"
                        [objectType]="'WP_Groups'">
                    </codx-img>
                </ng-template>
                <ng-container *ngIf="group.isOnline">
                    <div class="status">
                        <span class="icon-online"></span>
                    </div>
                </ng-container>
            </div>
            <div class="group-infor w-100">
                <div class="group-infor_name w-100">
                    <div class="fw-bold fs-6">{{group.groupType == '1' ? group.groupName2 : group.groupName}}</div>
                    <div class="mt-1">
                        <codx-tag 
                            [isEdit]="false" 
                            [disabled]="true"  
                            [value]="group.tagValue" 
                            [entityName]="'WP_Groups'">
                        </codx-tag>
                    </div>
                </div>
                <div class="d-flex align-items-center morefc-list ms-3">
                    <ng-container *ngIf="group.groupType == '2'">
                        <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light">
                            <span class="icon-group_add icon-16"></span>
                        </button>    
                    </ng-container>
                    <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light ms-1">
                        <span class="icon-launch icon-16"></span>
                    </button>
                    <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light ms-1">
                        <span class="icon-horizontal_rule icon-16" (click)="collapsed()"></span>
                    </button>
                    <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light ms-1" (click)="closeChatBox()">
                        <span class="icon-close icon-16"></span>
                    </button>
                </div>   
            </div>
        </div>
        <div #chatBoxBody class="chat-box-body" (scroll)="scroll(chatBoxBody)">
            <ng-container *ngFor="let item of arrMessages; let i = index">
                <div class="message"  [attr.scroll]="i == arrMessages.length - 1 ? (chatBoxBody | srollPipe) : null">
                    <ng-container *ngIf="user.userID == item.createdBy;else reciverMssg">
                        <div class="message-send">
                            <div class="message-function">
                                <span class="icon-more_vert me-2 cursor-pointer text-gray-600"></span>
                                <span class="icon-undo me-2 cursor-pointer text-gray-600" (click)="clickReplyMssg(item)"></span>
                                <span class="icon-tag_faces me-2 cursor-pointer text-gray-600"
                                (click)="openTooltipEmoji(tooltip1,item)"
                                #tooltip1="ngbTooltip"
                                triggers="manual"
                                placement="top"
                                [autoClose]="true"
                                [ngbTooltip]="tooltipEmojiMssg">
                                </span>
                            </div>
                            <ng-container *ngIf="item.messageType == '1' || item.messageType == '4'">
                                <div class="message-send-message">
                                    <ng-container *ngIf="item.refContent">
                                        <div class="message-reft">
                                            <span>{{item.refContent}}</span>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="item.message">
                                        <div class="message-send_content">
                                            <span>{{item.message}}</span>
                                            <!-- time -->
                                            <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                                <span class="d-block">{{item.createdOn | date:'hh:mm'}}</span>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </div>
                                
                            </ng-container>
                            <ng-container *ngIf="item.messageType == '2'" >
                                <div class="message-files">
                                    <codx-view-files 
                                        [objectID]="item.recID" 
                                        [objectType]="'WP_Messages'" 
                                        [formModel]="formModel"
                                        [format]="'grid'"
                                        (fileClicked)="clickViewFile($event)">
                                    </codx-view-files>
                                    <!-- time -->
                                    <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                        <div class="d-block">{{item.createdOn | date:'hh:mm'}}</div>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="item.votes">
                                <div class="emoji-message message-emoji">
                                    <div *ngFor="let vote of item.votes">
                                        <codx-vll 
                                            [path]="'assets/themes/wp/default/img/'"
                                            [name]="'L1480'" 
                                            [value]="vote.voteType" 
                                            [showIcon]="true" 
                                            [icoCss]="'w-15px h-15px'">
                                        </codx-vll>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </ng-container>
                    <ng-template #reciverMssg>
                        <div class="message-reciver">
                            <div class="message-reciver-avatar">
                                <codx-img 
                                    [objectId]="item.createdBy" 
                                    [width]="30"
                                    [objectType]="'AD_Users'">
                                </codx-img>
                                <ng-container *ngIf="item.isOnline">
                                    <div class="status">
                                        <span class="icon-online"></span>
                                    </div>
                                </ng-container>
                            </div>
                            <ng-container *ngIf="item.messageType == '1' || item.messageType == '4'">
                                <div class="message-reciver-message">
                                    <ng-container *ngIf="item.refContent">
                                        <div class="message-reft">
                                            <span>{{item.refContent}}</span>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="item.message">
                                        <div class="reciver-message">
                                            <span>{{item.message}}</span>
                                            <!-- time -->
                                            <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                                <span class="d-block">{{item.createdOn | date:'hh:mm'}}</span>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="item.messageType == '2'">
                                <div class="message-files">
                                    <codx-view-files 
                                        [objectID]="item.recID" 
                                        [objectType]="'WP_Messages'" 
                                        [formModel]="formModel"
                                        [format]="'grid'"
                                        (fileClicked)="clickViewFile($event)">
                                    </codx-view-files>
                                    <!-- time -->
                                    <ng-container *ngIf="i == arrMessages.length - 1 || item.createdBy != arrMessages[i+1]?.createdBy">
                                        <div class="d-block">{{item.createdOn | date:'hh:mm'}}</div>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="item.votes">
                                <div class="emoji-message message-emoji">
                                    <div *ngFor="let vote of item.votes">
                                        <codx-vll 
                                            [path]="'assets/themes/wp/default/img/'"
                                            [name]="'L1480'" 
                                            [value]="vote.voteType" 
                                            [showIcon]="true" 
                                            [icoCss]="'w-15px h-15px'">
                                        </codx-vll>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                        <div class="message-function">
                            <span class="icon-tag_faces me-2 cursor-pointer text-gray-600"
                                (click)="openTooltipEmoji(tooltip2,item)"
                                #tooltip2="ngbTooltip"
                                triggers="manual"
                                [autoClose]="true"
                                [ngbTooltip]="tooltipEmojiMssg">
                            </span>
                            <span class="icon-undo me-2 cursor-pointer text-gray-600" (click)="clickReplyMssg(item)"></span>
                            <span class="icon-more_vert me-2 cursor-pointer text-gray-600"></span>
                        </div>
                    </ng-template>  
                </div>
            </ng-container>
        </div>
        <div class="chat-box-footer border-top bg-body">
            <div class="footer-emoji me-2" ngbDropdown>
                <span class="icon-tag_faces icon-22" ngbDropdownToggle></span>
                <div ngbDropdownMenu class="dropdown-menu p-3 mb-3" aria-labelledby="dropdownMenuButton">
                    <emoji-mart 
                        [set]="emojiMode" 
                        [maxFrequentRows]="emojiMaxFrequentRows"
                        [perLine]="emojiPerLine"
                        [showSingleCategory]="true" 
                        [showPreview]="emojiReview" 
                        (emojiSelect)="addEmoji($event)">
                    </emoji-mart>
                </div>
            </div>
            <div class="footer-attachments">
                <span class="icon-photo icon-22" (click)="clickUploadFile()"></span>
                <div class="d-none">
                    <codx-attachment 
                        #codxATM 
                        [functionID]="funcID"
                        [allowMultiFile]="'1'"
                        [objectType]="'WP_Messages'" 
                        [showMessage]="'0'"
                        [hideImageUpload]="'1'" 
                        [hideUploadBtn]="'1'" 
                        [hideBtnSave]="'1'" 
                        [hideImageThumb]="'1'"
                        [hideUploadBtn]="'1'" 
                        (fileAdded)="addFiles($event)">
                    </codx-attachment>
                </div>
            </div>
            <div class="footer-message">
                <ng-container *ngIf="replyMssg">
                    <div class="footer-message-reply">
                        <div class="reply-content">
                            <p>
                                {{'Trả lời tin nhắn của ' + messageReply.createdName}}
                            </p>
                            <p>{{messageReply.message}}</p>
                        </div>
                        <div class="reply-colse">
                            <button type="button" class="cursor-pointer btn btn-icon btn-sm btn-light" (click)="clickReplyMssg()">
                                <span class="icon-close text-danger"></span>
                            </button>
                        </div>
                    </div>
                </ng-container>
                <div class="footer-message-text">
                    <codx-input 
                        type="textarea"
                        format="ed2" 
                        [rows]="1"
                        [class]="'rounded-pill'" 
                        [crrValue]="data.message"
                        (valueChange)="valueChange($event)">
                    </codx-input>
                </div>
            </div>
            <button type="button" class="footer-button btn btn-icon btn-circle btn-light" (click)="sendMessage()">
                <span class="icon-send icon-16"></span>
            </button>
        </div>
    </div>
</ng-container>
<ng-template #tooltipEmojiMssg let-mssg="mssg">
    <div class="row">
        <ng-container *ngFor="let item of vllL1480">
            <div (click)="clickVoteMssg(mssg,item)" class="col cursor-pointer" *ngIf="item.value">
                <codx-vll 
                    [path]="'assets/themes/wp/default/img/'"
                    [name]="'L1480'" 
                    [value]="item.value" 
                    [showIcon]="true" 
                    [icoCss]="'w-15px h-15px'">
                </codx-vll>
            </div>
        </ng-container>
    </div>
</ng-template>
