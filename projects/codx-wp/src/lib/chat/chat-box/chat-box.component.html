<ng-container *ngIf="group">
    <div class="chat-box">
        <div class="chat-box-header">
            <div class="group-avatar">
                <ng-container *ngIf="group.groupType == '1' ; else group1_n">
                    <codx-img 
                        [objectId]="group.groupID2" 
                        [objectName]="group.groupName2" 
                        [width]="35"
                        [objectType]="'AD_Users'">
                    </codx-img>
                </ng-container>
                <ng-template #group1_n>
                    <codx-img 
                        [objectId]="group.groupID" 
                        [objectName]="group.groupName" 
                        [width]="35"
                        [objectType]="'WP_Groups'">
                    </codx-img>
                </ng-template>
                <ng-container *ngIf="group.isOnline">
                    <div class="group-avatar_status">
                        <span class="group-avatar_status-icon"></span>
                    </div>
                </ng-container>
            </div>
            <div class="group-infor w-100">
                <div class="group-infor_name w-100">
                    <div class="fw-bold fs-6">{{group.groupType == '1' ? group.groupName2 : group.groupName}}</div>
                    <div class="mt-1">
                        <codx-tag 
                            [isEdit]="false"  
                            [value]="group.tagValue" 
                            [entityName]="'WP_Groups'">
                        </codx-tag>
                    </div>
                </div>
                <div class="d-flex align-items-center morefc-list ms-3">
                    <ng-container *ngIf="group.groupType == '2'">
                        <button type="button" class="btn btn-icon btn-sm btn-light">
                            <span class="icon-group_add icon-16"></span>
                        </button>    
                    </ng-container>
                    <button type="button" class="btn btn-icon btn-sm btn-light ms-1">
                        <span class="icon-launch icon-16"></span>
                    </button>
                    <button type="button" class="btn btn-icon btn-sm btn-light ms-1">
                        <span class="icon-horizontal_rule icon-16" (click)="collapsed()"></span>
                    </button>
                    <button type="button" class="btn btn-icon btn-sm btn-light ms-1" (click)="closeChatBox()">
                        <span class="icon-close icon-16"></span>
                    </button>
                </div>   
            </div>
        </div>
        <div #chatBoxBody class="chat-box-body" (scroll)="scroll(chatBoxBody)">
            <ng-container *ngFor="let item of arrMessages; let i = index">
                <div class="codx-message" [attr.scroll]="i == arrMessages.length - 1 ? (chatBoxBody | srollPipe) : null" [class.justify-content-end]="item.createdBy == user.userID">
                    <div class="message-img me-3" *ngIf="item.createdBy != user.userID">
                        <codx-img 
                            [objectId]="item.createdBy" 
                            [width]="30"
                            [objectType]="'AD_Users'">
                        </codx-img>
                    </div>
                    <ng-container *ngIf="item.messageType == '1'">
                        <div [class]="item.createdBy == user.userID ? 'my-message text-message':'text-message you-message'">
                            {{item.message}}
                        </div>
                    </ng-container>
                    <ng-container *ngIf="item.messageType == '2'" [class]="item.createdBy == user.userID ? 'my-message':'you-message'">
                        <div class="codx-message-files">
                            <codx-view-files 
                                [objectID]="item.recID" 
                                [objectType]="'WP_Messages'" 
                                [formModel]="formModel"
                                [format]="'grid'"
                                (fileClicked)="clickViewFile($event)">
                            </codx-view-files>
                        </div>
                    </ng-container>
                    
                </div>  
            </ng-container>
        </div>
        <div class="chat-box-footer border-top bg-body">
            <div class="footer-emoji me-2" ngbDropdown>
                <span class="icon-tag_faces icon-22" ngbDropdownToggle></span>
                <div ngbDropdownMenu class="dropdown-menu p-3 mb-3" aria-labelledby="dropdownMenuButton">
                    <emoji-mart 
                        [set]="emojiMode" 
                        [maxFrequentRows]="emojiMaxFrequentRows"
                        [perLine]="emojiPerLine"
                        [showSingleCategory]="true" 
                        [showPreview]="emojiReview" 
                        (emojiSelect)="addEmoji($event)">
                    </emoji-mart>
                </div>
            </div>
            <div class="footer-attachments">
                <span class="icon-photo icon-22" (click)="clickUploadFile()"></span>
                <div class="d-none">
                    <codx-attachment 
                        #codxATM 
                        [functionID]="funcID"
                        [allowMultiFile]="'1'"
                        [objectType]="'WP_Messages'" 
                        [showMessage]="'0'"
                        [hideImageUpload]="'1'" 
                        [hideUploadBtn]="'1'" 
                        [hideBtnSave]="'1'" 
                        [hideImageThumb]="'1'"
                        [hideUploadBtn]="'1'" 
                        (fileAdded)="addFiles($event)">
                    </codx-attachment>
                </div>
            </div>
            <div class="w-100 px-3">
            <ng-container *ngIf="fileUpload.length == 0;else tmpUploadFile">
                <div class="footer-message" (keyup.enter)="sendMessage()">
                    <codx-input 
                        type="textarea"
                        format="ed2" 
                        [rows]="1"
                        [class]="'rounded-pill'" 
                        [crrValue]="data.message"
                        (valueChange)="valueChange($event)">
                    </codx-input>
                </div>
            </ng-container>
            </div>
            <ng-template #tmpUploadFile>
                <div class="footer-upload bg-body mh-100px overflow-auto">
                    <div class="footer-upload-files d-flex flex-wrap">
                        <ng-container *ngFor="let item of fileUpload;let i = index">
                            <div class="upload-files-item cursor-pointer">
                                <ng-container *ngIf="item.referType == FILE_REFERTYPE.IMAGE">
                                    <codx-temp-full 
                                        [imageSrc]="item.source" 
                                        imgCss="w-25px h-25px">
                                    </codx-temp-full>
                                </ng-container>
                                <ng-container *ngIf="item.referType == FILE_REFERTYPE.VIDEO">
                                    <video 
                                        width="50"
                                        height="50"
                                        [autoplay]="false" 
                                        [src]="item.source | safe:'resourceUrl'">
                                    </video>
                                </ng-container>
                                <ng-container *ngIf="item.referType == FILE_REFERTYPE.APPLICATION">
                                    <codx-temp-full 
                                        [imageSrc]="item.extension | avtFile" 
                                        imgCss="w-50px h-50px"
                                        [title]="item.fileName" 
                                        [descLine]="2">
                                    </codx-temp-full>
                                </ng-container>
                                <div class="upload-files-item_remove cursor-pointer" (click)="removeFile(i)">
                                    <i class="icon-close icon-18 text-danger"></i>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                    <div class="footer-upload-text px-3" (keyup.enter)="sendMessage()">
                        <codx-input 
                            type="textarea"
                            format="ed2" 
                            [rows]="1"
                            [class]="'rounded-pill px-4'" 
                            [crrValue]="data.message"
                            (valueChange)="valueChange($event)">
                        </codx-input>
                    </div>
                </div>
            </ng-template>
            <button type="button" class="footer-button btn btn-icon btn-circle btn-light" (click)="sendMessage()">
                <span class="icon-send icon-16"></span>
            </button>
        </div>
    </div>
</ng-container>
