<codx-layout-add
  [title]="title"
  [tabInfo]="tabTitle"
  [subHeader]="subHeader"
  [footer]="footer"
  [dialog]="dialog"
  [openMore]="false"
  [tabContent]="tabContent"
  (setTitle)="setTitle($event)"
  (buttonClick)="buttonClick($event)"
  [isSider]="false"
  [formModel]="dialog.formModel"
  #form
></codx-layout-add>
<ng-template #subHeader> </ng-template>

<ng-template #tabInfo>
  <div class="form-group w-100">
    <h2><codx-label name="lblInfo" default="Thông tin chung"></codx-label></h2>
    <h6 class="text-muted">
      <codx-label
        name="lblInfoDes"
        default="Thông tin chung của báo cáo"
      ></codx-label>
    </h6>
    <div class="container" id="reportInfo" *ngIf="data">
      <!-- uploader template -->
      <div class="row mt-5">
        <!-- template -->
        <div class="col-4">
          <div class="rp_template-item rp_template-seleted">
            <div class="container py-2">
              <div class="row ">
                <div class="d-flex align-items-center">
                  <img src="../../../assets/codx/dms/file.svg" class="rp_template-item_rdl">
                  <ng-container *ngIf="data.reportContent && displayMode != '3' && displayMode != '4';else tmpDefaultName">
                    <span class="ms-2">{{data.reportName}}</span>
                </ng-container>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-12">
                  <div class="d-flex align-items-center justify-content-between">
                    <button class="btn btn-light-primary" (click)="clickUpload('0')">
                      <i class="icon-cloud_upload i-14"></i>
                      <span>Upload</span>
                    </button>
                    <button class="btn btn-light-primary" (click)="clickDowload('0')">
                      <i class="icon-cloud_download i-14"></i>
                      <span>Dowload</span>
                    </button>
                  </div>
                  <div class="d-none">
                    <ejs-uploader
                      #uploader
                      id="preloadfileupload"
                      [autoUpload]="false"
                      [multiple]="false"
                      locale="vi"
                      [allowedExtensions]="'.rdl,.rdlc'"
                      (selected)="fileSelected($event)"
                      (removing)="onFileRemove($event)"
                      (beforeUpload)="beforeUpload($event)"
                      (uploading)="uploading($event)"
                      [files]="files"
                      (fileListRendering)="fileRendering($event)"
                    >
                    </ejs-uploader>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="rp_template-item">
            <div class="container py-2">
              <div class="row">
                <div class="d-flex align-items-center">
                  <img src="../../../assets/codx/dms/xls.svg" class="rp_template-item_rdl">
                  <ng-container *ngIf="data.reportContent && displayMode == '3';else tmpDefaultName">
                      <span class="ms-2">{{data.reportName}}</span>
                  </ng-container>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-12">
                  <div class="d-flex align-items-center justify-content-between">
                    <button class="btn btn-light-primary" (click)="clickUpload('3')">
                      <i class="icon-cloud_upload i-14"></i>
                      <span>Upload</span>
                    </button>
                    <button class="btn btn-light-primary" (click)="clickDowload('3')">
                      <i class="icon-cloud_download i-14"></i>
                      <span>Dowload</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="rp_template-item">
            <div class="container py-2">
              <div class="row">
                <div class="d-flex align-items-center">
                  <img src="../../../assets/codx/dms/doc.svg" class="rp_template-item_rdl">
                  <ng-container *ngIf="data.reportContent && displayMode == '4';else tmpDefaultName">
                    <span class="ms-2">{{data.reportName}}</span>
                </ng-container>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-12">
                  <div class="d-flex align-items-center justify-content-between">
                    <button class="btn btn-light-primary" (click)="clickUpload('4')">
                      <i class="icon-cloud_upload i-14"></i>
                      <span>Upload</span>
                    </button>
                    <button class="btn btn-light-primary" (click)="clickDowload('4')">
                      <i class="icon-cloud_download i-14"></i>
                      <span>Dowload</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- radio button -->
      <div class="row mt-5">
        <div class="col">
          <codx-input crrValue="0" [disabled]="displayMode == '3' || displayMode == '4'" field="displayMode" type="radio" name="rdReport" label="Xem mẫu báo cáo gốc" [checked]="!displayMode || displayMode == '' || displayMode == '0'" (valueChange)="valueChange($event)"></codx-input>
        </div>
        <div class="col">
          <codx-input crrValue="1" [disabled]="displayMode == '3' || displayMode == '4'" field="displayMode" type="radio" name="rdReport" label="Xem trang in báo cáo" [checked]="displayMode == '1'" (valueChange)="valueChange($event)"></codx-input>
        </div>
        <div class="col">
          <codx-input crrValue="2" [disabled]="displayMode == '3' || displayMode == '4'" field="displayMode" type="radio" name="rdReport" label="Xem dạng PDF" [checked]="displayMode == '2'" (valueChange)="valueChange($event)"></codx-input>
        </div>
        <div class="col">
          <codx-input crrValue="3" [disabled]="displayMode != '3'" field="displayMode" type="radio" name="rdReport" label="Mẫu excel" [checked]="displayMode == '3'" (valueChange)="valueChange($event)"></codx-input>
        </div>
        <div class="col">
          <codx-input crrValue="4" [disabled]="displayMode != '4'" field="displayMode" type="radio" name="rdReport" label="Mẫu word" [checked]="displayMode == '4'" (valueChange)="valueChange($event)"></codx-input>
        </div>
      </div>
      <!-- report infor -->
      <div class="row mt-5">
        <div class="col-12">
          <codx-label
            class="text-muted"
            name="lblReportName"
            default="Tên báo cáo"
          ></codx-label>
          <codx-input
            type="text"
            field="defaultName"
            [crrValue]="data?.defaultName"
            (valueChange)="valueChange($event)"
          ></codx-input>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-12">
          <codx-label
            class="text-muted"
            name="lblDescription"
            default="Diễn giải"
          ></codx-label>
          <codx-input
            type="textarea"
            format="ed2"
            field="description"
            [crrValue]="data?.description"
            placeholder="Diễn giải"
            (valueChange)="valueChange($event)"
          ></codx-input>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-6">
          <codx-label
            class="text-muted"
            name="lblReportType"
            default="Loại báo cáo"
          ></codx-label>
          <codx-input
            type="valuelist"
            field="methodType"
            [crrValue]="data?.methodType"
            refValue=""
            (valueChange)="valueChange($event)"
          ></codx-input>
        </div>
        <div class="col-6">
          <codx-label
            class="text-muted"
            name="lblMethodName"
            default="Method"
          ></codx-label>
          <codx-input
            type="text"
            field="methodName"
            [crrValue]="data?.methodName"
            (valueChange)="valueChange($event)"
          ></codx-input>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-6">
          <codx-label
            class="text-muted"
            name="lblAssemblyName"
            default="Assembly"
          ></codx-label>
          <codx-input
            type="text"
            field="assemblyName"
            [crrValue]="data?.assemblyName"
            (valueChange)="valueChange($event)"
          ></codx-input>
        </div>
        <div class="col-6">
          <codx-label
            class="text-muted"
            name="lblClassName"
            default="Class"
          ></codx-label>
          <codx-input
            type="text"
            field="className"
            [crrValue]="data?.className"
            (valueChange)="valueChange($event)"
          ></codx-input>
        </div>
      </div>
    </div>
  </div>
  <ng-template #tmpDefaultName>
    <span class="ms-2">Mẫu báo cáo</span>
  </ng-template>
</ng-template>

<ng-template #tabParam>
  <div class="form-group w-100">
    <h2>
      <codx-label name="lblReportParams" default="Tham số báo cáo"></codx-label>
    </h2>
    <h6 class="text-muted">
      <codx-label
        name="lblReportParamSetting"
        default="Thiết lập tham số báo cáo"
      ></codx-label>
    </h6>
    <div class="mt-5 overflow-x-auto">
      <ejs-grid [dataSource]="parameters" height="550">
        <e-columns>
          <e-column width="80">
            <ng-template #template let-data>
              <button
                class="btn btn-sm btn-light-primary onhover"
                (click)="editParam(data)"
              >
                <div class="w-100 d-flex justify-content-between">
                  <i class="bi bi-pen"></i>
                </div>
              </button>
              <button
                class="btn btn-sm btn-light-danger onhover"
                (click)="deleteParam(data)"
              >
                <div class="w-100 d-flex justify-content-between">
                  <i class="bi bi-trash"></i>
                </div>
              </button>
            </ng-template>
          </e-column>
          <e-column
            field="controlIndex"
            headerText="Index"
            width="80"
            textAlign="Center"
          ></e-column>
          <e-column
            field="controlName"
            headerText="Control"
            width="120"
            textAlign="Center"
          ></e-column>
          <e-column
            field="labelName"
            headerText="Tên tham số"
            width="150"
            textAlign="Center"
          ></e-column>
          <e-column
            field="dataType"
            headerText="Kiểu dữ liệu"
            width="130"
            textAlign="Center"
          ></e-column>
          <e-column
            field="isRequired"
            headerText="Bắt buộc"
            width="150"
            textAlign="Center"
          >
            <ng-template #template let-data>
              <div
                *ngIf="data?.isRequired; else falsy"
                class="statustemp e-activecolor"
              >
                <span class="statustxt e-activecolor">Có</span>
              </div>
              <ng-template #falsy>
                <div class="statustemp e-inactivecolor">
                  <span class="statustxt e-inactivecolor">Không</span>
                </div>
              </ng-template>
            </ng-template>
          </e-column>
          <e-column
            field="isVisible"
            headerText="Hiển thị"
            width="150"
            textAlign="Center"
          >
            <ng-template #template let-data>
              <div
                *ngIf="data?.isVisible; else falsy"
                class="statustemp e-activecolor"
              >
                <span class="statustxt e-activecolor">Có</span>
              </div>
              <ng-template #falsy>
                <div class="statustemp e-inactivecolor">
                  <span class="statustxt e-inactivecolor">Không</span>
                </div>
              </ng-template>
            </ng-template>
          </e-column>
          <e-column
            field="isEnable"
            headerText="Kích hoạt"
            width="150"
            textAlign="Center"
          >
            <ng-template #template let-data>
              <div
                *ngIf="data?.isEnable; else falsy"
                class="statustemp e-activecolor"
              >
                <span class="statustxt e-activecolor">Có</span>
              </div>
              <ng-template #falsy>
                <div class="statustemp e-inactivecolor">
                  <span class="statustxt e-inactivecolor">Không</span>
                </div>
              </ng-template>
            </ng-template>
          </e-column>
          <e-column
            field="isPin"
            headerText="Ghim"
            width="150"
            textAlign="Center"
          >
            <ng-template #template let-data>
              <div
                *ngIf="data?.isPin; else falsy"
                class="statustemp e-activecolor"
              >
                <span class="statustxt e-activecolor">Có</span>
              </div>
              <ng-template #falsy>
                <div class="statustemp e-inactivecolor">
                  <span class="statustxt e-inactivecolor">Không</span>
                </div>
              </ng-template>
            </ng-template>
          </e-column>
        </e-columns>
      </ejs-grid>
    </div>
    <div class="mt-5">
      <button class="btn btn-primary" (click)="setReportParams()">
        <codx-label
          name="lblFormatParams"
          default="Định dạng tham số báo cáo"
        ></codx-label>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #tabSignature>
  <div class="form-group w-100">
    <h2><codx-label name="lblSignature" default="Chữ ký"></codx-label></h2>
    <h6 class="text-muted">
      <codx-label
        name="lblSigatures"
        default="Danh sách chữ ký báo cáo"
      ></codx-label>
    </h6>
  </div>
  <div class="containter mt-5">
    <div class="row d-flex justify-content-start">
      <h5 class="text-primary">
        <codx-label name="lblSignatureGroup" default="Bộ chữ ký"></codx-label>
      </h5>
    </div>
    <div class="row m-5">
      <div class="col-12 d-flex justify-content-start">
        <div style="width: 20%">
          <div class="row">
            <span>
              <img src="/assets/themes/sys/default/img/1_Signatures.svg" />
            </span>
          </div>
          <div class="row mt-5">
            <codx-input
              type="radio"
              [checked]="true"
              field="signatures"
              name="signature"
              crrValue="1"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="1 chữ ký"
            ></codx-input>
          </div>
        </div>
        <div style="width: 20%">
          <div class="row">
            <span>
              <img src="/assets/themes/sys/default/img/2_Signatures.svg" />
            </span>
          </div>
          <div class="row mt-5">
            <codx-input
              type="radio"
              field="signatures"
              name="signature"
              crrValue="2"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="2 chữ ký"
            ></codx-input>
          </div>
        </div>
        <div style="width: 20%">
          <div class="row">
            <span>
              <img src="/assets/themes/sys/default/img/3_Signatures.svg" />
            </span>
          </div>
          <div class="row mt-5">
            <codx-input
              type="radio"
              field="signatures"
              name="signature"
              crrValue="3"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="3 chữ ký"
            ></codx-input>
          </div>
        </div>
        <div style="width: 20%">
          <div class="row">
            <span>
              <img src="/assets/themes/sys/default/img/4_Signatures.svg" />
            </span>
          </div>
          <div class="row mt-5">
            <codx-input
              type="radio"
              field="signatures"
              name="signature"
              crrValue="4"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="4 chữ ký"
            ></codx-input>
          </div>
        </div>
        <div style="width: 20%">
          <div class="row">
            <span>
              <img src="/assets/themes/sys/default/img/5_Signatures.svg" />
            </span>
          </div>
          <div class="row mt-5">
            <codx-input
              type="radio"
              field="signatures"
              name="signature"
              crrValue="5"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="5 chữ ký"
            ></codx-input>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-5 d-flex justify-content-start">
      <h5 class="text-primary">
        <codx-label
          name="lblSignatureOrder"
          default="Chiều sắp xếp chữ ký"
        ></codx-label>
      </h5>
    </div>
    <div class="row m-5">
      <div class="col-6">
        <div class="row">
          <div class="col-6">
            <codx-input
              type="radio"
              field="signatureRoles"
              name="signatureOrder"
              crrValue="right"
              [checked]="true"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="Từ phải sang trái"
            ></codx-input>
          </div>
          <div class="col-6">
            <codx-input
              type="radio"
              field="signatureRoles"
              name="signatureOrder"
              crrValue="left"
              (valueChange)="valueRadio($event)"
              labelPosition="Right"
              label="Từ trái sang phải"
            ></codx-input>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="row mt-5 d-flex justify-content-start">
      <h5 class="text-primary"><codx-label name="lblSignatureList" default="Danh sách chữ ký"  ></codx-label></h5>
    </div>
    <div class="row mt-5">
      <ejs-grid [dataSource]='signatures' height='350'>
        <e-columns>
          <e-column field='index' headerText='STT' width='100' textAlign='Center'></e-column>
          <e-column field='role' headerText='Vai trò ký' width='220' textAlign='Center'></e-column>
          <e-column field='signer' headerText='Người ký' width='220' textAlign='Center'></e-column>
          <e-column field='description' headerText='Diễn giải' width='130'  textAlign='Left'></e-column>
      </e-columns>
      </ejs-grid>
    </div> -->
  </div>
</ng-template>

<ng-template #tabTemplate>
  <div class="form-group w-100">
    <h2>
      <codx-label
        name="lblExcelTemplate"
        formName="sys"
        default="Excel Template"
      ></codx-label>
    </h2>
    <h6 class="text-muted">
      <codx-label name="lblTemplates" default="Mẫu Template Excel"></codx-label>
    </h6>
  </div>
  <div class="containter mt-5">
    <div class="row w-100">
      <div
        class="d-flex align-items-start justify-content-between bg-light-success py-5 border"
        *ngFor="let item of dataEx"
      >
        <div class="d-flex align-items-top w-100">
          <div class="d-flex flex-column w-100">
            <div class="fw-bold text-dark">{{ item.templateName }}</div>
            <div class="fs-7 text-gray-500 text-italic">
              {{ item.description }}
            </div>
          </div>
        </div>
        <div class="d-flex align-items-start ms-6">
          <button
            type="button"
            class="btn btn-icon btn-sm btn-outline-primary"
            triggers="click"
            [autoClose]="true"
            [ngbTooltip]="tool"
            ngClass="border-0"
          >
            <span class="icon-more_vert icon-16"></span>
          </button>
          <ng-template #tool>
            <ng-container *ngFor="let x of moreFunction">
              <div
                class="d-flex p-2 cursor-pointer"
                (click)="editTemplate(x.id, item)"
              >
                <span
                  class="icon-16 me-2"
                  [ngClass]="x?.icon"
                  [style.color]="x?.textColor"
                ></span>
                <codx-label [fiedName]="x?.text"></codx-label>
              </div>
            </ng-container>
          </ng-template>
        </div>
      </div>
    </div>
    <div class="row h-25 w-100">
      <div class="d-flex justify-content-start">
        <button
          type="button"
          class="btn btn-light-primary mt-3"
          (click)="excelTemplate()"
        >
          <i class="icon-cloud_upload fs-5"></i
          ><span>
            <codx-label
              name="ExcelTemplate"
              formName="sys"
              default="Excel Template"
            ></codx-label>
          </span>
        </button>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #footer>
  <div class="w-100 d-flex">
    <div class="d-flex justify-content-start w-50">
      <button type="button" class="btn btn-light-info me-3" (click)="download()" *ngIf="data?.reportID">
        <i class="icon-i-cloud-download fs-5"></i><span>
          <codx-label name="lblDownloadRoot" formName="sys" default="Tải mẫu báo cáo gốc"></codx-label>
        </span>
      </button>
    </div>
    <div class="d-flex justify-content-end w-50">
      <button [disabled]="isBlockBtn" type="button" class="btn btn-primary ms-1" (click)="saveForm()">
        <codx-label name="lblSave" formName="sys" default="Lưu"></codx-label>
      </button>
    </div>
  </div>


</ng-template>
