<div class="row">
  <codx-kanban #kanban keyField="status" [dataSource]="dataSource" [columns]="columns"
    [columnTemplate]="columTemplate" [cardTemplate]="cardTemplate" [popupTemplate]="content"
    [swimlanes]="swimlaneSettings" [cardSettings]="cardSettings"
    (onDrag)="onDataDrag($event)">
  </codx-kanban>
</div>
<ng-template #cardTemplate let-data>
  <div class="card-template">
    <div class="e-card-header">
      <div class="e-card-header-caption">
        <div class="e-text">{{ data.dueDate | fmDT }}</div>
        <div class="e-text" [style.color]="data.textColor">
          {{ data.status | status }}
        </div>
        <div class="e-text" *ngIf="data.status != '8' && data.status != '9'">
          IsOverdue
        </div>
        <i
          class="lab la-font-awesome-flag"
          [style.color]="data.priorityColor"
        ></i>
        <div class="e-card-content">
          <div class="e-card-header-title">{{ data.taskName }}</div>
          <div class="d-flex" *ngIf="data.memo || data.memo2">
            <button (click)="viewMemo(data.id)">Xem mô tả chi tiết</button>
          </div>
          <div *ngIf="settings.CountObjects">
            <div class="e-text">Comments: {{ data.comments }}</div>
            <div class="e-text">Check list: {{ data.todo }}</div>
            <div class="e-text">Attachments: {{ data.attachments }}</div>
            <div class="e-card-avatar" *ngIf="data.category == '3' || data.category == '4'">{{ getString(data.userName) }}</div>
          </div>
          <div class="e-text">Comments: {{ data.comments }}</div>
          <div class="e-text">Attachments: {{ data.attachments }}</div>
        </div>
      </div>
    </div>

    <div class="e-card-custom-footer" *ngIf="cardId == data.id">
      <div class="e-text">{{ data.memo }}</div>
      <div class="e-text">{{ data.memo2 }}</div>
    </div>
  </div>
  <div class="content-box tm-box p-3 border">
    <div class="d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center flex-grow-1">
        <div class="d-flex align-items-center tm-date me-2">
          <span class="icon-access_time icon-16 text-muted me-1"></span>
          <span class="text-gray-500">{{ data.dueDate | fmDT }}</span>
        </div>
        <div class="me-2" [style.color]="data.textColor">{{ data.status | status }}</div>
      </div>
      <div class="d-flex align-items-end">
        <span class="icon-flag icon-20" [style.color]="data.priorityColor"></span>
        <div class="dropdown">
          <button class="btn btn-icon btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <span class="icon-more_vert icon-18"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item">
              <div class="d-flex align-items-center">
                <span class="icon-edit icon-16"></span>
                <span class="ms-3">Chỉnh sửa</span>
              </div>
            </a>
            <a class="dropdown-item">
              <div class="d-flex align-items-center">
                <span class="icon-delete icon-16"></span>
                <span class="ms-3">Xóa</span>
              </div>
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item">
              <div class="d-flex align-items-center">
                <span class="icon-attach_file icon-16"></span>
                <span class="ms-3">Đính kèm file</span>
              </div>
            </a>
          </div>
        </div>
      </div>

    </div>
    <div class="d-flex flex-column flex-grow-1 mt-3">
      <div class="d-flex flex-column flex-grow-1">
        <div class="text-dark fw-bold">
          {{ data.taskName }}
        </div>
        <div class="d-flex task-status mt-3">
          <span class="status-item primary"></span>
          <span class="status-item warning"></span>
          <span class="status-item info"></span>
        </div>
        <div class="progress mt-4" style="height: 5px">
          <div role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" class="progress-bar"
            style="width: 80%"></div>
        </div>
      </div>
      <div class="d-flex justify-content-between align-items-center mt-4">
        <div class="d-flex align-items-center me-2">
          <div class="d-flex align-items-center me-3">
            <span class="icon-mode_comment icon-18 text-gray-500 me-1"></span>
            <span class="text-gray-500">{{ data.comments }}</span>
          </div>
          <div class="d-flex align-items-center me-3">
            <span class="icon-check_box icon-18 text-gray-500 me-1"></span>
            <span class="text-gray-500">{{ data.todo }}</span>
          </div>
          <div class="d-flex align-items-center me-3">
            <span class="icon-attach_file icon-18 text-gray-500 me-1"></span>
            <span class="text-gray-500">{{ data.attachments }}</span>
          </div>
        </div>
        <div class="symbol-group symbol-hover justify-content-end">
          <div class="symbol symbol-24px symbol-circle">
            <codx-img #image objectId="ADMIN"></codx-img>
          </div>
          <div class="symbol symbol-24px symbol-circle">
            <codx-img #image objectId="ADMIN"></codx-img>
          </div>
          <div class="symbol symbol-24px symbol-circle">
            <codx-img #image objectId="ADMIN"></codx-img>
          </div>
          <div class="symbol symbol-24px symbol-circle symbol-light">
            <span class="symbol-label">5+</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #columTemplate let-data>
  <div class="header-template-wrap">
    <div class="header-icon e-icons {{ data.keyField }}"></div>
    <div class="header-text">{{ data.headerText }}</div>
  </div>
</ng-template>

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Drag & Drop</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <p>Bạn chắc chắn với hành động này không ?</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="submit($event, modal)">
      Đồng ý
    </button>
  </div>
</ng-template>

<ng-template #popupAdd let-modal>
  <div class="modal-header">
    <h4 class="modal-title">View</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <input type="text" [(ngModel)]="Sumary" placeholder="Nhập nội dung" />
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close(true)">
      Đồng ý
    </button>
  </div>
</ng-template>
