<codx-listview #listview [itemTemplate]="templateTask" funcId="" [pageSize]="100" service="TM"
  assemblyName="ERM.Business.TM" className="TaskBusiness" method="GetListDetailTasksAsync" [gridViewName]="'grvTasks'"
  entityName="TM_Tasks" title="group" groupBy="fieldGroup" type="listView" [selectFirst]="true" [data]="data">
</codx-listview>
<!-- <codx-listview #listview [itemTemplate]="templateTask" [selectFirst]="true" funcId="" [pageSize]="10"
            service="TM" assemblyName="ERM.Business.TM" className="TaskBusiness" method="GetListDetailTasksAsync"
            [predicate]="" [dataValue]="" type="listView" [gridViewName]="'grvTasks'" autoLoad="false"
            entityName="TM_Tasks" [data]="data" groupBy="createdOn">
          </codx-listview> -->

<ng-template #templateTask let-data>
  <div class="task-row py-3 px-6 ">
    <table class="table w-100 table-action-menu " >
      <tbody>
        <td class="w-400px">
          <div class="task-name mb-1 max-h-300px d-flex p-3 flex-grow-1 border-bottom task-active item-active" [style.background-color]="data?.taskID == itemSelected?.taskID ? '#F4F7FF' : '' " 
          (dblclick)="showControl(p2,data)" [ngbPopover]="popMorefunc" popoverClass="empPopoverClass" #p2="ngbPopover"
          placement="right left" container="body" autoClose="outside" triggers="manual">
            {{ data?.taskName }}</div>
        </td>
        <td class="w-100px">
          <div class="priority mb-1 max-h-70px" [class]="data?.priority|vll:'L0186':'icon'|async"
            [style.color]="(data?.priority|vll:'L0186':'color'|async)">{{ data?.priority }}</div>
        </td>
        <td class="w-150px">
          <div class="status mb-1 max-h-150px">{{ data?.status }}</div>
        </td>
        <td>
          <div class="w-200px ">
            <div class="dropdown ml-2" [class.dropdown-customv2]="data.memo" [ngbPopover]="popDetail" #p="ngbPopover"
              [openDelay]="500" (mouseenter)="PopoverDetail(p, data)" (mouseleave)="PopoverDetail(p, null)"
              placement="bottom" autoClose="outside">
              <button [disabled]="!data.memo" class="btn" type="button" id="dropdownShowDescription"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="icon-assignment icon-16 text-dark-50 mr-1"></span>
                <span *ngIf="data.memo" [innerHTML]="data.memo" class="task-des"></span>
                <span *ngIf="!data.memo" class="task-des">Mô tả công
                  việc</span>
              </button>
            </div>
          </div>
        </td>
        <td class="w-250px">
          <div class="d-flex align-items-center">
            <div class="symbol-group symbol-hover justify-content-end"
              *ngIf="data?.category == '1' || data?.category == '2'">
              <codx-img popoverClass="userPopoverClass" [ngbPopover]="popContent" placement="bottom"
                #empPopover="ngbPopover" [openDelay]="500" (mouseenter)="PopoverEmp(empPopover, data)"
                (mouseleave)="PopoverEmp(empPopover, null)" class="symbol symbol-30 symbol-circle ml-1"
                objectId="PMNHI" objectName="AD_Users" [numberImages]="4">
              </codx-img>
              
            </div>
            <!-- <div class="symbol-group symbol-hover justify-content-end"
          *ngIf="data?.category == '1' || data?.category == '2'">
          <codx-img class="symbol symbol-30 symbol-circle w-30px" [objectId]="data?.assignTo" objectType="AD_Users"
            width="40">
          </codx-img>
        </div> -->
          </div>
        </td>
        <td>
          <div class="d-flex align-items-center w-200px">
            <div class="text-dark font-weight-bold font-size-sm mr-1">
              Ngày hết hạn:
            </div>
            <div class="text-dark-50 font-size-sm">
              {{data.dueDate|date:'dd/MM/yyyy'}}
            </div>
          </div>
        </td>
        <td class="w-250px">
          <div class="d-flex align-items-center w-100px">
            <div class="d-flex align-items-center mr-3 {{data?.comments  ? 'text-success' : 'text-dark-50'}}">
              <span class="text-hover-primary icon-chat_bubble_outline icon-16"></span>
              <span class="ml-1"> {{data?.comments}}</span>
            </div>
            <div class="d-flex align-items-center mr-3 {{data?.todo ? 'text-success' : 'text-dark-50'}}">
              <span class="text-hover-primary icon-check-correct icon-16"></span>
              <span class="ml-1">
                {{data?.todo}}</span>
            </div>
            <div class="d-flex align-items-center {{data?.attachments ? 'text-success' : 'text-dark-50'}}">
              <span class="text-hover-primary icon-attach_file icon-16"></span>
              <span>
                {{data?.attachments}}
              </span>
            </div>
          </div>
        </td>
      </tbody>
    </table>
  </div>

  <!-- <div class="d-flex p-3 flex-grow-1 border-bottom task-active item-active">
     <more-funtion [data]="data" (clickAction)="onChangeStatusTask($event)">
    </more-funtion> 
    <div class="task-name mb-1 max-h-36px">{{ data?.taskName }}</div>
    <div class="priority mb-1 max-h-36px">
      <span class="icon-15 mr-2">
        <span [class]="data?.priority | vll: 'L0186':'icon' | async"
          [style.color]="data?.priority | vll: 'L0186':'color' | async"></span>
      </span>
    </div>
    <div class="task-status d-flex">
      <div class="label label-xxs label-pill label-inline label-light-danger mr-2 label-status"
        [style.border-color]="
      (data?.status | vll: 'L0614':'color' | async) + '30'
    " [style.background-color]="
      (data?.status | vll: 'L0614':'color' | async) + '30'
    " [style.color]="data?.status | vll: 'L0614':'color' | async" style="border: none">
        {{ data?.status | vll: "L0614":"text" | async }}
      </div>
      <span class="text-dark-50 font-size-md">
        {{ data?.createdOn | fmDT: "dmy" }}</span>
    </div>
    <div class="symbol symbol-40 symbol-circle mr-3">
      <codx-img class="symbol symbol-30 symbol-circle w-30px" [objectId]="data?.createdBy" objectType="AD_Users"
        width="40">
      </codx-img>
    </div>
    <div class="d-flex flex-column flex-grow-1">
      <div class="d-flex align-items-center justify-content-between">
        <div class="text-dark text-hover-primary font-weight-bold">
          {{ data.userName }}
        </div>

        
      </div>
      <span class="text-muted">{{ data.positionName }}</span>
      
      <div class="d-flex align-items-center justify-content-between">
        
        <div class="symbol-group symbol-hover justify-content-end"
          *ngIf="data?.category == '3' || data?.category == '4'">
          <lv-imageviewers class="symbol symbol-30 symbol-circle ml-1" [objectId]="data?.assignTo" objectName="AD_Users"
            [numberImages]="2">
          </lv-imageviewers>
        </div>
      </div>
    </div>
  </div> -->
</ng-template>

<ng-template #popMorefunc let-data>
  <a class="action-item" (click)="viewDetailTask(taskAction)" style="cursor: pointer">
    <div class="d-flex align-items-center btn-tooltip">
      <span class="icon-edit icon-18 ml-2 mr-2"></span>
      <span class="tooltiptext">Edit</span>
    </div>
  </a>
  <a class="action-item" (click)="copyDetailTask(taskAction)" style="cursor: pointer">
    <div class="d-flex align-items-center btn-tooltip">
      <span class="icon-content_copy icon-16 text-warning ml-2 mr-2"></span>
      <span class="tooltiptext">Copy</span>
    </div>
  </a>
  <a class="action-item" (click)="clickDelete(taskAction)" style="cursor: pointer">
    <div class="d-flex align-items-center btn-tooltip">
      <span class="icon-close icon-20 text-danger ml-2 mr-2"></span>
      <span class="tooltiptext">Delete</span>
    </div>
  </a>
  <a class="action-item" (click)="viewItem(taskAction)" style="cursor: pointer">
    <div class="d-flex align-items-center btn-tooltip">
      <span class="icon-visibility icon-20 text-primary ml-2 mr-2"></span>
      <span class="tooltiptext">Xem</span>
    </div>
  </a>
  <a class="action-item" (click)="setupStatus(p2,taskAction)" [ngbPopover]="setupStatusTask"
    popoverClass="empPopoverClass" #p2="ngbPopover" placement="right left" container="body" autoClose="outside"
    triggers="manual" style="cursor: pointer">
    <div class="d-flex align-items-center btn-tooltip">
      <span class="icon-add_box icon-20 text-dark ml-2 mr-2"></span>
      <span class="tooltiptext">Setup trạng thái </span>
    </div>
  </a>
</ng-template>

<ng-template #setupStatusTask>
  <div>
    <div>
      <a class="dropdown-item" (click)="ChangeStatusTask('9',taskAction)" style="cursor: pointer">
        <div class="d-flex align-items-center">
          <span class="icon-edit icon-18"></span>
          <span class="ml-3">Hoàn tất</span>
        </div>
      </a>
      <a class="dropdown-item">
        <div class="d-flex align-items-center" (click)="ChangeStatusTask('2',taskAction)" style="cursor: pointer">
          <span class="icon-content_copy icon-18"></span>
          <span class="ml-3">Đang thực hiện</span>
        </div>
      </a>
      <a class="dropdown-item" (click)="ChangeStatusTask('5',taskAction)" style="cursor: pointer">
        <div class="d-flex align-items-center">
          <span class="icon-delete icon-18"></span>
          <span class="ml-3">Hoãn lại</span>
        </div>
      </a>
      <a class="dropdown-item" (click)="ChangeStatusTask('8',taskAction)" style="cursor: pointer">
        <div class="d-flex align-items-center">
          <span class="icon-delete icon-18"></span>
          <span class="ml-3">Hủy</span>
        </div>
      </a>
    </div>
  </div>
</ng-template>

<ng-template #popContent let-data>
  <div>
    <ng-container>
      <div class="result-title text-dark font-size-h5 mb-5 mt-3">Phân công cho</div>
      <div class="task-list p10 full">
        <div class="d-flex align-items-start user-card p-3">
          <div class="symbol symbol-30px symbol-circle me-3">
            <codx-imgs [objectId]="data?.owner" objectType="AD_Users"></codx-imgs>
          </div>
          <div class="d-flex flex-column flex-grow-1">
            <div class="text-dark font-weight-bold">{{data?.ownerName}}</div>
            <div class="text-dark-50 font-size-sm">{{data?.position}}</div>
            <div class="text-dark">
              {{data?.memo2}}
            </div>
            <div class="d-flex align-items-center">
              <div class="d-flex align-items-center me-2">
                <span class="icon-access_time icon-16 text-muted"></span>
                <span class="text-muted">{{data?.dueDate | date:'dd/MM/yyyy'}}</span>
              </div>
              <div class="label label-xxs label-pill label-inline label-light-danger me-2 label-status"
                [style.border-color]="(data?.status | vll: 'L0614':'color' | async) + '30'"
                [style.background-color]="(data?.status | vll: 'L0614':'color' | async) + '30'"
                [style.color]="data?.status | vll: 'L0614':'color' | async" style="border: none">{{
                  data?.status | vll: "L0614":"text" | async }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

</ng-template>
<ng-template #popDetail>
  <div>
    <ng-container>
      <div class="d-flex flex-column flex-grow-1">
        <div class="result-title text-dark font-size-h5 mb-2">Mô tả chi tiết</div>
        <div class="text-dark-75 font-size-md">
          {{popoverDetail?.memo}}
          <div class="d-flex align-items-center mt-2">
            <div class="d-flex align-items-center me-2">
              <span class="icon-create icon-18 text-dark-50"></span>
              <span class="text-dark-50 text-italic"> {{popoverDetail?.memo2}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

</ng-template>
